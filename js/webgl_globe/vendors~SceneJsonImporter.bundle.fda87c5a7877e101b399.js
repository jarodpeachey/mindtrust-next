(window.webpackJsonp=window.webpackJsonp||[]).push([["vendors~SceneJsonImporter"],{319:function(e,t,s){"use strict";s.r(t),s.d(t,"SceneJsonImporter",(function(){return Ue}));class o{constructor(e){this.scene=e,this._masterCameraNodePath=null}setMasterCameraNodePath(e){this._masterCameraNodePath=e}masterCameraNodePath(){return this._masterCameraNodePath}masterCameraNode(){if(this.masterCameraNodePath){const e=this.masterCameraNodePath();if(!e)return this._find_any_camera();return this.scene.node(e)}return console.warn("master camera node not found"),this._find_any_camera()}_find_any_camera(){const e=this.scene.root();return e.nodesByType("perspectiveCamera")[0]||e.nodesByType("orthographicCamera")[0]}}class n{constructor(e){this._scene=e,this._queue=new Map,this._block_level=0,this._process_item_bound=this._process_item.bind(this),this._block_level=0}block(){this._block_level+=1}unblock(){this._block_level-=1,this._block_level<0&&(this._block_level=0),this.process_queue()}get blocked(){return this._block_level>0}enqueue(e,t){this._queue.set(e.graphNodeId(),t)}process_queue(){this.blocked||this._queue.forEach(this._process_item_bound)}_process_item(e,t){const s=this._scene.graph.node_from_id(t);s&&(this._queue.delete(t),s.dirtyController.run_post_dirty_hooks(e))}}class r{constructor(){this._cooking_nodes_by_id=new Map,this._resolves=[]}add_node(e){this._cooking_nodes_by_id.set(e.graphNodeId(),e)}remove_node(e){this._cooking_nodes_by_id.delete(e.graphNodeId()),0==this._cooking_nodes_by_id.size&&this.flush()}flush(){let e;for(;e=this._resolves.pop();)e()}async waitForCooksCompleted(){return 0==this._cooking_nodes_by_id.size?void 0:new Promise((e,t)=>{this._resolves.push(e)})}}class i{constructor(){this._next_id=0,this._successors=new Map,this._predecessors=new Map,this._nodes_by_id=new Map,this._nodesCount=0,this._debugging=!1,this._addedNodesDuringDebugging=new Map}startDebugging(){this._debugging=!0,console.log("CoreGraph.startDebugging",this._next_id)}stopDebugging(){this._debugging=!1,console.log("CoreGraph.stopDebugging",this._next_id)}printDebug(){this._addedNodesDuringDebugging.forEach((e,t)=>{console.log(t,e,e.graphPredecessors(),e.graphSuccessors())})}set_scene(e){this._scene=e}scene(){return this._scene}next_id(){return this._next_id+=1,this._next_id}nodes_from_ids(e){const t=[];for(let s of e){const e=this.node_from_id(s);e&&t.push(e)}return t}node_from_id(e){return this._nodes_by_id.get(e)}has_node(e){return null!=this._nodes_by_id.get(e.graphNodeId())}add_node(e){this._nodes_by_id.set(e.graphNodeId(),e),this._nodesCount+=1,this._debugging&&this._addedNodesDuringDebugging.set(e.graphNodeId(),e)}remove_node(e){this._nodes_by_id.delete(e.graphNodeId()),this._successors.delete(e.graphNodeId()),this._predecessors.delete(e.graphNodeId()),this._nodesCount-=1,this._debugging&&this._addedNodesDuringDebugging.delete(e.graphNodeId())}nodesCount(){return this._nodesCount}connect(e,t,s=!0){const o=e.graphNodeId(),n=t.graphNodeId();if(this.has_node(e)&&this.has_node(t)){if(s){s=!(!this._scene||this._scene.loadingController.isLoading())}let t=!1;return s&&(t=this._has_predecessor(o,n)),!t&&(this._create_connection(o,n),e.dirtyController.clear_successors_cache_with_predecessors(),!0)}return console.warn(`attempt to connect non existing node ${o} or ${n}`),!1}disconnect(e,t){this._remove_connection(e.graphNodeId(),t.graphNodeId()),e.dirtyController.clear_successors_cache_with_predecessors()}disconnect_predecessors(e){const t=this.predecessors(e);for(let s of t)this.disconnect(s,e)}disconnect_successors(e){const t=this.successors(e);for(let s of t)this.disconnect(e,s)}predecessor_ids(e){const t=this._predecessors.get(e);if(t){const e=[];return t.forEach((t,s)=>{e.push(s)}),e}return[]}predecessors(e){const t=this.predecessor_ids(e.graphNodeId());return this.nodes_from_ids(t)}successor_ids(e){const t=this._successors.get(e);if(t){const e=[];return t.forEach((t,s)=>{e.push(s)}),e}return[]}successors(e){const t=this.successor_ids(e.graphNodeId())||[];return this.nodes_from_ids(t)}all_predecessor_ids(e){return this.all_next_ids(e,"predecessor_ids")}all_successor_ids(e){return this.all_next_ids(e,"successor_ids")}all_predecessors(e){const t=this.all_predecessor_ids(e);return this.nodes_from_ids(t)}all_successors(e){const t=this.all_successor_ids(e);return this.nodes_from_ids(t)}_create_connection(e,t){let s=this._successors.get(e);if(s||(s=new Set,this._successors.set(e,s)),s.has(t))return;s.add(t);let o=this._predecessors.get(t);o||(o=new Set,this._predecessors.set(t,o)),o.add(e)}_remove_connection(e,t){let s=this._successors.get(e);s&&(s.delete(t),0==s.size&&this._successors.delete(e));let o=this._predecessors.get(t);o&&(o.delete(e),0==o.size&&this._predecessors.delete(t))}all_next_ids(e,t){const s=new Map,o=[];let n=this[t](e.graphNodeId());for(;n.length>0;){const e=[];for(let s of n)for(let o of this[t](s))e.push(o);for(let e of n)s.set(e,!0);for(let t of e)n.push(t);n=e}return s.forEach((e,t)=>{o.push(t)}),o}_has_predecessor(e,t){const s=this.predecessor_ids(e);if(s){if(s.includes(t))return!0;for(let e of s)return this._has_predecessor(e,t)}return!1}}class _{constructor(e){this._node=e,this._cooks_count=0,this._total_cook_time=0,this._total_inputs_time=0,this._total_params_time=0}update_cook_data(e){this._cooks_count+=1,this._total_cook_time+=e.cook_time,this._total_inputs_time+=e.inputs_time,this._total_params_time+=e.params_time}total_time(){return this._total_cook_time+this._total_inputs_time+this._total_params_time}total_cook_time(){return this._total_cook_time}cook_time_per_iteration(){return this._cooks_count>0?this._total_cook_time/this._cooks_count:0}total_inputs_time(){return this._total_inputs_time}inputs_time_per_iteration(){return this._cooks_count>0?this._total_inputs_time/this._cooks_count:0}total_params_time2(){return this._total_params_time}params_time_per_iteration2(){return this._cooks_count>0?this._total_params_time/this._cooks_count:0}cooks_count(){return this._cooks_count}print_object(){return{fullPath:this._node.fullPath(),cooks_count:this.cooks_count(),total_time:this.total_time(),total_cook_time:this.total_cook_time(),cook_time_per_iteration:this.cook_time_per_iteration(),inputs_time_per_iteration:this.inputs_time_per_iteration(),params_time_per_iteration:this.params_time_per_iteration2()}}}var a=s(25),d=s(59);class c{constructor(){this._started=!1,this._start_time=0,this._previous_timestamp=0,this._nodes_cook_data={},this._durations_by_name={},this._durations_count_by_name={}}profile(e,t){const s=performance.now();t();const o=performance.now()-s;console.log(`${e}: ${o}`)}start(){this._started||(this.reset(),this._started=!0,this._start_time=performance.now(),this._nodes_cook_data={},this._previous_timestamp=this._start_time)}stop(){this.reset()}reset(){this._started=!1,this._start_time=null,this._durations_by_name={},this._durations_count_by_name={},this._nodes_cook_data={}}started(){return this._started}record_node_cook_data(e,t){const s=e.graphNodeId();null==this._nodes_cook_data[s]&&(this._nodes_cook_data[s]=new _(e)),this._nodes_cook_data[s].update_cook_data(t)}record(e){this.started()||this.start();const t=performance.now();return null==this._durations_by_name[e]&&(this._durations_by_name[e]=0),this._durations_by_name[e]+=t-this._previous_timestamp,null==this._durations_count_by_name[e]&&(this._durations_count_by_name[e]=0),this._durations_count_by_name[e]+=1,this._previous_timestamp=t}print(){this.print_node_cook_data(),this.print_recordings()}print_node_cook_data(){let e=Object.values(this._nodes_cook_data);e=a.a.sortBy(e,e=>e.total_cook_time());const t=e.map(e=>e.print_object());console.log("--------------- NODES COOK TIME -----------");const s=[],o=a.a.sortBy(t,e=>-e.total_cook_time);for(let e of o)s.push(e);return console.table(s),t}print_recordings(){const e=d.a.clone(this._durations_by_name),t=d.a.clone(this._durations_count_by_name),s=[],o={};for(let t of Object.keys(e)){const n=e[t];s.push(n),null==o[n]&&(o[n]=[]),o[n].push(t)}s.sort((e,t)=>e-t);const n=a.a.uniq(s);console.log("--------------- PERF RECORDINGS -----------");const r=[];for(let e of n){const s=o[e];for(let o of s){const s=t[o],n={duration:e,name:o,count:s,duration_per_iteration:e/s};r.push(n)}}return console.table(r),r}}var h,l=s(20);class p{constructor(e){this.scene=e}setListener(e){this._events_listener?console.warn("scene already has a listener"):(this._events_listener=e,this.run_on_add_listener_callbacks())}onAddListener(e){this._events_listener?e():(this._on_add_listener_callbacks=this._on_add_listener_callbacks||[],this._on_add_listener_callbacks.push(e))}run_on_add_listener_callbacks(){if(this._on_add_listener_callbacks){let e;for(;e=this._on_add_listener_callbacks.pop();)e();this._on_add_listener_callbacks=void 0}}get eventsListener(){return this._events_listener}dispatch(e,t,s){var o;null===(o=this._events_listener)||void 0===o||o.process_events(e,t,s)}emitAllowed(){return null!=this._events_listener&&this.scene.loadingController.loaded()&&this.scene.loadingController.autoUpdating()}}class u{constructor(){this._params_by_id=new Map}register_param(e){this._params_by_id.set(e.graphNodeId(),e)}deregister_param(e){this._params_by_id.delete(e.graphNodeId())}regenerate_referring_expressions(e){e.nameController.graph_node.setSuccessorsDirty(e)}}class m{constructor(e){this.scene=e,this._lifecycle_on_create_allowed=!0}onCreateHookAllowed(){return this.scene.loadingController.loaded()&&this._lifecycle_on_create_allowed}onCreatePrevent(e){this._lifecycle_on_create_allowed=!1,e(),this._lifecycle_on_create_allowed=!0}}class f{constructor(e){this.dispatcher=e,this._nodes_by_graph_node_id=new Map,this._require_canvas_event_listeners=!1,this._active_event_types=[]}registerNode(e){this._nodes_by_graph_node_id.set(e.graphNodeId(),e),this.updateViewerEventListeners()}unregisterNode(e){this._nodes_by_graph_node_id.delete(e.graphNodeId()),this.updateViewerEventListeners()}processEvent(e){0!=this._active_event_types.length&&this._nodes_by_graph_node_id.forEach(t=>t.process_event(e))}updateViewerEventListeners(){this._update_active_event_types(),this._require_canvas_event_listeners&&this.dispatcher.scene.viewersRegister.traverseViewers(e=>{e.eventsController.updateEvents(this)})}activeEventTypes(){return this._active_event_types}_update_active_event_types(){const e=new Map;this._nodes_by_graph_node_id.forEach(t=>{if(t.parent()){const s=t.active_event_names();for(let t of s)e.set(t,!0)}}),this._active_event_types=[],e.forEach((e,t)=>{this._active_event_types.push(t)})}}!function(e){e.LOADED="sceneLoaded",e.PLAY="play",e.PAUSE="pause",e.TICK="tick"}(h||(h={}));const g=[h.LOADED,h.PLAY,h.PAUSE,h.TICK];class v extends f{type(){return"scene"}acceptedEventTypes(){return g.map(e=>""+e)}}class y{constructor(e){this.scene=e,this._loading_state=!1,this._auto_updating=!0,this._first_object_loaded=!1}get LOADED_EVENT_CONTEXT(){return this._LOADED_EVENT_CONTEXT=this._LOADED_EVENT_CONTEXT||{event:new Event(h.LOADED)}}markAsLoading(){this._set_loading_state(!0)}async markAsLoaded(){this.scene.missingExpressionReferencesController.resolve_missing_references(),await this._set_loading_state(!1),this.trigger_loaded_event()}trigger_loaded_event(){globalThis.Event&&this.scene.eventsDispatcher.sceneEventsController.processEvent(this.LOADED_EVENT_CONTEXT)}async _set_loading_state(e){this._loading_state=e,await this.set_auto_update(!this._loading_state)}isLoading(){return this._loading_state}loaded(){return!this._loading_state}autoUpdating(){return this._auto_updating}async set_auto_update(e){if(this._auto_updating!==e&&(this._auto_updating=e,this._auto_updating)){const e=this.scene.root();e&&await e.processQueue()}}on_first_object_loaded(){var e;if(!this._first_object_loaded){this._first_object_loaded=!0;const t=document.getElementById("scene_loading_container");t&&(null===(e=t.parentElement)||void 0===e||e.removeChild(t))}}}var b=s(21);class w{constructor(e,t){this.param=e,this.path=t}absolute_path(){return b.a.make_absolute_path(this.param.node,this.path)}matches_path(e){return this.absolute_path()==e}update_from_method_dependency_name_change(){var e;null===(e=this.param.expressionController)||void 0===e||e.update_from_method_dependency_name_change()}resolve_missing_dependencies(){const e=this.param.rawInputSerialized();this.param.set(this.param.defaultValue()),this.param.set(e)}}var E=s(52);class k{constructor(e){this.scene=e,this.references=new Map}register(e,t,s){const o=new w(e,s);return E.a.push_on_array_at_entry(this.references,e.graphNodeId(),o),o}deregister_param(e){this.references.delete(e.graphNodeId())}resolve_missing_references(){const e=[];this.references.forEach(t=>{for(let s of t)this._is_reference_resolvable(s)&&e.push(s)});for(let t of e)t.resolve_missing_dependencies()}_is_reference_resolvable(e){const t=e.absolute_path();if(t){if(this.scene.node(t))return!0;{const e=b.a.split_parent_child(t);if(e.child){const t=this.scene.node(e.parent);if(t){if(t.params.get(e.child))return!0}}}}}check_for_missing_references(e){this._check_for_missing_references_for_node(e);for(let t of e.params.all)this._check_for_missing_references_for_param(t)}_check_for_missing_references_for_node(e){const t=e.graphNodeId();this.references.forEach((s,o)=>{let n=!1;for(let t of s)t.matches_path(e.fullPath())&&(n=!0,t.resolve_missing_dependencies());n&&this.references.delete(t)})}_check_for_missing_references_for_param(e){const t=e.graphNodeId();this.references.forEach((s,o)=>{let n=!1;for(let t of s)t.matches_path(e.fullPath())&&(n=!0,t.resolve_missing_dependencies());n&&this.references.delete(t)})}}var N=s(34),C=s(38),A=s(8);class T extends C.a{static nodeContext(){return A.g.MANAGER}}var O=s(4),x=s(22);class L{constructor(e){this.scene=e}findObjectByMask(e){return this.findObjectByMaskInObject(e,this.scene.threejsScene())}findObjectByMaskInObject(e,t,s=""){for(let o of t.children){const t=this._removeTrailingOrHeadingSlash(o.name),n=`${s=this._removeTrailingOrHeadingSlash(s)}/${t}`;if(x.a.matchMask(n,e))return o;const r=this.findObjectByMaskInObject(e,o,n);if(r)return r}}objectsByMask(e){return this.objectsByMaskInObject(e,this.scene.threejsScene(),[],"")}objectsByMaskInObject(e,t,s=[],o=""){for(let n of t.children){const t=this._removeTrailingOrHeadingSlash(n.name),r=`${o=this._removeTrailingOrHeadingSlash(o)}/${t}`;x.a.matchMask(r,e)&&s.push(n),this.objectsByMaskInObject(e,n,s,r)}return s}_removeTrailingOrHeadingSlash(e){return"/"==e[0]&&(e=e.substr(1)),"/"==e[e.length-1]&&(e=e.substr(0,e.length-1)),e}}class S extends O.a{}const I=new S;class P extends T{constructor(){super(...arguments),this.params_config=I,this._object=new N.a,this._queued_nodes_by_id=new Map,this._children_controller_context=A.g.OBJ}static type(){return"obj"}initializeNode(){this._object.matrixAutoUpdate=!1,this.lifecycle.add_on_child_add_hook(this._on_child_add.bind(this)),this.lifecycle.add_on_child_remove_hook(this._on_child_remove.bind(this))}initDefaultScene(){this._object.name="/",this._scene.threejsScene().add(this._object)}object(){return this._object}createNode(e,t){return super.createNode(e,t)}children(){return super.children()}nodesByType(e){return super.nodesByType(e)}_addToQueue(e){const t=e.graphNodeId();return this._queued_nodes_by_id.has(t)||this._queued_nodes_by_id.set(t,e),e}async processQueue(){const e=new Map,t=[];this._queued_nodes_by_id.forEach((s,o)=>{const n=`_____${s.renderOrder}__${s.fullPath()}`;t.push(n),e.set(n,s)}),this._queued_nodes_by_id.clear();for(let s of t){const t=e.get(s);t&&(e.delete(s),this._addToScene(t))}}_update_object(e){return this.scene().loadingController.autoUpdating()?this._addToScene(e):this._addToQueue(e)}getParentForNode(e){if(e.attachableToHierarchy()){const t=e.io.inputs.input(0);return t?t.children_group:this._object}return null}_addToScene(e){var t;if(e.attachableToHierarchy()){const s=this.getParentForNode(e);s&&(e.usedInScene()?(null===(t=e.childrenDisplayController)||void 0===t||t.request_display_node_container(),e.addObjectToParent(s)):e.removeObjectFromParent())}}_removeFromScene(e){e.removeObjectFromParent()}areChildrenCooking(){const e=this.children();for(let t of e)if(t.cookController.isCooking()||t.isDisplayNodeCooking())return!0;return!1}addToParentTransform(e){this._update_object(e)}removeFromParentTransform(e){this._update_object(e)}_on_child_add(e){e&&this._update_object(e)}_on_child_remove(e){e&&this._removeFromScene(e)}}class M{constructor(e){this.scene=e,this._node_context_signatures={},this._instanciated_nodes_by_context_and_type={}}init(){this._root=new P(this.scene),this._root.initialize_base_and_node(),this._root.initDefaultScene()}root(){return this._root}_traverseNode(e,t){const s=e.children();if(s&&0!=s.length)for(let e of s)t(e),e.childrenController&&this._traverseNode(e,t)}clear(){var e;const t=this.root().children();for(let s of t)null===(e=this.root().childrenController)||void 0===e||e.removeNode(s)}node(e){return"/"===e?this.root():this.root().node(e)}allNodes(){let e=[this.root()],t=[this.root()],s=0;for(;t.length>0&&s<10;){const o=t.map(e=>e.childrenAllowed()?e.children():[]).flat();e=e.concat(o),t=o,s+=1}return e.flat()}nodesFromMask(e){const t=this.allNodes(),s=[];for(let o of t){const t=o.fullPath();x.a.matchMask(t,e)&&s.push(o)}return s}reset_node_context_signatures(){this._node_context_signatures={}}register_node_context_signature(e){e.childrenAllowed()&&e.childrenController&&(this._node_context_signatures[e.childrenController.node_context_signature()]=!0)}node_context_signatures(){return Object.keys(this._node_context_signatures).sort().map(e=>e.toLowerCase())}addToInstanciatedNode(e){const t=e.nodeContext(),s=e.type();this._instanciated_nodes_by_context_and_type[t]=this._instanciated_nodes_by_context_and_type[t]||{},this._instanciated_nodes_by_context_and_type[t][s]=this._instanciated_nodes_by_context_and_type[t][s]||{},this._instanciated_nodes_by_context_and_type[t][s][e.graphNodeId()]=e}removeFromInstanciatedNode(e){const t=e.nodeContext(),s=e.type();delete this._instanciated_nodes_by_context_and_type[t][s][e.graphNodeId()]}nodesByType(e){const t=[];return this._traverseNode(this.scene.root(),s=>{s.type()==e&&t.push(s)}),t}nodesByContextAndType(e,t){const s=[],o=this._instanciated_nodes_by_context_and_type[e];if(o){const e=o[t];if(e)for(let t of Object.keys(e))s.push(e[t])}return s}}var B=s(146);class D{constructor(e){this.scene=e}toJSON(e=!1){const t={},s={};for(let o of this.scene.nodesController.allNodes()){const n=new B.a(o);t[o.graphNodeId()]=n.toJSON(e);const r=o.params.all;for(let e of r)s[e.graphNodeId()]=e.toJSON()}return{nodes_by_graph_node_id:t,params_by_graph_node_id:s}}}var F,R=s(53);!function(e){e.auxclick="auxclick",e.click="click",e.contextmenu="contextmenu",e.dblclick="dblclick",e.mousedown="mousedown",e.mouseenter="mouseenter",e.mouseleave="mouseleave",e.mousemove="mousemove",e.mouseover="mouseover",e.mouseout="mouseout",e.mouseup="mouseup",e.pointerlockchange="pointerlockchange",e.pointerlockerror="pointerlockerror",e.select="select",e.wheel="wheel"}(F||(F={}));const j=[F.auxclick,F.click,F.contextmenu,F.dblclick,F.mousedown,F.mouseenter,F.mouseleave,F.mousemove,F.mouseover,F.mouseout,F.mouseup,F.pointerlockchange,F.pointerlockerror,F.select,F.wheel];class z extends f{constructor(){super(...arguments),this._require_canvas_event_listeners=!0}type(){return"mouse"}acceptedEventTypes(){return j.map(e=>""+e)}}var q=s(157);const U={visibleIf:{active:1},callback:e=>{K.PARAM_CALLBACK_update_register(e)}};class V extends q.a{constructor(){super(...arguments),this._active_event_names=[]}initializeBaseNode(){super.initializeBaseNode();this.lifecycle.add_on_add_hook(()=>{this.scene().eventsDispatcher.registerEventNode(this)}),this.lifecycle.add_delete_hook(()=>{this.scene().eventsDispatcher.unregisterEventNode(this)}),this.params.onParamsCreated("update_register",()=>{this._update_register()})}process_event(e){this.pv.active&&e.event&&this.dispatch_event_to_output(e.event.type,e)}static PARAM_CALLBACK_update_register(e){e._update_register()}_update_register(){this._update_active_event_names(),this.scene().eventsDispatcher.updateViewerEventListeners(this)}_update_active_event_names(){if(this._active_event_names=[],this.pv.active){const e=this.accepted_event_types();for(let t of e){const e=this.params.get(t);e&&e.value&&this._active_event_names.push(t)}}}active_event_names(){return this._active_event_names}}class K extends V{accepted_event_types(){return[]}}class X extends O.a{constructor(){super(...arguments),this.active=O.b.BOOLEAN(!0,{callback:e=>{$.PARAM_CALLBACK_update_register(e)}}),this.sep=O.b.SEPARATOR(null,{visibleIf:{active:!0}}),this.auxclick=O.b.BOOLEAN(0,U),this.click=O.b.BOOLEAN(0,U),this.contextmenu=O.b.BOOLEAN(0,U),this.dblclick=O.b.BOOLEAN(0,U),this.mousedown=O.b.BOOLEAN(1,U),this.mouseenter=O.b.BOOLEAN(0,U),this.mouseleave=O.b.BOOLEAN(0,U),this.mousemove=O.b.BOOLEAN(1,U),this.mouseover=O.b.BOOLEAN(0,U),this.mouseout=O.b.BOOLEAN(0,U),this.mouseup=O.b.BOOLEAN(1,U),this.pointerlockchange=O.b.BOOLEAN(0,U),this.pointerlockerror=O.b.BOOLEAN(0,U),this.select=O.b.BOOLEAN(0,U),this.wheel=O.b.BOOLEAN(0,U)}}const H=new X;class $ extends V{constructor(){super(...arguments),this.params_config=H}static type(){return"mouse"}accepted_event_types(){return j.map(e=>""+e)}initializeNode(){this.io.outputs.setNamedOutputConnectionPoints(j.map(e=>new R.a(e,R.b.MOUSE)))}}var Y;!function(e){e.pointerdown="pointerdown",e.pointermove="pointermove",e.pointerup="pointerup"}(Y||(Y={}));const J=[Y.pointerdown,Y.pointermove,Y.pointerup];class G extends f{constructor(){super(...arguments),this._require_canvas_event_listeners=!0}type(){return"pointer"}acceptedEventTypes(){return J.map(e=>""+e)}}class Q extends O.a{constructor(){super(...arguments),this.active=O.b.BOOLEAN(!0,{callback:e=>{Z.PARAM_CALLBACK_update_register(e)}}),this.sep=O.b.SEPARATOR(null,{visibleIf:{active:!0}}),this.pointerdown=O.b.BOOLEAN(1,U),this.pointermove=O.b.BOOLEAN(0,U),this.pointerup=O.b.BOOLEAN(0,U)}}const W=new Q;class Z extends V{constructor(){super(...arguments),this.params_config=W}static type(){return"pointer"}accepted_event_types(){return J.map(e=>""+e)}initializeNode(){this.io.outputs.setNamedOutputConnectionPoints(J.map(e=>new R.a(e,R.b.POINTER)))}}var ee,te,se=s(28);!function(e){e.SET_FRAME="setFrame"}(ee||(ee={})),function(e){e.TIME_REACHED="timeReached"}(te||(te={}));class oe extends O.a{constructor(){super(...arguments),this.active=O.b.BOOLEAN(!0,{callback:(e,t)=>{re.PARAM_CALLBACK_update_register(e)}}),this.sep=O.b.SEPARATOR(null,{visibleIf:{active:!0}}),this.sceneLoaded=O.b.BOOLEAN(1,U),this.play=O.b.BOOLEAN(1,U),this.pause=O.b.BOOLEAN(1,U),this.tick=O.b.BOOLEAN(1,U),this.sep0=O.b.SEPARATOR(),this.treachedTime=O.b.BOOLEAN(0,{callback:e=>{re.PARAM_CALLBACK_update_time_dependency(e)}}),this.reachedTime=O.b.INTEGER(10,{visibleIf:{treachedTime:1},range:[0,100]}),this.sep1=O.b.SEPARATOR(),this.setFrameValue=O.b.INTEGER(1,{range:[0,100]}),this.setFrame=O.b.BUTTON(null,{callback:e=>{re.PARAM_CALLBACK_setFrame(e)}})}}const ne=new oe;class re extends V{constructor(){super(...arguments),this.params_config=ne}static type(){return"scene"}accepted_event_types(){return g.map(e=>""+e)}dispose(){var e;null===(e=this.graph_node)||void 0===e||e.dispose(),super.dispose()}initializeNode(){this.io.inputs.setNamedInputConnectionPoints([new R.a(ee.SET_FRAME,R.b.BASE,this.onSetFrame.bind(this))]);const e=g.map(e=>new R.a(e,R.b.BASE));e.push(new R.a(te.TIME_REACHED,R.b.BASE)),this.io.outputs.setNamedOutputConnectionPoints(e),this.params.onParamsCreated("update_time_dependency",()=>{this.update_time_dependency()})}onSetFrame(e){this.scene().setFrame(this.pv.setFrameValue)}on_frame_update(){this.scene().time()>=this.pv.reachedTime&&this.dispatch_event_to_output(te.TIME_REACHED,{})}update_time_dependency(){this.pv.treachedTime?(this.graph_node=this.graph_node||new se.a(this.scene(),"scene_node_time_graph_node"),this.graph_node.addGraphInput(this.scene().timeController.graphNode),this.graph_node.addPostDirtyHook("time_update",this.on_frame_update.bind(this))):this.graph_node&&this.graph_node.graphDisconnectPredecessors()}static PARAM_CALLBACK_setFrame(e){e.onSetFrame({})}static PARAM_CALLBACK_update_time_dependency(e){e.update_time_dependency()}}var ie;!function(e){e.keydown="keydown",e.keypress="keypress",e.keyup="keyup"}(ie||(ie={}));const _e=[ie.keydown,ie.keypress,ie.keyup];class ae extends f{constructor(){super(...arguments),this._require_canvas_event_listeners=!0}type(){return"keyboard"}acceptedEventTypes(){return _e.map(e=>""+e)}}class de extends O.a{constructor(){super(...arguments),this.active=O.b.BOOLEAN(!0,{callback:(e,t)=>{he.PARAM_CALLBACK_update_register(e)}}),this.sep=O.b.SEPARATOR(null,{visibleIf:{active:!0}}),this.keydown=O.b.BOOLEAN(1,U),this.keypress=O.b.BOOLEAN(0,U),this.keyup=O.b.BOOLEAN(0,U)}}const ce=new de;class he extends V{constructor(){super(...arguments),this.params_config=ce}static type(){return"keyboard"}accepted_event_types(){return _e.map(e=>""+e)}initializeNode(){this.io.outputs.setNamedOutputConnectionPoints(_e.map(e=>new R.a(e,R.b.KEYBOARD)))}}class le{constructor(e){this.scene=e,this._controllers=[]}registerEventNode(e){const t=this._find_or_create_controller_for_node(e);t&&t.registerNode(e)}unregisterEventNode(e){const t=this._find_or_create_controller_for_node(e);t&&t.unregisterNode(e)}updateViewerEventListeners(e){const t=this._find_or_create_controller_for_node(e);t&&t.updateViewerEventListeners()}traverseControllers(e){for(let t of this._controllers)e(t)}_find_or_create_controller_for_node(e){switch(e.type()){case he.type():return this.keyboardEventsController;case $.type():return this.mouseEventsController;case Z.type():return this.pointerEventsController;case re.type():return this.sceneEventsController}}get keyboardEventsController(){return this._keyboard_events_controller=this._keyboard_events_controller||this._create_controller(ae)}get mouseEventsController(){return this._mouse_events_controller=this._mouse_events_controller||this._create_controller(z)}get pointerEventsController(){return this._pointer_events_controller=this._pointer_events_controller||this._create_controller(G)}get sceneEventsController(){return this._scene_events_controller=this._scene_events_controller||this._create_controller(v)}_create_controller(e){const t=new e(this);return this._controllers.includes(t)||this._controllers.push(t),t}}var pe,ue=s(12),me=s(150);class fe{constructor(e){this.scene=e,this._referenced_nodes_by_src_param_id=new Map,this._referencing_params_by_referenced_node_id=new Map,this._referencing_params_by_all_named_node_ids=new Map}set_reference_from_param(e,t){this._referenced_nodes_by_src_param_id.set(e.graphNodeId(),t),E.a.push_on_array_at_entry(this._referencing_params_by_referenced_node_id,t.graphNodeId(),e)}set_named_nodes_from_param(e){const t=e.decomposed_path.named_nodes();for(let s of t)E.a.push_on_array_at_entry(this._referencing_params_by_all_named_node_ids,s.graphNodeId(),e)}reset_reference_from_param(e){const t=this._referenced_nodes_by_src_param_id.get(e.graphNodeId());if(t){E.a.pop_from_array_at_entry(this._referencing_params_by_referenced_node_id,t.graphNodeId(),e);const s=e.decomposed_path.named_nodes();for(let t of s)E.a.pop_from_array_at_entry(this._referencing_params_by_all_named_node_ids,t.graphNodeId(),e);this._referenced_nodes_by_src_param_id.delete(e.graphNodeId())}}referencing_params(e){return this._referencing_params_by_referenced_node_id.get(e.graphNodeId())}referencing_nodes(e){const t=this._referencing_params_by_referenced_node_id.get(e.graphNodeId());if(t){const e=new Map;for(let s of t){const t=s.node;e.set(t.graphNodeId(),t)}const s=[];return e.forEach(e=>{s.push(e)}),s}}nodes_referenced_by(e){const t=new Set([ue.a.OPERATOR_PATH,ue.a.NODE_PATH]),s=[];for(let o of e.params.all)t.has(o.type())&&s.push(o);const o=new Map,n=[];for(let e of s)this._check_param(e,o,n);for(let e of n)o.set(e.node.graphNodeId(),e.node);const r=[];return o.forEach(e=>{r.push(e)}),r}_check_param(e,t,s){if(e instanceof me.a){const o=e.found_node(),n=e.found_param();return o&&t.set(o.graphNodeId(),o),void(n&&s.push(n))}}notify_name_updated(e){const t=this._referencing_params_by_all_named_node_ids.get(e.graphNodeId());if(t)for(let s of t)s.notify_path_rebuild_required(e)}notify_params_updated(e){const t=this._referencing_params_by_all_named_node_ids.get(e.graphNodeId());if(t)for(let s of t)s.options.is_selecting_param()&&s.notify_target_param_owner_params_updated(e)}}!function(e){e.MAX_FRAME_UPDATED="scene_maxFrameUpdated",e.REALTIME_STATUS_UPDATED="scene_realtime_status_updated",e.FRAME_UPDATED="scene_frame_updated",e.PLAY_STATE_UPDATED="scene_play_state_updated"}(pe||(pe={}));class ge{constructor(e){this.scene=e,this._frame=0,this._time=0,this._prev_performance_now=0,this._realtimeState=!0,this._maxFrame=600,this._maxFrameLocked=!1,this._playing=!1,this._graph_node=new se.a(e,"time controller")}get PLAY_EVENT_CONTEXT(){return this._PLAY_EVENT_CONTEXT=this._PLAY_EVENT_CONTEXT||{event:new Event(h.PLAY)}}get PAUSE_EVENT_CONTEXT(){return this._PAUSE_EVENT_CONTEXT=this._PAUSE_EVENT_CONTEXT||{event:new Event(h.PAUSE)}}get TICK_EVENT_CONTEXT(){return this._TICK_EVENT_CONTEXT=this._TICK_EVENT_CONTEXT||{event:new Event(h.TICK)}}get graphNode(){return this._graph_node}frame(){return this._frame}time(){return this._time}maxFrame(){return this._maxFrame}maxFrameLocked(){return this._maxFrameLocked}realtimeState(){return this._realtimeState}setMaxFrame(e){this._maxFrame=Math.floor(e),this.scene.dispatchController.dispatch(this._graph_node,pe.MAX_FRAME_UPDATED)}setMaxFrameLocked(e){this._maxFrameLocked=e,this.scene.dispatchController.dispatch(this._graph_node,pe.MAX_FRAME_UPDATED)}setRealtimeState(e){this._realtimeState=e,this.scene.dispatchController.dispatch(this._graph_node,pe.REALTIME_STATUS_UPDATED)}setTime(e,t=!0){if(e!=this._time){if(this._time=e,t){const e=Math.floor(60*this._time),t=this._ensureFrameWithinBounds(e);e!=t?this.setFrame(t,!0):this._frame=e}this.scene.dispatchController.dispatch(this._graph_node,pe.FRAME_UPDATED),this.scene.uniforms_controller.update_time_dependent_uniform_owners(),this.scene.cooker.block(),this.graphNode.setSuccessorsDirty(),this.scene.cooker.unblock(),this.scene.eventsDispatcher.sceneEventsController.processEvent(this.TICK_EVENT_CONTEXT)}}setFrame(e,t=!0){e!=this._frame&&(e=this._ensureFrameWithinBounds(e))!=this._frame&&(this._frame=e,t&&this.setTime(this._frame/60,!1))}setFrameToStart(){this.setFrame(ge.START_FRAME,!0)}incrementTimeIfPlaying(){this._playing&&(this.scene.root().areChildrenCooking()||this.incrementTime())}incrementTime(){if(this._realtimeState){const e=performance.now(),t=(e-this._prev_performance_now)/1e3,s=this._time+t;this._prev_performance_now=e,this.setTime(s)}else this.setFrame(this.frame()+1)}_ensureFrameWithinBounds(e){if(this._playing){if(this._maxFrameLocked&&e>this._maxFrame)return ge.START_FRAME}else{if(this._maxFrameLocked&&e>this._maxFrame)return this._maxFrame;if(e<ge.START_FRAME)return ge.START_FRAME}return e}playing(){return!0===this._playing}pause(){1==this._playing&&(this._playing=!1,this.scene.dispatchController.dispatch(this._graph_node,pe.PLAY_STATE_UPDATED),this.scene.eventsDispatcher.sceneEventsController.processEvent(this.PAUSE_EVENT_CONTEXT))}play(){!0!==this._playing&&(this._playing=!0,this._prev_performance_now=performance.now(),this.scene.dispatchController.dispatch(this._graph_node,pe.PLAY_STATE_UPDATED),this.scene.eventsDispatcher.sceneEventsController.processEvent(this.PLAY_EVENT_CONTEXT))}togglePlayPause(){this.playing()?this.pause():this.play()}}ge.START_FRAME=0;var ve=s(6);class ye{constructor(e){this.scene=e,this._time_dependent_uniform_owners={},this._time_dependent_uniform_owners_ids=null,this._resolution=new ve.a(1,1),this._resolution_dependent_uniform_owners={},this._resolution_dependent_uniform_owners_ids=[]}add_time_dependent_uniform_owner(e,t){this._time_dependent_uniform_owners[e]=t,this._time_dependent_uniform_owners_ids||(this._time_dependent_uniform_owners_ids=[]),this._time_dependent_uniform_owners_ids.includes(e)||this._time_dependent_uniform_owners_ids.push(e)}remove_time_dependent_uniform_owner(e){if(delete this._time_dependent_uniform_owners[e],this._time_dependent_uniform_owners_ids){const t=this._time_dependent_uniform_owners_ids.indexOf(e);t>=0&&this._time_dependent_uniform_owners_ids.splice(t,1)}}update_time_dependent_uniform_owners(){const e=this.scene.time();if(this._time_dependent_uniform_owners_ids)for(let t of this._time_dependent_uniform_owners_ids){this._time_dependent_uniform_owners[t].time.value=e}}add_resolution_dependent_uniform_owner(e,t){this._resolution_dependent_uniform_owners[e]=t,this._resolution_dependent_uniform_owners_ids||(this._resolution_dependent_uniform_owners_ids=[]),this._resolution_dependent_uniform_owners_ids.includes(e)||this._resolution_dependent_uniform_owners_ids.push(e),this._resolution&&this.update_resolution_dependent_uniforms(t)}remove_resolution_dependent_uniform_owner(e){if(delete this._resolution_dependent_uniform_owners[e],this._resolution_dependent_uniform_owners_ids){const t=this._resolution_dependent_uniform_owners_ids.indexOf(e);t>=0&&this._resolution_dependent_uniform_owners_ids.splice(t,1)}}update_resolution_dependent_uniform_owners(e){this._resolution.copy(e);for(let e of this._resolution_dependent_uniform_owners_ids){const t=this._resolution_dependent_uniform_owners[e];this.update_resolution_dependent_uniforms(t)}}update_resolution_dependent_uniforms(e){e.resolution.value.x=this._resolution.x*window.devicePixelRatio,e.resolution.value.y=this._resolution.y*window.devicePixelRatio}}class be{constructor(e){this.scene=e,this._viewers_by_id=new Map}registerViewer(e){this._viewers_by_id.set(e.id(),e)}unregisterViewer(e){this._viewers_by_id.delete(e.id())}traverseViewers(e){this._viewers_by_id.forEach(e)}}class we{constructor(){this._require_webgl2=!1}require_webgl2(){return this._require_webgl2}set_require_webgl2(){this._require_webgl2||(this._require_webgl2=!0,l.a.renderersController.setRequireWebGL2())}}var Ee=s(84);class ke{constructor(){this._params_by_id=new Map,this._assets_root=null}register_param(e){this._params_by_id.set(e.graphNodeId(),e)}deregister_param(e){this._params_by_id.delete(e.graphNodeId())}traverse_params(e){this._params_by_id.forEach((t,s)=>{e(t)})}root(){return this._assets_root}setRoot(e){""==e&&(e=null),this._assets_root=e}}class Ne{constructor(){this._threejsScene=new Ee.a,this._cameras_controller=new o(this),this._cooker=new n(this),this.cookController=new r,this._graph=new i,this._missing_expression_references_controller=new k(this),this._expressions_controller=new u,this._nodes_controller=new M(this),this._objects_controller=new L(this),this._references_controller=new fe(this),this._time_controller=new ge(this),this._read_only=!1,this._threejsScene.name="defaultScene",this._threejsScene.matrixAutoUpdate=!1,this._graph.set_scene(this),this.nodesController.init()}threejsScene(){return this._threejsScene}setUuid(e){return this._uuid=e}get uuid(){return this._uuid}setName(e){return this._name=e}name(){return this._name}get camerasController(){return this._cameras_controller}masterCameraNode(){return this.camerasController.masterCameraNode()}get cooker(){return this._cooker}get assets(){return this._assets_controller=this._assets_controller||new ke}async waitForCooksCompleted(){return this.cookController.waitForCooksCompleted()}get dispatchController(){return this._dispatch_controller=this._dispatch_controller||new p(this)}get eventsDispatcher(){return this._events_dispatcher=this._events_dispatcher||new le(this)}get graph(){return this._graph}get lifecycleController(){return this._lifecycle_controller=this._lifecycle_controller||new m(this)}get loadingController(){return this._loading_controller=this._loading_controller||new y(this)}get missingExpressionReferencesController(){return this._missing_expression_references_controller}get expressionsController(){return this._expressions_controller}get nodesController(){return this._nodes_controller}nodesByType(e){return this.nodesController.nodesByType(e)}get objectsController(){return this._objects_controller}findObjectByMask(e){return this._objects_controller.findObjectByMask(e)}objectsByMask(e){return this._objects_controller.objectsByMask(e)}get referencesController(){return this._references_controller}get performance(){return this._performance=this._performance||new c}get viewersRegister(){return this._viewers_register=this._viewers_register||new be(this)}get timeController(){return this._time_controller}setFrame(e){this.timeController.setFrame(e)}setFrameToStart(){this.timeController.setFrameToStart()}frame(){return this.timeController.frame()}time(){return this.timeController.time()}maxFrame(){return this.timeController.maxFrame()}play(){this.timeController.play()}pause(){this.timeController.pause()}get serializer(){return this._serializer=this._serializer||new D(this)}toJSON(){return this.serializer.toJSON()}markAsReadOnly(e){this._read_only||(this._read_only_requester=e,this._read_only=!0)}readOnly(){return this._read_only}readOnlyRequester(){return this._read_only_requester}get uniforms_controller(){return this._uniforms_controller=this._uniforms_controller||new ye(this)}get webgl_controller(){return this._webgl_controller=this._webgl_controller||new we}batchUpdates(e){this._cooker.block(),e(),this._cooker.unblock()}node(e){return this.nodesController.node(e)}root(){return this.nodesController.root()}}class Ce{constructor(e){this._param=e}process_data(e){const t=e.raw_input;void 0!==t&&this._param.set(t),this.add_main(e)}add_main(e){}static spare_params_data(e){return this.params_data(!0,e)}static non_spare_params_data_value(e){return this.params_data_value(!1,e)}static params_data(e,t){let s;if(t){s={};const e=Object.keys(t);let o;for(let n of e)o=t[n],o&&(s[n]=t)}return s}static params_data_value(e,t){let s;if(t){s={};const o=Object.keys(t);let n;for(let r of o)if(n=t[r],null!=n){const t=n.options,o=n.overriden_options;if(t||o){const i=n;t&&t.spare==e?null!=i.raw_input&&(s[r]={complex_data:i}):o&&(s[r]={complex_data:i})}else{const e=n;(o||null!=e)&&(s[r]={simple_data:e})}}}return s}}var Ae=s(105),Te=s(7);class Oe{constructor(e){this._node=e,this._nodes=[],this._optimized_root_node_names=new Set,this._operation_containers_by_name=new Map,this._node_inputs=[]}nodes(){return this._nodes}process_data(e,t){var s,o,n;if(!t)return;if(!this._node.childrenAllowed()||!this._node.childrenController)return;const{optimized_names:r}=Oe.child_names_by_optimized_state(t);this._nodes=[],this._optimized_root_node_names=new Set;for(let e of r)Oe.is_optimized_root_node(t,e)&&this._optimized_root_node_names.add(e);for(let r of this._optimized_root_node_names){const i=t[r],_=this._node.createNode(Ae.b);if(_){_.setName(r),this._nodes.push(_),(null===(s=i.flags)||void 0===s?void 0:s.display)&&(null===(n=null===(o=_.flags)||void 0===o?void 0:o.display)||void 0===n||n.set(!0));const t=this._create_operation_container(e,_,i,_.name());_.set_output_operation_container(t)}}for(let s of this._nodes){const o=s.output_operation_container();if(o){this._node_inputs=[],this._add_optimized_node_inputs(e,s,t,s.name(),o),s.io.inputs.setCount(this._node_inputs.length);for(let e=0;e<this._node_inputs.length;e++)s.setInput(e,this._node_inputs[e])}}}_add_optimized_node_inputs(e,t,s,o,n){var r;const i=s[o],_=i.inputs;if(_){for(let o of _)if(Te.a.isString(o)){const i=s[o];if(i)if(Oe.is_node_optimized(i)&&!this._optimized_root_node_names.has(o)){let r=this._operation_containers_by_name.get(o);r||(r=this._create_operation_container(e,t,i,o),r&&this._add_optimized_node_inputs(e,t,s,o,r)),n.add_input(r)}else{const e=null===(r=t.parent())||void 0===r?void 0:r.node(o);if(e){this._node_inputs.push(e);const s=this._node_inputs.length-1;t.add_input_config(n,{operation_input_index:n.current_input_index(),node_input_index:s}),n.increment_input_index()}}}1==i.cloned_state_overriden&&n.override_input_clone_state(i.cloned_state_overriden)}}static child_names_by_optimized_state(e){const t=Object.keys(e),s=[],o=[];for(let n of t){const t=e[n];l.a.playerMode()&&this.is_node_optimized(t)?s.push(n):o.push(n)}return{optimized_names:s,non_optimized_names:o}}static is_optimized_root_node_generic(e){return 0==e.outputs_count||e.non_optimized_count>0}static is_optimized_root_node(e,t){const s=this.node_outputs(e,t);let o=0;return s.forEach(t=>{const s=e[t];this.is_node_optimized(s)||o++}),this.is_optimized_root_node_generic({outputs_count:s.size,non_optimized_count:o})}static is_optimized_root_node_from_node(e){var t,s,o,n;if(!(null===(s=null===(t=e.flags)||void 0===t?void 0:t.optimize)||void 0===s?void 0:s.active()))return!1;const r=e.io.connections.outputConnections().map(e=>e.node_dest);let i=0;for(let e of r)(null===(n=null===(o=e.flags)||void 0===o?void 0:o.optimize)||void 0===n?void 0:n.active())||i++;return this.is_optimized_root_node_generic({outputs_count:r.length,non_optimized_count:i})}static node_outputs(e,t){const s=Object.keys(e),o=new Set;for(let n of s)if(n!=t){const s=e[n].inputs;if(s)for(let e of s)if(Te.a.isString(e)){e==t&&o.add(n)}}return o}_create_operation_container(e,t,s,o){const n=Ce.non_spare_params_data_value(s.params),r=Oe.operation_type(s),i=this._node.create_operation_container(r,o,n);return i&&(this._operation_containers_by_name.set(o,i),i.path_param_resolve_required()&&(t.add_operation_container_with_path_param_resolve_required(i),e.add_operations_composer_node_with_path_param_resolve_required(t))),i}static operation_type(e){return Oe.is_node_bypassed(e)?"null":e.type}static is_node_optimized(e){const t=e.flags;return!(!t||!t.optimize)}static is_node_bypassed(e){const t=e.flags;return!(!t||!t.bypass)}}class xe{constructor(e){this._node=e}process_data(e,t){var s;if(!t)return;if(!this._node.childrenAllowed()||!this._node.childrenController)return;const{optimized_names:o,non_optimized_names:n}=Oe.child_names_by_optimized_state(t),r=[];for(let s of n){const o=t[s];let n=o.type.toLowerCase();const i=Ce.non_spare_params_data_value(o.params);try{const e=this._node.createNode(n,i);e&&(e.setName(s),r.push(e))}catch(t){console.error("error importing node: cannot create with type "+n,t);const o=x.a.camelCase(n);try{const e=this._node.createNode(o,i);e&&(e.setName(s),r.push(e))}catch(t){e.report.add_warning(`failed to create node with type '${n}' or '${o}'`),l.a.warn("failed to create node with type",n,"or",o,t)}}}if(o.length>0){const o=new Oe(this._node);if(o.process_data(e,t),this._node.childrenController.context==A.g.SOP){const e=Object.keys(t);let n=void 0;for(let o of e){(null===(s=t[o].flags)||void 0===s?void 0:s.display)&&(n=o)}if(n){const e=r.map(e=>e.name()),t=o.nodes();for(let s of t)e.push(s.name());if(!e.includes(n)){const e=`node '${`${this._node.fullPath()}/${n}`}' with display flag has been optimized and does not exist in player mode`;console.error(e)}}}}const i=new Map;for(let s of r){if(t[s.name()]){const o=ze.dispatch_node(s);i.set(s.name(),o),o.process_data(e,t[s.name()])}else l.a.warn("possible import error for node "+s.name())}for(let e of r){const s=i.get(e.name());s&&s.process_inputs_data(t[e.name()])}}}const Le=["overriden_options","type"];class Se{constructor(e){this._node=e}process_data(e,t){if(this.set_connection_points(t.connection_points),this._node.childrenAllowed()&&this.create_nodes(e,t.nodes),this.set_selection(t.selection),this._node.io.inputs.overrideClonedStateAllowed()){const e=t.cloned_state_overriden;e&&this._node.io.inputs.overrideClonedState(e)}this.set_flags(t),this.set_params(t.params),t.persisted_config&&this.set_persisted_config(t.persisted_config),this.from_data_custom(t)}process_inputs_data(e){const t=e.maxInputsCount;null!=t&&this._node.io.inputs.setCount(1,t),this.setInputs(e.inputs)}process_ui_data(e,t){if(!t)return;if(l.a.playerMode())return;const s=this._node.uiData,o=t.pos;if(o){const e=(new ve.a).fromArray(o);s.setPosition(e)}const n=t.comment;n&&s.setComment(n),this._node.childrenAllowed()&&this.process_nodes_ui_data(e,t.nodes)}create_nodes(e,t){if(!t)return;new xe(this._node).process_data(e,t)}set_selection(e){if(this._node.childrenAllowed()&&this._node.childrenController&&e&&e.length>0){const t=[];e.forEach(e=>{const s=this._node.node(e);s&&t.push(s)}),this._node.childrenController.selection.set(t)}}set_flags(e){var t,s,o,n,r,i;const _=e.flags;if(_){const e=_.bypass;null!=e&&(null===(s=null===(t=this._node.flags)||void 0===t?void 0:t.bypass)||void 0===s||s.set(e));const a=_.display;null!=a&&(null===(n=null===(o=this._node.flags)||void 0===o?void 0:o.display)||void 0===n||n.set(a));const d=_.optimize;null!=d&&(null===(i=null===(r=this._node.flags)||void 0===r?void 0:r.optimize)||void 0===i||i.set(d))}}set_connection_points(e){e&&(e.in&&this._node.io.saved_connection_points_data.set_in(e.in),e.out&&this._node.io.saved_connection_points_data.set_out(e.out),this._node.io.has_connection_points_controller&&this._node.io.connection_points.update_signature_if_required())}setInputs(e){if(!e)return;let t;for(let s=0;s<e.length;s++)if(t=e[s],t&&this._node.parent())if(Te.a.isString(t)){const e=t,o=this._node.nodeSibbling(e);this._node.setInput(s,o)}else{const e=this._node.nodeSibbling(t.node),s=t.index;this._node.setInput(s,e,t.output)}}process_nodes_ui_data(e,t){if(!t)return;if(l.a.playerMode())return;const s=Object.keys(t);for(let o of s){const s=this._node.node(o);if(s){const n=t[o];ze.dispatch_node(s).process_ui_data(e,n)}}}set_params(e){if(!e)return;const t=Object.keys(e),s={};for(let o of t){const t=e[o],n=t.options;0;const r=t.type;let i,_=!1;this._node.params.has_param(o)&&(i=this._node.params.get(o),(i&&i.type()==r||null==r)&&(_=!0)),_?this._is_param_data_complex(t)?this._process_param_data_complex(o,t):this._process_param_data_simple(o,t):(s.names_to_delete=s.names_to_delete||[],s.names_to_delete.push(o),s.to_add=s.to_add||[],s.to_add.push({name:o,type:r,init_value:t.default_value,raw_input:t.raw_input,options:n}))}const o=s.names_to_delete&&s.names_to_delete.length>0,n=s.to_add&&s.to_add.length>0;if(o||n){this._node.params.update_params(s);for(let t of this._node.params.spare){const s=e[t.name()];!t.parent_param&&s&&(this._is_param_data_complex(s)?this._process_param_data_complex(t.name(),s):this._process_param_data_simple(t.name(),s))}}this._node.params.runOnSceneLoadHooks()}_process_param_data_simple(e,t){var s;null===(s=this._node.params.get(e))||void 0===s||s.set(t)}_process_param_data_complex(e,t){const s=this._node.params.get(e);s&&ze.dispatch_param(s).process_data(t)}_is_param_data_complex(e){if(Te.a.isString(e)||Te.a.isNumber(e)||Te.a.isArray(e)||Te.a.isBoolean(e))return!1;if(Te.a.isObject(e)){const t=Object.keys(e);for(let e of Le)if(t.includes(e))return!0}return!1}set_persisted_config(e){this._node.persisted_config&&this._node.persisted_config.load(e)}from_data_custom(e){}}class Ie extends Ce{add_main(e){}}const Pe=/\\n+/g;class Me extends Ce{add_main(e){let t=e.raw_input;void 0!==t&&(t=t.replace(Pe,"\n"),this._param.set(t))}}class Be extends Ce{add_main(e){const t=e.raw_input;t&&this._param.set(t)}}var De=s(62),Fe=s(151),Re=s(79);class je extends Se{create_nodes(e,t){const s=this._node.polyNodeController;s&&s.createChildNodesFromDefinition()}}class ze{static dispatch_node(e){return e.polyNodeController?new je(e):new Se(e)}static dispatch_param(e){return e instanceof De.a?new Ie(e):e instanceof Fe.a?new Me(e):e instanceof Re.a?new Be(e):new Ce(e)}}class qe{constructor(e){this._warnings=[]}warnings(){return this._warnings}reset(){this._warnings=[]}add_warning(e){this._warnings.push(e)}}class Ue{constructor(e){this._data=e,this.report=new qe(this)}static async loadData(e){const t=new Ue(e);return await t.scene()}async scene(){const e=new Ne;e.loadingController.markAsLoading();const t=this._data.properties;if(t){const s=t.maxFrame||600;e.timeController.setMaxFrame(s);const o=t.maxFrameLocked;o&&e.timeController.setMaxFrameLocked(o);const n=t.realtimeState;null!=n&&e.timeController.setRealtimeState(n),e.setFrame(t.frame||ge.START_FRAME),t.masterCameraNodePath&&e.camerasController.setMasterCameraNodePath(t.masterCameraNodePath)}e.cooker.block(),this._base_operations_composer_nodes_with_resolve_required=void 0;const s=ze.dispatch_node(e.root());return this._data.root&&s.process_data(this,this._data.root),this._data.ui&&s.process_ui_data(this,this._data.ui),this._resolve_operation_containers_with_path_param_resolve(),await e.loadingController.markAsLoaded(),e.cooker.unblock(),e}add_operations_composer_node_with_path_param_resolve_required(e){this._base_operations_composer_nodes_with_resolve_required||(this._base_operations_composer_nodes_with_resolve_required=[]),this._base_operations_composer_nodes_with_resolve_required.push(e)}_resolve_operation_containers_with_path_param_resolve(){if(this._base_operations_composer_nodes_with_resolve_required)for(let e of this._base_operations_composer_nodes_with_resolve_required)e.resolve_operation_containers_path_params()}}}}]);
//# sourceMappingURL=vendors~SceneJsonImporter.bundle.fda87c5a7877e101b399.js.map