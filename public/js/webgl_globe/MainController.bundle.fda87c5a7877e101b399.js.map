{"version":3,"sources":["webpack:///./src/controllers/MaterialsController.ts","webpack:///./src/core/TimelinePosition.ts","webpack:///./src/controllers/AnimationController.ts","webpack:///./src/core/Easing.ts","webpack:///./src/controllers/IntroController.ts","webpack:///./src/core/Sleep.ts","webpack:///./src/controllers/ObjectsController.ts","webpack:///./src/controllers/PrecompileController.ts","webpack:///./src/controllers/TweensController.ts","webpack:///./src/controllers/TimelinesController.ts","webpack:///./src/controllers/VisibilityController.ts","webpack:///./src/core/VisibilityChecker.ts","webpack:///./src/MainController.ts","webpack:///./src/controllers/FeaturesController.ts","webpack:///./src/controllers/SilosController.ts","webpack:///./src/controllers/HTMLController.ts"],"names":["main_controller","bg_node_original_opacity","sphere_original_opacity","FeaturesController","not_transparent","this","scene","bg_node","node","bg","material","sphere_node","sphere","arcs_node","arcs","selected_dots_node","selected_dots","dots_node","dots","dots_intro_node","dots_intro","role_colors","uniforms","v_POLY_param_color_role0_val","value","v_POLY_param_color_role1_val","v_POLY_param_color_role2_val","v_POLY_param_color_role3_val","v_POLY_param_color_role4_val","v_POLY_param_color_role5_val","pulse_shadow_node","pulse_shadow","reset","p","opacity","set","v_POLY_param_threshold_val","v_POLY_param_visibles_count_val","VISIBLE_ARCS_COUNT","VISIBLE_DOTS_COUNT","v_POLY_param_sparkle_center_val","v_POLY_param_sparkle_color_val","r","g","b","v_POLY_param_sparkle_intensity_val","v_POLY_param_sparkle_radius_val","mat","v_POLY_param_radius_val","v_POLY_param_baseopacity_val","PULSE_OPACITY_START","_set_mat_to_objects","objects","materials","object","TimelinePosition","delta","Math","abs","at_start_of_most_recently_added_animation","at_end_of_most_recently_added_animation","position","selected_dot_distance_to_next","_dot1_pos","Vector3","_dot2_pos","dot_pos","dot_pos2d","Vector2","ry_obj_node","selected_dots_obj_node","selected_dots_sop_node","_load_objects","_reset_css_objects","master_timeline","pause","play","css_objects_node","css_objects_core_group","requestContainer","css_objects","coreContent","css_object_inner_containers","map","css_object","element","children","core_group","selected_dots_points","points","selected_dot_angles","i","length","dot","nextDot","_distanceBetweenDots","angle","_angle","push","kill","tweens","style","_reset","timeline","id","onComplete","setTimeout","start","window","total_iterations_count","isLast","arc_timeline","timelines","create_timeline","undefined","relative_to_end_of_recently_added_animation","add","dot1","dot2","getPosition","distanceTo","localToWorld","y","normalize","x","z","roundAngle","PI","floor","angleRef","rotations","EasingName","EasingInOutMode","DURATION","SKIP_INTRO","shadow","cookController","waitForCooksCompleted","time","Promise","resolve","reject","sleep","html","move_profiles_to_css_objects","viewer","setAutoRender","pre_compile","render_default_dots","_start_intro_animation","v_POLY_param_progress_val","main_timeline","_on_completed","timeline1","timeline2","dots_mat","bg_mat","sphere_mat","camera_node","vars_dots_mat","duration","ease","NONE","to","camera","original_fov","fov","updateProjectionMatrix","cam_params","POWER3","OUT","onUpdate","absolute","vars_bg_mat","POWER2","vars_sphere_mat","ARCS_ANIM","set_dots_to_default_mat","animation","ObjectsController","_pulse_objects","dots_out_sop","pulse_objects_node","pulse_objects_core_group","pulse_mat","objectsWithGeo","index","object_shadow","PrecompileController","updateMatrix","set_dots_to_intro_mat","EASING","ROTATION","IN_OUT","ARC","DOT","PULSE","CSS","WAVE","RADIUS","INTENSITY_UP","POWER4","INTENSITY_DOWN","TRAILS_DOWN","GROW","FADE","RADIUS_INCREASE","prev_rotation_angle","wave_timelines","prev_angle","nearestAngleTo","threshold","MATRIX_AUTO_UPDATE","matrixAutoUpdate","vars_rot","onStart","rotation","selected_dots_mat","vars_dot_start","vars_dot_end","pulse_object","vars_grow_pulse","v_POLY_param_id_val","reset_pulse_mat","vars_fade_pulse","proxy","vars_css_object","vars_prev_css_object","max","arcs_mat","vars_arc","point","role","attribValue","color","wave_timeline","v_POLY_param_trail_intensity_val","copy","previous_wave_timeline","vars_sparkle_radius_increase","vars_sparkle_intensity_decrease","vars_trail_intensity_decrease","_start_dot_timeline","_arc_timeline","_end_dot_timeline","rotation_duration","_rotate_to_start_dot","_show_start_dot","_show_start_css_object","_rotate_to_end_dot","_show_arc","_pulse_timeline","_show_end_dot","_show_end_css_object","_hide_css_object","_start_wave","rotate_to_dot","show_start_dot","show_end_dot","show_arc","show_css_object","relative_to_start_of_recently_added_animation","hide_css_object","pulse_timeline","grow_pulse","fade_pulse","start_wave","mainController","bound_listener","on_scroll","bind","remove_events","set_onscroll_events","check_globe_visibility","init","addEventListener","removeEventListener","el","top","offsetTop","left","offsetLeft","width","offsetWidth","height","offsetHeight","pageYOffset","innerHeight","pageXOffset","innerWidth","intersectsWithViewport","HTMLController","intro","visibility","_playing","_debug","setFrame","debug","console","log","queryString","location","search","URLSearchParams","get","small","app","document","getElementById","ID_APP","classList","GSAP_DEBUG","SiloRole","SiloRoleName","SILO_ROLE_NAMES","STRATEGY","DESIGN","DEVELOPMENT","MARKETING","PRODUCTION","TECHNOLOGY","SiloLocation","SILOS_BY_NAME","Map","NEW_YORK","tag","rx","ry","LONDON","BERLIN","KIEV","BOSTON","TEL_AVIV","BANGALORE","BANGKOK","SYDNEY","SEATTLE","SAN_JOSE","MEDELLIN","BUENOS_AIRES","CAPE_TOWN","silos","locations","_core_transform","T","S","silo","_silo_data","start_pos","applyMatrix4","_matrix","toArray","matrix","XYZ","app_element","warn","globe_profiles_element","ID_PROFILES","mock_html","_create_profile_templates","elements_parent","silos_controller","css_object_element","selector","profile_wrapper","querySelector","profile_element","css_object_element_child","innerHTML","appendChild","cloneNode","container","forEach","template","_profile_template","append","attribs","wrapper","createElement","dataset","main_element","thumbnail","setAttribute","body","title_and_name","title","name","role_s","toString","toLowerCase","innerText"],"mappings":"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","file":"MainController.bundle.fda87c5a7877e101b399.js","sourcesContent":["import {PolySceneWithNodeMap} from '../polygonjs/scenes/default/PolySceneWithNodeMap';\nimport {ShaderMaterialWithCustomMaterials} from '@polygonjs/polygonjs/src/core/geometry/Material';\nimport {Vector3} from 'three/src/math/Vector3';\nimport {Color} from 'three/src/math/Color';\nimport {MeshBasicMaterial} from 'three/src/materials/MeshBasicMaterial';\nimport {MeshLambertMaterial} from 'three/src/materials/MeshLambertMaterial';\nimport {MainController} from '../MainController';\nimport {MeshBasicMatNode} from '@polygonjs/polygonjs/src/engine/nodes/mat/MeshBasic';\nimport {MeshLambertMatNode} from '@polygonjs/polygonjs/src/engine/nodes/mat/MeshLambert';\nimport {FeaturesController} from './FeaturesController';\nimport {Object3D} from 'three/src/core/Object3D';\nimport {Mesh} from 'three/src/objects/Mesh';\nimport {Material} from 'three/src/materials/Material';\n\ninterface ArcsMat extends ShaderMaterialWithCustomMaterials {\n\tuniforms: {\n\t\tv_POLY_param_threshold_val: {value: number};\n\t\tv_POLY_param_visibles_count_val: {value: number};\n\t};\n}\ninterface SelectedDotsMat extends ShaderMaterialWithCustomMaterials {\n\tuniforms: {\n\t\tv_POLY_param_threshold_val: {value: number};\n\t\tv_POLY_param_visibles_count_val: {value: number};\n\t\tv_POLY_param_color_role0_val: {value: Color};\n\t\tv_POLY_param_color_role1_val: {value: Color};\n\t\tv_POLY_param_color_role2_val: {value: Color};\n\t\tv_POLY_param_color_role3_val: {value: Color};\n\t\tv_POLY_param_color_role4_val: {value: Color};\n\t\tv_POLY_param_color_role5_val: {value: Color};\n\t};\n}\ninterface DotsMat extends ShaderMaterialWithCustomMaterials {\n\tuniforms: {\n\t\tv_POLY_param_sparkle_radius_val: {value: number};\n\t\tv_POLY_param_sparkle_intensity_val: {value: number};\n\t\tv_POLY_param_sparkle_center_val: {value: Vector3};\n\t\tv_POLY_param_sparkle_color_val: {value: Color};\n\t\tv_POLY_param_trail_intensity_val: {value: number};\n\t};\n}\ninterface DotsIntroMat extends ShaderMaterialWithCustomMaterials {\n\tuniforms: {\n\t\tv_POLY_param_progress_val: {value: number};\n\t};\n}\n\nexport interface PulseShadowMat extends ShaderMaterialWithCustomMaterials {\n\tuniforms: {\n\t\tv_POLY_param_id_val: {value: number};\n\t\tv_POLY_param_radius_val: {value: number};\n\t\tv_POLY_param_baseopacity_val: {value: number};\n\t};\n}\n\nexport class MaterialsController {\n\tstatic VISIBLE_DOTS_COUNT: Readonly<number> = 2;\n\tstatic VISIBLE_ARCS_COUNT: Readonly<number> = 1;\n\tstatic PULSE_OPACITY_START: Readonly<number> = 0.8;\n\n\tpublic bg_node: MeshBasicMatNode;\n\tpublic bg: MeshBasicMaterial;\n\tpublic bg_node_original_opacity: number = 0;\n\tpublic sphere_node: MeshLambertMatNode;\n\tpublic sphere: MeshLambertMaterial;\n\tpublic sphere_original_opacity: number = FeaturesController.not_transparent() ? 1.0 : 0.75;\n\tpublic arcs: ArcsMat;\n\tpublic selected_dots: SelectedDotsMat;\n\tpublic dots: DotsMat;\n\tpublic dots_intro: DotsIntroMat;\n\t// public pulse: MeshBasicMaterial;\n\tpublic pulse_shadow: PulseShadowMat;\n\n\tpublic role_colors: Color[];\n\n\tprivate scene: PolySceneWithNodeMap;\n\tconstructor(private main_controller: MainController) {\n\t\tthis.scene = this.main_controller.scene;\n\n\t\t// bg\n\t\tthis.bg_node = this.scene.node('/MAT/mesh_basic_BG');\n\t\tthis.bg = this.bg_node.material;\n\t\t// bg\n\t\tthis.sphere_node = this.scene.node('/MAT/mesh_lambert_SPHERE');\n\t\tthis.sphere = this.sphere_node.material;\n\t\t// arcs\n\t\tconst arcs_node = this.scene.node('/MAT/mesh_basic_builder_ARCS');\n\t\tthis.arcs = arcs_node.material as ArcsMat;\n\t\t// dots\n\t\tconst selected_dots_node = this.scene.node('/MAT/mesh_basic_builder_SELECTED_DOTS');\n\t\tthis.selected_dots = selected_dots_node.material as SelectedDotsMat;\n\t\tconst dots_node = this.scene.node('/MAT/mesh_basic_builder_DOTS');\n\t\tthis.dots = dots_node.material as DotsMat;\n\t\tconst dots_intro_node = this.scene.node('/MAT/mesh_basic_builder_DOTS_intro');\n\t\tthis.dots_intro = dots_intro_node.material as DotsIntroMat;\n\t\tthis.role_colors = [\n\t\t\tthis.selected_dots.uniforms.v_POLY_param_color_role0_val.value,\n\t\t\tthis.selected_dots.uniforms.v_POLY_param_color_role1_val.value,\n\t\t\tthis.selected_dots.uniforms.v_POLY_param_color_role2_val.value,\n\t\t\tthis.selected_dots.uniforms.v_POLY_param_color_role3_val.value,\n\t\t\tthis.selected_dots.uniforms.v_POLY_param_color_role4_val.value,\n\t\t\tthis.selected_dots.uniforms.v_POLY_param_color_role5_val.value,\n\t\t];\n\t\t// pulse\n\t\t// const pulse_node = this.scene.node('/MAT/mesh_basic_pulse');\n\t\t// this.pulse = pulse_node.material;\n\t\tconst pulse_shadow_node = this.scene.node('/MAT/mesh_basic_builder_pulse_shadow');\n\t\tthis.pulse_shadow = pulse_shadow_node.material as PulseShadowMat;\n\t}\n\tasync init() {\n\t\tthis.reset();\n\t}\n\n\treset() {\n\t\t// intro\n\t\tthis.bg_node_original_opacity = this.bg_node.p.opacity.value;\n\t\tthis.bg_node.p.opacity.set(0);\n\n\t\t// this.sphere_original_opacity = this.sphere_node.p.opacity.value;\n\t\tthis.sphere_node.p.opacity.set(0);\n\n\t\t// threshold\n\t\tthis.arcs.uniforms.v_POLY_param_threshold_val.value = 0;\n\t\tthis.selected_dots.uniforms.v_POLY_param_threshold_val.value = 0;\n\t\t// visible arcs count\n\t\tthis.arcs.uniforms.v_POLY_param_visibles_count_val.value = MaterialsController.VISIBLE_ARCS_COUNT;\n\t\tthis.selected_dots.uniforms.v_POLY_param_visibles_count_val.value = MaterialsController.VISIBLE_DOTS_COUNT;\n\t\t// dots\n\t\tthis.dots.uniforms.v_POLY_param_sparkle_center_val.value.set(0, 10, 0);\n\t\tthis.dots.uniforms.v_POLY_param_sparkle_color_val.value.r = 1;\n\t\tthis.dots.uniforms.v_POLY_param_sparkle_color_val.value.g = 0;\n\t\tthis.dots.uniforms.v_POLY_param_sparkle_color_val.value.b = 0;\n\t\tthis.dots.uniforms.v_POLY_param_sparkle_intensity_val.value = 0;\n\t\tthis.dots.uniforms.v_POLY_param_sparkle_radius_val.value = 0;\n\t}\n\tstatic reset_pulse_mat(mat: PulseShadowMat) {\n\t\tmat.uniforms.v_POLY_param_radius_val.value = 0;\n\t\tmat.uniforms.v_POLY_param_baseopacity_val.value = this.PULSE_OPACITY_START;\n\t}\n\n\tset_dots_to_intro_mat() {\n\t\tthis._set_mat_to_objects(this.main_controller.objects.dots, this.main_controller.materials.dots_intro);\n\t}\n\tset_dots_to_default_mat() {\n\t\tthis._set_mat_to_objects(this.main_controller.objects.dots, this.main_controller.materials.dots);\n\t}\n\tprivate _set_mat_to_objects(objects: Object3D[], mat: Material) {\n\t\tfor (let object of objects) {\n\t\t\t(object as Mesh).material = mat;\n\t\t}\n\t}\n}\n","// https://greensock.com/docs/v3/GSAP/Timeline\n\nexport class TimelinePosition {\n\tstatic relative_to_end_of_timeline(delta: number) {\n\t\tif (delta > 0) {\n\t\t\treturn `+=${delta}`;\n\t\t} else {\n\t\t\treturn `-=${Math.abs(delta)}`;\n\t\t}\n\t}\n\tstatic at_start_of_most_recently_added_animation() {\n\t\treturn '<';\n\t}\n\tstatic at_end_of_most_recently_added_animation() {\n\t\treturn '>';\n\t}\n\tstatic relative_to_start_of_recently_added_animation(delta: number) {\n\t\tif (delta == 0) {\n\t\t\treturn this.at_start_of_most_recently_added_animation();\n\t\t} else {\n\t\t\tif (delta > 0) {\n\t\t\t\treturn `<+${delta}`;\n\t\t\t} else {\n\t\t\t\treturn `<-${Math.abs(delta)}`;\n\t\t\t}\n\t\t}\n\t}\n\tstatic relative_to_end_of_recently_added_animation(delta: number) {\n\t\tif (delta == 0) {\n\t\t\treturn this.at_end_of_most_recently_added_animation();\n\t\t} else {\n\t\t\tif (delta > 0) {\n\t\t\t\treturn `>+${delta}`;\n\t\t\t} else {\n\t\t\t\treturn `>-${Math.abs(delta)}`;\n\t\t\t}\n\t\t}\n\t}\n\tstatic absolute(position: number) {\n\t\treturn position;\n\t}\n}\n","import {PolySceneWithNodeMap} from '../polygonjs/scenes/default/PolySceneWithNodeMap';\nimport {GeoObjNode} from '@polygonjs/polygonjs/src/engine/nodes/obj/Geo';\nimport {CSS2DObject} from '@polygonjs/polygonjs/src/modules/core/objects/CSS2DObject';\nimport {NullSopNode} from '@polygonjs/polygonjs/src/engine/nodes/sop/Null';\nimport {CorePoint} from '@polygonjs/polygonjs/src/core/geometry/Point';\nimport {MainController} from '../MainController';\nimport {Vector3} from 'three/src/math/Vector3';\nimport {Vector2} from 'three/src/math/Vector2';\nimport {NullObjNode} from '@polygonjs/polygonjs/src/engine/nodes/obj/Null';\nimport {MaterialsController} from './MaterialsController';\nimport {TimelinePosition} from '../core/TimelinePosition';\n\n// if not using GSDevTools\nimport gsap from 'gsap/gsap-core';\n// if using GSDevTools\n// import gsap from 'gsap';\n// import {FeaturesController} from './FeaturesController';\n// import GSDevTools from 'gsap/GSDevTools';\n\n/*\nin order to use GSDevTool,\n\n1 - include the lib downloaded locally\n\"dependencies\": {\n\t\t\"gsap\": \"file:./gsap_business_green/gsap-bonus/package\",\n\t\tinstead of \n\t\t\"gsap\": \"3.5.1\",\n\n\n2 - import the plugin\nimport GSDevTools from 'gsap/GSDevTools';\n\n3 - import gsap instead of gsap/gsap-core\n\n4- register the plugin (currently in init())\ngsap.registerPlugin(GSDevTools);\n\n5 - open it for a specific timeline (currently in start)\nif (FeaturesController.GSAP_DEBUG) {\n\tGSDevTools.create({animation: master_timeline});\n}\n*/\nexport {gsap};\n\nexport class AnimationController {\n\t// objects\n\tpublic readonly ry_obj_node: NullObjNode | undefined;\n\tpublic readonly selected_dots_obj_node: GeoObjNode;\n\tpublic readonly selected_dots_sop_node: NullSopNode;\n\tpublic css_objects: CSS2DObject[] | undefined;\n\tpublic css_object_inner_containers: HTMLElement[] | undefined;\n\tpublic selected_dots_points: CorePoint[] | undefined;\n\tpublic selected_dot_angles: number[] | undefined;\n\tpublic selected_dot_distance_to_next: number[] = [];\n\tprivate master_timeline: gsap.core.Timeline | undefined;\n\n\tprivate scene: PolySceneWithNodeMap;\n\tconstructor(private main_controller: MainController) {\n\t\tthis.scene = this.main_controller.scene;\n\n\t\t// objects\n\t\tthis.ry_obj_node = this.scene.node('/null_ry');\n\t\tthis.selected_dots_obj_node = this.scene.node('/selected_dots');\n\t\tthis.selected_dots_sop_node = this.scene.node('/arcs/OUT_selected_dots');\n\t}\n\n\tasync init() {\n\t\tawait this._load_objects();\n\t\tthis._reset_css_objects();\n\t\t// if (FeaturesController.GSAP_DEBUG) {\n\t\t// \tgsap.registerPlugin(GSDevTools);\n\t\t// \tconsole.log('register GSAP debug');\n\t\t// }\n\t}\n\n\tpublic pause() {\n\t\tthis.master_timeline?.pause();\n\t}\n\tpublic play() {\n\t\tthis.master_timeline?.play();\n\t}\n\n\tprivate async _load_objects() {\n\t\t// load css objects\n\t\tconst css_objects_node = this.scene.node('/css_objects/OUT');\n\t\tconst css_objects_core_group = await css_objects_node.requestContainer();\n\t\tthis.css_objects = css_objects_core_group.coreContent()?.objects() as CSS2DObject[];\n\n\t\tthis.css_object_inner_containers = this.css_objects.map((css_object) => {\n\t\t\treturn css_object.element.children[0] as HTMLElement;\n\t\t});\n\n\t\t// load selected dots\n\t\tconst selected_dots_container = await this.selected_dots_sop_node.requestContainer();\n\t\tconst core_group = selected_dots_container.coreContent();\n\t\tif (core_group) {\n\t\t\tthis.selected_dots_points = core_group.points();\n\t\t\tif (this.selected_dots_points) {\n\t\t\t\tthis.selected_dot_distance_to_next = [];\n\t\t\t\tthis.selected_dot_angles = [];\n\t\t\t\t// let prevAngle: number | undefined;\n\t\t\t\tfor (let i = 0; i < this.selected_dots_points.length; i++) {\n\t\t\t\t\tconst dot = this.selected_dots_points[i];\n\t\t\t\t\tconst nextDot: CorePoint | null = this.selected_dots_points[i + 1];\n\t\t\t\t\tif (nextDot) {\n\t\t\t\t\t\tthis.selected_dot_distance_to_next[i] = this._distanceBetweenDots(dot, nextDot);\n\t\t\t\t\t}\n\t\t\t\t\tconst angle = this._angle(dot);\n\t\t\t\t\t// if (prevAngle) {\n\t\t\t\t\t// \tconst delta = Math.abs(angle - prevAngle);\n\t\t\t\t\t// \tif (delta > Math.PI) {\n\t\t\t\t\t// \t\tif (angle > prevAngle) {\n\t\t\t\t\t// \t\t\tangle -= 2 * Math.PI;\n\t\t\t\t\t// \t\t} else {\n\t\t\t\t\t// \t\t\tangle += 2 * Math.PI;\n\t\t\t\t\t// \t\t}\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\t\t\t\t\tthis.selected_dot_angles.push(angle);\n\n\t\t\t\t\t// prevAngle = angle;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_reset() {\n\t\tif (this.master_timeline) {\n\t\t\tthis.master_timeline.kill();\n\t\t}\n\n\t\tthis.main_controller.materials.reset();\n\t\tthis.main_controller.tweens.reset();\n\t\tthis._reset_css_objects();\n\t}\n\n\tprivate _reset_css_objects() {\n\t\t// toggling the visibility will lead to a brief frame loss\n\t\t// when setting them to true later\n\t\t// this.selected_dots_obj_node.object.visible = false;\n\t\tif (this.css_object_inner_containers) {\n\t\t\tfor (let element of this.css_object_inner_containers) {\n\t\t\t\telement.style.opacity = '0';\n\t\t\t}\n\t\t}\n\t}\n\n\tasync start() {\n\t\tif (0 + 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.selected_dots_points) {\n\t\t\treturn;\n\t\t}\n\t\tthis._reset();\n\n\t\tthis.master_timeline = gsap.timeline({\n\t\t\tid: `master_timeline`,\n\t\t\tonComplete: () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t// restart animation when done\n\t\t\t\t\tthis.start();\n\t\t\t\t}, 500);\n\t\t\t},\n\t\t});\n\t\t(window as any).master_timeline = this.master_timeline;\n\n\t\tlet total_iterations_count = this.selected_dots_points.length - 1 + MaterialsController.VISIBLE_ARCS_COUNT;\n\n\t\t// it's tempting to use 'i < total_iterations_count - 1'\n\t\t// but I need to iterate until 'i < total_iterations_count'\n\t\t// so that the last arc gets retracted gradually instead of just disappearing in one frame.\n\t\tfor (let i = 0; i < total_iterations_count; i++) {\n\t\t\tconst isLast = i == total_iterations_count - 1;\n\t\t\tconst arc_timeline = this.main_controller.timelines.create_timeline(i, isLast);\n\t\t\t// make sure to have position as undefined for the first arc, otherwise the camera will jump when doing a second round (of all arcs)\n\t\t\tconst position =\n\t\t\t\ti == 0 ? undefined : TimelinePosition.relative_to_end_of_recently_added_animation(-3.5 * 1);\n\t\t\tthis.master_timeline.add(arc_timeline, position);\n\t\t}\n\n\t\t// if (FeaturesController.GSAP_DEBUG) {\n\t\t// \tGSDevTools.create({animation: this.master_timeline});\n\t\t// }\n\t}\n\n\t//\n\t//\n\t// UTILS\n\t//\n\t//\n\tprivate _dot1_pos = new Vector3();\n\tprivate _dot2_pos = new Vector3();\n\tprivate _distanceBetweenDots(dot1: CorePoint, dot2: CorePoint): number {\n\t\tdot1.getPosition(this._dot1_pos);\n\t\tdot2.getPosition(this._dot2_pos);\n\t\treturn this._dot1_pos.distanceTo(this._dot2_pos);\n\t}\n\tprivate dot_pos = new Vector3();\n\tprivate dot_pos2d = new Vector2();\n\t_angle(dot: CorePoint) {\n\t\tdot.getPosition(this.dot_pos);\n\t\tthis.selected_dots_obj_node.object.localToWorld(this.dot_pos);\n\t\tthis.dot_pos.y = 0;\n\t\tthis.dot_pos.normalize();\n\t\tthis.dot_pos2d.y = this.dot_pos.x; // x goes to y\n\t\tthis.dot_pos2d.x = this.dot_pos.z; // z goes to x\n\t\tlet angle = this.dot_pos2d.angle();\n\t\tangle = AnimationController.roundAngle(angle);\n\t\treturn angle;\n\t}\n\tstatic roundAngle(angle: number) {\n\t\twhile (angle > Math.PI || angle < -Math.PI) {\n\t\t\tif (angle > Math.PI) {\n\t\t\t\tangle = -(2 * Math.PI - angle);\n\t\t\t}\n\t\t\tif (angle < -Math.PI) {\n\t\t\t\tangle = +(2 * Math.PI - angle);\n\t\t\t}\n\t\t}\n\t\treturn angle;\n\t}\n\tstatic rotations(angle: number) {\n\t\treturn Math.floor((angle + Math.PI) / (2 * Math.PI));\n\t}\n\tstatic nearestAngleTo(angle: number, angleRef: number): number {\n\t\tconst rotations = this.rotations(angle);\n\t\tconst refRotations = this.rotations(angleRef);\n\n\t\tconst offset = (refRotations - rotations) * 2 * Math.PI;\n\n\t\treturn angle + offset;\n\t}\n}\n","export enum EasingName {\n\tNONE = 'none',\n\tPOWER1 = 'power1',\n\tPOWER2 = 'power2',\n\tPOWER3 = 'power3',\n\tPOWER4 = 'power4',\n\tBACK = 'back',\n\tELASTIC = 'elastic',\n\tBOUNCE = 'bounce',\n\t// rough\n\tSLOW = 'slow',\n\tSTEPS = 'steps',\n\tCIRC = 'circ',\n\tEXPO = 'expo',\n\tSINE = 'sine',\n\t// Custom\n}\nexport enum EasingInOutMode {\n\tIN = 'in',\n\tOUT = 'out',\n\tIN_OUT = 'inOut',\n}\n","import {MainController} from '../MainController';\nimport {PolySceneWithNodeMap} from '../polygonjs/scenes/default/PolySceneWithNodeMap';\nimport {EasingName, EasingInOutMode} from '../core/Easing';\nimport {gsap} from './AnimationController';\nimport {FeaturesController} from './FeaturesController';\nimport {CoreSleep} from '../core/Sleep';\nimport {TimelinePosition} from '../core/TimelinePosition';\n\nconst SPEED_UP = 1 / 1.5;\nexport class IntroController {\n\tprivate DURATION = {\n\t\tdots: FeaturesController.SKIP_INTRO ? 0.25 : 5 * SPEED_UP,\n\t\tshadow: FeaturesController.SKIP_INTRO ? 0.25 : 2.5 * (SPEED_UP * 1.5),\n\t};\n\n\tprivate scene: PolySceneWithNodeMap;\n\tconstructor(private main_controller: MainController) {\n\t\tthis.scene = this.main_controller.scene;\n\t}\n\tasync init() {\n\t\tthis._reset();\n\n\t\t// wait for main geo to cook\n\t\tconst node = this.scene.node('/selected_dots/REF_cook');\n\t\tawait node.requestContainer();\n\t\tawait this.scene.cookController.waitForCooksCompleted();\n\t\t// This seems to alleviate a bug where\n\t\t// some objects would appear for a single frame\n\t\tawait CoreSleep.sleep(10);\n\t\tsetTimeout(() => {\n\t\t\tthis.main_controller.html.move_profiles_to_css_objects();\n\t\t\t// Add a delay to allow the css objects to be created.\n\t\t\t// This delay is fine, as long as we have a long enough intro animation.\n\t\t}, 1000);\n\t\tthis.main_controller.viewer.setAutoRender();\n\t\tawait this.main_controller.pre_compile.render_default_dots();\n\t\tthis.scene.play();\n\t\tthis._start_intro_animation();\n\t}\n\n\tprotected _reset() {\n\t\tconst dots_mat = this.main_controller.materials.dots_intro;\n\t\tdots_mat.uniforms.v_POLY_param_progress_val.value = 0;\n\t}\n\n\tprotected _start_intro_animation() {\n\t\tconst main_timeline = gsap.timeline({\n\t\t\tonComplete: () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis._on_completed();\n\t\t\t\t}, 50);\n\t\t\t},\n\t\t});\n\t\tconst timeline1 = gsap.timeline();\n\t\tconst timeline2 = gsap.timeline();\n\n\t\tconst dots_mat = this.main_controller.materials.dots_intro;\n\t\tconst bg_mat = this.main_controller.materials.bg;\n\t\tconst sphere_mat = this.main_controller.materials.sphere;\n\t\tconst camera_node = this.scene.node('/perspective_camera_MASTER');\n\t\tif (!camera_node) {\n\t\t\treturn;\n\t\t}\n\n\t\tdots_mat.uniforms.v_POLY_param_progress_val.value = 3;\n\t\tconst vars_dots_mat: gsap.TweenVars = {\n\t\t\tvalue: 7,\n\t\t\tduration: this.DURATION.dots,\n\t\t\tease: EasingName.NONE,\n\t\t};\n\t\ttimeline1.to(dots_mat.uniforms.v_POLY_param_progress_val, vars_dots_mat);\n\n\t\tconst camera = camera_node.object;\n\t\tconst original_fov = camera.fov;\n\t\tcamera.fov = original_fov / 1.5;\n\t\tcamera.updateProjectionMatrix();\n\t\tconst cam_params: gsap.TweenVars = {\n\t\t\tfov: original_fov,\n\t\t\tduration: this.DURATION.dots,\n\t\t\tease: `${EasingName.POWER3}.${EasingInOutMode.OUT}`,\n\t\t\tonUpdate: () => {\n\t\t\t\tcamera.updateProjectionMatrix();\n\t\t\t},\n\t\t};\n\t\ttimeline1.to(camera, cam_params, TimelinePosition.absolute(0));\n\n\t\tconst vars_bg_mat: gsap.TweenVars = {\n\t\t\topacity: this.main_controller.materials.bg_node_original_opacity,\n\t\t\tduration: this.DURATION.shadow,\n\t\t\tease: `${EasingName.POWER2}.${EasingInOutMode.OUT}`,\n\t\t};\n\t\ttimeline2.to(bg_mat, vars_bg_mat, TimelinePosition.relative_to_end_of_recently_added_animation(-1));\n\n\t\tconst vars_sphere_mat: gsap.TweenVars = {\n\t\t\topacity: this.main_controller.materials.sphere_original_opacity,\n\t\t\tduration: this.DURATION.shadow,\n\t\t\tease: `${EasingName.POWER2}.${EasingInOutMode.OUT}`,\n\t\t};\n\t\ttimeline2.to(sphere_mat, vars_sphere_mat, TimelinePosition.absolute(0));\n\n\t\tmain_timeline.add(timeline1);\n\t\tmain_timeline.add(timeline2, TimelinePosition.relative_to_end_of_recently_added_animation(-1));\n\t}\n\n\tprivate _on_completed() {\n\t\tif (FeaturesController.ARCS_ANIM) {\n\t\t\tthis.main_controller.materials.set_dots_to_default_mat();\n\t\t\tthis.main_controller.animation.start();\n\t\t}\n\t}\n}\n","export class CoreSleep {\n\tstatic sleep(time: number): Promise<void> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve();\n\t\t\t}, time);\n\t\t});\n\t}\n}\n","import {Mesh} from 'three/src/objects/Mesh';\nimport {PolySceneWithNodeMap} from '../polygonjs/scenes/default/PolySceneWithNodeMap';\nimport {MainController} from '../MainController';\nimport {PulseShadowMat} from './MaterialsController';\nimport {OperationsComposerSopNode} from '@polygonjs/polygonjs/src/engine/nodes/sop/OperationsComposer';\n\nexport class ObjectsController {\n\tpublic readonly dots_out_sop: OperationsComposerSopNode;\n\tpublic dots: Mesh[] = [];\n\tprivate _pulse_objects: Mesh[] = [];\n\tprivate scene: PolySceneWithNodeMap;\n\tconstructor(private main_controller: MainController) {\n\t\tthis.scene = this.main_controller.scene;\n\n\t\tthis.dots_out_sop = this.scene.node('/dots/object_properties_OUT');\n\t}\n\n\tasync init() {\n\t\tconst pulse_objects_node = this.scene.node('/pulses/REF_cook');\n\t\tconst pulse_objects_core_group = await pulse_objects_node.requestContainer();\n\t\tthis._pulse_objects = pulse_objects_core_group.coreContent()?.objects() as Mesh[];\n\n\t\tfor (let object of this._pulse_objects) {\n\t\t\tconst pulse_mat = object.material as PulseShadowMat;\n\t\t\tpulse_mat.uniforms.v_POLY_param_baseopacity_val.value = 0;\n\t\t\tpulse_mat.uniforms.v_POLY_param_radius_val.value = 0;\n\t\t\t// object.visible = false;\n\t\t}\n\n\t\t// dots objects\n\t\tconst container = await this.dots_out_sop.requestContainer();\n\t\tconst core_group = container.coreContent();\n\t\tif (core_group) {\n\t\t\tthis.dots = core_group?.objectsWithGeo() as Mesh[];\n\t\t}\n\t}\n\tpulse_object(index: number) {\n\t\tconst object_shadow = this._pulse_objects[index];\n\t\tif (!object_shadow) {\n\t\t\t// console.log('no pulse object found with index', index);\n\t\t\treturn;\n\t\t}\n\t\treturn object_shadow;\n\t}\n}\n","import {PolySceneWithNodeMap} from '../polygonjs/scenes/default/PolySceneWithNodeMap';\nimport {MainController} from '../MainController';\n\nexport class PrecompileController {\n\tprivate scene: PolySceneWithNodeMap;\n\n\tconstructor(private main_controller: MainController) {\n\t\tthis.scene = this.main_controller.scene;\n\t}\n\n\tasync init() {\n\t\tawait this.scene.cookController.waitForCooksCompleted();\n\t\tawait this.scene.node('/dots/object_properties_OUT').requestContainer();\n\n\t\t// this.main_controller.materials.set_dots_to_default_mat();\n\t\t// this._precompile();\n\t\t// this.main_controller.materials.set_dots_to_intro_mat();\n\t\t// this._precompile();\n\t}\n\n\t// private _precompile() {\n\t// \tconst precompile_start = performance.now();\n\t// \tconst viewer = this.main_controller.viewer;\n\t// \tconst renderer = viewer.renderer();\n\t// \tconst camera = viewer.camera_node.object;\n\t// \tconst scene = this.scene.default_scene;\n\n\t// \tif (renderer) {\n\t// \t\trenderer.compile(scene, camera);\n\t// \t}\n\t// \tconsole.log('[webgl globe] scene precompilation time', performance.now() - precompile_start);\n\t// }\n\n\t// this forces the default dots to be rendered.\n\t// as precompile does not seem enough.\n\t// not doing this will create a 50-80ms jump in requestAnimationFrame\n\t// as the geometry will be sent to the GPU\n\tasync render_default_dots() {\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.main_controller.materials.set_dots_to_default_mat();\n\t\t\tconst dots = this.main_controller.objects.dots;\n\t\t\tfor (let dot of dots) {\n\t\t\t\tdot.position.y = -100;\n\t\t\t\tdot.updateMatrix();\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tfor (let dot of dots) {\n\t\t\t\t\tdot.position.y = 0;\n\t\t\t\t\tdot.updateMatrix();\n\t\t\t\t}\n\n\t\t\t\tthis.main_controller.materials.set_dots_to_intro_mat();\n\t\t\t\tresolve();\n\t\t\t}, 50);\n\t\t});\n\t}\n}\n","import {AnimationController, gsap} from './AnimationController';\nimport {MainController} from '../MainController';\nimport {EasingName, EasingInOutMode} from '../core/Easing';\nimport {TimelinePosition} from '../core/TimelinePosition';\nimport {FeaturesController} from './FeaturesController';\nimport {PulseShadowMat, MaterialsController} from './MaterialsController';\n\nconst EASING = {\n\tROTATION: `${EasingName.POWER2}.${EasingInOutMode.IN_OUT}`,\n\tARC: `${EasingName.POWER2}.${EasingInOutMode.IN_OUT}`,\n\tDOT: `${EasingName.POWER2}.${EasingInOutMode.IN_OUT}`,\n\tPULSE: `${EasingName.POWER2}.${EasingInOutMode.IN_OUT}`,\n\tCSS: `${EasingName.POWER2}.${EasingInOutMode.IN_OUT}`,\n\tWAVE: {\n\t\tRADIUS: `${EasingName.POWER2}.${EasingInOutMode.OUT}`,\n\t\tINTENSITY_UP: `${EasingName.POWER4}.${EasingInOutMode.OUT}`,\n\t\tINTENSITY_DOWN: `${EasingName.POWER4}.${EasingInOutMode.IN_OUT}`,\n\t\tTRAILS_DOWN: `${EasingName.POWER4}.${EasingInOutMode.IN_OUT}`,\n\t},\n};\nexport const DURATION = {\n\tDOT_START: 1,\n\tDOT_END: 1,\n\tCSS: 2,\n\tPULSE: {\n\t\tGROW: 1.8,\n\t\tFADE: 1,\n\t},\n\tWAVE: {\n\t\tRADIUS_INCREASE: 4,\n\t\t// INTENSITY_UP: 0.8,\n\t\tINTENSITY_DOWN: 2,\n\t\tTRAILS_DOWN: 2,\n\t},\n};\n\nexport class TweensController {\n\tprivate prev_rotation_angle = 0;\n\tprivate wave_timelines: gsap.core.Timeline[] = [];\n\tconstructor(private main_controller: MainController) {}\n\n\treset() {\n\t\tthis.wave_timelines = [];\n\t}\n\n\t//\n\t//\n\t// ROTATION\n\t//\n\t//\n\trotate_to_dot(timeline: gsap.core.Timeline, index: number, position?: string | number) {\n\t\tif (!this.main_controller.animation.selected_dot_angles) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.main_controller.animation.ry_obj_node) {\n\t\t\treturn;\n\t\t}\n\t\tlet angle = this.main_controller.animation.selected_dot_angles[index];\n\t\tif (angle == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst prev_angle = this.prev_rotation_angle || 0;\n\t\tangle = AnimationController.nearestAngleTo(angle, prev_angle);\n\n\t\tlet delta = Math.abs(angle - prev_angle);\n\t\tconst threshold = 0.25 * Math.PI;\n\t\tif (delta > Math.PI) {\n\t\t\tif (angle > prev_angle) {\n\t\t\t\tangle -= 2 * Math.PI;\n\t\t\t} else {\n\t\t\t\tangle += 2 * Math.PI;\n\t\t\t}\n\t\t\tdelta = Math.abs(angle - prev_angle);\n\t\t}\n\t\tif (delta < threshold) {\n\t\t\treturn;\n\t\t}\n\t\tthis.prev_rotation_angle = angle;\n\t\tconst duration = 1.25 * delta;\n\n\t\tconst object = this.main_controller.animation.ry_obj_node.object;\n\t\tif (FeaturesController.MATRIX_AUTO_UPDATE) {\n\t\t\tobject.matrixAutoUpdate = true;\n\t\t}\n\n\t\tconst vars_rot: gsap.TweenVars = {\n\t\t\tid: 'rotate',\n\t\t\ty: -angle,\n\t\t\tduration: duration,\n\t\t\tease: EASING.ROTATION,\n\t\t\tonStart: () => {\n\t\t\t\tobject.matrixAutoUpdate = true;\n\t\t\t},\n\t\t\tonComplete: () => {\n\t\t\t\tif (!FeaturesController.MATRIX_AUTO_UPDATE) {\n\t\t\t\t\tobject.matrixAutoUpdate = false;\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t\ttimeline.to(object.rotation, vars_rot, position);\n\t\treturn duration;\n\t}\n\n\t//\n\t//\n\t// DOT\n\t//\n\t//\n\tshow_start_dot(timeline: gsap.core.Timeline, index: number, position?: string | number) {\n\t\tconst selected_dots_mat = this.main_controller.materials.selected_dots;\n\t\t// const vars_dot_start_from: gsap.TweenVars = {\n\t\t// \tvalue: Math.max(0, index - 0.01),\n\t\t// };\n\t\tconst duration = index == 0 ? 3 : DURATION.DOT_START;\n\n\t\tconst vars_dot_start: gsap.TweenVars = {\n\t\t\tid: 'start_dot',\n\t\t\tvalue: index + 0.99,\n\t\t\tduration: duration,\n\t\t\tease: EASING.DOT,\n\t\t\tonStart: () => {\n\t\t\t\t// visibilty is set here, as if it is set earlier,\n\t\t\t\t// there always seems to be a bug where the object will briefly be fully visible for a frame and then disappear, just before the animation start\n\t\t\t\t// toggling the visibility will lead to a brief frame loss\n\t\t\t\t// so it is removed for now\n\t\t\t\t// this.main_controller.animation.selected_dots_obj_node.object.visible = true;\n\t\t\t},\n\t\t};\n\t\ttimeline.to(\n\t\t\tselected_dots_mat.uniforms.v_POLY_param_threshold_val,\n\t\t\t// vars_dot_start_from,\n\t\t\tvars_dot_start,\n\t\t\tposition\n\t\t);\n\t}\n\tshow_end_dot(timeline: gsap.core.Timeline, index: number, position?: string | number) {\n\t\tconst selected_dots_mat = this.main_controller.materials.selected_dots;\n\t\t// const vars_dot_end_from: gsap.TweenVars = {\n\t\t// \tvalue: index + 0.99,\n\t\t// };\n\t\tconst vars_dot_end: gsap.TweenVars = {\n\t\t\tid: 'end_dot',\n\t\t\tvalue: index + 1.99,\n\t\t\tduration: DURATION.DOT_END,\n\t\t\tease: EASING.DOT,\n\t\t};\n\t\t(window as any).selected_dots_mat = selected_dots_mat;\n\t\ttimeline.to(\n\t\t\tselected_dots_mat.uniforms.v_POLY_param_threshold_val,\n\t\t\t// vars_dot_end_from,\n\t\t\tvars_dot_end,\n\t\t\tposition\n\t\t);\n\t\t// const pulse_timeline = this._pulse_timeline(index);\n\t\t// this.grow_pulse(timeline, index, 0);\n\t\t// timeline.add(pulse_timeline, TimelinePosition.relative_to_start_of_recently_added_animation(0.1));\n\t\t// this.fade_pulse(\n\t\t// \ttimeline,\n\t\t// \tindex,\n\t\t// \tTimelinePosition.relative_to_start_of_recently_added_animation(-DURATION.PULSE.FADE)\n\t\t// );\n\t}\n\n\t//\n\t//\n\t// PULSE\n\t//\n\t//\n\tgrow_pulse(timeline: gsap.core.Timeline, index: number, position?: string | number) {\n\t\tconst object_shadow = this.main_controller.objects.pulse_object(index);\n\t\tif (!object_shadow) {\n\t\t\treturn;\n\t\t}\n\t\tconst pulse_mat = object_shadow.material as PulseShadowMat;\n\n\t\tconst vars_grow_pulse: gsap.TweenVars = {\n\t\t\tid: 'grow_pulse',\n\t\t\tvalue: 1,\n\t\t\tduration: DURATION.PULSE.GROW,\n\t\t\tease: EASING.PULSE,\n\t\t\tonStart: () => {\n\t\t\t\t// object_shadow.visible = true;\n\t\t\t\tpulse_mat.uniforms.v_POLY_param_id_val.value = index;\n\t\t\t\tMaterialsController.reset_pulse_mat(pulse_mat);\n\t\t\t},\n\t\t};\n\t\ttimeline.to(pulse_mat.uniforms.v_POLY_param_radius_val, vars_grow_pulse, position);\n\t}\n\tfade_pulse(timeline: gsap.core.Timeline, index: number, position?: string | number) {\n\t\tconst object_shadow = this.main_controller.objects.pulse_object(index);\n\t\tif (!object_shadow) {\n\t\t\treturn;\n\t\t}\n\t\tconst pulse_mat = object_shadow.material as PulseShadowMat;\n\n\t\tconst vars_fade_pulse: gsap.TweenVars = {\n\t\t\tid: 'fade_pulse',\n\t\t\tvalue: 0,\n\t\t\tduration: DURATION.PULSE.FADE,\n\t\t\tease: EASING.PULSE,\n\n\t\t\tonComplete: () => {\n\t\t\t\t// object_shadow.visible = false;\n\t\t\t\tpulse_mat.uniforms.v_POLY_param_id_val.value = -1;\n\t\t\t\tMaterialsController.reset_pulse_mat(pulse_mat);\n\t\t\t},\n\t\t};\n\t\ttimeline.to(pulse_mat.uniforms.v_POLY_param_baseopacity_val, vars_fade_pulse, position);\n\t}\n\n\t//\n\t//\n\t// CSS OBJECT\n\t//\n\t//\n\tshow_css_object(timeline: gsap.core.Timeline, index: number, position: string | number) {\n\t\tif (!this.main_controller.animation.css_object_inner_containers) {\n\t\t\treturn;\n\t\t}\n\t\tconst css_object = this.main_controller.animation.css_object_inner_containers[index];\n\t\tif (!css_object) {\n\t\t\treturn;\n\t\t}\n\t\tconst proxy = {value: 0};\n\t\tconst vars_css_object: gsap.TweenVars = {\n\t\t\tvalue: 1,\n\t\t\tduration: DURATION.CSS,\n\t\t\tease: EASING.CSS,\n\t\t\tonUpdate: () => {\n\t\t\t\tcss_object.style.opacity = `${proxy.value}`;\n\t\t\t},\n\t\t};\n\t\ttimeline.to(proxy, vars_css_object, position);\n\t}\n\thide_css_object(timeline: gsap.core.Timeline, index: number) {\n\t\tif (!this.main_controller.animation.css_object_inner_containers) {\n\t\t\treturn;\n\t\t}\n\t\tconst css_object = this.main_controller.animation.css_object_inner_containers[index];\n\t\tif (!css_object) {\n\t\t\treturn;\n\t\t}\n\t\tconst proxy = {value: 1};\n\t\tconst vars_prev_css_object: gsap.TweenVars = {\n\t\t\tvalue: 0,\n\t\t\tduration: DURATION.CSS,\n\t\t\tease: EASING.CSS,\n\t\t\tonUpdate: () => {\n\t\t\t\tcss_object.style.opacity = `${proxy.value}`;\n\t\t\t},\n\t\t};\n\t\ttimeline.to(proxy, vars_prev_css_object, '<+=0');\n\t}\n\n\t//\n\t//\n\t// ARC\n\t//\n\t//\n\tshow_arc(timeline: gsap.core.Timeline, index: number, position: string | number) {\n\t\t// if (!this.main_controller.animation.selected_dot_angles) {\n\t\t// \treturn;\n\t\t// }\n\t\t// let angle = this.main_controller.animation.selected_dot_angles[index + 1];\n\t\t// const prev_angle = this.main_controller.animation.selected_dot_angles[index];\n\t\t// let duration = 1.6; // for when the last arc disappears\n\t\t// if (angle != null || prev_angle != null) {\n\t\t// \tlet delta = Math.abs(angle - prev_angle);\n\t\t// \tif (delta > Math.PI) {\n\t\t// \t\tif (angle > prev_angle) {\n\t\t// \t\t\tangle -= 2 * Math.PI;\n\t\t// \t\t} else {\n\t\t// \t\t\tangle += 2 * Math.PI;\n\t\t// \t\t}\n\t\t// \t\tdelta = Math.abs(angle - prev_angle);\n\t\t// \t}\n\t\t// \tduration = 0.8 * delta;\n\t\t// }\n\t\tconst defaultDuration = 1.6; // for when the last arc disappears\n\t\tlet duration = this.main_controller.animation.selected_dot_distance_to_next[index] || defaultDuration;\n\t\tduration = Math.max(duration, 1.6);\n\n\t\tconst arcs_mat = this.main_controller.materials.arcs;\n\t\tconst vars_arc: gsap.TweenVars = {\n\t\t\tid: 'arc',\n\t\t\tvalue: index + 1,\n\t\t\tduration: duration,\n\t\t\tease: EASING.ARC,\n\t\t};\n\t\ttimeline.to(arcs_mat.uniforms.v_POLY_param_threshold_val, vars_arc, position);\n\t\treturn duration;\n\t}\n\n\t//\n\t//\n\t// SPARKLE\n\t//\n\t//\n\tstart_wave(timeline: gsap.core.Timeline, index: number, position: string | number) {\n\t\tif (!this.main_controller.animation.selected_dots_points) {\n\t\t\treturn;\n\t\t}\n\t\tconst point = this.main_controller.animation.selected_dots_points[index + 1];\n\t\tif (!point) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst dots_mat = this.main_controller.materials.dots;\n\t\tconst role = point.attribValue('role') as number;\n\t\tconst role_colors = this.main_controller.materials.role_colors;\n\t\tconst color = role_colors[role];\n\n\t\tconst wave_timeline = gsap.timeline({\n\t\t\tid: `wave-${index}`,\n\t\t\tonStart: () => {\n\t\t\t\tpoint.getPosition(dots_mat.uniforms.v_POLY_param_sparkle_center_val.value);\n\t\t\t\tdots_mat.uniforms.v_POLY_param_sparkle_intensity_val.value = 1.4;\n\t\t\t\tdots_mat.uniforms.v_POLY_param_trail_intensity_val.value = 2;\n\t\t\t\tdots_mat.uniforms.v_POLY_param_sparkle_radius_val.value = -0.08;\n\t\t\t\tdots_mat.uniforms.v_POLY_param_sparkle_color_val.value.copy(color);\n\n\t\t\t\tconst previous_wave_timeline = this.wave_timelines[index - 1];\n\t\t\t\tif (previous_wave_timeline) {\n\t\t\t\t\tprevious_wave_timeline.pause();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tthis.wave_timelines[index] = wave_timeline;\n\n\t\t// const intensity_by_role = [2.0, 2.0, 2.0, 2.0, 2.0, 1.2];\n\t\t// const intensity = 3; //intensity_by_role[role] || 2.0;\n\n\t\t// start mat anim\n\t\t// const vars_sparkle_intensity_increase: gsap.TweenVars = {\n\t\t// \tvalue: intensity,\n\t\t// \tduration: DURATION.WAVE.INTENSITY_UP,\n\t\t// \tease: EASING.WAVE.INTENSITY_UP,\n\t\t// };\n\t\tconst vars_sparkle_radius_increase: gsap.TweenVars = {\n\t\t\tvalue: 1.0,\n\t\t\tduration: DURATION.WAVE.RADIUS_INCREASE,\n\t\t\tease: EASING.WAVE.RADIUS,\n\t\t};\n\t\tconst vars_sparkle_intensity_decrease: gsap.TweenVars = {\n\t\t\tvalue: 0,\n\t\t\tduration: DURATION.WAVE.INTENSITY_DOWN,\n\t\t\tease: EASING.WAVE.INTENSITY_DOWN,\n\t\t};\n\t\tconst vars_trail_intensity_decrease: gsap.TweenVars = {\n\t\t\tvalue: 0,\n\t\t\tduration: DURATION.WAVE.INTENSITY_DOWN,\n\t\t\tease: EASING.WAVE.INTENSITY_DOWN,\n\t\t};\n\t\t// sparkle_timeline.to(dots_mat.uniforms.v_POLY_param_sparkle_intensity_val, vars_sparkle_intensity_increase);\n\t\twave_timeline.to(\n\t\t\tdots_mat.uniforms.v_POLY_param_sparkle_radius_val,\n\t\t\tvars_sparkle_radius_increase\n\t\t\t// TimelinePosition.relative_to_start_of_recently_added_animation(0)\n\t\t);\n\t\twave_timeline.to(\n\t\t\tdots_mat.uniforms.v_POLY_param_sparkle_intensity_val,\n\t\t\tvars_sparkle_intensity_decrease,\n\t\t\tTimelinePosition.absolute(1)\n\t\t);\n\t\twave_timeline.to(\n\t\t\tdots_mat.uniforms.v_POLY_param_trail_intensity_val,\n\t\t\tvars_trail_intensity_decrease,\n\t\t\tTimelinePosition.absolute(2)\n\t\t);\n\n\t\ttimeline.add(wave_timeline, position);\n\t}\n}\n","import {gsap} from './AnimationController';\nimport {MainController} from '../MainController';\nimport {TimelinePosition} from '../core/TimelinePosition';\nimport {DURATION} from './TweensController';\n// import {MaterialsController} from './MaterialsController';\n\nconst END_DOT_TIMELINE_POSITION = 0.25;\nexport class TimelinesController {\n\tconstructor(private main_controller: MainController) {}\n\n\tcreate_timeline(index: number, isLast: boolean) {\n\t\tconst main_timeline = gsap.timeline({id: `main-${index}`});\n\n\t\tmain_timeline.add(this._start_dot_timeline(index));\n\n\t\t// the very first arc should be delayed more than the following ones\n\t\t// const arc_start_position = index == 0 ? 1 : -1;\n\t\t// no more delay for first arc\n\t\tconst arc_start_position = -1;\n\n\t\tmain_timeline.add(\n\t\t\tthis._arc_timeline(index),\n\t\t\tTimelinePosition.relative_to_end_of_recently_added_animation(arc_start_position)\n\t\t);\n\t\tmain_timeline.add(\n\t\t\tthis._end_dot_timeline(index, isLast),\n\t\t\tTimelinePosition.relative_to_end_of_recently_added_animation(-0.5 - END_DOT_TIMELINE_POSITION)\n\t\t);\n\n\t\treturn main_timeline;\n\t}\n\t//\n\t//\n\t// TIMELINES\n\t//\n\t//\n\tprotected _start_dot_timeline(index: number) {\n\t\tconst timeline = gsap.timeline({id: `start_dot-${index}`});\n\t\tconst rotation_duration = this._rotate_to_start_dot(timeline, index);\n\n\t\tif (index == 0) {\n\t\t\tthis._show_start_dot(timeline, index, rotation_duration);\n\t\t\tthis._show_start_css_object(timeline, index);\n\t\t}\n\t\t// this._hide_css_object(timeline, index - 1);\n\t\treturn timeline;\n\t}\n\tprotected _arc_timeline(index: number) {\n\t\tconst timeline = gsap.timeline({id: `arc-${index}`});\n\t\tthis._rotate_to_end_dot(timeline, index);\n\t\tthis._show_arc(timeline, index);\n\t\tthis._pulse_timeline(timeline, index - 1);\n\t\treturn timeline;\n\t}\n\tprotected _end_dot_timeline(index: number, isLast: boolean) {\n\t\tconst timeline = gsap.timeline({id: `end_dot-${index}`});\n\t\tthis._show_end_dot(timeline, index);\n\t\tthis._show_end_css_object(timeline, index + 1);\n\t\tthis._hide_css_object(timeline, index);\n\t\tif (isLast) {\n\t\t\tthis._show_end_dot(timeline, index + 1);\n\t\t}\n\t\tif (!isLast) {\n\t\t\tthis._start_wave(timeline, index);\n\t\t}\n\t\treturn timeline;\n\t}\n\t//\n\t//\n\t//\tSTART DOT TIMELINE\n\t//\n\t//\n\tprotected _rotate_to_start_dot(timeline: gsap.core.Timeline, index: number) {\n\t\tif (index == 0) {\n\t\t\treturn this.main_controller.tweens.rotate_to_dot(timeline, index);\n\t\t}\n\t}\n\tprotected _show_start_dot(timeline: gsap.core.Timeline, index: number, rotation_duration?: number) {\n\t\t// no position offset if there is no rotation required to show start dot\n\t\t// const start_dot_pos =\n\t\t// \trotation_duration != null ? TimelinePosition.relative_to_end_of_recently_added_animation(-0.5) : undefined;\n\t\t// const pulse_timeline = this._pulse_timeline(index);\n\t\t// timeline.add(pulse_timeline);\n\t\tthis.main_controller.tweens.show_start_dot(timeline, index, TimelinePosition.absolute(0.5));\n\t}\n\tprotected _show_end_dot(timeline: gsap.core.Timeline, index: number) {\n\t\t// const end_dot_delay = -Math.min(1, arc_duration);\n\t\tthis.main_controller.tweens.show_end_dot(\n\t\t\ttimeline,\n\t\t\tindex\n\t\t\t// TimelinePosition.absolute(0)\n\t\t\t// TimelinePosition.relative_to_end_of_recently_added_animation(end_dot_delay)\n\t\t);\n\n\t\t// this.main_controller.tweens.grow_pulse(timeline, index, TimelinePosition.absolute(0));\n\t\t// this.main_controller.tweens.fade_pulse(\n\t\t// \ttimeline,\n\t\t// \tindex,\n\t\t// \tTimelinePosition.relative_to_end_of_recently_added_animation(-DURATION.PULSE.FADE)\n\t\t// );\n\t}\n\t//\n\t//\n\t// ARC TIMELINE\n\t//\n\t//\n\tprotected _rotate_to_end_dot(timeline: gsap.core.Timeline, index: number, rotation_duration?: number) {\n\t\tthis.main_controller.tweens.rotate_to_dot(timeline, index + 1);\n\t}\n\tprotected _show_arc(timeline: gsap.core.Timeline, index: number) {\n\t\tthis.main_controller.tweens.show_arc(timeline, index, TimelinePosition.absolute(0.4));\n\t}\n\t//\n\t//\n\t// END DOT TIMELINE\n\t//\n\t//\n\tprotected _show_start_css_object(timeline: gsap.core.Timeline, index: number) {\n\t\tthis.main_controller.tweens.show_css_object(\n\t\t\ttimeline,\n\t\t\tindex,\n\t\t\tTimelinePosition.relative_to_start_of_recently_added_animation(0)\n\t\t);\n\t}\n\tprotected _show_end_css_object(timeline: gsap.core.Timeline, index: number) {\n\t\tthis.main_controller.tweens.show_css_object(timeline, index, TimelinePosition.absolute(0));\n\t}\n\tprotected _hide_css_object(timeline: gsap.core.Timeline, index: number) {\n\t\tthis.main_controller.tweens.hide_css_object(timeline, index);\n\t}\n\n\t// protected _hide_start_css_object(timeline: gsap.core.Timeline, index: number) {\n\t// \tthis.main_controller.tweens.hide_css_object(timeline, index);\n\t// }\n\t// protected _hide_end_css_object(timeline: gsap.core.Timeline, index: number) {\n\t// \tthis.main_controller.tweens.hide_css_object(timeline, index);\n\t// }\n\n\tprotected _pulse_timeline(timeline: gsap.core.Timeline, index: number) {\n\t\tconst pulse_timeline = gsap.timeline({id: `pulse-${index}`});\n\t\tthis.main_controller.tweens.grow_pulse(pulse_timeline, index, TimelinePosition.absolute(0));\n\t\tthis.main_controller.tweens.fade_pulse(\n\t\t\tpulse_timeline,\n\t\t\tindex,\n\t\t\tTimelinePosition.relative_to_end_of_recently_added_animation(-DURATION.PULSE.FADE)\n\t\t);\n\t\ttimeline.add(pulse_timeline, TimelinePosition.relative_to_start_of_recently_added_animation(-0.5));\n\t}\n\tprotected _start_wave(timeline: gsap.core.Timeline, index: number) {\n\t\tthis.main_controller.tweens.start_wave(\n\t\t\ttimeline,\n\t\t\tindex,\n\t\t\tTimelinePosition.absolute(0.1 + END_DOT_TIMELINE_POSITION)\n\t\t);\n\t}\n}\n","import {MainController} from '../MainController';\nimport {VisibilityChecker} from '../core/VisibilityChecker';\n\n// const HAS_BEEN_MANUALLY_PAUSED_ATTR = \"has_been_manually_paused\";\n\n// export class GlobeVisibilityCheckerHandler {\n// \tprivate static _checker: GlobeVisibilityChecker;\n\n// \tstatic init() {\n// \t\tdocument.addEventListener('DOMContentLoaded', () => {\n// \t\t\tthis._checker = new GlobeVisibilityChecker();\n// \t\t});\n// \t}\n// \tstatic reset() {\n// \t\tif (this._checker) {\n// \t\t\tthis._checker.reset();\n// \t\t}\n// \t}\n// }\n\n// checks video visibility\nexport class VisibilityController {\n\tprivate bound_listener: () => void = this.on_scroll.bind(this);\n\n\tconstructor(private mainController: MainController) {}\n\n\t// TODO: check when calling that with turbolinks if used\n\tdestroy() {\n\t\tthis.remove_events();\n\t}\n\tinit() {\n\t\tthis.set_onscroll_events();\n\t\tsetTimeout(() => {\n\t\t\tthis.check_globe_visibility();\n\t\t}, 500);\n\t}\n\treset() {\n\t\tthis.init();\n\t}\n\n\tprivate set_onscroll_events() {\n\t\twindow.addEventListener('scroll', this.bound_listener, false);\n\t}\n\n\tprivate remove_events() {\n\t\twindow.removeEventListener('scroll', this.bound_listener);\n\t}\n\n\tprivate on_scroll() {\n\t\tthis.check_globe_visibility();\n\t}\n\tprivate check_globe_visibility() {\n\t\tconst isVisible = VisibilityChecker.intersectsWithViewport(this.mainController.element);\n\t\tif (isVisible) {\n\t\t\tthis.play();\n\t\t} else {\n\t\t\tthis.pause();\n\t\t}\n\t}\n\n\tprivate pause() {\n\t\tthis.mainController.pause();\n\t}\n\tprivate play() {\n\t\tthis.mainController.play();\n\t}\n}\n","export class VisibilityChecker {\n\t// static is_element_center_in_viewport(element: Element): boolean {\n\t// \tconst bounding = element.getBoundingClientRect();\n\t// \tconst center = {\n\t// \t\tx: 0.5 * (bounding.left + bounding.right),\n\t// \t\ty: 0.5 * (bounding.top + bounding.bottom),\n\t// \t};\n\t// \tconst max = {\n\t// \t\tx: window.innerWidth || document.documentElement.clientWidth,\n\t// \t\ty: window.innerHeight || document.documentElement.clientHeight,\n\t// \t};\n\t// \tconst isInCenter = center.x >= 0 && center.x <= max.x && center.y >= 0 && center.y <= max.y;\n\t// \treturn isInCenter;\n\t// }\n\n\tstatic intersectsWithViewport(el: HTMLElement): boolean {\n\t\tvar top = el.offsetTop;\n\t\tvar left = el.offsetLeft;\n\t\tvar width = el.offsetWidth;\n\t\tvar height = el.offsetHeight;\n\n\t\treturn (\n\t\t\ttop < window.pageYOffset + window.innerHeight &&\n\t\t\tleft < window.pageXOffset + window.innerWidth &&\n\t\t\ttop + height > window.pageYOffset &&\n\t\t\tleft + width > window.pageXOffset\n\t\t);\n\n\t\t// const max = {\n\t\t// \tx: window.innerWidth || document.documentElement.clientWidth,\n\t\t// \ty: window.innerHeight || document.documentElement.clientHeight,\n\t\t// };\n\n\t\t// const bounding = element.getBoundingClientRect();\n\t\t// const corners = {\n\t\t// \ttl: bounding.top >= 0 && bounding.left >= 0,\n\t\t// \ttr: bounding.top >= 0 && bounding.right <= max.x,\n\t\t// \tbl: bounding.top <= 0 && bounding.left >= 0,\n\t\t// \tbr: bounding.bottom <= max.y && bounding.right <= max.x,\n\t\t// };\n\t\t// console.log(corners, bounding);\n\t\t// return corners.tl || corners.tr || corners.bl || corners.br;\n\t\t// return (\n\t\t// \tbounding.top >= 0 ||\n\t\t// \tbounding.left >= 0 ||\n\t\t// \tbounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) ||\n\t\t// \tbounding.right <= (window.innerWidth || document.documentElement.clientWidth)\n\t\t// );\n\t}\n\n\t// static is_element_fully_in_viewport(element: Element): boolean {\n\t// \tconst bounding = element.getBoundingClientRect();\n\t// \treturn (\n\t// \t\tbounding.top >= 0 &&\n\t// \t\tbounding.left >= 0 &&\n\t// \t\tbounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n\t// \t\tbounding.right <= (window.innerWidth || document.documentElement.clientWidth)\n\t// \t);\n\t// }\n}\n","import {PolySceneWithNodeMap} from './polygonjs/scenes/default/PolySceneWithNodeMap';\nimport {AnimationController} from './controllers/AnimationController';\nimport {HTMLController} from './controllers/HTMLController';\nimport {IntroController} from './controllers/IntroController';\nimport {MaterialsController} from './controllers/MaterialsController';\nimport {ObjectsController} from './controllers/ObjectsController';\nimport {PrecompileController} from './controllers/PrecompileController';\nimport {TimelinesController} from './controllers/TimelinesController';\nimport {TweensController} from './controllers/TweensController';\nimport {ThreejsViewer} from '@polygonjs/polygonjs/src/engine/viewers/Threejs';\nimport {VisibilityController} from './controllers/VisibilityController';\n\nexport class MainController {\n\tpublic readonly animation = new AnimationController(this);\n\tpublic readonly html = new HTMLController(this);\n\tpublic readonly intro = new IntroController(this);\n\tpublic readonly materials = new MaterialsController(this);\n\tpublic readonly objects = new ObjectsController(this);\n\tpublic readonly pre_compile = new PrecompileController(this);\n\tpublic readonly timelines = new TimelinesController(this);\n\tpublic readonly tweens = new TweensController(this);\n\tpublic readonly visibility = new VisibilityController(this);\n\n\tconstructor(\n\t\tpublic readonly scene: PolySceneWithNodeMap,\n\t\tpublic readonly viewer: ThreejsViewer,\n\t\tpublic readonly element: HTMLElement\n\t) {\n\t\tscene.setFrame(0);\n\t}\n\tasync init() {\n\t\tthis.visibility.init();\n\t\tawait this.objects.init(); // objects first to fetch the objects\n\t\tawait this.pre_compile.init(); // precompile once we have objects\n\t\tawait this.materials.init();\n\t\tawait this.animation.init();\n\t\tawait this.intro.init();\n\t}\n\n\tprivate _playing = true;\n\tprivate _debug = false;\n\tsetDebug(debug: boolean) {\n\t\tthis._debug = debug;\n\t}\n\tpause() {\n\t\tif (!this._playing) {\n\t\t\treturn;\n\t\t}\n\t\tthis._playing = false;\n\t\tif (this._debug) {\n\t\t\tconsole.log('globe pause');\n\t\t}\n\t\tthis.viewer.setAutoRender(false);\n\t\tthis.animation.pause();\n\t}\n\tplay() {\n\t\tif (this._playing) {\n\t\t\treturn;\n\t\t}\n\t\tthis._playing = true;\n\t\tif (this._debug) {\n\t\t\tconsole.log('globe play');\n\t\t}\n\t\tthis.viewer.setAutoRender(true);\n\t\tthis.animation.play();\n\t}\n}\n","import {HTMLController} from './HTMLController';\n\nexport class FeaturesController {\n\tstatic SKIP_INTRO: Readonly<boolean> = false;\n\tstatic ARCS_ANIM: Readonly<boolean> = true;\n\tstatic MATRIX_AUTO_UPDATE: Readonly<boolean> = true;\n\tstatic GSAP_DEBUG: Readonly<boolean> = true;\n\n\tstatic not_transparent() {\n\t\tconst queryString = window.location.search;\n\t\tconst urlParams = new URLSearchParams(queryString);\n\t\treturn urlParams.get('transparent') == '0';\n\t}\n\n\tstatic small() {\n\t\tconst queryString = window.location.search;\n\t\tconst urlParams = new URLSearchParams(queryString);\n\t\treturn urlParams.get('small') == '1';\n\t}\n\tstatic mock_html() {\n\t\tconst queryString = window.location.search;\n\t\tconst urlParams = new URLSearchParams(queryString);\n\t\treturn urlParams.get('mock_html') == '1';\n\t}\n\tstatic init() {\n\t\tif (this.small()) {\n\t\t\tconst app = document.getElementById(HTMLController.ID_APP);\n\t\t\tif (app) {\n\t\t\t\tapp.classList.add('small');\n\t\t\t}\n\t\t}\n\t}\n}\n","import {CoreTransform, RotationOrder} from '@polygonjs/polygonjs/src/core/Transform';\nimport {Vector3} from 'three/src/math/Vector3';\n\nexport enum SiloRole {\n\tSTRATEGY = 0,\n\tDESIGN = 1,\n\tDEVELOPMENT = 2,\n\tMARKETING = 3,\n\tPRODUCTION = 4,\n\tTECHNOLOGY = 5,\n}\nexport enum SiloRoleName {\n\tSTRATEGY = 'Strategy',\n\tDESIGN = 'Design',\n\tDEVELOPMENT = 'Development',\n\tMARKETING = 'Marketing',\n\tPRODUCTION = 'Production',\n\tTECHNOLOGY = 'Technology',\n}\nexport const SILO_ROLE_NAMES: SiloRoleName[] = [\n\tSiloRoleName.STRATEGY,\n\tSiloRoleName.DESIGN,\n\tSiloRoleName.DEVELOPMENT,\n\tSiloRoleName.MARKETING,\n\tSiloRoleName.PRODUCTION,\n\tSiloRoleName.TECHNOLOGY,\n];\nexport enum SiloLocation {\n\tNEW_YORK = 'new_york',\n\tLONDON = 'london',\n\tBERLIN = 'berlin',\n\tKIEV = 'kiev',\n\tBOSTON = 'boston',\n\tTEL_AVIV = 'tel_aviv',\n\tBANGALORE = 'bangalore',\n\tBANGKOK = 'bangkok',\n\tSYDNEY = 'sydney',\n\tSEATTLE = 'seattle',\n\tSAN_JOSE = 'san_jose',\n\tMEDELLIN = 'medellin',\n\tBUENOS_AIRES = 'buenos_aires',\n\tCAPE_TOWN = 'cape_town',\n}\n\ninterface Silo {\n\trole: SiloRole;\n\ttag: string;\n\trx: number;\n\try: number;\n}\n\nexport const SILOS_BY_NAME: Map<SiloLocation, Silo> = new Map();\nSILOS_BY_NAME.set(SiloLocation.NEW_YORK, {\n\trole: SiloRole.STRATEGY,\n\ttag: 'Digital Strategist',\n\trx: -13,\n\try: -5.1,\n});\nSILOS_BY_NAME.set(SiloLocation.LONDON, {\n\trole: SiloRole.DESIGN,\n\ttag: 'UI/UX Designer',\n\trx: -24,\n\try: 67.2,\n});\nSILOS_BY_NAME.set(SiloLocation.BERLIN, {\n\trole: SiloRole.TECHNOLOGY,\n\ttag: 'DevOps Engineer',\n\trx: -25.22,\n\try: 80.7,\n});\nSILOS_BY_NAME.set(SiloLocation.KIEV, {\n\trole: SiloRole.DEVELOPMENT,\n\ttag: 'Front-End Developer',\n\trx: 203,\n\try: -82,\n});\nSILOS_BY_NAME.set(SiloLocation.BOSTON, {\n\trole: SiloRole.MARKETING,\n\ttag: 'Digital Marketer',\n\trx: -17,\n\try: 0.7,\n});\nSILOS_BY_NAME.set(SiloLocation.TEL_AVIV, {\n\trole: SiloRole.TECHNOLOGY,\n\ttag: 'Blockchain Architect',\n\trx: -4.9,\n\try: 101.9,\n});\nSILOS_BY_NAME.set(SiloLocation.BANGALORE, {\n\trole: SiloRole.DEVELOPMENT,\n\ttag: 'iOS Developer',\n\trx: 7,\n\try: -219.2,\n});\nSILOS_BY_NAME.set(SiloLocation.BANGKOK, {\n\trole: SiloRole.PRODUCTION,\n\ttag: '3D Animator',\n\trx: 8.5,\n\try: -197,\n});\nSILOS_BY_NAME.set(SiloLocation.SYDNEY, {\n\trole: SiloRole.TECHNOLOGY,\n\ttag: 'SEO Specialist',\n\trx: 46.2,\n\try: 212,\n});\nSILOS_BY_NAME.set(SiloLocation.SEATTLE, {\n\trole: SiloRole.MARKETING,\n\ttag: 'Product Manager',\n\trx: -21.6,\n\try: 310,\n});\nSILOS_BY_NAME.set(SiloLocation.SAN_JOSE, {\n\trole: SiloRole.STRATEGY,\n\ttag: 'Creative Director',\n\trx: -5.8,\n\try: -41.1,\n});\nSILOS_BY_NAME.set(SiloLocation.MEDELLIN, {\n\trole: SiloRole.DEVELOPMENT,\n\ttag: 'Full-Stack Developer',\n\trx: 17.3,\n\try: -3.6,\n});\nSILOS_BY_NAME.set(SiloLocation.BUENOS_AIRES, {\n\trole: SiloRole.PRODUCTION,\n\ttag: 'Character Artist',\n\trx: 50,\n\try: 13.2,\n});\nSILOS_BY_NAME.set(SiloLocation.CAPE_TOWN, {\n\trole: SiloRole.MARKETING,\n\ttag: 'Copywriter',\n\trx: 46.1,\n\try: 445,\n});\nexport class SilosController {\n\tpublic readonly silos: Silo[] = [];\n\tpublic readonly locations: SiloLocation[] = [\n\t\tSiloLocation.NEW_YORK,\n\t\tSiloLocation.LONDON,\n\t\tSiloLocation.CAPE_TOWN,\n\t\tSiloLocation.BANGALORE,\n\t\tSiloLocation.SYDNEY,\n\t\tSiloLocation.SEATTLE,\n\t\tSiloLocation.BUENOS_AIRES,\n\t\tSiloLocation.BERLIN,\n\t\tSiloLocation.BANGKOK,\n\t\tSiloLocation.SAN_JOSE,\n\t\tSiloLocation.MEDELLIN,\n\t\tSiloLocation.BOSTON,\n\t\tSiloLocation.TEL_AVIV,\n\t\tSiloLocation.KIEV,\n\t];\n\tconstructor() {\n\t\t// const location_pairs: [SiloLocation, SiloLocation][] = [\n\t\t// \t[SiloLocation.NEW_YORK, SiloLocation.LONDON],\n\t\t// \t[SiloLocation.TEL_AVIV, SiloLocation.BANGALORE],\n\t\t// \t[SiloLocation.SYDNEY, SiloLocation.MEDELLIN],\n\t\t// \t[SiloLocation.BOSTON, SiloLocation.BERLIN],\n\t\t// \t[SiloLocation.CAPE_TOWN, SiloLocation.SAN_JOSE],\n\t\t// \t[SiloLocation.NEW_YORK, SiloLocation.SYDNEY],\n\t\t// \t[SiloLocation.BANGKOK, SiloLocation.KIEV],\n\t\t// \t[SiloLocation.LONDON, SiloLocation.SAN_JOSE],\n\t\t// \t[SiloLocation.BUENOS_AIRES, SiloLocation.SEATTLE],\n\t\t// ];\n\t\t// for (let location_pair of location_pairs) {\n\t\t// \tthis.locations.push(location_pair[0]);\n\t\t// \tthis.locations.push(location_pair[1]);\n\t\t// \tconst silo_start = SILOS_BY_NAME.get(location_pair[0]);\n\t\t// \tconst silo_end = SILOS_BY_NAME.get(location_pair[1]);\n\t\t// \tif (silo_start && silo_end) {\n\t\t// \t\tthis.silos.push(silo_start);\n\t\t// \t\tthis.silos.push(silo_end);\n\t\t// \t}\n\t\t//}\n\n\t\tfor (let location of this.locations) {\n\t\t\tconst silo = SILOS_BY_NAME.get(location);\n\t\t\tif (silo) {\n\t\t\t\tthis.silos.push(silo);\n\t\t\t}\n\t\t}\n\t}\n\n\tdata() {\n\t\treturn this.silos.map((silo) => {\n\t\t\treturn this._silo_data(silo);\n\t\t});\n\t}\n\n\tprivate _core_transform = new CoreTransform();\n\tprivate T = new Vector3(0, 0, 0);\n\tprivate S = new Vector3(1, 1, 1);\n\tprivate _silo_data(silo: Silo) {\n\t\tconst start_pos = new Vector3(0, 0, 1);\n\n\t\tstart_pos.applyMatrix4(this._matrix(silo.rx, 0));\n\t\tstart_pos.applyMatrix4(this._matrix(0, silo.ry));\n\n\t\treturn {\n\t\t\trole: silo.role,\n\t\t\tposition: start_pos.toArray(),\n\t\t};\n\t}\n\tprivate _matrix(rx: number, ry: number) {\n\t\treturn this._core_transform.matrix(this.T, new Vector3(rx, ry, 0), this.S, 1, RotationOrder.XYZ);\n\t}\n}\n","import {MainController} from '../MainController';\nimport {FeaturesController} from './FeaturesController';\nimport {SiloRole, SiloLocation, SILO_ROLE_NAMES, SILOS_BY_NAME, SilosController} from './SilosController';\n\ninterface TemplateAttributes {\n\trole: SiloRole;\n\tlocation: SiloLocation;\n}\n\nexport class HTMLController {\n\tstatic readonly ID_APP = 'webgl-globe-app';\n\tstatic readonly ID_PROFILES = 'webgl-globe-profiles';\n\n\tconstructor(protected main_controller: MainController) {}\n\tmove_profiles_to_css_objects() {\n\t\tconst app_element = document.getElementById(HTMLController.ID_APP);\n\t\tif (!app_element) {\n\t\t\tconsole.warn(`no element with id ${HTMLController.ID_APP}`);\n\t\t\treturn;\n\t\t}\n\t\tconst globe_profiles_element = document.getElementById(HTMLController.ID_PROFILES);\n\t\tif (!globe_profiles_element) {\n\t\t\tconsole.warn(`no element with id ${HTMLController.ID_PROFILES}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (FeaturesController.mock_html()) {\n\t\t\tthis._create_profile_templates(globe_profiles_element);\n\t\t}\n\n\t\tconst elements_parent = app_element.children[0];\n\t\tconst silos_controller = new SilosController();\n\t\tconst silos = silos_controller.silos;\n\t\tconst locations = silos_controller.locations;\n\t\tfor (let i = 0; i < silos.length; i++) {\n\t\t\tconst location = locations[i];\n\t\t\tconst css_object_element = elements_parent.children[i];\n\t\t\tif (css_object_element) {\n\t\t\t\tconst selector = `[data-location=${location}]`;\n\t\t\t\tconst profile_wrapper = globe_profiles_element.querySelector(selector);\n\t\t\t\tif (profile_wrapper) {\n\t\t\t\t\tconst profile_element = profile_wrapper.children[0];\n\t\t\t\t\tconst css_object_element_child = css_object_element.children[0];\n\t\t\t\t\tcss_object_element_child.innerHTML = '';\n\t\t\t\t\tcss_object_element_child.appendChild(profile_element.cloneNode(true));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.warn('webgl-globe, missing html element', i);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _create_profile_templates(container: HTMLElement) {\n\t\tSILOS_BY_NAME.forEach((silo, location) => {\n\t\t\tconst template = this._profile_template({role: silo.role, location: location});\n\t\t\tcontainer.append(template);\n\t\t});\n\t}\n\n\tprivate _profile_template(attribs: TemplateAttributes) {\n\t\tconst wrapper = document.createElement('div');\n\t\twrapper.classList.add('wrapper');\n\t\twrapper.dataset['location'] = attribs.location;\n\n\t\tconst main_element = document.createElement('div');\n\t\tmain_element.classList.add('globe-profile');\n\t\t// image\n\t\tconst thumbnail = document.createElement('img');\n\t\tthumbnail.classList.add('globe-profile-thumbnail');\n\t\tthumbnail.setAttribute('src', '/media/img/profiles/profile_test.01.128.jpg');\n\t\tmain_element.append(thumbnail);\n\t\t// body\n\t\tconst body = document.createElement('div');\n\t\tbody.classList.add('globe-profile-body');\n\t\tconst title_and_name = document.createElement('div');\n\t\ttitle_and_name.classList.add('globe-profile-title-and-name');\n\t\tconst title = document.createElement('div');\n\t\ttitle.classList.add('globe-profile-title');\n\t\tconst name = document.createElement('div');\n\t\tname.classList.add('globe-profile-name');\n\t\tconst tag = document.createElement('span');\n\t\ttag.classList.add('globe-profile-tag');\n\t\tconst role_s = SILO_ROLE_NAMES[attribs.role];\n\t\ttag.classList.add(`${role_s.toString().toLowerCase()}`);\n\t\ttag.innerText = role_s.toString().toLowerCase();\n\n\t\ttitle_and_name.append(title);\n\t\ttitle_and_name.append(name);\n\t\tbody.append(title_and_name);\n\t\tbody.append(tag);\n\t\tmain_element.append(body);\n\t\twrapper.append(main_element);\n\t\treturn wrapper;\n\t}\n}\n"],"sourceRoot":""}
