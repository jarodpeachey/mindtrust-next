(window.webpackJsonp=window.webpackJsonp||[]).push([["vendors~PolyRegister~SceneJsonImporter"],{100:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var s=n(43),r=n(81);class i extends s.a{constructor(){super(...arguments),this.decomposed_path=new r.a}}},102:function(t,e,n){"use strict";n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return _})),n.d(e,"b",(function(){return c}));var s,r=n(12),i=n(79),o=n(103);!function(t){t.BOOL="bool",t.INT="int",t.FLOAT="float",t.VEC2="vec2",t.VEC3="vec3",t.VEC4="vec4",t.SAMPLER_2D="sampler2D"}(s||(s={}));s.BOOL,s.INT,s.FLOAT,s.VEC2,s.VEC3,s.VEC4;const a={[s.BOOL]:r.a.BOOLEAN,[s.INT]:r.a.INTEGER,[s.FLOAT]:r.a.FLOAT,[s.VEC2]:r.a.VECTOR2,[s.VEC3]:r.a.VECTOR3,[s.VEC4]:r.a.VECTOR4,[s.SAMPLER_2D]:r.a.RAMP},_={[r.a.BOOLEAN]:s.BOOL,[r.a.COLOR]:s.VEC3,[r.a.INTEGER]:s.INT,[r.a.FLOAT]:s.FLOAT,[r.a.FOLDER]:void 0,[r.a.VECTOR2]:s.VEC2,[r.a.VECTOR3]:s.VEC3,[r.a.VECTOR4]:s.VEC4,[r.a.BUTTON]:void 0,[r.a.OPERATOR_PATH]:void 0,[r.a.PARAM_PATH]:void 0,[r.a.NODE_PATH]:void 0,[r.a.RAMP]:void 0,[r.a.SEPARATOR]:void 0,[r.a.STRING]:void 0},u={[s.BOOL]:!1,[s.INT]:0,[s.FLOAT]:0,[s.VEC2]:[0,0],[s.VEC3]:[0,0,0],[s.VEC4]:[0,0,0,0],[s.SAMPLER_2D]:i.a.DEFAULT_VALUE_JSON};s.BOOL,s.INT,s.FLOAT,s.VEC2,s.VEC3,s.VEC4,s.SAMPLER_2D;class c extends o.a{constructor(t,e,n){super(t,e),this._name=t,this._type=e,this._init_value=n,this._init_value=this._init_value||u[this._type]}type(){return this._type}are_types_matched(t,e){return t==e}get param_type(){return a[this._type]}get init_value(){return this._init_value}toJSON(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type}}}},103:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{constructor(t,e,n){this._name=t,this._type=e,this._init_value=n}get init_value(){return this._init_value}name(){return this._name}type(){return this._type}are_types_matched(t,e){return!0}toJSON(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type}}}},105:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return r}));const s="operationsComposer";class r{constructor(t,e){this.scene=t,this.states=e}static type(){throw"type to be overriden"}type(){return this.constructor.type()}static context(){throw console.error("operation has no node_context",this),"context requires override"}context(){return this.constructor.context()}cook(t,e){}}r.DEFAULT_PARAMS={},r.INPUT_CLONED_STATE=[]},12:function(t,e,n){"use strict";var s;n.d(e,"a",(function(){return s})),function(t){t.BOOLEAN="boolean",t.BUTTON="button",t.COLOR="color",t.FLOAT="float",t.FOLDER="folder",t.INTEGER="integer",t.OPERATOR_PATH="operator_path",t.PARAM_PATH="param_path",t.NODE_PATH="node_path",t.RAMP="ramp",t.SEPARATOR="separator",t.STRING="string",t.VECTOR2="vector2",t.VECTOR3="vector3",t.VECTOR4="vector4"}(s||(s={}))},120:function(t,e,n){"use strict";var s;n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return r})),function(t){t.BasisTextureLoader="BasisTextureLoader",t.DRACOLoader="DRACOLoader",t.EXRLoader="EXRLoader",t.FBXLoader="FBXLoader",t.GLTFLoader="GLTFLoader",t.OBJLoader="OBJLoader",t.PDBLoader="PDBLoader",t.PLYLoader="PLYLoader",t.RGBELoader="RGBELoader",t.SVGLoader="SVGLoader",t.STLLoader="STLLoader",t.TTFLoader="TTFLoader"}(s||(s={}));class r{constructor(){this._loaded_module_by_name=new Map,this._promise_by_name=new Map}register(t,e){this._promise_by_name.set(t,e)}async module(t){const e=this._loaded_module_by_name.get(t);if(e)return e;{const e=this._promise_by_name.get(t);if(e){const n=await e;if(n)return this._loaded_module_by_name.set(t,n),n}else console.warn(`module ${t} not registered`)}}}},121:function(t,e,n){"use strict";var s;n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return r})),function(t){t.GL_MESH_BASIC="GL_MESH_BASIC",t.GL_MESH_LAMBERT="GL_MESH_LAMBERT",t.GL_MESH_STANDARD="GL_MESH_STANDARD",t.GL_PARTICLES="GL_PARTICLES",t.GL_POINTS="GL_POINTS",t.GL_TEXTURE="GL_TEXTURE",t.GL_VOLUME="GL_VOLUME"}(s||(s={}));class r{constructor(){this._controller_assembler_by_name=new Map}register(t,e,n){this._controller_assembler_by_name.set(t,{controller:e,assembler:n})}unregister(t){this._controller_assembler_by_name.delete(t)}}},122:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var s=n(28),r=n(7);class i extends s.a{constructor(t,e,n){var s;super(t.scene(),"MethodDependency"),this.param=t,this.path_argument=e,this.decomposed_path=n,this._update_from_name_change_bound=this._update_from_name_change.bind(this),null===(s=t.expressionController)||void 0===s||s.registerMethodDependency(this),this.addPostDirtyHook("_update_from_name_change",this._update_from_name_change_bound)}_update_from_name_change(t){if(t&&this.decomposed_path){const e=t;this.decomposed_path.update_from_name_change(e);const n=this.decomposed_path.to_path(),s=this.jsep_node;s&&(s.value=(""+s.value).replace(""+this.path_argument,n),s.raw=s.raw.replace(""+this.path_argument,n)),this.param.expressionController&&this.param.expressionController.update_from_method_dependency_name_change()}}reset(){this.graphDisconnectPredecessors()}listen_for_name_changes(){if(this.jsep_node&&this.decomposed_path)for(let t of this.decomposed_path.named_nodes())if(t){const e=t;e.nameController&&this.addGraphInput(e.nameController.graph_node)}}set_jsep_node(t){this.jsep_node=t}set_resolved_graph_node(t){this.resolved_graph_node=t}set_unresolved_path(t){this.unresolved_path=t}static create(t,e,n,s){const o=r.a.isNumber(e),a=new i(t,e,s);if(n)a.set_resolved_graph_node(n);else if(!o){const t=e;a.set_unresolved_path(t)}return a}}},126:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{constructor(t){this._index=t}index(){return this._index}}},127:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));const s=function(t){return function(e){return Math.pow(e,t)}},r=function(t){return function(e){return 1-Math.abs(Math.pow(e-1,t))}},i=function(t){return function(e){return e<.5?s(t)(2*e)/2:r(t)(2*e-1)/2+.5}},o={linear:i(1),ease_i:function(t,e){return s(e)(t)},ease_o:function(t,e){return r(e)(t)},ease_io:function(t,e){return i(e)(t)},ease_i2:s(2),ease_o2:r(2),ease_io2:i(2),ease_i3:i(3),ease_o3:i(3),ease_io3:i(3),ease_i4:i(4),ease_o4:i(4),ease_io4:i(4),ease_i_sin:function(t){return 1+Math.sin(Math.PI/2*t-Math.PI/2)},ease_o_sin:function(t){return Math.sin(Math.PI/2*t)},ease_io_sin:function(t){return(1+Math.sin(Math.PI*t-Math.PI/2))/2},ease_i_elastic:function(t){return(.04-.04/t)*Math.sin(25*t)+1},ease_o_elastic:function(t){return.04*t/--t*Math.sin(25*t)},ease_io_elastic:function(t){return(t-=.5)<0?(.02+.01/t)*Math.sin(50*t):(.02-.01/t)*Math.sin(50*t)+1}}},128:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var s=n(25);class r{static create_index_if_none(t){if(!t.index){const e=t.getAttribute("position");if(e){const n=e.array;t.setIndex(s.a.range(n.length/3))}}}}},13:function(t,e,n){"use strict";var s;n.d(e,"a",(function(){return s})),function(t){t.ALWAYS="always",t.NEVER="never",t.FROM_NODE="from_node"}(s||(s={}))},146:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{constructor(t){this.node=t}toJSON(t=!1){var e,n,s,r,i,o;const a={name:this.node.name(),type:this.node.type(),graph_node_id:this.node.graphNodeId(),is_dirty:this.node.isDirty(),ui_data_json:this.node.uiData.toJSON(),error_message:this.node.states.error.message(),children:this.childrenIds(),maxInputsCount:this.maxInputsCount(),inputs:this.inputIds(),input_connection_output_indices:this.input_connection_output_indices(),named_input_connection_points:this.named_input_connection_points(),named_output_connection_points:this.named_output_connection_points(),param_ids:this.to_json_params(t),override_cloned_state_allowed:this.node.io.inputs.overrideClonedStateAllowed(),inputs_clone_required_states:this.node.io.inputs.cloneRequiredStates(),flags:{display:null===(n=null===(e=this.node.flags)||void 0===e?void 0:e.display)||void 0===n?void 0:n.active(),bypass:null===(r=null===(s=this.node.flags)||void 0===s?void 0:s.bypass)||void 0===r?void 0:r.active(),optimize:null===(o=null===(i=this.node.flags)||void 0===i?void 0:i.optimize)||void 0===o?void 0:o.active()},selection:void 0};return this.node.childrenAllowed()&&this.node.childrenController&&(a.selection=this.node.childrenController.selection.toJSON()),a}childrenIds(){return this.node.children().map(t=>t.graphNodeId())}maxInputsCount(){return this.node.io.inputs.maxInputsCount()}inputIds(){return this.node.io.inputs.inputs().map(t=>null!=t?t.graphNodeId():void 0)}input_connection_output_indices(){var t;return null===(t=this.node.io.connections.inputConnections())||void 0===t?void 0:t.map(t=>null!=t?t.output_index:void 0)}named_input_connection_points(){return this.node.io.inputs.named_input_connection_points.map(t=>t.toJSON())}named_output_connection_points(){return this.node.io.outputs.named_output_connection_points.map(t=>t.toJSON())}to_json_params_from_names(t,e=!1){return t.map(t=>this.node.params.get(t).graphNodeId())}to_json_params(t=!1){return this.to_json_params_from_names(this.node.params.names,t)}}},147:function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return l}));var s=n(12),r=n(36),i=n(28),o=n(7),a=n(25),_=n(59);var u,c;!function(t){t.TYPESCRIPT="typescript"}(u||(u={})),function(t){t.TEXTURE_IMAGE="texture_image",t.TEXTURE_VIDEO="texture_video",t.GEOMETRY="geometry",t.FONT="font",t.SVG="svg"}(c||(c={}));class l{constructor(t){this._param=t,this._programatic_visible_state=!0,this._callbackAllowed=!1,this._update_visibility_and_remove_dirty_bound=this.update_visibility_and_remove_dirty.bind(this),this._ui_data_dependency_set=!1}dispose(){var t;this._options.callback=void 0,this._options.callbackString=void 0,null===(t=this._visibility_graph_node)||void 0===t||t.dispose()}set(t){this._default_options=t,this._options=_.a.cloneDeep(this._default_options),this.post_set_options()}copy(t){this._default_options=_.a.cloneDeep(t.default()),this._options=_.a.cloneDeep(t.current()),this.post_set_options()}set_option(t,e){if(this._options[t]=e,this._param.components)for(let n of this._param.components)n.options.set_option(t,e)}post_set_options(){this._handle_computeOnDirty()}param(){return this._param}node(){return this._param.node}default(){return this._default_options}current(){return this._options}has_options_overridden(){return!_.a.isEqual(this._options,this._default_options)}overridden_options(){const t={},e=Object.keys(this._options);for(let n of e)if(!_.a.isEqual(this._options[n],this._default_options[n])){const e=_.a.cloneDeep(this._options[n]);Object.assign(t,{[n]:e})}return t}overridden_option_names(){return Object.keys(this.overridden_options())}computeOnDirty(){return this._options.computeOnDirty||!1}_handle_computeOnDirty(){this.computeOnDirty()&&(this._computeOnDirty_callback_added||(this.param().addPostDirtyHook("computeOnDirty",this._compute_param.bind(this)),this._computeOnDirty_callback_added=!0))}async _compute_param(){await this.param().compute()}has_callback(){return null!=this._options.callback||null!=this._options.callbackString}allowCallback(){this._callbackAllowed=!0}execute_callback(){if(!this._callbackAllowed)return;if(!this.node())return;if(!this.node().scene().loadingController.loaded())return;const t=this.get_callback();if(null!=t){const e=this.param().parent_param;e?e.options.execute_callback():t(this.node(),this.param())}}get_callback(){if(this.has_callback())return this._options.callback=this._options.callback||this.create_callback_from_string()}create_callback_from_string(){const t=this._options.callbackString;if(t){const e=new Function("node","scene","window","location",t);return()=>{e(this.node(),this.node().scene(),null,null)}}}color_conversion(){return this._options.conversion}makes_node_dirty_when_dirty(){let t;if(null!=this.param().parent_param)return!1;let e=!0;return null!=(t=this._options.cook)&&(e=t),e}file_browse_option(){return this._options.fileBrowse}file_browse_allowed(){return null!=this.file_browse_option()}file_browse_type(){const t=this.file_browse_option();return t?t.type:null}is_expression_for_entities(){const t=this._options.expression;return t&&t.forEntities||!1}level(){return this._options.level||0}has_menu(){return null!=this.menu_options()}menu_options(){return this._options.menu}menu_entries(){const t=this.menu_options();return t?t.entries:[]}has_menu_radio(){return this.has_menu()}is_multiline(){return!0===this._options.multiline}language(){return this._options.language}is_code(){return null!=this.language()}node_selection_options(){return this._options.nodeSelection}node_selection_context(){const t=this.node_selection_options();if(t)return t.context}node_selection_types(){const t=this.node_selection_options();if(t)return t.types}dependent_on_found_node(){return!("dependentOnFoundNode"in this._options)||this._options.dependentOnFoundNode}is_selecting_param(){return null!=this.param_selection_options()}param_selection_options(){return this._options.paramSelection}param_selection_type(){const t=this.param_selection_options();if(t){const e=t;if(!o.a.isBoolean(e))return e}}range(){return this._options.range||[0,1]}step(){return this._options.step}range_locked(){return this._options.rangeLocked||[!1,!1]}ensure_in_range(t){const e=this.range();return t>=e[0]&&t<=e[1]?t:t<e[0]?!0===this.range_locked()[0]?e[0]:t:!0===this.range_locked()[1]?e[1]:t}is_spare(){return this._options.spare||!1}texture_options(){return this._options.texture}texture_as_env(){const t=this.texture_options();return null!=t&&!0===t.env}is_hidden(){return!0===this._options.hidden||!1===this._programatic_visible_state}is_visible(){return!this.is_hidden()}set_visible_state(t){this._options.hidden=!t,this.param().emit(r.a.VISIBLE_UPDATED)}label(){return this._options.label}is_label_hidden(){const t=this.param().type();return t===s.a.BUTTON||t===s.a.SEPARATOR||t===s.a.BOOLEAN&&this.is_field_hidden()}is_field_hidden(){return!1===this._options.field}ui_data_depends_on_other_params(){return"visibleIf"in this._options}visibility_predecessors(){const t=this._options.visibleIf;if(!t)return[];let e=[];e=o.a.isArray(t)?a.a.uniq(t.map(t=>Object.keys(t)).flat()):Object.keys(t);const n=this.param().node;return a.a.compact(e.map(t=>{const e=n.params.get(t);if(e)return e;console.error(`param ${t} not found as visibility condition for ${this.param().name()} in node ${this.param().node.type()}`)}))}set_ui_data_dependency(){if(this._ui_data_dependency_set)return;this._ui_data_dependency_set=!0;const t=this.visibility_predecessors();if(t.length>0){this._visibility_graph_node=new i.a(this.param().scene(),"param_visibility");for(let e of t)this._visibility_graph_node.addGraphInput(e);this._visibility_graph_node.addPostDirtyHook("_update_visibility_and_remove_dirty",this._update_visibility_and_remove_dirty_bound)}}update_visibility_and_remove_dirty(){this.update_visibility(),this.param().removeDirtyState()}async update_visibility(){const t=this._options.visibleIf;if(t){const e=this.visibility_predecessors(),n=e.map(t=>{if(t.isDirty())return t.compute()});if(this._programatic_visible_state=!1,await Promise.all(n),o.a.isArray(t))for(let n of t){e.filter(t=>t.value==n[t.name()]).length==e.length&&(this._programatic_visible_state=!0)}else{const n=e.filter(e=>e.value==t[e.name()]);this._programatic_visible_state=n.length==e.length}this.param().emit(r.a.VISIBLE_UPDATED)}}}},148:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n(257),r=n.n(s),i=n(7);r.a.addUnaryOp("@");r.a.addBinaryOp("**",10);class o{constructor(){}parse_expression(t){try{this.reset(),this.node=r()(t)}catch(e){const n=`could not parse the expression '${t}' (error: ${e})`;this.error_message=n}}parse_expression_for_string_param(t){try{this.reset();const e=o.string_value_elements(t),n=[];for(let t=0;t<e.length;t++){const s=e[t];let i;i=t%2==1?r()(s):{type:"Literal",value:`'${s}'`,raw:`'${s}'`},n.push(i)}this.node={type:"CallExpression",arguments:n,callee:{type:"Identifier",name:"strConcat"}}}catch(e){const n=`could not parse the expression '${t}' (error: ${e})`;this.error_message=n}}static string_value_elements(t){return null!=t&&i.a.isString(t)?t.split("`"):[]}reset(){this.node=void 0,this.error_message=void 0}}},149:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var s=n(98),r=n(12),i=n(22),o=n(7);class a extends s.a{static type(){return r.a.FLOAT}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copy_value(t){this.set(t.valueSerialized())}_prefilter_invalid_raw_input(t){return o.a.isArray(t)?t[0]:o.a.isString(t)&&i.a.isNumber(t)?parseFloat(t):t}static are_raw_input_equal(t,e){return t==e}static are_values_equal(t,e){return t==e}static convert(t){if(o.a.isNumber(t))return t;if(o.a.isBoolean(t))return t?1:0;if(i.a.isNumber(t)){const e=parseFloat(t);if(o.a.isNumber(e))return e}return null}convert(t){const e=a.convert(t);return e?this.options.ensure_in_range(e):e}}},15:function(t,e,n){"use strict";n.d(e,"l",(function(){return s})),n.d(e,"k",(function(){return y})),n.d(e,"p",(function(){return b})),n.d(e,"m",(function(){return w})),n.d(e,"o",(function(){return x})),n.d(e,"n",(function(){return E})),n.d(e,"e",(function(){return T})),n.d(e,"a",(function(){return O})),n.d(e,"f",(function(){return C})),n.d(e,"h",(function(){return N})),n.d(e,"d",(function(){return k})),n.d(e,"i",(function(){return S})),n.d(e,"g",(function(){return R})),n.d(e,"b",(function(){return P})),n.d(e,"c",(function(){return I})),n.d(e,"j",(function(){return D}));var s,r=n(180),i=n(84),o=n(125),a=n(34),_=n(5),u=n(9),c=n(181),l=n(67),h=n(68),d=n(69),p=n(47),m=n(24),f=n(41),g=n(119),v=n(182);!function(t){t.OBJECT3D="Object3D",t.MESH="Mesh",t.POINTS="Points",t.LINE_SEGMENTS="LineSegments",t.LOD="LOD"}(s||(s={}));const y={[s.MESH]:f.a,[s.POINTS]:o.a,[s.LINE_SEGMENTS]:g.a,[s.OBJECT3D]:m.a,[s.LOD]:v.a};function b(t){switch(t){case m.a:return s.OBJECT3D;case f.a:return s.MESH;case o.a:return s.POINTS;case g.a:return s.LINE_SEGMENTS;case v.a:return s.LOD;default:return console.warn("object type not supported",t),s.MESH}}function w(t){return t instanceof f.a?s.MESH:t instanceof g.a?s.LINE_SEGMENTS:t instanceof o.a?s.POINTS:t instanceof m.a?s.OBJECT3D:void console.warn("ObjectTypeByObject received an unknown object type",t)}const x=[s.MESH,s.POINTS,s.LINE_SEGMENTS],E=[{name:"Mesh",value:x.indexOf(s.MESH)},{name:"Points",value:x.indexOf(s.POINTS)},{name:"LineSegments",value:x.indexOf(s.LINE_SEGMENTS)}],A={MeshStandard:new h.a({color:16777215,side:_.G,metalness:.5,roughness:.9}),[s.MESH]:new d.a({color:new u.a(1,1,1),side:_.G,vertexColors:!1,transparent:!0,depthTest:!0}),[s.POINTS]:new l.a({color:16777215,size:.1,depthTest:!0}),[s.LINE_SEGMENTS]:new p.a({color:16777215,linewidth:1})};var T;!function(t){t[t.VERTEX=0]="VERTEX",t[t.OBJECT=1]="OBJECT"}(T||(T={}));const O=[T.VERTEX,T.OBJECT],C=[{name:"vertex",value:T.VERTEX},{name:"object",value:T.OBJECT}];var N;!function(t){t[t.NUMERIC=0]="NUMERIC",t[t.STRING=1]="STRING"}(N||(N={}));const k=[N.NUMERIC,N.STRING],S=[{name:"numeric",value:N.NUMERIC},{name:"string",value:N.STRING}];var R;!function(t){t[t.FLOAT=1]="FLOAT",t[t.VECTOR2=2]="VECTOR2",t[t.VECTOR3=3]="VECTOR3",t[t.VECTOR4=4]="VECTOR4"}(R||(R={}));const P=[R.FLOAT,R.VECTOR2,R.VECTOR3,R.VECTOR4],I=[R.FLOAT,R.VECTOR4],D={ATTRIB_CLASS:{VERTEX:T.VERTEX,OBJECT:T.OBJECT},OBJECT_TYPES:x,CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME:{[i.a.name]:"Scene",[a.a.name]:"Group",[m.a.name]:"Object3D",[f.a.name]:"Mesh",[o.a.name]:"Points",[g.a.name]:"LineSegments",[c.a.name]:"Bone",[r.a.name]:"SkinnedMesh"},CONSTRUCTORS_BY_NAME:{[s.MESH]:f.a,[s.POINTS]:o.a,[s.LINE_SEGMENTS]:g.a},MATERIALS:A}},150:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var s,r=n(100),i=n(21),o=n(12),a=n(36),_=n(7);!function(t){t.NODE="NODE",t.PARAM="PARAM"}(s||(s={}));class u extends r.a{constructor(){super(...arguments),this._found_node=null,this._found_node_with_expected_type=null,this._found_param=null,this._found_param_with_expected_type=null}static type(){return o.a.OPERATOR_PATH}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return""+this._raw_input}valueSerialized(){return""+this.value}_copy_value(t){this.set(t.valueSerialized())}static are_raw_input_equal(t,e){return t==e}static are_values_equal(t,e){return t==e}isDefault(){return this._value==this._default_value}setNode(t){this.set(t.fullPath())}processRawInput(){this._value!=this._raw_input&&(this._value=this._raw_input,this.setDirty(),this.emitController.emit(a.a.VALUE_UPDATED))}async process_computation(){this.find_target()}find_target(){if(!this.node)return;const t=this._value;let e=null,n=null;const r=null!=t&&""!==t,o=this.options.param_selection_options()?s.PARAM:s.NODE;this.scene().referencesController.reset_reference_from_param(this),this.decomposed_path.reset(),r&&(o==s.PARAM?n=i.a.find_param(this.node,t,this.decomposed_path):e=i.a.find_node(this.node,t,this.decomposed_path));const a=o==s.PARAM?this._found_param:this._found_node,_=o==s.PARAM?n:e;if(this.scene().referencesController.set_named_nodes_from_param(this),e&&this.scene().referencesController.set_reference_from_param(this,e),(null==a?void 0:a.graphNodeId())!==(null==_?void 0:_.graphNodeId())){const t=this.options.dependent_on_found_node();this._found_node&&t&&this.removeGraphInput(this._found_node),o==s.PARAM?(this._found_param=n,this._found_node=null):(this._found_node=e,this._found_param=null),e&&this._assign_found_node(e),n&&this._assign_found_param(n),this.options.execute_callback()}this.removeDirtyState()}_assign_found_node(t){const e=this.options.dependent_on_found_node();this._is_node_expected_context(t)?this._is_node_expected_type(t)?(this._found_node_with_expected_type=t,e&&this.addGraphInput(t)):this.states.error.set(`node type is ${t.type()} but the params expects one of ${(this._expected_node_types()||[]).join(", ")}`):this.states.error.set(`node context is ${t.nodeContext()} but the params expects a ${this._expected_context()}`)}_assign_found_param(t){this._is_param_expected_type(t)?this._found_param_with_expected_type=t:this.states.error.set(`param type is ${t.type()} but the params expects a ${this._expected_param_type()}`)}found_node(){return this._found_node}found_param(){return this._found_param}found_node_with_context(t){return this._found_node_with_expected_type}found_node_with_context_and_type(t,e){const n=this.found_node_with_context(t);if(n)if(_.a.isArray(e)){for(let t of e)if(n.type()==t)return n;this.states.error.set(`expected node type to be ${e.join(", ")}, but was instead ${n.type()}`)}else{const t=e;if(n.type()==t)return n;this.states.error.set(`expected node type to be ${t}, but was instead ${n.type()}`)}}found_param_with_type(t){if(this._found_param_with_expected_type)return this._found_param_with_expected_type}found_node_with_expected_type(){return this._found_node_with_expected_type}_expected_context(){return this.options.node_selection_context()}_is_node_expected_context(t){var e,n;const s=this._expected_context();if(null==s)return!0;return s==(null===(n=null===(e=t.parent())||void 0===e?void 0:e.childrenController)||void 0===n?void 0:n.context)}_expected_node_types(){return this.options.node_selection_types()}_expected_param_type(){return this.options.param_selection_type()}_is_node_expected_type(t){const e=this._expected_node_types();return null==e||(null==e?void 0:e.includes(t.type()))}_is_param_expected_type(t){const e=this._expected_node_types();return null==e||e.includes(t.type())}notify_path_rebuild_required(t){this.decomposed_path.update_from_name_change(t);const e=this.decomposed_path.to_path();this.set(e)}notify_target_param_owner_params_updated(t){this.setDirty()}}},151:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var s=n(43),r=n(148),i=n(12),o=n(176),a=n(36),_=n(7);class u extends s.a{static type(){return i.a.STRING}defaultValueSerialized(){return this._default_value}_clone_raw_input(t){return""+t}rawInputSerialized(){return""+this._raw_input}valueSerialized(){return""+this.value}_copy_value(t){this.set(t.value)}static are_raw_input_equal(t,e){return t==e}static are_values_equal(t,e){return t==e}isDefault(){return this._raw_input==this._default_value}convert(t){return _.a.isString(t)?t:""+t}rawInput(){return this._raw_input}processRawInput(){this.states.error.clear(),this._value_elements(this._raw_input).length>=3?(this._expression_controller=this._expression_controller||new o.a(this),this._raw_input!=this._expression_controller.expression()&&(this._expression_controller.set_expression(this._raw_input),this.setDirty(),this.emitController.emit(a.a.EXPRESSION_UPDATED))):this._raw_input!=this._value&&(this._value=this._raw_input,this.removeDirtyState(),this.setSuccessorsDirty(this),this.emitController.emit(a.a.VALUE_UPDATED),this.options.execute_callback(),this._expression_controller&&(this._expression_controller.set_expression(void 0,!1),this.emitController.emit(a.a.EXPRESSION_UPDATED)))}async process_computation(){var t;if((null===(t=this.expressionController)||void 0===t?void 0:t.active())&&!this.expressionController.requires_entities()){const t=await this.expressionController.compute_expression();if(this.expressionController.is_errored())this.states.error.set("expression error: "+this.expressionController.error_message());else{const e=this.convert(t);null!=e?(this._value=e,this.emitController.emit(a.a.VALUE_UPDATED),this.options.execute_callback()):this.states.error.set(`expression returns an invalid type (${t})`),this.removeDirtyState()}}}_value_elements(t){return r.a.string_value_elements(t)}}},157:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n(38),r=n(8),i=n(52);class o extends s.a{constructor(){super(...arguments),this._cook_without_inputs_bound=this._cook_without_inputs.bind(this)}static nodeContext(){return r.g.EVENT}initializeBaseNode(){this.uiData.setLayoutHorizontal(),this.addPostDirtyHook("cook_without_inputs_on_dirty",this._cook_without_inputs_bound),this.io.inputs.set_depends_on_inputs(!1),this.io.connections.initInputs(),this.io.connection_points.spare_params.initializeNode()}_cook_without_inputs(){this.cookController.cook_main_without_inputs()}cook(){this.cookController.end_cook()}process_event_via_connection_point(t,e){e.event_listener?e.event_listener(t):this.process_event(t)}process_event(t){}async dispatch_event_to_output(t,e){this.run_on_dispatch_hook(t,e);const n=this.io.outputs.get_output_index(t);if(n>=0){const t=this.io.connections.outputConnections().filter(t=>t.output_index==n);let s;for(let n of t){s=n.node_dest;const t=s.io.inputs.named_input_connection_points[n.input_index];s.process_event_via_connection_point(e,t)}}else console.warn(`requested output '${t}' does not exist on node '${this.fullPath()}'`)}onDispatch(t,e){this._on_dispatch_hooks_by_output_name=this._on_dispatch_hooks_by_output_name||new Map,i.a.push_on_array_at_entry(this._on_dispatch_hooks_by_output_name,t,e)}run_on_dispatch_hook(t,e){if(this._on_dispatch_hooks_by_output_name){const n=this._on_dispatch_hooks_by_output_name.get(t);if(n)for(let t of n)t(e)}}}},176:function(t,e,n){"use strict";n.d(e,"a",(function(){return E}));var s=n(148);var r=n(31),i=n(127),o=n(7);class a{constructor(t){this.param=t,this._set_error_from_error_bound=this._set_error_from_error.bind(this)}clear_error(){this._error_message=void 0}set_error(t){this._error_message=this._error_message||t}_set_error_from_error(t){o.a.isString(t)?this._error_message=t:this._error_message=t.message}is_errored(){return null!=this._error_message}error_message(){return this._error_message}reset(){this._error_message=void 0}traverse_node(t){const e="traverse_"+t.type;if(this[e])return this[e](t);this.set_error("expression unknown node type: "+t.type)}traverse_BinaryExpression(t){return`${this.traverse_node(t.left)} ${t.operator} ${this.traverse_node(t.right)}`}traverse_LogicalExpression(t){return`${this.traverse_node(t.left)} ${t.operator} ${this.traverse_node(t.right)}`}traverse_MemberExpression(t){return`${this.traverse_node(t.object)}.${this.traverse_node(t.property)}`}traverse_ConditionalExpression(t){return`(${this.traverse_node(t.test)}) ? (${this.traverse_node(t.consequent)}) : (${this.traverse_node(t.alternate)})`}traverse_Compound(t){const e=t.body;let n=[];for(let t=0;t<e.length;t++){const s=e[t];"Identifier"==s.type?"$"==s.name[0]?n.push("`${"+this.traverse_node(s)+"}`"):n.push(`'${s.name}'`):n.push("`${"+this.traverse_node(s)+"}`")}return n.join(" + ")}traverse_Literal(t){return""+t.raw}}class _{constructor(){}reset(){this._attribute_names&&this._attribute_names.clear()}assign_attributes_lines(){var t;if(this._attribute_names){const e=[];return null===(t=this._attribute_names)||void 0===t||t.forEach(t=>{e.push(_.assign_attribute_line(t))}),e.join(";\n")}return""}assign_arrays_lines(){var t;if(this._attribute_names){const e=[];return null===(t=this._attribute_names)||void 0===t||t.forEach(t=>{e.push(_.assign_item_size_line(t)),e.push(_.assign_array_line(t))}),e.join(";\n")}return""}attribute_presence_check_line(){var t;if(this._attribute_names){const e=[];if(null===(t=this._attribute_names)||void 0===t||t.forEach(t=>{const n=_.var_attribute(t);e.push(n)}),e.length>0)return e.join(" && ")}return"true"}add(t){this._attribute_names=this._attribute_names||new Set,this._attribute_names.add(t)}static assign_attribute_line(t){return`const ${this.var_attribute(t)} = entities[0].geometry().attributes['${t}']`}static assign_item_size_line(t){const e=this.var_attribute(t);return`const ${this.var_attribute_size(t)} = ${e}.itemSize`}static assign_array_line(t){const e=this.var_attribute(t);return`const ${this.var_array(t)} = ${e}.array`}static var_attribute(t){return"attrib_"+t}static var_attribute_size(t){return"attrib_size_"+t}static var_array(t){return"array_"+t}var_attribute_size(t){return _.var_attribute_size(t)}var_array(t){return _.var_array(t)}}var u=n(58),c=n(22),l=n(20);const h={math_random:"random"},d=Object.keys(i.a),p={};["abs","acos","acosh","asin","asinh","atan","atan2","atanh","ceil","cos","cosh","exp","expm1","floor","log","log1p","log2","log10","max","min","pow","round","sign","sin","sinh","sqrt","tan","tanh"].forEach(t=>{p[t]="Math."+t}),["cbrt","hypot","log10","trunc"].forEach(t=>{p[t]="Math."+t}),Object.keys(h).forEach(t=>{const e=h[t];p[t]="Math."+e}),["fit","fit01","fract","deg2rad","rad2deg","rand","clamp"].forEach(t=>{p[t]="Core.Math."+t}),d.forEach(t=>{p[t]="Core.Math.Easing."+t}),["precision"].forEach(t=>{p[t]="Core.String."+t});const m={if:class{static if(t){return`(${t[0]}) ? (${t[1]}) : (${t[2]})`}}.if},f={};["E","LN2","LN10","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"].forEach(t=>{f[t]="Math."+t});const g={x:0,y:1,z:2,w:3,r:0,g:1,b:2};class v extends a{constructor(t){super(t),this.param=t,this._attribute_requirements_controller=new _,this.methods=[],this.method_index=-1,this.method_dependencies=[],this.immutable_dependencies=[]}parse_tree(t){if(this.reset(),null==t.error_message){try{if(this._attribute_requirements_controller.reset(),t.node){const e=this.traverse_node(t.node);e&&!this.is_errored()&&(this.function_main_string=e)}else console.warn("no parsed_tree.node")}catch(t){console.warn("error in expression for param "+this.param.fullPath()),console.warn(t)}if(this.function_main_string)try{this.function=new Function("Core","param","methods","_set_error_from_error",`\n\t\t\t\t\ttry {\n\t\t\t\t\t\t${this.function_body()}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t_set_error_from_error(e)\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}`)}catch(t){console.warn(t),this.set_error("cannot generate function")}else this.set_error("cannot generate function body")}else this.set_error("cannot parse expression")}reset(){super.reset(),this.function_main_string=void 0,this.methods=[],this.method_index=-1,this.function=void 0,this.method_dependencies=[],this.immutable_dependencies=[]}function_body(){return this.param.options.is_expression_for_entities()?`\n\t\t\tconst entities = param.expressionController.entities();\n\t\t\tif(entities){\n\t\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\t\tlet entity;\n\t\t\t\t\tconst entity_callback = param.expressionController.entity_callback();\n\t\t\t\t\t${this._attribute_requirements_controller.assign_attributes_lines()}\n\t\t\t\t\tif( ${this._attribute_requirements_controller.attribute_presence_check_line()} ){\n\t\t\t\t\t\t${this._attribute_requirements_controller.assign_arrays_lines()}\n\t\t\t\t\t\tfor(let index=0; index < entities.length; index++){\n\t\t\t\t\t\t\tentity = entities[index];\n\t\t\t\t\t\t\tresult = ${this.function_main_string};\n\t\t\t\t\t\t\tentity_callback(entity, result);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve()\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst error = new Error('attribute not found')\n\t\t\t\t\t\t_set_error_from_error(error)\n\t\t\t\t\t\treject(error)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\treturn []`:`\n\t\t\treturn new Promise( async (resolve, reject)=>{\n\t\t\t\ttry {\n\t\t\t\t\tconst value = ${this.function_main_string}\n\t\t\t\t\tresolve(value)\n\t\t\t\t} catch(e) {\n\t\t\t\t\t_set_error_from_error(e)\n\t\t\t\t\treject()\n\t\t\t\t}\n\t\t\t})\n\t\t\t`}eval_allowed(){return null!=this.function}eval_function(){if(this.function){this.clear_error();const t={Math:u.a,String:c.a};return this.function(t,this.param,this.methods,this._set_error_from_error_bound)}}traverse_CallExpression(t){const e=t.arguments.map(t=>this.traverse_node(t)),n=t.callee.name;if(n){const s=m[n];if(s)return s(e);const r=""+e.join(", "),i=p[n];if(i)return`${i}(${r})`;const o=l.a.expressionsRegister;if(o.getMethod(n)){const s=t.arguments[0],i="return "+e[0];let o,a=[];try{o=new Function(i),a=o()}catch{}return this._create_method_and_dependencies(n,a,s),`(await methods[${this.method_index}].process_arguments([${r}]))`}{const t=`method not found (${n}), available methods are: ${o.availableMethods().join(", ")}`;l.a.warn(t)}}this.set_error("unknown method: "+n)}traverse_BinaryExpression(t){return`(${this.traverse_node(t.left)} ${t.operator} ${this.traverse_node(t.right)})`}traverse_LogicalExpression(t){return`(${this.traverse_node(t.left)} ${t.operator} ${this.traverse_node(t.right)})`}traverse_MemberExpression(t){return`${this.traverse_node(t.object)}.${this.traverse_node(t.property)}`}traverse_UnaryExpression(t){if("@"===t.operator){let e,n,s=t.argument;switch(s.type){case"Identifier":e=s.name;break;case"MemberExpression":{const t=s,r=t.object,i=t.property;e=r.name,n=i.name;break}}if(e){if(e=r.b.remap_name(e),"ptnum"==e)return"((entity != null) ? entity.index() : 0)";{const t=this._attribute_requirements_controller.var_attribute_size(e),s=this._attribute_requirements_controller.var_array(e);if(this._attribute_requirements_controller.add(e),n){return`${s}[entity.index()*${t}+${g[n]}]`}return`${s}[entity.index()*${t}]`}}return console.warn("attribute not found"),""}return`${t.operator}${this.traverse_node(t.argument)}`}traverse_Literal(t){return""+t.raw}traverse_Identifier(t){if("$"!=t.name[0])return t.name;{const e=t.name.substr(1),n=f[e];if(n)return n;const s="traverse_Identifier_"+e;if(this[s])return this[s]();this.set_error("identifier unknown: "+t.name)}}traverse_Identifier_F(){return this.immutable_dependencies.push(this.param.scene().timeController.graphNode),"param.scene().timeController.frame()"}traverse_Identifier_T(){return this.immutable_dependencies.push(this.param.scene().timeController.graphNode),"param.scene().timeController.time()"}traverse_Identifier_CH(){return`'${this.param.name()}'`}traverse_Identifier_CEX(){return this._method_centroid("x")}traverse_Identifier_CEY(){return this._method_centroid("y")}traverse_Identifier_CEZ(){return this._method_centroid("z")}_method_centroid(t){const e=[0,`'${t}'`].join(", ");return this._create_method_and_dependencies("centroid",0),`(await methods[${this.method_index}].process_arguments([${e}]))`}_create_method_and_dependencies(t,e,n){const s=l.a.expressionsRegister,r=s.getMethod(t);if(!r){const e=`method not found (${t}), available methods are: ${s.availableMethods().join(", ")}`;return this.set_error(e),void l.a.warn(e)}const i=new r(this.param);if(this.method_index+=1,this.methods[this.method_index]=i,i.require_dependency()){const t=i.find_dependency(e);t?(n&&t.set_jsep_node(n),this.method_dependencies.push(t)):n&&o.a.isString(e)&&this.param.scene().missingExpressionReferencesController.register(this.param,n,e)}}}class y extends a{constructor(t){super(t),this.param=t}parse_tree(t){if(null==t.error_message&&t.node)try{return this.traverse_node(t.node)}catch(t){this.set_error("could not traverse tree")}else this.set_error("cannot parse tree")}traverse_CallExpression(t){const e=""+t.arguments.map(t=>this.traverse_node(t)).join(", ");return`${t.callee.name}(${e})`}traverse_UnaryExpression(t){return`${t.operator}${this.traverse_node(t.argument)}`}traverse_Identifier(t){return""+t.name}}class b{constructor(t){this.param=t,this.cyclic_graph_detected=!1,this.method_dependencies=[]}set_error(t){this.error_message=this.error_message||t}reset(){this.param.graphDisconnectPredecessors(),this.method_dependencies.forEach(t=>{t.reset()}),this.method_dependencies=[]}update(t){this.cyclic_graph_detected=!1,this.connect_immutable_dependencies(t),this.method_dependencies=t.method_dependencies,this.handle_method_dependencies(),this.listen_for_name_changes()}connect_immutable_dependencies(t){t.immutable_dependencies.forEach(t=>{if(0==this.cyclic_graph_detected&&0==this.param.addGraphInput(t))return this.cyclic_graph_detected=!0,this.set_error("cannot create expression, infinite graph detected"),void this.reset()})}handle_method_dependencies(){this.method_dependencies.forEach(t=>{0==this.cyclic_graph_detected&&this.handle_method_dependency(t)})}handle_method_dependency(t){const e=t.resolved_graph_node;if(e&&!this.param.addGraphInput(e))return this.cyclic_graph_detected=!0,this.set_error("cannot create expression, infinite graph detected"),void this.reset()}listen_for_name_changes(){this.method_dependencies.forEach(t=>{t.listen_for_name_changes()})}}var w=n(12);class x{constructor(t){this.param=t,this.parse_completed=!1,this.parse_started=!1,this.parsed_tree=new s.a,this.function_generator=new v(this.param),this.dependencies_controller=new b(this.param)}parse_expression(t){if(this.parse_started)throw new Error("parse in progress for param "+this.param.fullPath());this.parse_started=!0,this.parse_completed=!1,this.parsed_tree=this.parsed_tree||new s.a,this.reset(),this.param.type()==w.a.STRING?this.parsed_tree.parse_expression_for_string_param(t):this.parsed_tree.parse_expression(t),this.function_generator.parse_tree(this.parsed_tree),null==this.function_generator.error_message()&&(this.dependencies_controller.update(this.function_generator),this.dependencies_controller.error_message?this.param.states.error.set(this.dependencies_controller.error_message):(this.parse_completed=!0,this.parse_started=!1))}async compute_function(){if(!this.compute_allowed())return new Promise((t,e)=>{t(null)});try{return await this.function_generator.eval_function()}catch(t){return}}reset(){this.parse_completed=!1,this.parse_started=!1,this.dependencies_controller.reset(),this.function_generator.reset()}is_errored(){return this.function_generator.is_errored()}error_message(){return this.function_generator.error_message()}compute_allowed(){return this.function_generator.eval_allowed()}update_from_method_dependency_name_change(){this.expression_string_generator=this.expression_string_generator||new y(this.param);const t=this.expression_string_generator.parse_tree(this.parsed_tree);t?this.param.set(t):console.warn("failed to regenerate expression")}}class E{constructor(t){this.param=t}dispose(){this._resetMethodDependencies()}_resetMethodDependencies(){var t,e;null===(t=this._method_dependencies_by_graph_node_id)||void 0===t||t.forEach(t=>{t.dispose()}),null===(e=this._method_dependencies_by_graph_node_id)||void 0===e||e.clear()}registerMethodDependency(t){this._method_dependencies_by_graph_node_id=this._method_dependencies_by_graph_node_id||new Map,this._method_dependencies_by_graph_node_id.set(t.graphNodeId(),t)}active(){return null!=this._expression}expression(){return this._expression}is_errored(){return!!this._manager&&this._manager.is_errored()}error_message(){return this._manager?this._manager.error_message():null}requires_entities(){return this.param.options.is_expression_for_entities()}set_expression(t,e=!0){var n;this.param.scene().missingExpressionReferencesController.deregister_param(this.param),this.param.scene().expressionsController.deregister_param(this.param),this._expression!=t&&(this._resetMethodDependencies(),this._expression=t,this._expression?(this._manager=this._manager||new x(this.param),this._manager.parse_expression(this._expression)):null===(n=this._manager)||void 0===n||n.reset(),e&&this.param.setDirty())}update_from_method_dependency_name_change(){this._manager&&this.active()&&this._manager.update_from_method_dependency_name_change()}async compute_expression(){if(this._manager&&this.active()){return await this._manager.compute_function()}}async compute_expression_for_entities(t,e){var n,s;this.set_entities(t,e),await this.compute_expression(),(null===(n=this._manager)||void 0===n?void 0:n.error_message())&&this.param.node.states.error.set("expression evalution error: "+(null===(s=this._manager)||void 0===s?void 0:s.error_message())),this.reset_entities()}compute_expression_for_points(t,e){return this.compute_expression_for_entities(t,e)}compute_expression_for_objects(t,e){return this.compute_expression_for_entities(t,e)}entities(){return this._entities}entity_callback(){return this._entity_callback}set_entities(t,e){this._entities=t,this._entity_callback=e}reset_entities(){this._entities=void 0,this._entity_callback=void 0}}},198:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},20:function(t,e,n){"use strict";n.d(e,"a",(function(){return y}));var s=n(55),r=n(179);const i={};var o;!function(t){t.WEBGL="webgl",t.WEBGL2="webgl2",t.EXPERIMENTAL_WEBGL="experimental-webgl",t.EXPERIMENTAL_WEBGL2="experimental-webgl2"}(o||(o={}));class a{constructor(){this._next_renderer_id=0,this._next_env_map_id=0,this._renderers={},this._env_maps={},this._printDebug=!1,this._require_webgl2=!1,this._resolves=[]}setPrintDebug(t=!0){this._printDebug=t}printDebug(){return this._printDebug}printDebugMessage(t){this._printDebug&&console.log("[Poly debug]",t)}setRequireWebGL2(){this._require_webgl2||(this._require_webgl2=!0)}webgl2Available(){return void 0===this._webgl2_available&&(this._webgl2_available=this._set_webgl2_available()),this._webgl2_available}_set_webgl2_available(){const t=document.createElement("canvas");return null!=(window.WebGL2RenderingContext&&t.getContext(o.WEBGL2))}renderingContext(t){let e=null;return this._require_webgl2&&(e=this._rendering_context_webgl(t,!0),e||console.warn("failed to create webgl2 context")),e||(e=this._rendering_context_webgl(t,!1)),e}_rendering_context_webgl(t,e){let n;n=this.webgl2Available()||e?o.WEBGL2:o.WEBGL;let s=t.getContext(n,i);return s?this.printDebugMessage(`create gl context: ${n}.`):(n=e?o.EXPERIMENTAL_WEBGL2:o.EXPERIMENTAL_WEBGL,this.printDebugMessage(`create gl context: ${n}.`),s=t.getContext(n,i)),s}registerRenderer(t){if(t._polygon_id)throw new Error("render already registered");t._polygon_id=this._next_renderer_id+=1,this._renderers[t._polygon_id]=t,1==Object.keys(this._renderers).length&&this.flush_callbacks_with_renderer(t)}deregisterRenderer(t){delete this._renderers[t._polygon_id],t.dispose()}firstRenderer(){const t=Object.keys(this._renderers)[0];return t?this._renderers[t]:null}renderers(){return Object.values(this._renderers)}flush_callbacks_with_renderer(t){let e;for(;e=this._resolves.pop();)e(t)}async waitForRenderer(){const t=this.firstRenderer();return t||new Promise((t,e)=>{this._resolves.push(t)})}renderTarget(t,e,n){return this.webgl2Available()?new r.a(t,e,n):new s.a(t,e,n)}}class _{constructor(){this._root="/three/js/libs"}root(){return this._root}setRoot(t){this._root=t}}class u{constructor(t){this.poly=t,this._node_register=new Map,this._node_register_categories=new Map,this._node_register_options=new Map}register(t,e,n){const s=t.nodeContext(),r=t.type().toLowerCase();let i=this._node_register.get(s);i||(i=new Map,this._node_register.set(s,i));if(i.get(r))console.error(`node ${s}/${r} already registered`);else{if(i.set(r,t),e){let t=this._node_register_categories.get(s);t||(t=new Map,this._node_register_categories.set(s,t)),t.set(r,e)}if(n){let t=this._node_register_options.get(s);t||(t=new Map,this._node_register_options.set(s,t)),t.set(r,n)}this.poly.pluginsRegister.registerNode(t)}}deregister(t,e){var n,s,r;null===(n=this._node_register.get(t))||void 0===n||n.delete(e),null===(s=this._node_register_categories.get(t))||void 0===s||s.delete(e),null===(r=this._node_register_options.get(t))||void 0===r||r.delete(e)}isRegistered(t,e){const n=this._node_register.get(t);return!!n&&null!=n.get(e)}registeredNodesForContextAndParentType(t,e){var n;if(this._node_register.get(t)){const s=[];return null===(n=this._node_register.get(t))||void 0===n||n.forEach((t,e)=>{s.push(t)}),s.filter(n=>{var s;const r=n.type().toLowerCase(),i=null===(s=this._node_register_options.get(t))||void 0===s?void 0:s.get(r);if(i){const n=i.only,s=i.except,r=`${t}/${e}`;return n?n.includes(r):!s||!s.includes(r)}return!0})}return[]}registeredNodes(t,e){const n={},s=this.registeredNodesForContextAndParentType(t,e);for(let t of s){n[t.type().toLowerCase()]=t}return n}registeredCategory(t,e){var n;return null===(n=this._node_register_categories.get(t))||void 0===n?void 0:n.get(e.toLowerCase())}map(){return this._node_register}}class c{constructor(t){this.poly=t,this._operation_register=new Map}register(t){const e=t.context();let n=this._operation_register.get(e);n||(n=new Map,this._operation_register.set(e,n));const s=t.type().toLowerCase();if(n.get(s)){const t=`operation ${e}/${s} already registered`;console.error(t)}else n.set(s,t),this.poly.pluginsRegister.registerOperation(t)}registeredOperationsForContextAndParentType(t,e){var n;if(this._operation_register.get(t)){const e=[];return null===(n=this._operation_register.get(t))||void 0===n||n.forEach((t,n)=>{e.push(t)}),e}return[]}registeredOperation(t,e){const n=this._operation_register.get(t);if(n)return n.get(e.toLowerCase())}}class l extends class{constructor(){this._methods_names=[],this._methods_by_name=new Map}register(t,e){this._methods_names.push(e),this._methods_by_name.set(e,t)}getMethod(t){return this._methods_by_name.get(t)}availableMethods(){return this._methods_names}}{getMethod(t){return super.getMethod(t)}}var h=n(120);class d extends h.a{async module(t){return await super.module(t)}}var p=n(121);class m extends p.b{assembler(t,e){const n=this._controller_assembler_by_name.get(e);if(n){return new(0,n.controller)(t,n.assembler)}return n}unregister(t){const e=this._controller_assembler_by_name.get(t);return super.unregister(t),e}}class f{constructor(t){this.poly=t,this._plugins_by_name=new Map,this._plugin_name_by_node_context_by_type=new Map,this._plugin_name_by_operation_context_by_type=new Map}register(t){this._current_plugin=t,this._plugins_by_name.set(t.name(),t),t.init(this.poly),this._current_plugin=void 0}pluginByName(t){return this._plugins_by_name.get(t)}registerNode(t){if(!this._current_plugin)return;const e=t.nodeContext(),n=t.type();let s=this._plugin_name_by_node_context_by_type.get(e);s||(s=new Map,this._plugin_name_by_node_context_by_type.set(e,s)),s.set(n,this._current_plugin.name())}registerOperation(t){if(!this._current_plugin)return;const e=t.context(),n=t.type();let s=this._plugin_name_by_operation_context_by_type.get(e);s||(s=new Map,this._plugin_name_by_operation_context_by_type.set(e,s)),s.set(n,this._current_plugin.name())}toJson(){const t={plugins:{},nodes:{},operations:{}};return this._plugins_by_name.forEach((e,n)=>{t.plugins[n]=e.toJSON()}),this._plugin_name_by_node_context_by_type.forEach((e,n)=>{t.nodes[n]={},e.forEach((e,s)=>{t.nodes[n][s]=e})}),this._plugin_name_by_operation_context_by_type.forEach((e,n)=>{t.operations[n]={},e.forEach((e,s)=>{t.operations[n][s]=e})}),t}}class g{constructor(t){this._camera_types=[]}register(t){const e=t.type();this._camera_types.includes(e)||this._camera_types.push(e)}registeredTypes(){return this._camera_types}}class v{constructor(){this.renderersController=new a,this.nodesRegister=new u(this),this.operationsRegister=new c(this),this.expressionsRegister=new l,this.modulesRegister=new d,this.assemblersRegister=new m,this.pluginsRegister=new f(this),this.camerasRegister=new g(this),this.scenesByUuid={},this._player_mode=!0,this._logger=null}static _instance_(){if(window.__POLYGONJS_POLY_INSTANCE__)return window.__POLYGONJS_POLY_INSTANCE__;{const t=new v;return window.__POLYGONJS_POLY_INSTANCE__=t,window.__POLYGONJS_POLY_INSTANCE__}}setPlayerMode(t){this._player_mode=t}playerMode(){return this._player_mode}registerNode(t,e,n){this.nodesRegister.register(t,e,n)}registerOperation(t){this.operationsRegister.register(t)}registerCamera(t){this.camerasRegister.register(t)}registerPlugin(t){this.pluginsRegister.register(t)}registeredNodes(t,e){return this.nodesRegister.registeredNodes(t,e)}registeredOperation(t,e){return this.operationsRegister.registeredOperation(t,e)}registeredCameraTypes(){return this.camerasRegister.registeredTypes()}inWorkerThread(){return!1}desktopController(){}get libs(){return this._libs_controller=this._libs_controller||new _}setEnv(t){this._env=t}env(){return this._env}setLogger(t){this._logger=t}get logger(){return this._logger}log(t,...e){var n;null===(n=this.logger)||void 0===n||n.log(t,...e)}warn(t,...e){var n;null===(n=this.logger)||void 0===n||n.warn(t,...e)}error(t,...e){var n;null===(n=this.logger)||void 0===n||n.error(t,...e)}}const y=v._instance_()},21:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return r})),n.d(e,"d",(function(){return i})),n.d(e,"a",(function(){return o}));const s={NODE:{UV:"/COP/imageUv",ENV_MAP:"/COP/envMap"}};class r{constructor(t=""){this._path=t,this._node=null}set_path(t){this._path=t}set_node(t){this._node=t}path(){return this._path}node(){return this._node}resolve(t){this._node=o.find_node(t,this._path)}clone(){const t=new r(this._path);return t.set_node(this._node),t}ensure_node_context(t,e){const n=this.node();if(!n)return void(null==e||e.set("no node found at "+this.path()));const s=n.nodeContext();return s==t?n:void(null==e||e.set(`expected ${t} node, but got a ${s}`))}}class i{constructor(t=""){this._path=t,this._param=null}set_path(t){this._path=t}set_param(t){this._param=t}path(){return this._path}param(){return this._param}resolve(t){this._param=o.find_param(t,this._path)}clone(){const t=new i(this._path);return t.set_param(this._param),t}}class o{static split_parent_child(t){const e=t.split(o.SEPARATOR).filter(t=>t.length>0),n=e.pop();return{parent:e.join(o.SEPARATOR),child:n}}static find_node(t,e,n){if(!t)return null;const s=e.split(o.SEPARATOR).filter(t=>t.length>0),r=s[0];let i=null;if(e[0]!==o.SEPARATOR){switch(r){case o.PARENT:null==n||n.add_path_element(r),i=t.parent();break;case o.CURRENT:null==n||n.add_path_element(r),i=t;break;default:i=t.node(r),i&&(null==n||n.add_node(r,i))}if(null!=i&&s.length>1){const t=s.slice(1).join(o.SEPARATOR);i=this.find_node(i,t,n)}return i}{const s=e.substr(1);i=this.find_node(t.root(),s,n)}return i}static find_param(t,e,n){if(!t)return null;const s=e.split(o.SEPARATOR);if(1===s.length)return t.params.get(s[0]);{const e=s.slice(0,+(s.length-2)+1||void 0).join(o.SEPARATOR),r=this.find_node(t,e,n);if(null!=r){const t=s[s.length-1],e=r.params.get(t);return n&&e&&n.add_node(t,e),e}return null}}static relativePath(t,e){const n=this.closest_common_parent(t,e);if(n){const s=this.distanceToParent(t,n);let r="";if(s>0){let t=0;const e=[];for(;t++<s;)e.push(o.PARENT);r=e.join(o.SEPARATOR)+o.SEPARATOR}const i=n.fullPath().split(o.SEPARATOR).filter(t=>t.length>0),a=e.fullPath().split(o.SEPARATOR).filter(t=>t.length>0),_=[];let u=0;for(let t of a)i[u]||_.push(t),u++;return`${r}${_.join(o.SEPARATOR)}`}return e.fullPath()}static closest_common_parent(t,e){const n=this.parents(t).reverse().concat([t]),s=this.parents(e).reverse().concat([e]),r=Math.min(n.length,s.length);let i=null;for(let t=0;t<r;t++)n[t].graphNodeId()==s[t].graphNodeId()&&(i=n[t]);return i}static parents(t){const e=[];let n=t.parent();for(;n;)e.push(n),n=n.parent();return e}static distanceToParent(t,e){let n=0,s=t;const r=e.graphNodeId();for(;s&&s.graphNodeId()!=r;)n+=1,s=s.parent();return s&&s.graphNodeId()==r?n:-1}static make_absolute_path(t,e){if(e[0]==o.SEPARATOR)return e;const n=e.split(o.SEPARATOR),s=n.shift();if(!s)return t.fullPath();switch(s){case"..":{const e=t.parent();return e?this.make_absolute_path(e,n.join(o.SEPARATOR)):null}case".":return this.make_absolute_path(t,n.join(o.SEPARATOR));default:return[t.fullPath(),e].join(o.SEPARATOR)}}}o.SEPARATOR="/",o.DOT=".",o.CURRENT=o.DOT,o.PARENT="..",o.CURRENT_WITH_SLASH=o.CURRENT+"/",o.PARENT_WITH_SLASH=o.PARENT+"/",o.NON_LETTER_PREFIXES=[o.SEPARATOR,o.DOT]},22:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var s=n(7),r=n(25);const i=/[, ]/,o=/\d+$/,a=/^0+/,_=/,| /,u=/^-?\d+\.?\d*$/;var c;!function(t){t.TRUE="true",t.FALSE="false"}(c||(c={}));class l{static isBoolean(t){return t==c.TRUE||t==c.FALSE}static toBoolean(t){return t==c.TRUE}static isNumber(t){return u.test(t)}static tailDigits(t){const e=t.match(o);return e?parseInt(e[0]):0}static increment(t){const e=t.match(o);if(e){let n=e[0],s="";const r=n.match(a);r&&(s=r[0]);const i=parseInt(n);0==i&&s.length>0&&"0"==s[s.length-1]&&(s=s.slice(0,-1));return`${t.substring(0,t.length-e[0].length)}${s}${i+1}`}return t+"1"}static pluralize(t){return"s"!==t[t.length-1]?t+"s":t}static camelCase(t){const e=t.replace(/_/g," ").split(" ");let n="";for(let t=0;t<e.length;t++){let s=e[t].toLowerCase();t>0&&(s=this.upperFirst(s)),n+=s}return n}static upperFirst(t){return t[0].toUpperCase()+t.substr(1)}static titleize(t){return t.split(/\s|_/g).map(t=>this.upperFirst(t)).join(" ")}static precision(t,e=2){e=Math.max(e,0);const n=(""+t).split(".");if(e<=0)return n[0];let s=n[1];if(void 0!==s)return s.length>e&&(s=s.substring(0,e)),s=s.padEnd(e,"0"),`${n[0]}.${s}`;{const n=t+".",s=n.length+e;return n.padEnd(s,"0")}}static ensureFloat(t){const e=""+t;return e.indexOf(".")>=0?e:e+".0"}static matchMask(t,e){if("*"===e)return!0;if(t==e)return!0;const n=e.split(" ");if(n.length>1){for(let e of n){if(this.matchMask(t,e))return!0}return!1}e=`^${e=e.split("*").join(".*")}$`;return new RegExp(e).test(t)}static matchesOneMask(t,e){let n=!1;for(let s of e)l.matchMask(t,s)&&(n=!0);return n}static attribNames(t){const e=t.split(i),n=new Set;for(let t of e)t=t.trim(),t.length>0&&n.add(t);const s=new Array(n.size);let r=0;return n.forEach(t=>{s[r]=t,r++}),s}static indices(t){const e=t.split(_);if(e.length>1){const t=e.flatMap(t=>this.indices(t));return r.a.uniq(t).sort((t,e)=>t-e)}{const t=e[0];if(t){const e="-";if(t.indexOf(e)>0){const n=t.split(e);return r.a.range(parseInt(n[0]),parseInt(n[1])+1)}{const e=parseInt(t);return s.a.isNumber(e)?[e]:[]}}return[]}}static escapeLineBreaks(t){return t.replace(/(\r\n|\n|\r)/gm,"\\n")}}},25:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n(52);class r{static union(t,e){const n=new Set;return t.forEach(t=>n.add(t)),e.forEach(t=>n.add(t)),n}static intersection(t,e){const n=new Set;return t.forEach(t=>{e.has(t)&&n.add(t)}),e.forEach(e=>{t.has(e)&&n.add(e)}),n}static difference(t,e){const n=new Set;return t.forEach(t=>{e.has(t)||n.add(t)}),e.forEach(e=>{t.has(e)||n.add(e)}),n}}var i=n(7);class o{static min(t){let e=t[0];for(let n of t)n<e&&(e=n);return e}static max(t){let e=t[0];for(let n of t)n>e&&(e=n);return e}static sum(t){let e=0;for(let n of t)e+=n;return e}static compact(t){const e=[];for(let n of t)null!=n&&e.push(n);return e}static uniq(t){const e=new Set;for(let n of t)e.add(n);const n=new Array(e.size);let s=0;return e.forEach(t=>{n[s]=t,s++}),n}static chunk(t,e){const n=[];let s=[];n.push(s);for(let r=0;r<t.length;r++)s.length==e&&(s=[],n.push(s)),s.push(t[r]);return n}static union(t,e){const n=[];return r.union(this.toSet(t),this.toSet(e)).forEach(t=>n.push(t)),n}static intersection(t,e){const n=[];return r.intersection(this.toSet(t),this.toSet(e)).forEach(t=>n.push(t)),n}static difference(t,e){const n=[];return r.difference(this.toSet(t),this.toSet(e)).forEach(t=>n.push(t)),n}static toSet(t){const e=new Set;for(let n of t)e.add(n);return e}static isEqual(t,e){if(t.length!=e.length)return!1;const n=t.length;for(let s=0;s<n;s++)if(t[s]!=e[s])return!1;return!0}static sortBy(t,e){if(0==t.length)return[];const n=new Map,r=new Set;for(let i of t){const t=e(i);r.add(t),s.a.push_on_array_at_entry(n,t,i)}const o=new Array(r.size);let a=0;r.forEach(t=>{o[a]=t,a++}),i.a.isString(o[0])?o.sort():o.sort((t,e)=>t-e);const _=new Array(t.length);a=0;for(let t of o){const e=n.get(t);if(e)for(let t of e)_[a]=t,a++}return _}static range(t,e,n=1){null==e&&(e=t,t=0);const s=Math.floor((e-t)/n),r=new Array(s);for(let e=0;e<r.length;e++)r[e]=t+e*n;return r}}},257:function(t,e,n){!function(n){"use strict";var s=function(t,e){var n=new Error(t+" at character "+e);throw n.index=e,n.description=t,n},r={"-":!0,"!":!0,"~":!0,"+":!0},i={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},o=function(t){var e,n=0;for(var s in t)(e=s.length)>n&&t.hasOwnProperty(s)&&(n=e);return n},a=o(r),_=o(i),u={true:!0,false:!1,null:null},c=function(t){return i[t]||0},l=function(t,e,n){return{type:"||"===t||"&&"===t?"LogicalExpression":"BinaryExpression",operator:t,left:e,right:n}},h=function(t){return t>=48&&t<=57},d=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=128&&!i[String.fromCharCode(t)]},p=function(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t>=128&&!i[String.fromCharCode(t)]},m=function(t){for(var e,n,o=0,m=t.charAt,f=t.charCodeAt,g=function(e){return m.call(t,e)},v=function(e){return f.call(t,e)},y=t.length,b=function(){for(var t=v(o);32===t||9===t||10===t||13===t;)t=v(++o)},w=function(){var t,e,n=E();return b(),63!==v(o)?n:(o++,(t=w())||s("Expected expression",o),b(),58===v(o)?(o++,(e=w())||s("Expected expression",o),{type:"ConditionalExpression",test:n,consequent:t,alternate:e}):void s("Expected :",o))},x=function(){b();for(var e=t.substr(o,_),n=e.length;n>0;){if(i.hasOwnProperty(e)&&(!d(v(o))||o+e.length<t.length&&!p(v(o+e.length))))return o+=n,e;e=e.substr(0,--n)}return!1},E=function(){var t,e,n,r,i,a,_,u,h;if(a=A(),!(e=x()))return a;for(i={value:e,prec:c(e)},(_=A())||s("Expected expression after "+e,o),r=[a,i,_];(e=x())&&0!==(n=c(e));){for(i={value:e,prec:n},h=e;r.length>2&&n<=r[r.length-2].prec;)_=r.pop(),e=r.pop().value,a=r.pop(),t=l(e,a,_),r.push(t);(t=A())||s("Expected expression after "+h,o),r.push(i,t)}for(t=r[u=r.length-1];u>1;)t=l(r[u-1].value,r[u-2],t),u-=2;return t},A=function(){var e,n,s;if(b(),e=v(o),h(e)||46===e)return T();if(39===e||34===e)return O();if(91===e)return R();for(s=(n=t.substr(o,a)).length;s>0;){if(r.hasOwnProperty(n)&&(!d(v(o))||o+n.length<t.length&&!p(v(o+n.length))))return o+=s,{type:"UnaryExpression",operator:n,argument:A(),prefix:!0};n=n.substr(0,--s)}return!(!d(e)&&40!==e)&&k()},T=function(){for(var t,e,n="";h(v(o));)n+=g(o++);if(46===v(o))for(n+=g(o++);h(v(o));)n+=g(o++);if("e"===(t=g(o))||"E"===t){for(n+=g(o++),"+"!==(t=g(o))&&"-"!==t||(n+=g(o++));h(v(o));)n+=g(o++);h(v(o-1))||s("Expected exponent ("+n+g(o)+")",o)}return e=v(o),d(e)?s("Variable names cannot start with a number ("+n+g(o)+")",o):46===e&&s("Unexpected period",o),{type:"Literal",value:parseFloat(n),raw:n}},O=function(){for(var t,e="",n=g(o++),r=!1;o<y;){if((t=g(o++))===n){r=!0;break}if("\\"===t)switch(t=g(o++)){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=t}else e+=t}return r||s('Unclosed quote after "'+e+'"',o),{type:"Literal",value:e,raw:n+e+n}},C=function(){var e,n=v(o),r=o;for(d(n)?o++:s("Unexpected "+g(o),o);o<y&&(n=v(o),p(n));)o++;return e=t.slice(r,o),u.hasOwnProperty(e)?{type:"Literal",value:u[e],raw:e}:"this"===e?{type:"ThisExpression"}:{type:"Identifier",name:e}},N=function(t){for(var e,n,r=[],i=!1,a=0;o<y;){if(b(),(e=v(o))===t){i=!0,o++,41===t&&a&&a>=r.length&&s("Unexpected token "+String.fromCharCode(t),o);break}if(44===e){if(o++,++a!==r.length)if(41===t)s("Unexpected token ,",o);else if(93===t)for(var _=r.length;_<a;_++)r.push(null)}else(n=w())&&"Compound"!==n.type||s("Expected comma",o),r.push(n)}return i||s("Expected "+String.fromCharCode(t),o),r},k=function(){var t,e;for(e=40===(t=v(o))?S():C(),b(),t=v(o);46===t||91===t||40===t;)o++,46===t?(b(),e={type:"MemberExpression",computed:!1,object:e,property:C()}):91===t?(e={type:"MemberExpression",computed:!0,object:e,property:w()},b(),93!==(t=v(o))&&s("Unclosed [",o),o++):40===t&&(e={type:"CallExpression",arguments:N(41),callee:e}),b(),t=v(o);return e},S=function(){o++;var t=w();if(b(),41===v(o))return o++,t;s("Unclosed (",o)},R=function(){return o++,{type:"ArrayExpression",elements:N(93)}},P=[];o<y;)59===(e=v(o))||44===e?o++:(n=w())?P.push(n):o<y&&s('Unexpected "'+g(o)+'"',o);return 1===P.length?P[0]:{type:"Compound",body:P}};m.version="0.3.5",m.toString=function(){return"JavaScript Expression Parser (JSEP) v"+m.version},m.addUnaryOp=function(t){return a=Math.max(t.length,a),r[t]=!0,this},m.addBinaryOp=function(t,e){return _=Math.max(t.length,_),i[t]=e,this},m.addLiteral=function(t,e){return u[t]=e,this},m.removeUnaryOp=function(t){return delete r[t],t.length===a&&(a=o(r)),this},m.removeAllUnaryOps=function(){return r={},a=0,this},m.removeBinaryOp=function(t){return delete i[t],t.length===_&&(_=o(i)),this},m.removeAllBinaryOps=function(){return i={},_=0,this},m.removeLiteral=function(t){return delete u[t],this},m.removeAllLiterals=function(){return u={},this},t.exports?e=t.exports=m:e.parse=m}()},26:function(t,e,n){"use strict";var s;n.d(e,"a",(function(){return s})),function(t){t.CREATED="node_created",t.DELETED="node_deleted",t.NAME_UPDATED="node_name_update",t.OVERRIDE_CLONABLE_STATE_UPDATE="node_override_clonable_state_update",t.NAMED_OUTPUTS_UPDATED="node_named_outputs_updated",t.NAMED_INPUTS_UPDATED="node_named_inputs_updated",t.INPUTS_UPDATED="node_inputs_updated",t.PARAMS_UPDATED="node_params_updated",t.UI_DATA_POSITION_UPDATED="node_ui_data_position_updated",t.UI_DATA_COMMENT_UPDATED="node_ui_data_comment_updated",t.ERROR_UPDATED="node_error_updated",t.FLAG_BYPASS_UPDATED="bypass_flag_updated",t.FLAG_DISPLAY_UPDATED="display_flag_updated",t.FLAG_OPTIMIZE_UPDATED="optimize_flag_updated",t.SELECTION_UPDATED="selection_updated"}(s||(s={}))},27:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{static unreachable(t){throw new Error("Didn't expect to get here")}}},28:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));class s{constructor(t){this.node=t,this._dirty_count=0,this._dirty=!0}dispose(){this._cached_successors=void 0,this._post_dirty_hooks=void 0,this._post_dirty_hook_names=void 0}isDirty(){return!0===this._dirty}dirtyTimestamp(){return this._dirty_timestamp}dirtyCount(){return this._dirty_count}addPostDirtyHook(t,e){this._post_dirty_hook_names=this._post_dirty_hook_names||[],this._post_dirty_hooks=this._post_dirty_hooks||[],this._post_dirty_hook_names.includes(t)?console.warn(`hook with name ${t} already exists`,this.node):(this._post_dirty_hook_names.push(t),this._post_dirty_hooks.push(e))}removePostDirtyHook(t){if(this._post_dirty_hook_names&&this._post_dirty_hooks){const e=this._post_dirty_hook_names.indexOf(t);e>=0&&(this._post_dirty_hook_names.splice(e,1),this._post_dirty_hooks.splice(e,1))}}has_hook(t){return!!this._post_dirty_hook_names&&this._post_dirty_hook_names.includes(t)}removeDirtyState(){this._dirty=!1}set_forbidden_trigger_nodes(t){this._forbidden_trigger_nodes=t.map(t=>t.graphNodeId())}set_dirty(t,e){null==e&&(e=!0),t&&this._forbidden_trigger_nodes&&this._forbidden_trigger_nodes.includes(t.graphNodeId())||(null==t&&(t=this.node),this._dirty=!0,this._dirty_timestamp=performance.now(),this._dirty_count+=1,this.run_post_dirty_hooks(t),!0===e&&this.set_successors_dirty(t))}run_post_dirty_hooks(t){if(this._post_dirty_hooks){const e=this.node.scene().cooker;if(e.blocked)e.enqueue(this.node,t);else for(let e of this._post_dirty_hooks)e(t)}}set_successors_dirty(t){this._cached_successors=this._cached_successors||this.node.graphAllSuccessors();for(let e of this._cached_successors)e.dirtyController.set_dirty(t,!1)}clear_successors_cache(){this._cached_successors=void 0}clear_successors_cache_with_predecessors(){this.clear_successors_cache();for(let t of this.node.graphAllPredecessors())t.dirtyController.clear_successors_cache()}}class r{constructor(t,e){this._scene=t,this._name=e,this._dirty_controller=new s(this),this._graph_node_id=t.graph.next_id(),t.graph.add_node(this),this._graph=t.graph}dispose(){this._dirty_controller.dispose(),this.graphRemove()}name(){return this._name}setName(t){this._name=t}scene(){return this._scene}graphNodeId(){return this._graph_node_id}get dirtyController(){return this._dirty_controller}setDirty(t){t=t||this,this._dirty_controller.set_dirty(t)}setSuccessorsDirty(t){this._dirty_controller.set_successors_dirty(t)}removeDirtyState(){this._dirty_controller.removeDirtyState()}isDirty(){return this._dirty_controller.isDirty()}addPostDirtyHook(t,e){this._dirty_controller.addPostDirtyHook(t,e)}graphRemove(){this._graph.remove_node(this)}addGraphInput(t,e=!0){return this._graph.connect(t,this,e)}removeGraphInput(t){this._graph.disconnect(t,this)}graphDisconnectPredecessors(){this._graph.disconnect_predecessors(this)}graphDisconnectSuccessors(){this._graph.disconnect_successors(this)}graphPredecessorIds(){return this._graph.predecessor_ids(this._graph_node_id)||[]}graphPredecessors(){return this._graph.predecessors(this)}graphSuccessors(){return this._graph.successors(this)}graphAllPredecessors(){return this._graph.all_predecessors(this)}graphAllSuccessors(){return this._graph.all_successors(this)}}},31:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return c}));var s,r=n(6),i=n(3),o=n(16),a=n(7),_=n(15);!function(t){t.POSITION="position",t.NORMAL="normal",t.TANGENT="tangent"}(s||(s={}));const u={P:"position",N:"normal",Cd:"color"};class c{static remap_name(t){return u[t]||t}static array_to_indexed_arrays(t){const e={};let n=0;const s=[],r=[];let i=0;for(;i<t.length;){const o=t[i],a=e[o];null!=a?s.push(a):(r.push(o),s.push(n),e[o]=n,n+=1),i++}return{indices:s,values:r}}static default_value(t){switch(t){case 1:return 0;case 2:return new r.a(0,0);case 3:return new i.a(0,0,0);default:throw`size ${t} not yet implemented`}}static copy(t,e,n=!0){const s=null==t?void 0:t.array,r=null==e?void 0:e.array;if(s&&r){const t=Math.min(s.length,r.length);for(let e=0;e<t;e++)r[e]=s[e];n&&(e.needsUpdate=!0)}}static attribSizeFromValue(t){if(a.a.isString(t)||a.a.isNumber(t))return _.g.FLOAT;if(a.a.isArray(t))return t.length;switch(t.constructor){case r.a:return _.g.VECTOR2;case i.a:return _.g.VECTOR3;case o.a:return _.g.VECTOR4}return 0}}},36:function(t,e,n){"use strict";var s;n.d(e,"a",(function(){return s})),function(t){t.VISIBLE_UPDATED="param_visible_updated",t.RAW_INPUT_UPDATED="raw_input_updated",t.VALUE_UPDATED="param_value_updated",t.EXPRESSION_UPDATED="param_expression_update",t.ERROR_UPDATED="param_error_updated",t.DELETED="param_deleted"}(s||(s={}))},38:function(t,e,n){"use strict";n.d(e,"a",(function(){return Lt}));var s=n(28),r=n(6),i=n(9),o=n(26),a=n(7);class _{constructor(t,e=0,n=0){this.node=t,this._position=new r.a,this._width=50,this._color=new i.a(.75,.75,.75),this._layout_vertical=!0,this._json={x:0,y:0},this._position.x=e,this._position.y=n}setComment(t){this._comment=t,this.node.emit(o.a.UI_DATA_COMMENT_UPDATED)}comment(){return this._comment}setColor(t){this._color=t}color(){return this._color}setLayoutHorizontal(){this._layout_vertical=!1}isLayoutVertical(){return this._layout_vertical}copy(t){this._position.copy(t.position()),this._color.copy(t.color())}position(){return this._position}setPosition(t,e=0){if(a.a.isNumber(t)){const n=t;this._position.set(n,e)}else this._position.copy(t);this.node.emit(o.a.UI_DATA_POSITION_UPDATED)}translate(t,e=!1){this._position.add(t),e&&(this._position.x=Math.round(this._position.x),this._position.y=Math.round(this._position.y)),this.node.emit(o.a.UI_DATA_POSITION_UPDATED)}toJSON(){return this._json.x=this._position.x,this._json.y=this._position.y,this._json.comment=this._comment,this._json}}n(39);class u{constructor(t){this.node=t}}class c extends u{active(){return this.are_params_time_dependent()||this.are_inputs_time_dependent()}are_params_time_dependent(){const t=this.node.params.names;for(let e of t){const t=this.node.params.get(e);if(t&&t.states.time_dependent.active())return!0}return!1}are_inputs_time_dependent(){const t=this.node.io.inputs.inputs();for(let e of t)if(e&&e.states.time_dependent.active())return!0;return!1}force_time_dependent(){const t=this.node.graphPredecessors().map(t=>t.graphNodeId()),e=this.node.scene().timeController.graphNode;t.includes(e.graphNodeId())||this.node.addGraphInput(e,!1)}unforce_time_dependent(){const t=this.node.scene().timeController.graphNode;this.node.removeGraphInput(t)}}var l=n(20);class h extends u{set(t){this._message!=t&&(t&&l.a.warn(`[${this.node.fullPath()}] error: '${t}'`),this._message=t,this.on_update())}message(){return this._message}clear(){this.set(void 0)}active(){return null!=this._message}on_update(){null!=this._message&&this.node.setContainer(null,`from error '${this._message}'`),this.node.emit(o.a.ERROR_UPDATED)}}class d{constructor(t){this.node=t,this.time_dependent=new c(this.node),this.error=new h(this.node)}}class p{constructor(t){this.node=t,this._graph_node=new s.a(t.scene(),"node_name_controller")}dispose(){this._graph_node.dispose(),this._on_set_name_hooks=void 0,this._on_set_fullPath_hooks=void 0}get graph_node(){return this._graph_node}static base_name(t){let e=t.type();const n=e[e.length-1];return a.a.isNaN(parseInt(n))||(e+="_"),e+"1"}request_name_to_parent(t){const e=this.node.parent();e&&e.childrenAllowed()&&e.childrenController?e.childrenController.set_child_name(this.node,t):console.warn("request_name_to_parent failed, no parent found")}setName(t){t!=this.node.name()&&this.request_name_to_parent(t)}update_name_from_parent(t){var e;if(this.node._set_core_name(t),this.post_setName(),this.run_post_set_fullPath_hooks(),this.node.childrenAllowed()){const t=null===(e=this.node.childrenController)||void 0===e?void 0:e.children();if(t)for(let e of t)e.nameController.run_post_set_fullPath_hooks()}this.node.lifecycle.creation_completed&&(this.node.scene().missingExpressionReferencesController.check_for_missing_references(this.node),this.node.scene().expressionsController.regenerate_referring_expressions(this.node)),this.node.scene().referencesController.notify_name_updated(this.node),this.node.emit(o.a.NAME_UPDATED)}add_post_set_name_hook(t){this._on_set_name_hooks=this._on_set_name_hooks||[],this._on_set_name_hooks.push(t)}add_post_set_fullPath_hook(t){this._on_set_fullPath_hooks=this._on_set_fullPath_hooks||[],this._on_set_fullPath_hooks.push(t)}post_setName(){if(this._on_set_name_hooks)for(let t of this._on_set_name_hooks)t()}run_post_set_fullPath_hooks(){if(this._on_set_fullPath_hooks)for(let t of this._on_set_fullPath_hooks)t()}}var m=n(21);class f{constructor(t){this.node=t,this._parent=null}parent(){return this._parent}setParent(t){t!=this.node.parentController.parent()&&(this._parent=t,this._parent&&this.node.nameController.request_name_to_parent(p.base_name(this.node)))}is_selected(){var t,e,n;return(null===(n=null===(e=null===(t=this.parent())||void 0===t?void 0:t.childrenController)||void 0===e?void 0:e.selection)||void 0===n?void 0:n.contains(this.node))||!1}fullPath(t){const e=m.a.SEPARATOR;if(null!=this._parent){if(this._parent==t)return this.node.name();{const n=this._parent.fullPath(t);return n===e?n+this.node.name():n+e+this.node.name()}}return e}onSetParent(){if(this._on_set_parent_hooks)for(let t of this._on_set_parent_hooks)t()}find_node(t){if(null==t)return null;if(t==m.a.CURRENT||t==m.a.CURRENT_WITH_SLASH)return this.node;if(t==m.a.PARENT||t==m.a.PARENT_WITH_SLASH)return this.node.parent();const e=m.a.SEPARATOR;if(t[0]===e&&(t=t.substring(1,t.length)),t.split){const n=t.split(e);if(1===n.length){const t=n[0];return this.node.childrenController?this.node.childrenController.child_by_name(t):null}return m.a.find_node(this.node,t)}return console.error("unexpected path given:",t),null}}var g=n(22),v=n(25);class y{constructor(t){this._node=t,this._node_ids=[],this._json=[]}node(){return this._node}nodes(){return this._node.scene().graph.nodes_from_ids(this._node_ids)}contains(t){return this._node_ids.includes(t.graphNodeId())}equals(t){const e=t.map(t=>t.graphNodeId()).sort();return v.a.isEqual(e,this._node_ids)}clear(){this._node_ids=[],this.send_update_event()}set(t){this._node_ids=[],this.add(t)}add(t){const e=t.map(t=>t.graphNodeId());this._node_ids=v.a.union(this._node_ids,e),this.send_update_event()}remove(t){const e=t.map(t=>t.graphNodeId());this._node_ids=v.a.difference(this._node_ids,e),this.send_update_event()}send_update_event(){this._node.emit(o.a.SELECTION_UPDATED)}toJSON(){return this._json=this._json||[],this._json=this._node_ids.map(t=>t),this._json}}var b=n(3),w=n(16),x=n(13),E=n(27);class A{constructor(t){this.inputs_controller=t,this._clone_required_states=[],this._overridden=!1}init_inputs_cloned_state(t){a.a.isArray(t)?this._cloned_states=t:this._cloned_state=t,this._update_clone_required_state()}override_cloned_state_allowed(){if(this._cloned_states)for(let t of this._cloned_states)if(t==x.a.FROM_NODE)return!0;return!!this._cloned_state&&this._cloned_state==x.a.FROM_NODE}clone_required_state(t){return this._clone_required_states[t]}clone_required_states(){return this._clone_required_states}_get_clone_required_state(t){const e=this._cloned_states;if(e){const n=e[t];if(null!=n)return this.clone_required_from_state(n)}return!this._cloned_state||this.clone_required_from_state(this._cloned_state)}clone_required_from_state(t){switch(t){case x.a.ALWAYS:return!0;case x.a.NEVER:return!1;case x.a.FROM_NODE:return!this._overridden}return E.a.unreachable(t)}override_cloned_state(t){this._overridden=t,this._update_clone_required_state()}overriden(){return this._overridden}_update_clone_required_state(){if(this._cloned_states){const t=[];for(let e=0;e<this._cloned_states.length;e++)t[e]=this._get_clone_required_state(e);this._clone_required_states=t}else if(this._cloned_state){const t=this.inputs_controller.inputs_count(),e=[];for(let n=0;n<t;n++)e[n]=this._get_clone_required_state(n);this._clone_required_states=e}else;}}class T{constructor(t){this.operation_container=t}inputs_count(){return this.operation_container.inputs_count()}init_inputs_cloned_state(t){this._cloned_states_controller||(this._cloned_states_controller=new A(this),this._cloned_states_controller.init_inputs_cloned_state(t))}clone_required(t){var e;const n=null===(e=this._cloned_states_controller)||void 0===e?void 0:e.clone_required_state(t);return null==n||n}override_cloned_state(t){var e;null===(e=this._cloned_states_controller)||void 0===e||e.override_cloned_state(t)}}class O extends class{constructor(t,e,n){this.operation=t,this.name=e,this.params={},this._apply_default_params(),this._apply_init_params(n),this._init_cloned_states()}path_param_resolve_required(){return null!=this._path_params}resolve_path_params(t){if(this._path_params)for(let e of this._path_params)e.resolve(t)}_apply_default_params(){const t=this.operation.constructor.DEFAULT_PARAMS,e=Object.keys(t);for(let n of e){const e=t[n],s=this._convert_param_data(n,e);null!=s&&(this.params[n]=s)}}_apply_init_params(t){const e=Object.keys(t);for(let n of e){const e=t[n];if(null!=e.simple_data){const t=e.simple_data,s=this._convert_export_param_data(n,t);null!=s&&(this.params[n]=s)}}}_convert_param_data(t,e){if(a.a.isNumber(e)||a.a.isBoolean(e)||a.a.isString(e))return e;if(e instanceof m.c){const t=e.clone();return this._path_params||(this._path_params=[]),this._path_params.push(t),t}return e instanceof i.a||e instanceof r.a||e instanceof b.a||e instanceof w.a?e.clone():void 0}_convert_export_param_data(t,e){const n=this.params[t];if(a.a.isBoolean(e))return e;if(a.a.isNumber(e))return a.a.isBoolean(n)?e>=1:e;if(a.a.isString(e)){if(n){if(n instanceof m.c)return n.set_path(e);if(n instanceof m.d)return n.set_path(e)}return e}a.a.isArray(e)&&this.params[t].fromArray(e)}setInput(t,e){this._inputs=this._inputs||[],this._inputs[t]=e}inputs_count(){return this._inputs?this._inputs.length:0}inputs_controller(){return this._inputs_controller=this._inputs_controller||new T(this)}_init_cloned_states(){const t=this.operation.constructor.INPUT_CLONED_STATE;this.inputs_controller().init_inputs_cloned_state(t)}input_clone_required(t){return!this._inputs_controller||this._inputs_controller.clone_required(t)}override_input_clone_state(t){this.inputs_controller().override_cloned_state(t)}cook(t){return this.operation.cook(t,this.params)}}{constructor(t,e,n){super(t,e,n),this.operation=t,this.name=e,this.init_params=n,this._inputs=[],this._current_input_index=0,this._dirty=!0}add_input(t){super.setInput(this._current_input_index,t),this.increment_input_index()}increment_input_index(){this._current_input_index++}current_input_index(){return this._current_input_index}setDirty(){if(!this._dirty){this._compute_result=void 0;for(let t=0;t<this._inputs.length;t++){this._inputs[t].setDirty()}}}async compute(t,e){if(this._compute_result)return this._compute_result;const n=[],s=e.get(this);s&&s.forEach((e,s)=>{n[s]=t[e]});for(let s=0;s<this._inputs.length;s++){const r=this._inputs[s];let i=await r.compute(t,e);i&&(this.input_clone_required(s)&&(i=i.clone()),n[s]=i)}const r=this.operation.cook(n,this.params);return this._compute_result=r?r instanceof Promise?await r:r:void 0,this._dirty=!1,this._compute_result}}class C{constructor(t,e){this.node=t,this._context=e,this._children={},this._children_by_type={},this._children_and_grandchildren_by_context={}}get selection(){return this._selection=this._selection||new y(this.node)}dispose(){const t=this.children();for(let e of t)this.node.removeNode(e);this._selection=void 0}get context(){return this._context}set_output_node_find_method(t){this._output_node_find_method=t}output_node(){if(this._output_node_find_method)return this._output_node_find_method()}set_child_name(t,e){let n;if(e=(e=e.replace(/[^A-Za-z0-9]/g,"_")).replace(/^[0-9]/,"_"),null!=(n=this._children[e])){if(t.name()===e&&n.graphNodeId()===t.graphNodeId())return;return e=g.a.increment(e),this.set_child_name(t,e)}{const n=t.name();this._children[n]&&delete this._children[n],this._children[e]=t,t.nameController.update_name_from_parent(e),this._add_to_nodesByType(t),this.node.scene().nodesController.addToInstanciatedNode(t)}}node_context_signature(){return`${this.node.nodeContext()}/${this.node.type()}`}available_children_classes(){return l.a.registeredNodes(this._context,this.node.type())}is_valid_child_type(t){return null!=this.available_children_classes()[t]}createNode(t,e,n=""){if("string"==typeof t){const s=this._find_node_class(t);return this._create_and_init_node(s,e,n)}return this._create_and_init_node(t,e,n)}_create_and_init_node(t,e,n=""){const s=new t(this.node.scene(),"child_node_"+n,e);return s.initialize_base_and_node(),this.add_node(s),s.lifecycle.set_creation_completed(),s}_find_node_class(t){const e=this.available_children_classes()[t.toLowerCase()];if(null==e){const e=`child node type '${t}' not found for node '${this.node.fullPath()}'. Available types are: ${Object.keys(this.available_children_classes()).join(", ")}, ${this._context}, ${this.node.type()}`;throw console.error(e),e}return e}create_operation_container(t,e,n){const s=l.a.registeredOperation(this._context,t);if(null==s){const e=`no operation found with context ${this._context}/${t}`;throw console.error(e),e}{const t=new s(this.node.scene());return new O(t,e,n||{})}}add_node(t){if(t.setParent(this.node),t.params.init(),t.parentController.onSetParent(),t.nameController.run_post_set_fullPath_hooks(),t.childrenAllowed()&&t.childrenController)for(let e of t.childrenController.children())e.nameController.run_post_set_fullPath_hooks();return this.node.emit(o.a.CREATED,{child_node_json:t.toJSON()}),this.node.scene().lifecycleController.onCreateHookAllowed()&&t.lifecycle.run_on_create_hooks(),t.lifecycle.run_on_add_hooks(),this.set_child_name(t,p.base_name(t)),this.node.lifecycle.run_on_child_add_hooks(t),t.require_webgl2()&&this.node.scene().webgl_controller.set_require_webgl2(),this.node.scene().missingExpressionReferencesController.check_for_missing_references(t),t}removeNode(t){if(t.parent()!=this.node)return console.warn(`node ${t.name()} not under parent ${this.node.fullPath()}`);{this.selection.contains(t)&&this.selection.remove([t]);const e=t.io.connections.firstInputConnection(),n=t.io.connections.inputConnections(),s=t.io.connections.outputConnections();if(n)for(let t of n)t&&t.disconnect({setInput:!0});if(s)for(let t of s)if(t&&(t.disconnect({setInput:!0}),e)){const n=e.node_src,s=t.output_index,r=t.node_dest,i=t.input_index;r.io.inputs.setInput(i,n,s)}t.setParent(null),delete this._children[t.name()],this._remove_from_nodesByType(t),this.node.scene().nodesController.removeFromInstanciatedNode(t),t.setSuccessorsDirty(this.node),t.graphDisconnectSuccessors(),this.node.lifecycle.run_on_child_remove_hooks(t),t.lifecycle.run_on_delete_hooks(),t.dispose(),t.emit(o.a.DELETED,{parent_id:this.node.graphNodeId()})}}_add_to_nodesByType(t){const e=t.graphNodeId(),n=t.type();this._children_by_type[n]=this._children_by_type[n]||[],this._children_by_type[n].includes(e)||this._children_by_type[n].push(e),this.add_to_children_and_grandchildren_by_context(t)}_remove_from_nodesByType(t){const e=t.graphNodeId(),n=t.type();if(this._children_by_type[n]){const t=this._children_by_type[n].indexOf(e);t>=0&&(this._children_by_type[n].splice(t,1),0==this._children_by_type[n].length&&delete this._children_by_type[n])}this.remove_from_children_and_grandchildren_by_context(t)}add_to_children_and_grandchildren_by_context(t){var e;const n=t.graphNodeId(),s=t.nodeContext();this._children_and_grandchildren_by_context[s]=this._children_and_grandchildren_by_context[s]||[],this._children_and_grandchildren_by_context[s].includes(n)||this._children_and_grandchildren_by_context[s].push(n);const r=this.node.parent();r&&r.childrenAllowed()&&(null===(e=r.childrenController)||void 0===e||e.add_to_children_and_grandchildren_by_context(t))}remove_from_children_and_grandchildren_by_context(t){var e;const n=t.graphNodeId(),s=t.nodeContext();if(this._children_and_grandchildren_by_context[s]){const t=this._children_and_grandchildren_by_context[s].indexOf(n);t>=0&&(this._children_and_grandchildren_by_context[s].splice(t,1),0==this._children_and_grandchildren_by_context[s].length&&delete this._children_and_grandchildren_by_context[s])}const r=this.node.parent();r&&r.childrenAllowed()&&(null===(e=r.childrenController)||void 0===e||e.remove_from_children_and_grandchildren_by_context(t))}nodesByType(t){const e=this._children_by_type[t]||[],n=this.node.scene().graph,s=[];for(let t of e){const e=n.node_from_id(t);e&&s.push(e)}return s}child_by_name(t){return this._children[t]}has_children_and_grandchildren_with_context(t){return null!=this._children_and_grandchildren_by_context[t]}children(){return Object.values(this._children)}children_names(){return Object.keys(this._children).sort()}traverse_children(t){var e;for(let n of this.children())t(n),null===(e=n.childrenController)||void 0===e||e.traverse_children(t)}}class N{constructor(t){this.node=t,this._creation_completed=!1}dispose(){this._on_child_add_hooks=void 0,this._on_child_remove_hooks=void 0,this._on_create_hooks=void 0,this._on_add_hooks=void 0,this._on_delete_hooks=void 0}set_creation_completed(){this._creation_completed||(this._creation_completed=!0)}get creation_completed(){return this.node.scene().loadingController.loaded()&&this._creation_completed}add_on_child_add_hook(t){this._on_child_add_hooks=this._on_child_add_hooks||[],this._on_child_add_hooks.push(t)}run_on_child_add_hooks(t){this.execute_hooks_with_child_node(this._on_child_add_hooks,t)}add_on_child_remove_hook(t){this._on_child_remove_hooks=this._on_child_remove_hooks||[],this._on_child_remove_hooks.push(t)}run_on_child_remove_hooks(t){this.execute_hooks_with_child_node(this._on_child_remove_hooks,t)}add_on_create_hook(t){this._on_create_hooks=this._on_create_hooks||[],this._on_create_hooks.push(t)}run_on_create_hooks(){this.execute_hooks(this._on_create_hooks)}add_on_add_hook(t){this._on_add_hooks=this._on_add_hooks||[],this._on_add_hooks.push(t)}run_on_add_hooks(){this.execute_hooks(this._on_add_hooks)}add_delete_hook(t){this._on_delete_hooks=this._on_delete_hooks||[],this._on_delete_hooks.push(t)}run_on_delete_hooks(){this.execute_hooks(this._on_delete_hooks)}execute_hooks(t){if(t){let e;for(e of t)e()}}execute_hooks_with_child_node(t,e){if(t){let n;for(n of t)n(e)}}}var k=n(8);class S{constructor(t){this._node=t}set_node(t){this._node=t}node(){return this._node}set_content(t){this._content=t,this._post_set_content()}has_content(){return null!=this._content}content(){return this._content}_post_set_content(){}coreContent(){return this._content}coreContentCloned(){return this._content}infos(){return[]}}var R=n(42),P=n(76);const I={[k.g.ANIM]:class extends S{set_content(t){super.set_content(t)}set_timeline_builder(t){return this.set_content(t)}timeline_builder(){return this.content()}coreContentCloned(){if(this._content)return this._content.clone()}},[k.g.COP]:class extends S{set_content(t){super.set_content(t)}texture(){return this._content}coreContent(){return this._content}coreContentCloned(){var t;const e=null===(t=this._content)||void 0===t?void 0:t.clone();return e&&(e.needsUpdate=!0),e}object(){return this.texture()}infos(){if(null!=this._content)return[this._content]}resolution(){return this._content&&this._content.image?[this._content.image.width,this._content.image.height]:[-1,-1]}},[k.g.EVENT]:class extends S{set_content(t){super.set_content(t)}},[k.g.GL]:class extends S{object(){return this._content}},[k.g.JS]:class extends S{object(){return this._content}},[k.g.MANAGER]:class extends S{set_content(t){super.set_content(t)}},[k.g.MAT]:class extends S{set_content(t){super.set_content(t)}set_material(t){null!=this._content&&this._content.dispose(),this.set_content(t)}has_material(){return this.has_content()}material(){return this.content()}},[k.g.OBJ]:class extends S{set_content(t){super.set_content(t)}set_object(t){return this.set_content(t)}has_object(){return this.has_content()}object(){return this.content()}},[k.g.POST]:class extends S{set_content(t){super.set_content(t)}render_pass(){return this._content}object(t={}){return this.render_pass()}},[k.g.ROP]:class extends S{set_content(t){super.set_content(t)}renderer(){return this._content}},[k.g.SOP]:class extends S{coreContentCloned(){if(this._content)return this._content.clone()}set_content(t){super.set_content(t)}firstObject(){if(this._content)return this._content.objects()[0]}firstCoreObject(){const t=this.firstObject();if(t)return new P.a(t,0)}firstGeometry(){const t=this.firstObject();return t?t.geometry:null}objectsCount(){return this._content?this._content.objects().length:0}objectsVisibleCount(){return this._content,0}objectsCountByType(){const t={},e=this._content;if(this._content&&e)for(let n of e.coreObjects()){const e=n.humanType();null==t[e]&&(t[e]=0),t[e]+=1}return t}objectsNamesByType(){const t={},e=this._content;if(this._content&&e)for(let n of e.coreObjects()){const e=n.humanType();t[e]=t[e]||[],t[e].push(n.name())}return t}pointAttributeNames(){let t=[];const e=this.firstGeometry();return e&&(t=Object.keys(e.attributes)),t}pointAttributeSizesByName(){let t={};const e=this.firstGeometry();return e&&Object.keys(e.attributes).forEach(n=>{const s=e.attributes[n];t[n]=s.itemSize}),t}objectAttributeSizesByName(){let t={};const e=this.firstCoreObject();if(e){const n=e.attribNames();for(let s of n){const n=e.attribSize(s);null!=n&&(t[s]=n)}}return t}pointAttributeTypesByName(){let t={};const e=this.firstGeometry();if(e){const n=new R.a(e);Object.keys(e.attributes).forEach(e=>{t[e]=n.attribType(e)})}return t}objectAttributeTypesByName(){let t={};const e=this.firstCoreObject();if(e)for(let n of e.attribNames())t[n]=e.attribType(n);return t}objectAttributeNames(){let t=[];const e=this.firstObject();return e&&(t=Object.keys(e.userData.attributes||{})),t}pointsCount(){return this._content?this._content.pointsCount():0}totalPointsCount(){return this._content?this._content.totalPointsCount():0}objectsData(){return this._content?this._content.objectsData():[]}boundingBox(){return this._content.boundingBox()}center(){return this._content.center()}size(){return this._content.size()}}};class D{constructor(t){this.node=t,this._callbacks=[],this._callbacks_tmp=[];const e=I[t.nodeContext()];this._container=new e(this.node)}get container(){return this._container}async requestContainer(){var t,e;return(null===(e=null===(t=this.node.flags)||void 0===t?void 0:t.bypass)||void 0===e?void 0:e.active())?await this.requestInputContainer(0)||this._container:this.node.isDirty()?new Promise((t,e)=>{this._callbacks.push(t),this.node.cookController.cook_main()}):this._container}async requestInputContainer(t){const e=this.node.io.inputs.input(t);return e?await e.requestContainer():(this.node.states.error.set(`input ${t} required`),this.notify_requesters(),null)}notify_requesters(t){let e;for(this._callbacks_tmp=this._callbacks.slice(),this._callbacks.splice(0,this._callbacks.length),t||(t=this.node.containerController.container);e=this._callbacks_tmp.pop();)e(t);this.node.scene().cookController.remove_node(this.node)}}class L{constructor(t){this.cookController=t,this._inputs_start=0,this._params_start=0,this._cook_start=0,this._cooks_count=0,this._data={inputs_time:0,params_time:0,cook_time:0}}get cooks_count(){return this._cooks_count}get data(){return this._data}active(){return this.cookController.performance_record_started}record_inputs_start(){this.active()&&(this._inputs_start=performance.now())}record_inputs_end(){this.active()&&(this._data.inputs_time=performance.now()-this._inputs_start)}record_params_start(){this.active()&&(this._params_start=performance.now())}record_params_end(){this.active()&&(this._data.params_time=performance.now()-this._params_start)}record_cook_start(){this.active()&&(this._cook_start=performance.now())}record_cook_end(){this.active()&&(this._data.cook_time=performance.now()-this._cook_start,this._cooks_count+=1)}}class M{constructor(t){this.node=t,this._cooking=!1,this._performance_controller=new L(this),this._inputs_evaluation_required=!0,this._core_performance=this.node.scene().performance}get performance_record_started(){return this._core_performance.started()}disallow_inputs_evaluation(){this._inputs_evaluation_required=!1}isCooking(){return!0===this._cooking}_init_cooking_state(){this._cooking=!0,this._cooking_dirty_timestamp=this.node.dirtyController.dirtyTimestamp()}_start_cook_if_no_errors(t){if(this.node.states.error.active())this.end_cook();else try{this._performance_controller.record_cook_start(),this.node.cook(t)}catch(t){this.node.states.error.set(`node internal error: '${t}'.`),l.a.warn(t),this.end_cook()}}async cook_main(){if(this.isCooking())return;let t;this._init_cooking_state(),this.node.states.error.clear(),this.node.scene().cookController.add_node(this.node),t=this._inputs_evaluation_required?await this._evaluate_inputs():[],this.node.params.params_eval_required()&&await this._evaluate_params(),this._start_cook_if_no_errors(t)}async cook_main_without_inputs(){this.node.scene().cookController.add_node(this.node),this.isCooking()?l.a.warn("cook_main_without_inputs already cooking",this.node.fullPath()):(this._init_cooking_state(),this.node.states.error.clear(),this.node.params.params_eval_required()&&await this._evaluate_params(),this._start_cook_if_no_errors([]))}end_cook(t){this._finalize_cook_performance();const e=this.node.dirtyController.dirtyTimestamp();null==e||e===this._cooking_dirty_timestamp?(this.node.removeDirtyState(),this._terminate_cook_process()):(l.a.log("COOK AGAIN",e,this._cooking_dirty_timestamp,this.node.fullPath()),this._cooking=!1,this.cook_main())}_terminate_cook_process(){this.isCooking()&&(this._cooking=!1,this.node.containerController.notify_requesters(),this._run_on_cook_complete_hooks())}async _evaluate_inputs(){this._performance_controller.record_inputs_start();let t=[];const e=this.node.io.inputs;this._inputs_evaluation_required&&(t=e.is_any_input_dirty()?await e.eval_required_inputs():await e.containers_without_evaluation());const n=e.inputs(),s=[];let r;for(let i=0;i<n.length;i++)r=t[i],r&&(e.cloneRequired(i)?s[i]=r.coreContentCloned():s[i]=r.coreContent());return this._performance_controller.record_inputs_end(),s}async _evaluate_params(){this._performance_controller.record_params_start(),await this.node.params.eval_all(),this._performance_controller.record_params_end()}get cooks_count(){return this._performance_controller.cooks_count}get cook_time(){return this._performance_controller.data.cook_time}_finalize_cook_performance(){this._core_performance.started()&&(this._performance_controller.record_cook_end(),this._core_performance.record_node_cook_data(this.node,this._performance_controller.data))}add_on_cook_complete_hook(t,e){this._on_cook_complete_hook_ids=this._on_cook_complete_hook_ids||[],this._on_cook_complete_hooks=this._on_cook_complete_hooks||[],this._on_cook_complete_hook_ids.push(t.graphNodeId()),this._on_cook_complete_hooks.push(e)}remove_on_cook_complete_hook(t){var e;if(!this._on_cook_complete_hook_ids||!this._on_cook_complete_hooks)return;const n=null===(e=this._on_cook_complete_hook_ids)||void 0===e?void 0:e.indexOf(t.graphNodeId());this._on_cook_complete_hook_ids.splice(n,1),this._on_cook_complete_hooks.splice(n,1)}_run_on_cook_complete_hooks(){if(this._on_cook_complete_hooks)for(let t of this._on_cook_complete_hooks)t(this.node)}}var z=n(146),B=n(12),q=n(98);class V extends q.a{static type(){return B.a.BOOLEAN}defaultValueSerialized(){return a.a.isString(this._default_value)?this._default_value:this.convert(this._default_value)||!1}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copy_value(t){this.set(t.value)}static are_raw_input_equal(t,e){return t==e}static are_values_equal(t,e){return t==e}convert(t){if(a.a.isBoolean(t))return t;if(a.a.isNumber(t))return t>=1;if(a.a.isString(t)){if(g.a.isBoolean(t))return g.a.toBoolean(t);if(g.a.isNumber(t)){return parseFloat(t)>=1}}return null}}var j=n(43);class G extends j.a{static type(){return B.a.BUTTON}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copy_value(t){}static are_raw_input_equal(t,e){return!0}static are_values_equal(t,e){return!0}async pressButton(){(this.node.isDirty()||this.node.cookController.isCooking())&&await this.node.requestContainer(),this.options.execute_callback()}}var U=n(62),$=n(99);const F=["r","g","b"];class H extends U.a{constructor(){super(...arguments),this._value=new i.a,this._value_pre_conversion=new i.a,this._value_serialized_dirty=!1,this._value_serialized=[0,0,0],this._value_pre_conversion_serialized=[0,0,0],this._copied_value=[0,0,0]}static type(){return B.a.COLOR}componentNames(){return F}defaultValueSerialized(){return a.a.isArray(this._default_value)?this._default_value:this._default_value.toArray()}valueSerialized(){return this._update_value_serialized_if_required(),this._value_serialized}valuePreConversionSerialized(){return this._update_value_serialized_if_required(),this._value_pre_conversion_serialized}_copy_value(t){t.value.toArray(this._copied_value),this.set(this._copied_value)}_clone_raw_input(t){if(t instanceof i.a)return t.clone();return[t[0],t[1],t[2]]}static are_raw_input_equal(t,e){return t instanceof i.a?e instanceof i.a?t.equals(e):t.r==e[0]&&t.g==e[1]&&t.b==e[2]:e instanceof i.a?t[0]==e.r&&t[1]==e.g&&t[2]==e.b:t[0]==e[0]&&t[1]==e[1]&&t[2]==e[2]}static are_values_equal(t,e){return t.equals(e)}initComponents(){super.initComponents(),this.r=this.components[0],this.g=this.components[1],this.b=this.components[2],this._value_serialized_dirty=!0}_update_value_serialized_if_required(){this._value_serialized_dirty&&(this._value_serialized[0]=this._value.r,this._value_serialized[1]=this._value.g,this._value_serialized[2]=this._value.b,this._value_pre_conversion_serialized[0]=this._value_pre_conversion.r,this._value_pre_conversion_serialized[1]=this._value_pre_conversion.g,this._value_pre_conversion_serialized[2]=this._value_pre_conversion.b)}valuePreConversion(){return this._value_pre_conversion}set_value_from_components(){this._value_pre_conversion.r=this.r.value,this._value_pre_conversion.g=this.g.value,this._value_pre_conversion.b=this.b.value,this._value.copy(this._value_pre_conversion);const t=this.options.color_conversion();if(null!=t&&t!=$.a.NONE){switch(t){case $.a.GAMMA_TO_LINEAR:return void this._value.convertGammaToLinear();case $.a.LINEAR_TO_GAMMA:return void this._value.convertLinearToGamma();case $.a.SRGB_TO_LINEAR:return void this._value.convertSRGBToLinear();case $.a.LINEAR_TO_SRGB:return void this._value.convertLinearToSRGB()}E.a.unreachable(t)}this._value_serialized_dirty=!0}}var J=n(149);class X extends j.a{static type(){return B.a.FOLDER}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copy_value(t){}static are_raw_input_equal(t,e){return!0}static are_values_equal(t,e){return!0}}class Y extends q.a{static type(){return B.a.INTEGER}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copy_value(t){this.set(t.valueSerialized())}_prefilter_invalid_raw_input(t){return a.a.isArray(t)?t[0]:a.a.isString(t)&&g.a.isNumber(t)?parseInt(t):t}static are_raw_input_equal(t,e){return t==e}static are_values_equal(t,e){return t==e}static convert(t){if(a.a.isNumber(t))return Math.round(t);if(a.a.isBoolean(t))return t?1:0;if(g.a.isNumber(t)){const e=parseInt(t);if(a.a.isNumber(e))return e}return null}convert(t){const e=Y.convert(t);return e?this.options.ensure_in_range(e):e}}var W=n(150),Z=n(100),K=n(36);class Q extends Z.a{static type(){return B.a.PARAM_PATH}initialize_param(){this._value=new m.d}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return""+this._raw_input}valueSerialized(){return""+this.value}_copy_value(t){this.set(t.valueSerialized())}static are_raw_input_equal(t,e){return t==e}static are_values_equal(t,e){return t==e}isDefault(){return this._raw_input==this._default_value}setParam(t){this.set(t.fullPath())}processRawInput(){this._value.path()!=this._raw_input&&(this._value.set_path(this._raw_input),this.find_target(),this.setDirty(),this.emitController.emit(K.a.VALUE_UPDATED))}async process_computation(){this.find_target()}find_target(){if(!this.node)return;const t=this._raw_input;let e=null;const n=null!=t&&""!==t;this.scene().referencesController.reset_reference_from_param(this),this.decomposed_path.reset(),n&&(e=m.a.find_param(this.node,t,this.decomposed_path));const s=this._value.param(),r=e;if(this.scene().referencesController.set_named_nodes_from_param(this),e&&this.scene().referencesController.set_reference_from_param(this,e),(null==s?void 0:s.graphNodeId())!==(null==r?void 0:r.graphNodeId())){const t=this.options.dependent_on_found_node(),n=this._value.param();n&&t&&this.removeGraphInput(n),e?this._assign_found_node(e):this._value.set_param(null),this.options.execute_callback()}this.removeDirtyState()}_assign_found_node(t){const e=this.options.dependent_on_found_node();this._value.set_param(t),e&&this.addGraphInput(t)}notify_path_rebuild_required(t){this.decomposed_path.update_from_name_change(t);const e=this.decomposed_path.to_path();this.set(e)}notify_target_param_owner_params_updated(t){this.setDirty()}}class tt extends Z.a{static type(){return B.a.NODE_PATH}initialize_param(){this._value=new m.c}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return""+this._raw_input}valueSerialized(){return""+this.value}_copy_value(t){this.set(t.valueSerialized())}static are_raw_input_equal(t,e){return t==e}static are_values_equal(t,e){return t==e}isDefault(){return this._raw_input==this._default_value}setNode(t){this.set(t.fullPath())}processRawInput(){this._value.path()!=this._raw_input&&(this._value.set_path(this._raw_input),this.find_target(),this.setDirty(),this.emitController.emit(K.a.VALUE_UPDATED))}async process_computation(){this.find_target()}find_target(){if(!this.node)return;const t=this._raw_input;let e=null;const n=null!=t&&""!==t;this.scene().referencesController.reset_reference_from_param(this),this.decomposed_path.reset(),n&&(e=m.a.find_node(this.node,t,this.decomposed_path));const s=this._value.node(),r=e;if(this.scene().referencesController.set_named_nodes_from_param(this),e&&this.scene().referencesController.set_reference_from_param(this,e),(null==s?void 0:s.graphNodeId())!==(null==r?void 0:r.graphNodeId())){const t=this.options.dependent_on_found_node(),n=this._value.node();n&&t&&this.removeGraphInput(n),e?this._assign_found_node(e):this._value.set_node(null),this.options.execute_callback()}this.removeDirtyState()}_assign_found_node(t){const e=this.options.dependent_on_found_node();this._is_node_expected_context(t)?this._is_node_expected_type(t)?(this._value.set_node(t),e&&this.addGraphInput(t)):this.states.error.set(`node type is ${t.type()} but the params expects one of ${(this._expected_node_types()||[]).join(", ")}`):this.states.error.set(`node context is ${t.nodeContext()} but the params expects a ${this._expected_context()}`)}_expected_context(){return this.options.node_selection_context()}_is_node_expected_context(t){var e,n;const s=this._expected_context();if(null==s)return!0;return s==(null===(n=null===(e=t.parent())||void 0===e?void 0:e.childrenController)||void 0===n?void 0:n.context)}_expected_node_types(){return this.options.node_selection_types()}_is_node_expected_type(t){const e=this._expected_node_types();return null==e||(null==e?void 0:e.includes(t.type()))}notify_path_rebuild_required(t){this.decomposed_path.update_from_name_change(t);const e=this.decomposed_path.to_path();this.set(e)}notify_target_param_owner_params_updated(t){this.setDirty()}}var et=n(79);class nt extends j.a{static type(){return B.a.SEPARATOR}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copy_value(t){}static are_raw_input_equal(t,e){return!0}static are_values_equal(t,e){return!0}}var st=n(151);const rt=["x","y"];class it extends U.a{constructor(){super(...arguments),this._value=new r.a,this._copied_value=[0,0]}static type(){return B.a.VECTOR2}componentNames(){return rt}defaultValueSerialized(){return a.a.isArray(this._default_value)?this._default_value:this._default_value.toArray()}valueSerialized(){return this.value.toArray()}_copy_value(t){t.value.toArray(this._copied_value),this.set(this._copied_value)}_clone_raw_input(t){if(t instanceof r.a)return t.clone();return[t[0],t[1]]}static are_raw_input_equal(t,e){return t instanceof r.a?e instanceof r.a?t.equals(e):t.x==e[0]&&t.y==e[1]:e instanceof r.a?t[0]==e.x&&t[1]==e.y:t[0]==e[0]&&t[1]==e[1]}static are_values_equal(t,e){return t.equals(e)}initComponents(){super.initComponents(),this.x=this.components[0],this.y=this.components[1]}set_value_from_components(){this._value.x=this.x.value,this._value.y=this.y.value}}const ot=["x","y","z"];class at extends U.a{constructor(){super(...arguments),this._value=new b.a,this._copied_value=[0,0,0]}static type(){return B.a.VECTOR3}componentNames(){return ot}defaultValueSerialized(){return a.a.isArray(this._default_value)?this._default_value:this._default_value.toArray()}valueSerialized(){return this.value.toArray()}_copy_value(t){t.value.toArray(this._copied_value),this.set(this._copied_value)}_clone_raw_input(t){if(t instanceof b.a)return t.clone();return[t[0],t[1],t[2]]}static are_raw_input_equal(t,e){return t instanceof b.a?e instanceof b.a?t.equals(e):t.x==e[0]&&t.y==e[1]&&t.z==e[2]:e instanceof b.a?t[0]==e.x&&t[1]==e.y&&t[2]==e.z:t[0]==e[0]&&t[1]==e[1]&&t[2]==e[2]}static are_values_equal(t,e){return t.equals(e)}initComponents(){super.initComponents(),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2]}set_value_from_components(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value}}const _t=["x","y","z","w"];class ut extends U.a{constructor(){super(...arguments),this._value=new w.a,this._copied_value=[0,0,0,0]}static type(){return B.a.VECTOR4}componentNames(){return _t}defaultValueSerialized(){return a.a.isArray(this._default_value)?this._default_value:this._default_value.toArray()}valueSerialized(){return this.value.toArray()}_copy_value(t){t.value.toArray(this._copied_value),this.set(this._copied_value)}_clone_raw_input(t){if(t instanceof w.a)return t.clone();return[t[0],t[1],t[2],t[3]]}static are_raw_input_equal(t,e){return t instanceof w.a?e instanceof w.a?t.equals(e):t.x==e[0]&&t.y==e[1]&&t.z==e[2]&&t.w==e[3]:e instanceof w.a?t[0]==e.x&&t[1]==e.y&&t[2]==e.z&&t[3]==e.w:t[0]==e[0]&&t[1]==e[1]&&t[2]==e[2]&&t[3]==e[3]}static are_values_equal(t,e){return t.equals(e)}initComponents(){super.initComponents(),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2],this.w=this.components[3]}set_value_from_components(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value,this._value.w=this.w.value}}const ct={[B.a.BOOLEAN]:V,[B.a.BUTTON]:G,[B.a.COLOR]:H,[B.a.FLOAT]:J.a,[B.a.FOLDER]:X,[B.a.INTEGER]:Y,[B.a.OPERATOR_PATH]:W.a,[B.a.PARAM_PATH]:Q,[B.a.NODE_PATH]:tt,[B.a.RAMP]:et.a,[B.a.SEPARATOR]:nt,[B.a.STRING]:st.a,[B.a.VECTOR2]:it,[B.a.VECTOR3]:at,[B.a.VECTOR4]:ut};class lt{constructor(){}dispose(){this._callback=void 0}params(){return this._params}callback(){return this._callback}init(t,e){if(this._params=t,e)this._callback=e;else{const t=this._params[0];switch(t.type()){case B.a.STRING:return this._handle_string_param(t);case B.a.OPERATOR_PATH:return this._handle_operator_path_param(t);case B.a.NODE_PATH:return this._handle_node_path_param(t);case B.a.PARAM_PATH:return this._handle_param_path_param(t);case B.a.FLOAT:case B.a.INTEGER:return this._handle_number_param(t)}}}_handle_string_param(t){this._callback=()=>t.value}_handle_operator_path_param(t){this._callback=()=>t.value}_handle_node_path_param(t){this._callback=()=>t.value.path()}_handle_param_path_param(t){this._callback=()=>t.value.path()}_handle_number_param(t){this._callback=()=>""+t.value}}class ht{constructor(t){this.node=t,this._param_create_mode=!1,this._params_created=!1,this._params_by_name={},this._params_list=[],this._param_names=[],this._non_spare_params=[],this._spare_params=[],this._non_spare_param_names=[],this._spare_param_names=[],this._params_added_since_last_params_eval=!1}get label(){return this._label_controller=this._label_controller||new lt}hasLabelController(){return null!=this._label_controller}dispose(){var t;this._params_node&&this._params_node.dispose();for(let t of this.all)t.dispose();this._post_create_params_hook_names=void 0,this._post_create_params_hooks=void 0,this._on_scene_load_hooks=void 0,this._on_scene_load_hook_names=void 0,null===(t=this._label_controller)||void 0===t||t.dispose()}init_dependency_node(){this._params_node||(this._params_node=new s.a(this.node.scene(),"params"),this.node.addGraphInput(this._params_node,!1))}init(){this.init_dependency_node(),this._param_create_mode=!0,this.init_from_params_config(),this.node.create_params(),this._post_create_params()}_post_create_params(){this._update_caches(),this.init_param_accessors(),this._param_create_mode=!1,this._params_created=!0,this.run_post_create_params_hooks()}post_create_spare_params(){this._update_caches(),this.init_param_accessors()}update_params(t){let e=!1,n=!1;if(t.names_to_delete)for(let e of t.names_to_delete)this.has(e)&&(this.delete_param(e),n=!0);if(t.to_add)for(let n of t.to_add){const t=this.addParam(n.type,n.name,n.init_value,n.options);t&&(null!=n.raw_input&&t.set(n.raw_input),e=!0)}(n||e)&&(this.post_create_spare_params(),this.node.scene().referencesController.notify_params_updated(this.node),this.node.emit(o.a.PARAMS_UPDATED))}init_from_params_config(){const t=this.node.params_config;let e=!1;if(t)for(let n of Object.keys(t)){const s=t[n];let r;this.node.params_init_value_overrides&&(r=this.node.params_init_value_overrides[n],e=!0),this.addParam(s.type,n,s.init_value,s.options,r)}e&&this.node.setDirty(),this.node.params_init_value_overrides=void 0}init_param_accessors(){let t=Object.getOwnPropertyNames(this.node.pv);this._remove_unneeded_accessors(t),t=Object.getOwnPropertyNames(this.node.pv);for(let e of this.all){const n=e.options.is_spare();(!t.includes(e.name())||n)&&(Object.defineProperty(this.node.pv,e.name(),{get:()=>e.value,configurable:n}),Object.defineProperty(this.node.p,e.name(),{get:()=>e,configurable:n}))}}_remove_unneeded_accessors(t){const e=this._param_names,n=[];for(let s of t)e.includes(s)||n.push(s);for(let t of n)Object.defineProperty(this.node.pv,t,{get:()=>{},configurable:!0}),Object.defineProperty(this.node.p,t,{get:()=>{},configurable:!0})}get params_node(){return this._params_node}get all(){return this._params_list}get non_spare(){return this._non_spare_params}get spare(){return this._spare_params}get names(){return this._param_names}get non_spare_names(){return this._non_spare_param_names}get spare_names(){return this._spare_param_names}set_with_type(t,e,n){const s=this.param_with_type(t,n);s?s.set(e):l.a.warn(`param ${t} not found with type ${n}`)}set_float(t,e){this.set_with_type(t,e,B.a.FLOAT)}set_vector3(t,e){this.set_with_type(t,e,B.a.VECTOR3)}has_param(t){return null!=this._params_by_name[t]}has(t){return this.has_param(t)}get(t){return this.param(t)}param_with_type(t,e){const n=this.param(t);if(n&&n.type()==e)return n}get_float(t){return this.param_with_type(t,B.a.FLOAT)}get_operator_path(t){return this.param_with_type(t,B.a.OPERATOR_PATH)}value(t){var e;return null===(e=this.param(t))||void 0===e?void 0:e.value}value_with_type(t,e){var n;return null===(n=this.param_with_type(t,e))||void 0===n?void 0:n.value}boolean(t){return this.value_with_type(t,B.a.BOOLEAN)}float(t){return this.value_with_type(t,B.a.FLOAT)}integer(t){return this.value_with_type(t,B.a.INTEGER)}string(t){return this.value_with_type(t,B.a.STRING)}vector2(t){return this.value_with_type(t,B.a.VECTOR2)}vector3(t){return this.value_with_type(t,B.a.VECTOR3)}color(t){return this.value_with_type(t,B.a.COLOR)}param(t){const e=this._params_by_name[t];return null!=e?e:(l.a.warn(`tried to access param '${t}' in node ${this.node.fullPath()}, but existing params are: ${this.names} on node ${this.node.fullPath()}`),null)}delete_param(t){const e=this._params_by_name[t];if(!e)throw new Error(`param '${t}' does not exist on node ${this.node.fullPath()}`);if(this._params_node&&this._params_node.removeGraphInput(this._params_by_name[t]),e._setup_node_dependencies(null),delete this._params_by_name[t],e.isMultiple()&&e.components)for(let t of e.components){const e=t.name();delete this._params_by_name[e]}}addParam(t,e,n,s={},r){const i=s.spare||!1;!1!==this._param_create_mode||i||l.a.warn(`node ${this.node.fullPath()} (${this.node.type()}) param '${e}' cannot be created outside of create_params`),null==this.node.scene()&&l.a.warn(`node ${this.node.fullPath()} (${this.node.type()}) has no scene assigned`);const o=ct[t];if(null!=o){const a=this._params_by_name[e];a&&(i?a.type()!=t&&this.delete_param(a.name()):l.a.warn(`a param named ${e} already exists`,this.node));const _=new o(this.node.scene(),this.node);if(_.options.set(s),_.setName(e),_.setInitValue(n),_.initComponents(),null==r)_.set(n);else if(_.options.is_expression_for_entities()&&_.set(n),null!=r.raw_input)_.set(r.raw_input);else if(null!=r.simple_data)_.set(r.simple_data);else if(null!=r.complex_data){const t=r.complex_data.raw_input;t?_.set(t):_.set(n);const e=r.complex_data.overriden_options;if(null!=e){const t=Object.keys(e);for(let n of t)_.options.set_option(n,e[n])}}if(_._setup_node_dependencies(this.node),this._params_by_name[_.name()]=_,_.isMultiple()&&_.components)for(let t of _.components)this._params_by_name[t.name()]=t;return this._params_added_since_last_params_eval=!0,_}}_update_caches(){this._params_list=Object.values(this._params_by_name),this._param_names=Object.keys(this._params_by_name),this._non_spare_params=Object.values(this._params_by_name).filter(t=>!t.options.is_spare()),this._spare_params=Object.values(this._params_by_name).filter(t=>t.options.is_spare()),this._non_spare_param_names=Object.values(this._params_by_name).filter(t=>!t.options.is_spare()).map(t=>t.name()),this._spare_param_names=Object.values(this._params_by_name).filter(t=>t.options.is_spare()).map(t=>t.name())}async _eval_param(t){t.isDirty()&&(await t.compute(),t.states.error.active()&&this.node.states.error.set(`param '${t.name()}' error: ${t.states.error.message()}`))}async eval_params(t){const e=[];for(let n of t)n.isDirty()&&e.push(this._eval_param(n));await Promise.all(e),this.node.states.error.active()&&this.node.setContainer(null)}params_eval_required(){return this._params_node&&(this._params_node.isDirty()||this._params_added_since_last_params_eval)}async eval_all(){var t;this.params_eval_required()&&(await this.eval_params(this._params_list),null===(t=this._params_node)||void 0===t||t.removeDirtyState(),this._params_added_since_last_params_eval=!1)}onParamsCreated(t,e){if(this._params_created)e();else{if(this._post_create_params_hook_names&&this._post_create_params_hook_names.includes(t))return void l.a.error(`hook name ${t} already exists`);this._post_create_params_hook_names=this._post_create_params_hook_names||[],this._post_create_params_hook_names.push(t),this._post_create_params_hooks=this._post_create_params_hooks||[],this._post_create_params_hooks.push(e)}}addOnSceneLoadHook(t,e){this._on_scene_load_hook_names=this._on_scene_load_hook_names||[],this._on_scene_load_hooks=this._on_scene_load_hooks||[],this._on_scene_load_hook_names.includes(t)?l.a.warn(`hook with name ${t} already exists`,this.node):(this._on_scene_load_hook_names.push(t),this._on_scene_load_hooks.push(e))}run_post_create_params_hooks(){if(this._post_create_params_hooks)for(let t of this._post_create_params_hooks)t()}runOnSceneLoadHooks(){if(this._on_scene_load_hooks)for(let t of this._on_scene_load_hooks)t()}}class dt{constructor(){}}class pt{constructor(t,e,n=0,s=0){if(this._node_src=t,this._node_dest=e,this._output_index=n,this._input_index=s,null==this._output_index)throw"bad output index";if(null==this._input_index)throw"bad input index";this._id=pt._next_id++,this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.addOutputConnection(this),this._node_dest.io.connections.addInputConnection(this))}get id(){return this._id}get node_src(){return this._node_src}get node_dest(){return this._node_dest}get output_index(){return this._output_index}get input_index(){return this._input_index}src_connection_point(){const t=this._node_src,e=this._output_index;return t.io.outputs.named_output_connection_points[e]}dest_connection_point(){const t=this._node_dest,e=this._input_index;return t.io.inputs.named_input_connection_points[e]}disconnect(t={}){this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.removeOutputConnection(this),this._node_dest.io.connections.removeInputConnection(this)),!0===t.setInput&&this._node_dest.io.inputs.setInput(this._input_index,null)}}pt._next_id=0;class mt{constructor(t){this.inputs_controller=t,this._clone_required_states=[],this._overridden=!1,this.node=t.node}initInputsClonedState(t){a.a.isArray(t)?this._cloned_states=t:this._cloned_state=t,this._update_clone_required_state()}overrideClonedStateAllowed(){if(this._cloned_states)for(let t of this._cloned_states)if(t==x.a.FROM_NODE)return!0;return!!this._cloned_state&&this._cloned_state==x.a.FROM_NODE}cloneRequiredState(t){return this._clone_required_states[t]}cloneRequiredStates(){return this._clone_required_states}_get_clone_required_state(t){const e=this._cloned_states;if(e){const n=e[t];if(null!=n)return this.clone_required_from_state(n)}return!this._cloned_state||this.clone_required_from_state(this._cloned_state)}clone_required_from_state(t){switch(t){case x.a.ALWAYS:return!0;case x.a.NEVER:return!1;case x.a.FROM_NODE:return!this._overridden}return E.a.unreachable(t)}overrideClonedState(t){this._overridden=t,this._update_clone_required_state(),this.node.emit(o.a.OVERRIDE_CLONABLE_STATE_UPDATE),this.node.setDirty()}overriden(){return this._overridden}_update_clone_required_state(){if(this._cloned_states){const t=[];for(let e=0;e<this._cloned_states.length;e++)t[e]=this._get_clone_required_state(e);this._clone_required_states=t}else if(this._cloned_state){const t=this.inputs_controller.maxInputsCount(),e=[];for(let n=0;n<t;n++)e[n]=this._get_clone_required_state(n);this._clone_required_states=e}else;}}class ft{constructor(t){this.node=t,this._graph_node_inputs=[],this._inputs=[],this._has_named_inputs=!1,this._min_inputs_count=0,this._max_inputs_count=0,this._maxInputsCountOnInput=0,this._depends_on_inputs=!0}dispose(){this._graph_node&&this._graph_node.dispose();for(let t of this._graph_node_inputs)t&&t.dispose();this._on_update_hooks=void 0,this._on_update_hook_names=void 0}set_depends_on_inputs(t){this._depends_on_inputs=t}set_min_inputs_count(t){this._min_inputs_count=t}set_max_inputs_count(t){0==this._max_inputs_count&&(this._maxInputsCountOnInput=t),this._max_inputs_count=t,this.init_graph_node_inputs()}named_input_connection_points_by_name(t){if(this._named_input_connection_points)for(let e of this._named_input_connection_points)if(e&&e.name()==t)return e}setNamedInputConnectionPoints(t){this._has_named_inputs=!0;const e=this.node.io.connections.inputConnections();if(e)for(let n of e)n&&n.input_index>=t.length&&n.disconnect({setInput:!0});this._named_input_connection_points=t,this.set_min_inputs_count(0),this.set_max_inputs_count(t.length),this.init_graph_node_inputs(),this.node.emit(o.a.NAMED_INPUTS_UPDATED)}get has_named_inputs(){return this._has_named_inputs}get named_input_connection_points(){return this._named_input_connection_points||[]}init_graph_node_inputs(){for(let t=0;t<this._max_inputs_count;t++)this._graph_node_inputs[t]=this._graph_node_inputs[t]||this._create_graph_node_input(t)}_create_graph_node_input(t){const e=new s.a(this.node.scene(),"input_"+t);return this._graph_node||(this._graph_node=new s.a(this.node.scene(),"inputs"),this.node.addGraphInput(this._graph_node,!1)),this._graph_node.addGraphInput(e,!1),e}maxInputsCount(){return this._max_inputs_count||0}maxInputsCountOverriden(){return this._max_inputs_count!=this._maxInputsCountOnInput}input_graph_node(t){return this._graph_node_inputs[t]}setCount(t,e){null==e&&(e=t),this.set_min_inputs_count(t),this.set_max_inputs_count(e),this.init_connections_controller_inputs()}init_connections_controller_inputs(){this.node.io.connections.initInputs()}is_any_input_dirty(){var t;return(null===(t=this._graph_node)||void 0===t?void 0:t.isDirty())||!1}async containers_without_evaluation(){const t=[];for(let e=0;e<this._inputs.length;e++){const n=this._inputs[e];let s=void 0;n&&(s=await n.requestContainer()),t.push(s)}return t}existing_input_indices(){const t=[];if(this._max_inputs_count>0)for(let e=0;e<this._inputs.length;e++)this._inputs[e]&&t.push(e);return t}async eval_required_inputs(){var t;let e=[];if(this._max_inputs_count>0){const n=this.existing_input_indices();if(n.length<this._min_inputs_count)this.node.states.error.set("inputs are missing");else if(n.length>0){const n=[];let s;for(let t=0;t<this._inputs.length;t++)s=this._inputs[t],s&&n.push(this.eval_required_input(t));e=await Promise.all(n),null===(t=this._graph_node)||void 0===t||t.removeDirtyState()}}return e}async eval_required_input(t){let e=void 0;const n=this.input(t);if(n&&(e=await n.requestContainer(),this._graph_node_inputs[t].removeDirtyState()),e&&e.coreContent());else{const e=this.input(t);if(e){const n=e.states.error.message();n&&this.node.states.error.set(`input ${t} is invalid (error: ${n})`)}}return e}get_named_input_index(t){var e;if(this._named_input_connection_points)for(let n=0;n<this._named_input_connection_points.length;n++)if((null===(e=this._named_input_connection_points[n])||void 0===e?void 0:e.name())==t)return n;return-1}get_input_index(t){if(a.a.isString(t)){if(this.has_named_inputs)return this.get_named_input_index(t);throw new Error(`node ${this.node.fullPath()} has no named inputs`)}return t}setInput(t,e,n=0){const s=this.get_input_index(t)||0;if(s<0){const e=`invalid input (${t}) for node ${this.node.fullPath()}`;throw console.warn(e),new Error(e)}let r=0;if(e&&e.io.outputs.has_named_outputs&&(r=e.io.outputs.get_output_index(n),null==r||r<0)){const t=e.io.outputs.named_output_connection_points.map(t=>t.name());return void console.warn(`node ${e.fullPath()} does not have an output named ${n}. inputs are: ${t.join(", ")}`)}const i=this._graph_node_inputs[s];if(null==i){const t="graph_input_node not found at index "+s;throw console.warn(t),new Error(t)}if(e&&this.node.parent()!=e.parent())return;const a=this._inputs[s];let _=null,u=void 0;this.node.io.connections&&(u=this.node.io.connections.inputConnection(s)),u&&(_=u.output_index),e===a&&r==_||(null!=a&&this._depends_on_inputs&&i.removeGraphInput(a),null!=e?i.addGraphInput(e)?(this._depends_on_inputs||i.removeGraphInput(e),u&&u.disconnect({setInput:!1}),this._inputs[s]=e,new pt(e,this.node,r,s)):console.warn(`cannot connect ${e.fullPath()} to ${this.node.fullPath()}`):(this._inputs[s]=null,u&&u.disconnect({setInput:!1})),this._run_on_set_input_hooks(),i.setSuccessorsDirty(),this.node.emit(o.a.INPUTS_UPDATED))}remove_input(t){const e=this.inputs();let n;for(let s=0;s<e.length;s++)n=e[s],null!=n&&null!=t&&n.graphNodeId()===t.graphNodeId()&&this.setInput(s,null)}input(t){return this._inputs[t]}named_input(t){if(this.has_named_inputs){const e=this.get_input_index(t);return this._inputs[e]}return null}named_input_connection_point(t){if(this.has_named_inputs&&this._named_input_connection_points){const e=this.get_input_index(t);return this._named_input_connection_points[e]}}has_named_input(t){return this.get_named_input_index(t)>=0}has_input(t){return null!=this._inputs[t]}inputs(){return this._inputs}initInputsClonedState(t){this._cloned_states_controller||(this._cloned_states_controller=new mt(this),this._cloned_states_controller.initInputsClonedState(t))}overrideClonedStateAllowed(){var t;return(null===(t=this._cloned_states_controller)||void 0===t?void 0:t.overrideClonedStateAllowed())||!1}overrideClonedState(t){var e;null===(e=this._cloned_states_controller)||void 0===e||e.overrideClonedState(t)}clonedStateOverriden(){var t;return(null===(t=this._cloned_states_controller)||void 0===t?void 0:t.overriden())||!1}cloneRequired(t){var e;const n=null===(e=this._cloned_states_controller)||void 0===e?void 0:e.cloneRequiredState(t);return null==n||n}cloneRequiredStates(){var t;const e=null===(t=this._cloned_states_controller)||void 0===t?void 0:t.cloneRequiredStates();return null==e||e}add_on_set_input_hook(t,e){this._on_update_hooks=this._on_update_hooks||[],this._on_update_hook_names=this._on_update_hook_names||[],this._on_update_hook_names.includes(t)?console.warn(`hook with name ${t} already exists`,this.node):(this._on_update_hooks.push(e),this._on_update_hook_names.push(t))}_run_on_set_input_hooks(){if(this._on_update_hooks)for(let t of this._on_update_hooks)t()}}class gt{constructor(t){this.node=t,this._has_outputs=!1,this._has_named_outputs=!1}set_has_one_output(){this._has_outputs=!0}set_has_no_output(){this._has_outputs=!1}get has_outputs(){return this._has_outputs}get has_named_outputs(){return this._has_named_outputs}has_named_output(t){return this.get_named_output_index(t)>=0}get named_output_connection_points(){return this._named_output_connection_points||[]}named_output_connection(t){if(this._named_output_connection_points)return this._named_output_connection_points[t]}get_named_output_index(t){var e;if(this._named_output_connection_points)for(let n=0;n<this._named_output_connection_points.length;n++)if((null===(e=this._named_output_connection_points[n])||void 0===e?void 0:e.name())==t)return n;return-1}get_output_index(t){return null!=t?a.a.isString(t)?this.has_named_outputs?this.get_named_output_index(t):(console.warn(`node ${this.node.fullPath()} has no named outputs`),-1):t:-1}named_output_connection_points_by_name(t){if(this._named_output_connection_points)for(let e of this._named_output_connection_points)if((null==e?void 0:e.name())==t)return e}setNamedOutputConnectionPoints(t,e=!0){this._has_named_outputs=!0;const n=this.node.io.connections.outputConnections();if(n)for(let e of n)e&&e.output_index>=t.length&&e.disconnect({setInput:!0});this._named_output_connection_points=t,e&&this.node.scene()&&this.node.setDirty(this.node),this.node.emit(o.a.NAMED_OUTPUTS_UPDATED)}used_output_names(){var t;const e=this.node.io.connections;if(e){let n=e.outputConnections().map(t=>t?t.output_index:null);n=v.a.uniq(n);const s=[];n.forEach(t=>{a.a.isNumber(t)&&s.push(t)});const r=[];for(let e of s){const n=null===(t=this.named_output_connection_points[e])||void 0===t?void 0:t.name();n&&r.push(n)}return r}return[]}}class vt{constructor(t){this._node=t,this._output_connections=new Map}initInputs(){const t=this._node.io.inputs.maxInputsCount();for(this._input_connections=this._input_connections||new Array(t);this._input_connections.length<t;)this._input_connections.push(void 0)}addInputConnection(t){this._input_connections?this._input_connections[t.input_index]=t:console.warn("input connections array not initialized")}removeInputConnection(t){if(this._input_connections)if(t.input_index<this._input_connections.length){this._input_connections[t.input_index]=void 0;let e=!0;for(let n=t.input_index;n<this._input_connections.length;n++)this._input_connections[n]&&(e=!1);e&&(this._input_connections=this._input_connections.slice(0,t.input_index))}else console.warn("attempt to remove an input connection at index "+t.input_index);else console.warn("input connections array not initialized")}inputConnection(t){if(this._input_connections)return this._input_connections[t]}firstInputConnection(){return this._input_connections?v.a.compact(this._input_connections)[0]:null}inputConnections(){return this._input_connections}addOutputConnection(t){const e=t.output_index,n=t.id;let s=this._output_connections.get(e);s||(s=new Map,this._output_connections.set(e,s)),s.set(n,t)}removeOutputConnection(t){const e=t.output_index,n=t.id;let s=this._output_connections.get(e);s&&s.delete(n)}outputConnections(){let t=[];return this._output_connections.forEach((e,n)=>{e.forEach((e,n)=>{e&&t.push(e)})}),t}}class yt{constructor(t){this._node=t}set_in(t){this._in=t}set_out(t){this._out=t}clear(){this._in=void 0,this._out=void 0}in(){return this._in}out(){return this._out}}var bt,wt=n(102),xt=n(103);!function(t){t.BOOL="bool",t.INT="int",t.FLOAT="float",t.VEC2="vec2",t.VEC3="vec3",t.VEC4="vec4"}(bt||(bt={}));bt.BOOL,bt.INT,bt.FLOAT,bt.VEC2,bt.VEC3,bt.VEC4;const Et={[bt.BOOL]:B.a.BOOLEAN,[bt.INT]:B.a.INTEGER,[bt.FLOAT]:B.a.FLOAT,[bt.VEC2]:B.a.VECTOR2,[bt.VEC3]:B.a.VECTOR3,[bt.VEC4]:B.a.VECTOR4},At={[B.a.BOOLEAN]:bt.BOOL,[B.a.COLOR]:bt.VEC3,[B.a.INTEGER]:bt.INT,[B.a.FLOAT]:bt.FLOAT,[B.a.FOLDER]:void 0,[B.a.VECTOR2]:bt.VEC2,[B.a.VECTOR3]:bt.VEC3,[B.a.VECTOR4]:bt.VEC4,[B.a.BUTTON]:void 0,[B.a.OPERATOR_PATH]:void 0,[B.a.PARAM_PATH]:void 0,[B.a.NODE_PATH]:void 0,[B.a.RAMP]:void 0,[B.a.SEPARATOR]:void 0,[B.a.STRING]:void 0},Tt={[bt.BOOL]:!1,[bt.INT]:0,[bt.FLOAT]:0,[bt.VEC2]:[0,0],[bt.VEC3]:[0,0,0],[bt.VEC4]:[0,0,0,0]};bt.BOOL,bt.INT,bt.FLOAT,bt.VEC2,bt.VEC3,bt.VEC4;class Ot extends xt.a{constructor(t,e){super(t,e),this._name=t,this._type=e,this._init_value=Tt[this._type]}type(){return this._type}are_types_matched(t,e){return t==e}get param_type(){return Et[this._type]}get init_value(){return this._init_value}toJSON(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type}}}var Ct=n(53);const Nt={[k.g.ANIM]:void 0,[k.g.COP]:void 0,[k.g.EVENT]:Ct.b.BASE,[k.g.GL]:wt.c.FLOAT,[k.g.JS]:bt.FLOAT,[k.g.MANAGER]:void 0,[k.g.MAT]:void 0,[k.g.OBJ]:void 0,[k.g.POST]:void 0,[k.g.ROP]:void 0,[k.g.SOP]:void 0};function kt(t,e,n){switch(t){case k.g.EVENT:return new Ct.a(e,n);case k.g.GL:return new wt.b(e,n);case k.g.JS:return new Ot(e,n);default:return}}var St=n(59);class Rt{constructor(t,e){this.node=t,this._context=e,this._raw_input_serialized_by_param_name=new Map,this._default_value_serialized_by_param_name=new Map,this._initialized=!1}initializeNode(){this._initialized?console.warn("already initialized",this.node):(this._initialized=!0,this.node.params.onParamsCreated("create_inputs_from_params",this.create_inputs_from_params.bind(this)))}initialized(){return this._initialized}create_inputs_from_params(){const t=function(t){switch(t){case k.g.EVENT:return;case k.g.GL:return wt.a;case k.g.JS:return At;default:return}}(this._context);if(!t)return;const e=[];for(let n of this.node.params.names){let s=!0;if(this._inputless_param_names&&this._inputless_param_names.length>0&&this._inputless_param_names.includes(n)&&(s=!1),s&&this.node.params.has(n)){const s=this.node.params.get(n);if(s&&!s.parent_param){const n=t[s.type()];if(n){const t=kt(this._context,s.name(),n);t&&e.push(t)}}}}this.node.io.inputs.setNamedInputConnectionPoints(e)}set_inputless_param_names(t){return this._inputless_param_names=t}create_spare_parameters(){if(this.node.scene().loadingController.isLoading())return;const t=this.node.params.spare_names,e={};for(let n of t)if(this.node.params.has(n)){const t=this.node.params.get(n);t&&(this._raw_input_serialized_by_param_name.set(n,t.rawInputSerialized()),this._default_value_serialized_by_param_name.set(n,t.defaultValueSerialized()),e.names_to_delete=e.names_to_delete||[],e.names_to_delete.push(n))}for(let t of this.node.io.inputs.named_input_connection_points)if(t){const n=t.name(),s=t.param_type;let r=t.init_value;const i=this._default_value_serialized_by_param_name.get(n);let o=this.node.param_default_value(n);if(r=null!=o?o:null!=i?i:t.init_value,a.a.isArray(t.init_value))if(a.a.isNumber(r)){const e=new Array(t.init_value.length);e.fill(r),r=e}else a.a.isArray(r)&&r.length==t.init_value.length&&null!=i&&(r=t.init_value);null!=r&&(e.to_add=e.to_add||[],e.to_add.push({name:n,type:s,init_value:St.a.clone(r),raw_input:St.a.clone(r),options:{spare:!0}}))}this.node.params.update_params(e);for(let t of this.node.params.spare)if(!t.parent_param){const e=this._raw_input_serialized_by_param_name.get(t.name());e&&t.set(e)}}}class Pt{constructor(t,e){this.node=t,this._context=e,this._create_spare_params_from_inputs=!0,this._functions_overridden=!1,this._input_name_function=t=>"in"+t,this._output_name_function=t=>0==t?"val":"val"+t,this._expected_input_types_function=()=>{const t=this.first_input_connection_type()||this.default_connection_type();return[t,t]},this._expected_output_types_function=()=>[this._expected_input_types_function()[0]],this._update_signature_if_required_bound=this.update_signature_if_required.bind(this),this._initialized=!1,this._spare_params_controller=new Rt(this.node,this._context)}default_connection_type(){return Nt[this._context]}create_connection_point(t,e){return kt(this._context,t,e)}functions_overridden(){return this._functions_overridden}initialized(){return this._initialized}set_create_spare_params_from_inputs(t){this._create_spare_params_from_inputs=t}set_input_name_function(t){this._initialize_if_required(),this._input_name_function=t}set_output_name_function(t){this._initialize_if_required(),this._output_name_function=t}set_expected_input_types_function(t){this._initialize_if_required(),this._functions_overridden=!0,this._expected_input_types_function=t}set_expected_output_types_function(t){this._initialize_if_required(),this._functions_overridden=!0,this._expected_output_types_function=t}input_name(t){return this._wrapped_input_name_function(t)}output_name(t){return this._wrapped_output_name_function(t)}initializeNode(){this._initialized?console.warn("already initialized",this.node):(this._initialized=!0,this.node.io.inputs.add_on_set_input_hook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.addOnSceneLoadHook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.onParamsCreated("_update_signature_if_required_bound",this._update_signature_if_required_bound),this.node.addPostDirtyHook("_update_signature_if_required",this._update_signature_if_required_bound),this._spare_params_controller.initialized()||this._spare_params_controller.initializeNode())}_initialize_if_required(){this._initialized||this.initializeNode()}get spare_params(){return this._spare_params_controller}update_signature_if_required(t){this.node.lifecycle.creation_completed&&this._connections_match_inputs()||(this.update_connection_types(),this.node.removeDirtyState(),this.node.scene().loadingController.isLoading()||this.make_successors_update_signatures())}make_successors_update_signatures(){const t=this.node.graphAllSuccessors();if(this.node.childrenAllowed()){const e=this.node.nodesByType(k.e.INPUT),n=this.node.nodesByType(k.e.OUTPUT);for(let n of e)t.push(n);for(let e of n)t.push(e)}for(let e of t){const t=e;t.io&&t.io.has_connection_points_controller&&t.io.connection_points.initialized()&&t.io.connection_points.update_signature_if_required(this.node)}}update_connection_types(){const t=this._wrapped_expected_input_types_function(),e=this._wrapped_expected_output_types_function(),n=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.create_connection_point(this._wrapped_input_name_function(e),s);n.push(r)}const s=[];for(let t=0;t<e.length;t++){const n=e[t],r=this.create_connection_point(this._wrapped_output_name_function(t),n);s.push(r)}this.node.io.inputs.setNamedInputConnectionPoints(n),this.node.io.outputs.setNamedOutputConnectionPoints(s,!1),this._create_spare_params_from_inputs&&this._spare_params_controller.create_spare_parameters()}_connections_match_inputs(){const t=this.node.io.inputs.named_input_connection_points.map(t=>null==t?void 0:t.type()),e=this.node.io.outputs.named_output_connection_points.map(t=>null==t?void 0:t.type()),n=this._wrapped_expected_input_types_function(),s=this._wrapped_expected_output_types_function();if(n.length!=t.length)return!1;if(s.length!=e.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!=n[e])return!1;for(let t=0;t<e.length;t++)if(e[t]!=s[t])return!1;return!0}_wrapped_expected_input_types_function(){if(this.node.scene().loadingController.isLoading()){const t=this.node.io.saved_connection_points_data.in();if(t)return t.map(t=>t.type)}return this._expected_input_types_function()}_wrapped_expected_output_types_function(){if(this.node.scene().loadingController.isLoading()){const t=this.node.io.saved_connection_points_data.out();if(t)return t.map(t=>t.type)}return this._expected_output_types_function()}_wrapped_input_name_function(t){if(this.node.scene().loadingController.isLoading()){const e=this.node.io.saved_connection_points_data.in();if(e)return e[t].name}return this._input_name_function(t)}_wrapped_output_name_function(t){if(this.node.scene().loadingController.isLoading()){const e=this.node.io.saved_connection_points_data.out();if(e)return e[t].name}return this._output_name_function(t)}first_input_connection_type(){return this.input_connection_type(0)}input_connection_type(t){const e=this.node.io.connections.inputConnections();if(e){const n=e[t];if(n)return n.src_connection_point().type()}}}class It{constructor(t){this.node=t,this._connections=new vt(this.node)}get connections(){return this._connections}get inputs(){return this._inputs=this._inputs||new ft(this.node)}has_inputs(){return null!=this._inputs}get outputs(){return this._outputs=this._outputs||new gt(this.node)}has_outputs(){return null!=this._outputs}get connection_points(){return this._connection_points=this._connection_points||new Pt(this.node,this.node.nodeContext())}get has_connection_points_controller(){return null!=this._connection_points}get saved_connection_points_data(){return this._saved_connection_points_data=this._saved_connection_points_data||new yt(this.node)}clear_saved_connection_points_data(){this._saved_connection_points_data&&(this._saved_connection_points_data.clear(),this._saved_connection_points_data=void 0)}}class Dt{constructor(){}}class Lt extends s.a{constructor(t,e="BaseNode",n){super(t,e),this.params_init_value_overrides=n,this.containerController=new D(this),this.pv=new dt,this.p=new Dt,this._initialized=!1}copy_param_values(t){const e=this.params.non_spare;for(let n of e){const e=t.params.get(n.name());e&&n.copy_value(e)}}get parentController(){return this._parent_controller=this._parent_controller||new f(this)}static displayedInputNames(){return[]}get childrenControllerContext(){return this._children_controller_context}_create_children_controller(){if(this._children_controller_context)return new C(this,this._children_controller_context)}get childrenController(){return this._children_controller=this._children_controller||this._create_children_controller()}childrenAllowed(){return null!=this._children_controller_context}get uiData(){return this._ui_data=this._ui_data||new _(this)}get states(){return this._states=this._states||new d(this)}get lifecycle(){return this._lifecycle=this._lifecycle||new N(this)}get serializer(){return this._serializer=this._serializer||new z.a(this)}get cookController(){return this._cook_controller=this._cook_controller||new M(this)}get io(){return this._io=this._io||new It(this)}get nameController(){return this._name_controller=this._name_controller||new p(this)}setName(t){this.nameController.setName(t)}_set_core_name(t){this._name=t}get params(){return this._params_controller=this._params_controller||new ht(this)}initialize_base_and_node(){var t;this._initialized?console.warn("node already initialized"):(this._initialized=!0,null===(t=this.displayNodeController)||void 0===t||t.initializeNode(),this.initializeBaseNode(),this.initializeNode(),this.polyNodeController&&this.polyNodeController.initializeNode())}initializeBaseNode(){}initializeNode(){}static type(){throw"type to be overriden"}type(){return this.constructor.type()}static nodeContext(){throw console.error("node has no node_context",this),"node_context requires override"}nodeContext(){return this.constructor.nodeContext()}static require_webgl2(){return!1}require_webgl2(){return this.constructor.require_webgl2()}setParent(t){this.parentController.setParent(t)}parent(){return this.parentController.parent()}root(){return this._scene.root()}fullPath(t){return this.parentController.fullPath(t)}create_params(){}addParam(t,e,n,s){var r;return null===(r=this._params_controller)||void 0===r?void 0:r.addParam(t,e,n,s)}param_default_value(t){return null}cook(t){return null}async requestContainer(){return this.isDirty()?await this.containerController.requestContainer():this.containerController.container}setContainer(t,e=null){this.containerController.container.set_content(t),null!=t&&(t.name||(t.name=this.fullPath()),t.node||(t.node=this)),this.cookController.end_cook(e)}createNode(t,e){var n;return null===(n=this.childrenController)||void 0===n?void 0:n.createNode(t,e)}create_operation_container(t,e,n){var s;return null===(s=this.childrenController)||void 0===s?void 0:s.create_operation_container(t,e,n)}removeNode(t){var e;null===(e=this.childrenController)||void 0===e||e.removeNode(t)}dispose(){var t,e;super.dispose(),this.setParent(null),this.io.inputs.dispose(),this.lifecycle.dispose(),null===(t=this.displayNodeController)||void 0===t||t.dispose(),this.nameController.dispose(),null===(e=this.childrenController)||void 0===e||e.dispose(),this.params.dispose()}children(){var t;return(null===(t=this.childrenController)||void 0===t?void 0:t.children())||[]}node(t){var e;return(null===(e=this.parentController)||void 0===e?void 0:e.find_node(t))||null}nodeSibbling(t){var e;const n=this.parent();if(n){const s=null===(e=n.childrenController)||void 0===e?void 0:e.child_by_name(t);if(s)return s}return null}nodesByType(t){var e;return(null===(e=this.childrenController)||void 0===e?void 0:e.nodesByType(t))||[]}setInput(t,e,n=0){this.io.inputs.setInput(t,e,n)}emit(t,e=null){this.scene().dispatchController.dispatch(this,t,e)}toJSON(t=!1){return this.serializer.toJSON(t)}async requiredModules(){}usedAssembler(){}integrationData(){}}},39:function(t,e,n){"use strict";n.d(e,"a",(function(){return _})),n.d(e,"c",(function(){return h})),n.d(e,"b",(function(){return d})),n.d(e,"d",(function(){return p}));class s{constructor(t){this.node=t,this._state=!0,this._hooks=null}onUpdate(t){this._hooks=this._hooks||[],this._hooks.push(t)}_on_update(){}set(t){this._state!=t&&(this._state=t,this._on_update(),this.runHooks())}active(){return this._state}toggle(){this.set(!this._state)}runHooks(){if(this._hooks)for(let t of this._hooks)t()}}var r=n(26);class i extends s{constructor(){super(...arguments),this._state=!1}_on_update(){this.node.emit(r.a.FLAG_BYPASS_UPDATED),this.node.setDirty()}}class o extends s{_on_update(){this.node.emit(r.a.FLAG_DISPLAY_UPDATED)}}class a extends s{constructor(){super(...arguments),this._state=!1}_on_update(){this.node.emit(r.a.FLAG_OPTIMIZE_UPDATED)}}class _{constructor(t){this.node=t}has_display(){return!1}has_bypass(){return!1}has_optimize(){return!1}}function u(t){return class extends t{constructor(){super(...arguments),this.display=new o(this.node)}has_display(){return!0}}}function c(t){return class extends t{constructor(){super(...arguments),this.bypass=new i(this.node)}has_bypass(){return!0}}}function l(t){return class extends t{constructor(){super(...arguments),this.optimize=new a(this.node)}has_optimize(){return!0}}}class h extends(u(_)){}c(_);c(u(_));class d extends(l(c(_))){}class p extends(l(c(u(_)))){}},4:function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return l}));var s=n(12),r=n(79),i=n(9),o=n(6),a=n(3),_=n(16);class u{constructor(t,e,n){this.type=t,this.init_value=e,this.options=n}}class c{static BUTTON(t,e){return new u(s.a.BUTTON,t,e)}static BOOLEAN(t,e){return new u(s.a.BOOLEAN,t,e)}static COLOR(t,e){return t instanceof i.a&&(t=t.toArray()),new u(s.a.COLOR,t,e)}static FLOAT(t,e){return new u(s.a.FLOAT,t,e)}static FOLDER(t=null,e){return new u(s.a.FOLDER,t,e)}static INTEGER(t,e){return new u(s.a.INTEGER,t,e)}static RAMP(t=r.a.DEFAULT_VALUE,e){return new u(s.a.RAMP,t,e)}static SEPARATOR(t=null,e){return new u(s.a.SEPARATOR,t,e)}static STRING(t="",e){return new u(s.a.STRING,t,e)}static VECTOR2(t,e){return t instanceof o.a&&(t=t.toArray()),new u(s.a.VECTOR2,t,e)}static VECTOR3(t,e){return t instanceof a.a&&(t=t.toArray()),new u(s.a.VECTOR3,t,e)}static VECTOR4(t,e){return t instanceof _.a&&(t=t.toArray()),new u(s.a.VECTOR4,t,e)}static OPERATOR_PATH(t,e){return new u(s.a.OPERATOR_PATH,t,e)}static NODE_PATH(t,e){return new u(s.a.NODE_PATH,t,e)}static PARAM_PATH(t,e){return new u(s.a.PARAM_PATH,t,e)}}class l{}},42:function(t,e,n){"use strict";n.d(e,"a",(function(){return S}));var s=n(3),r=n(11),i=n(16),o=n(6),a=n(31),_=n(126),u=n(7);const c="position",l="normal";var h;!function(t){t.x="x",t.y="y",t.z="z",t.w="w",t.r="r",t.g="g",t.b="b"}(h||(h={}));const d={x:0,y:1,z:2,w:3,r:0,g:1,b:2};class p extends _.a{constructor(t,e){super(e),this._core_geometry=t,this._geometry=this._core_geometry.geometry()}applyMatrix4(t){this.position().applyMatrix4(t)}core_geometry(){return this._core_geometry}geometry(){return this._geometry=this._geometry||this._core_geometry.geometry()}attribSize(t){return t=a.b.remap_name(t),this._geometry.getAttribute(t).itemSize}hasAttrib(t){const e=a.b.remap_name(t);return this._core_geometry.hasAttrib(e)}attribValue(t,e){if("ptnum"===t)return this.index();{let n=null,r=null;"."===t[t.length-2]&&(n=t[t.length-1],r=d[n],t=t.substring(0,t.length-2));const _=a.b.remap_name(t),u=this._geometry.getAttribute(_);if(!u){const e=`attrib ${t} not found. availables are: ${Object.keys(this._geometry.attributes||{}).join(",")}`;throw console.warn(e),e}{const{array:t}=u;if(this._core_geometry.isAttribIndexed(_))return this.indexedAttribValue(_);{const n=u.itemSize,a=this._index*n;if(null==r)switch(n){case 1:return t[a];case 2:return(e=e||new o.a).fromArray(t,a),e;case 3:return(e=e||new s.a).fromArray(t,a),e;case 4:return(e=e||new i.a).fromArray(t,a),e;default:throw`size not valid (${n})`}else switch(n){case 1:return t[a];default:return t[a+r]}}}}}indexedAttribValue(t){const e=this.attribValueIndex(t);return this._core_geometry.userDataAttrib(t)[e]}stringAttribValue(t){return this.indexedAttribValue(t)}attribValueIndex(t){return this._core_geometry.isAttribIndexed(t)?this._geometry.getAttribute(t).array[this._index]:-1}isAttribIndexed(t){return this._core_geometry.isAttribIndexed(t)}position(){return this._position||(this._position=this._findPosition(new s.a))}_findPosition(t){const{array:e}=this._geometry.getAttribute(c);return t.fromArray(e,3*this._index)}getPosition(t){const{array:e}=this._geometry.getAttribute(c);return t.fromArray(e,3*this._index)}setPosition(t){this.setAttribValueVector3(c,t)}normal(){const{array:t}=this._geometry.getAttribute(l);return this._normal=this._normal||new s.a,this._normal.fromArray(t,3*this._index)}setNormal(t){return this.setAttribValueVector3(l,t)}setAttribValue(t,e){if(null==e)return;if(null==t)throw"Point.set_attrib_value requires a name";const n=this._geometry.getAttribute(t),s=n.array,r=n.itemSize;if(u.a.isArray(e))for(let t=0;t<r;t++)s[this._index*r+t]=e[t];else switch(r){case 1:s[this._index]=e;break;case 2:const t=e;s[2*this._index+0]=t.x,s[2*this._index+1]=t.y;break;case 3:if(null!=e.r){const t=e;s[3*this._index+0]=t.r,s[3*this._index+1]=t.g,s[3*this._index+2]=t.b}else{const t=e;s[3*this._index+0]=t.x,s[3*this._index+1]=t.y,s[3*this._index+2]=t.z}break;default:throw console.warn("Point.set_attrib_value does not yet allow attrib size "+r),`attrib size ${r} not implemented`}}setAttribValueVector3(t,e){if(null==e)return;if(null==t)throw"Point.set_attrib_value requires a name";const n=this._geometry.getAttribute(t).array,s=3*this._index;n[s]=e.x,n[s+1]=e.y,n[s+2]=e.z}setAttribIndex(t,e){return this._geometry.getAttribute(t).array[this._index]=e}}var m=n(123),f=n(58),g=n(25);class v{constructor(t,e){this._core_geometry=t,this._index=e,this._geometry=this._core_geometry.geometry()}index(){return this._index}points(){return this._points=this._points||this._get_points()}applyMatrix4(t){for(let e of this.points())e.applyMatrix4(t)}_get_points(){var t;const e=(null===(t=this._geometry.index)||void 0===t?void 0:t.array)||[],n=3*this._index;return[new p(this._core_geometry,e[n+0]),new p(this._core_geometry,e[n+1]),new p(this._core_geometry,e[n+2])]}positions(){return this._positions=this._positions||this._get_positions()}_get_positions(){const t=this.points();return[t[0].position(),t[1].position(),t[2].position()]}triangle(){return this._triangle=this._triangle||this._get_triangle()}_get_triangle(){const t=this.positions();return new m.a(t[0],t[1],t[2])}deltas(){return this._deltas=this._deltas||this._get_deltas()}_get_deltas(){const t=this.positions();return[t[1].clone().sub(t[0]),t[2].clone().sub(t[0])]}area(){return this.triangle().getArea()}center(t){const e=this.positions();return t.x=(e[0].x+e[1].x+e[2].x)/3,t.y=(e[0].y+e[1].y+e[2].y)/3,t.z=(e[0].z+e[1].z+e[2].z)/3,t}random_position(t){let e=[f.a.randFloat(t),f.a.randFloat(6541*t)];return e[0]+e[1]>1&&(e[0]=1-e[0],e[1]=1-e[1]),this.positions()[0].clone().add(this.deltas()[0].clone().multiplyScalar(e[0])).add(this.deltas()[1].clone().multiplyScalar(e[1]))}attrib_value_at_position(t,e){const n=new s.a;this.triangle().getBarycoord(e,n);const r=n.toArray(),i=this._geometry.attributes[t].itemSize,o=this.points().map(e=>e.attribValue(t));let a,_,u=0;switch(i){case 1:_=0;for(let t of o)_+=t*r[u],u++;a=_;break;default:for(let t of o){const e=t.multiplyScalar(r[u]);_?_.add(e):_=e,u++}a=_}return a}static interpolated_value(t,e,n,r){const i=[e.a,e.b,e.c],a=t.getAttribute("position").array,_=i.map(t=>new s.a(a[3*t+0],a[3*t+1],a[3*t+2])),u=r.itemSize,c=r.array;let l=[];switch(u){case 1:l=i.map(t=>c[t]);break;case 2:l=i.map(t=>new o.a(c[2*t+0],c[2*t+1]));break;case 3:l=i.map(t=>new s.a(c[3*t+0],c[3*t+1],c[3*t+2]))}const h=i.map((t,e)=>n.distanceTo(_[e])),d=g.a.sum([h[0]*h[1],h[0]*h[2],h[1]*h[2]]),p=[h[1]*h[2]/d,h[0]*h[2]/d,h[0]*h[1]/d];let m;switch(u){case 1:m=g.a.sum(i.map((t,e)=>p[e]*l[e]));break;default:var f=i.map((t,e)=>l[e].multiplyScalar(p[e]));m=null;for(let t of f)m?m.add(t):m=t}return m}}var y=n(15),b=n(19);class w{from_points(t){t=this._filter_points(t);const e=new b.a,n=new S(e),s=t[0];if(null!=s){const i=s.geometry(),o=s.core_geometry(),a={};for(let e=0;e<t.length;e++)a[t[e].index()]=e;const _=this._indices_from_points(a,i);_&&e.setIndex(_);const{attributes:u}=i;for(let s of Object.keys(u)){if(null!=o.userDataAttribs()[s]){const i=g.a.uniq(t.map(t=>t.indexedAttribValue(s))),o={};i.forEach((t,e)=>o[t]=e),n.userDataAttribs()[s]=i;const a=[];for(let e of t){const t=o[e.indexedAttribValue(s)];a.push(t)}e.setAttribute(s,new r.b(a,1))}else{const n=u[s].itemSize,i=new Array(t.length*n);switch(n){case 1:for(let e=0;e<t.length;e++)i[e]=t[e].attribValue(s);break;default:let e;for(let r=0;r<t.length;r++)e=t[r].attribValue(s),e.toArray(i,r*n)}e.setAttribute(s,new r.b(i,n))}}}return e}}var x=n(183),E=n(184),A=n(5),T={computeTangents:function(t){t.computeTangents(),console.warn("THREE.BufferGeometryUtils: .computeTangents() has been removed. Use BufferGeometry.computeTangents() instead.")},mergeBufferGeometries:function(t,e){for(var n=null!==t[0].index,s=new Set(Object.keys(t[0].attributes)),r=new Set(Object.keys(t[0].morphAttributes)),i={},o={},a=t[0].morphTargetsRelative,_=new b.a,u=0,c=0;c<t.length;++c){var l=t[c],h=0;if(n!==(null!==l.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var d in l.attributes){if(!s.has(d))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+'. All geometries must have compatible attributes; make sure "'+d+'" attribute exists among all geometries, or in none of them.'),null;void 0===i[d]&&(i[d]=[]),i[d].push(l.attributes[d]),h++}if(h!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". Make sure all geometries have the same number of attributes."),null;if(a!==l.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var d in l.morphAttributes){if(!r.has(d))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[d]&&(o[d]=[]),o[d].push(l.morphAttributes[d])}if(_.userData.mergedUserData=_.userData.mergedUserData||[],_.userData.mergedUserData.push(l.userData),e){var p;if(n)p=l.index.count;else{if(void 0===l.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". The geometry must have either an index or a position attribute"),null;p=l.attributes.position.count}_.addGroup(u,p,c),u+=p}}if(n){var m=0,f=[];for(c=0;c<t.length;++c){for(var g=t[c].index,v=0;v<g.count;++v)f.push(g.getX(v)+m);m+=t[c].attributes.position.count}_.setIndex(f)}for(var d in i){var y=this.mergeBufferAttributes(i[d]);if(!y)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" attribute."),null;_.setAttribute(d,y)}for(var d in o){var w=o[d][0].length;if(0===w)break;_.morphAttributes=_.morphAttributes||{},_.morphAttributes[d]=[];for(c=0;c<w;++c){var x=[];for(v=0;v<o[d].length;++v)x.push(o[d][v][c]);var E=this.mergeBufferAttributes(x);if(!E)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" morphAttribute."),null;_.morphAttributes[d].push(E)}}return _},mergeBufferAttributes:function(t){for(var e,n,s,i=0,o=0;o<t.length;++o){var a=t[o];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=a.array.constructor),e!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=a.itemSize),n!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===s&&(s=a.normalized),s!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=a.array.length}var _=new e(i),u=0;for(o=0;o<t.length;++o)_.set(t[o].array,u),u+=t[o].array.length;return new r.a(_,n,s)},interleaveAttributes:function(t){for(var e,n=0,s=0,r=0,i=t.length;r<i;++r){var o=t[r];if(void 0===e&&(e=o.array.constructor),e!==o.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=o.array.length,s+=o.itemSize}var a=new x.a(new e(n),s),_=0,u=[],c=["getX","getY","getZ","getW"],l=["setX","setY","setZ","setW"],h=0;for(i=t.length;h<i;h++){var d=(o=t[h]).itemSize,p=o.count,m=new E.a(a,d,_,o.normalized);u.push(m),_+=d;for(var f=0;f<p;f++)for(var g=0;g<d;g++)m[l[g]](f,o[c[g]](f))}return u},estimateBytesUsed:function(t){var e=0;for(var n in t.attributes){var s=t.getAttribute(n);e+=s.count*s.itemSize*s.array.BYTES_PER_ELEMENT}var r=t.getIndex();return e+=r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0},mergeVertices:function(t,e=1e-4){e=Math.max(e,Number.EPSILON);for(var n={},s=t.getIndex(),i=t.getAttribute("position"),o=s?s.count:i.count,a=0,_=Object.keys(t.attributes),u={},c={},l=[],h=["getX","getY","getZ","getW"],d=0,p=_.length;d<p;d++){u[b=_[d]]=[],(A=t.morphAttributes[b])&&(c[b]=new Array(A.length).fill().map(()=>[]))}var m=Math.log10(1/e),f=Math.pow(10,m);for(d=0;d<o;d++){var g=s?s.getX(d):d,v="",y=0;for(p=_.length;y<p;y++)for(var b=_[y],w=(E=t.getAttribute(b)).itemSize,x=0;x<w;x++)v+=~~(E[h[x]](g)*f)+",";if(v in n)l.push(n[v]);else{for(y=0,p=_.length;y<p;y++){b=_[y];var E=t.getAttribute(b),A=t.morphAttributes[b],T=(w=E.itemSize,u[b]),O=c[b];for(x=0;x<w;x++){var C=h[x];if(T.push(E[C](g)),A)for(var N=0,k=A.length;N<k;N++)O[N].push(A[N][C](g))}}n[v]=a,l.push(a),a++}}const S=t.clone();for(d=0,p=_.length;d<p;d++){b=_[d];var R=t.getAttribute(b),P=new R.array.constructor(u[b]);E=new r.a(P,R.itemSize,R.normalized);if(S.setAttribute(b,E),b in c)for(y=0;y<c[b].length;y++){var I=t.morphAttributes[b][y],D=(P=new I.array.constructor(c[b][y]),new r.a(P,I.itemSize,I.normalized));S.morphAttributes[b][y]=D}}return S.setIndex(l),S},toTrianglesDrawMode:function(t,e){if(e===A.Oc)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===A.Mc||e===A.Nc){var n=t.getIndex();if(null===n){var s=[],r=t.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var i=0;i<r.count;i++)s.push(i);t.setIndex(s),n=t.getIndex()}var o=n.count-2,a=[];if(e===A.Mc)for(i=1;i<=o;i++)a.push(n.getX(0)),a.push(n.getX(i)),a.push(n.getX(i+1));else for(i=0;i<o;i++)i%2==0?(a.push(n.getX(i)),a.push(n.getX(i+1)),a.push(n.getX(i+2))):(a.push(n.getX(i+2)),a.push(n.getX(i+1)),a.push(n.getX(i)));a.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var _=t.clone();return _.setIndex(a),_.clearGroups(),_}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t},computeMorphedAttributes:function(t){if(!0!==t.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;var e=new s.a,n=new s.a,i=new s.a,o=new s.a,a=new s.a,_=new s.a,u=new s.a,c=new s.a,l=new s.a;function h(t,s,r,h,d,p,m,f,g){e.fromBufferAttribute(r,p),n.fromBufferAttribute(r,m),i.fromBufferAttribute(r,f);var v=t.morphTargetInfluences;if(s.morphTargets&&h&&v){u.set(0,0,0),c.set(0,0,0),l.set(0,0,0);for(var y=0,b=h.length;y<b;y++){var w=v[y];h=h[y];0!==w&&(o.fromBufferAttribute(h,p),a.fromBufferAttribute(h,m),_.fromBufferAttribute(h,f),d?(u.addScaledVector(o,w),c.addScaledVector(a,w),l.addScaledVector(_,w)):(u.addScaledVector(o.sub(e),w),c.addScaledVector(a.sub(n),w),l.addScaledVector(_.sub(i),w)))}e.add(u),n.add(c),i.add(l)}t.isSkinnedMesh&&(t.boneTransform(p,e),t.boneTransform(m,n),t.boneTransform(f,i)),g[3*p+0]=e.x,g[3*p+1]=e.y,g[3*p+2]=e.z,g[3*m+0]=n.x,g[3*m+1]=n.y,g[3*m+2]=n.z,g[3*f+0]=i.x,g[3*f+1]=i.y,g[3*f+2]=i.z}var d,p,m,f,g,v,y,b,w,x=t.geometry,E=t.material,A=x.index,T=x.attributes.position,O=x.morphAttributes.position,C=x.morphTargetsRelative,N=x.attributes.normal,k=x.morphAttributes.position,S=x.groups,R=x.drawRange,P=new Float32Array(T.count*T.itemSize),I=new Float32Array(N.count*N.itemSize);if(null!==A)if(Array.isArray(E))for(f=0,v=S.length;f<v;f++)for(w=E[(b=S[f]).materialIndex],g=Math.max(b.start,R.start),y=Math.min(b.start+b.count,R.start+R.count);g<y;g+=3)h(t,w,T,O,C,d=A.getX(g),p=A.getX(g+1),m=A.getX(g+2),P),h(t,w,N,k,C,d,p,m,I);else for(f=Math.max(0,R.start),v=Math.min(A.count,R.start+R.count);f<v;f+=3)h(t,E,T,O,C,d=A.getX(f),p=A.getX(f+1),m=A.getX(f+2),P),h(t,E,N,k,C,d,p,m,I);else if(void 0!==T)if(Array.isArray(E))for(f=0,v=S.length;f<v;f++)for(w=E[(b=S[f]).materialIndex],g=Math.max(b.start,R.start),y=Math.min(b.start+b.count,R.start+R.count);g<y;g+=3)h(t,w,T,O,C,d=g,p=g+1,m=g+2,P),h(t,w,N,k,C,d,p,m,I);else for(f=Math.max(0,R.start),v=Math.min(T.count,R.start+R.count);f<v;f+=3)h(t,E,T,O,C,d=f,p=f+1,m=f+2,P),h(t,E,N,k,C,d,p,m,I);return{positionAttribute:T,normalAttribute:N,morphedPositionAttribute:new r.b(P,3),morphedNormalAttribute:new r.b(I,3)}}},O=n(128);var C=n(27),N=n(59),k=n(22);class S{constructor(t){this._geometry=t}geometry(){return this._geometry}uuid(){return this._geometry.uuid}boundingBox(){return this._bounding_box=this._bounding_box||this._create_bounding_box()}_create_bounding_box(){if(this._geometry.computeBoundingBox(),this._geometry.boundingBox)return this._geometry.boundingBox}markAsInstance(){this._geometry.userData.isInstance=!0}static markedAsInstance(t){return!0===t.userData.isInstance}markedAsInstance(){return S.markedAsInstance(this._geometry)}positionAttribName(){let t="position";return this.markedAsInstance()&&(t="instancePosition"),t}computeVertexNormals(){this._geometry.computeVertexNormals()}userDataAttribs(){const t="indexed_attrib_values";return this._geometry.userData[t]=this._geometry.userData[t]||{}}indexedAttributeNames(){return Object.keys(this.userDataAttribs()||{})}userDataAttrib(t){return t=a.b.remap_name(t),this.userDataAttribs()[t]}isAttribIndexed(t){return t=a.b.remap_name(t),null!=this.userDataAttrib(t)}hasAttrib(t){return"ptnum"===t||(t=a.b.remap_name(t),null!=this._geometry.attributes[t])}attribType(t){return this.isAttribIndexed(t)?y.h.STRING:y.h.NUMERIC}static attribNames(t){return Object.keys(t.attributes)}attribNames(){return S.attribNames(this._geometry)}static attribNamesMatchingMask(t,e){const n=k.a.attribNames(e),s=[];for(let e of this.attribNames(t))for(let t of n)k.a.matchMask(e,t)&&s.push(e);return g.a.uniq(s)}attribSizes(){const t={};for(let e of this.attribNames())t[e]=this._geometry.attributes[e].itemSize;return t}attribSize(t){let e;return t=a.b.remap_name(t),null!=(e=this._geometry.attributes[t])?e.itemSize:"ptnum"===t?1:0}setIndexedAttributeValues(t,e){this.userDataAttribs()[t]=e}setIndexedAttribute(t,e,n){this.setIndexedAttributeValues(t,e),this._geometry.setAttribute(t,new r.c(n,1))}addNumericAttrib(t,e=1,n=0){const s=[];let i=!1;if(u.a.isNumber(n)){for(let t=0;t<this.pointsCount();t++)for(let t=0;t<e;t++)s.push(n);i=!0}else if(e>1)if(u.a.isArray(n)){for(let t=0;t<this.pointsCount();t++)for(let t=0;t<e;t++)s.push(n[t]);i=!0}else{const t=n;if(2==e&&null!=t.x&&null!=t.y){for(let e=0;e<this.pointsCount();e++)s.push(t.x),s.push(t.y);i=!0}const r=n;if(3==e&&null!=r.x&&null!=r.y&&null!=r.z){for(let t=0;t<this.pointsCount();t++)s.push(r.x),s.push(r.y),s.push(r.z);i=!0}const o=n;if(3==e&&null!=o.r&&null!=o.g&&null!=o.b){for(let t=0;t<this.pointsCount();t++)s.push(o.r),s.push(o.g),s.push(o.b);i=!0}const a=n;if(4==e&&null!=a.x&&null!=a.y&&null!=a.z&&null!=a.w){for(let t=0;t<this.pointsCount();t++)s.push(a.x),s.push(a.y),s.push(a.z),s.push(a.w);i=!0}}if(!i)throw console.warn(n),`CoreGeometry.add_numeric_attrib error: no other default value allowed for now in add_numeric_attrib (default given: ${n})`;this._geometry.setAttribute(t.trim(),new r.b(s,e))}initPositionAttribute(t,e){const n=[];null==e&&(e=new s.a);for(let s=0;s<t;s++)n.push(e.x),n.push(e.y),n.push(e.z);return this._geometry.setAttribute("position",new r.b(n,3))}addAttribute(t,e){switch(e.type()){case y.h.STRING:return console.log("TODO: to implement");case y.h.NUMERIC:return this.addNumericAttrib(t,e.size())}}renameAttrib(t,e){this.isAttribIndexed(t)&&(this.userDataAttribs()[e]=N.a.clone(this.userDataAttribs()[t]),delete this.userDataAttribs()[t]);const n=this._geometry.getAttribute(t);return this._geometry.setAttribute(e.trim(),new r.b(n.array,n.itemSize)),this._geometry.deleteAttribute(t)}deleteAttribute(t){return this.isAttribIndexed(t)&&delete this.userDataAttribs()[t],this._geometry.deleteAttribute(t)}clone(){return S.clone(this._geometry)}static clone(t){let e;const n=t.clone();return null!=(e=t.userData)&&(n.userData=N.a.cloneDeep(e)),n}pointsCount(){return S.pointsCount(this._geometry)}static pointsCount(t){let e,n=0;let s="position";if(new this(t).markedAsInstance()&&(s="instancePosition"),null!=(e=t.getAttribute(s))){let t;null!=(t=e.array)&&(n=t.length/3)}return n}points(){return this.pointsFromGeometry()}pointsFromGeometry(){const t=[],e=this._geometry.getAttribute(this.positionAttribName());if(null!=e){const n=e.array.length/3;for(let e=0;e<n;e++){const n=new p(this,e);t.push(n)}}return t}static geometryFromPoints(t,e){switch(e){case y.l.MESH:return this._mesh_builder.from_points(t);case y.l.POINTS:return this._points_builder.from_points(t);case y.l.LINE_SEGMENTS:return this._lines_segment_builder.from_points(t);case y.l.OBJECT3D:case y.l.LOD:return null}C.a.unreachable(e)}static merge_geometries(t){return class{static merge(t){if(0===t.length)return;for(let e of t)O.a.create_index_if_none(e);const e=t.map(t=>new S(t)),n=e[0].indexedAttributeNames(),s={};for(let t of n){const n={},r=[];for(let s of e){const e=s.points();for(let s of e){r.push(s);const e=s.indexedAttribValue(t);null!=n[e]?n[e]:n[e]=Object.keys(n).length}}const i=Object.keys(n);for(let e of r){const s=n[e.indexedAttribValue(t)];e.setAttribIndex(t,s)}s[t]=i}const r=T.mergeBufferGeometries(t),i=new S(r);return Object.keys(s).forEach(t=>{const e=s[t];i.setIndexedAttributeValues(t,e)}),r&&delete r.userData.mergedUserData,r}}.merge(t)}segments(){var t;const e=(null===(t=this.geometry().index)||void 0===t?void 0:t.array)||[];return g.a.chunk(e,2)}faces(){return this.facesFromGeometry()}facesFromGeometry(){var t;const e=((null===(t=this.geometry().index)||void 0===t?void 0:t.array)||[]).length/3;return g.a.range(e).map(t=>new v(this,t))}}S._mesh_builder=new class extends w{_filter_points(t){var e;const n=t[0];if(n){const s=null===(e=n.geometry().getIndex())||void 0===e?void 0:e.array;if(s){const e={};for(let n of t)e[n.index()]=n;const n=[],r=s.length;let i,o,a;for(let t=0;t<r;t+=3)i=e[s[t+0]],o=e[s[t+1]],a=e[s[t+2]],i&&o&&a&&(n.push(i),n.push(o),n.push(a));return n}}return[]}_indices_from_points(t,e){const n=e.index;if(null!=n){const e=n.array,s=[];let r,i,o,a,_,u;for(let n=0;n<e.length;n+=3)r=e[n+0],i=e[n+1],o=e[n+2],a=t[r],_=t[i],u=t[o],null!=a&&null!=_&&null!=u&&(s.push(a),s.push(_),s.push(u));return s}}},S._points_builder=new class extends w{_filter_points(t){return t}_indices_from_points(t,e){const n=e.index;if(null!=n){const e=n.array,s=[];let r,i;for(let n=0;n<e.length;n++)r=e[n],i=t[r],null!=i&&s.push(i);return s}}},S._lines_segment_builder=new class extends w{_filter_points(t){var e;const n=t[0];if(n){const s=null===(e=n.geometry().getIndex())||void 0===e?void 0:e.array;if(s){const e={};for(let n of t)e[n.index()]=n;const n=[],r=s.length;let i,o;for(let t=0;t<r;t+=2)i=e[s[t+0]],o=e[s[t+1]],i&&o&&(n.push(i),n.push(o));return n}}return[]}_indices_from_points(t,e){const n=e.index;if(null!=n){const e=n.array,s=[];let r,i,o,a;for(let n=0;n<e.length;n+=2)r=e[n],i=e[n+1],o=t[r],a=t[i],null!=o&&null!=a&&(s.push(o),s.push(a));return s}}}},43:function(t,e,n){"use strict";n.d(e,"a",(function(){return m}));var s=n(21),r=n(28),i=n(147);class o{constructor(t){this.param=t,this._blocked_emit=!1,this._blocked_parent_emit=!1,this._count_by_event_name={}}emitAllowed(){return!0!==this._blocked_emit&&(!this.param.scene().loadingController.isLoading()&&this.param.scene().dispatchController.emitAllowed())}blockEmit(){if(this._blocked_emit=!0,this.param.isMultiple()&&this.param.components)for(let t of this.param.components)t.emitController.blockEmit();return!0}unblockEmit(){if(this._blocked_emit=!1,this.param.isMultiple()&&this.param.components)for(let t of this.param.components)t.emitController.unblockEmit();return!0}blockParentEmit(){return this._blocked_parent_emit=!0,!0}unblockParentEmit(){return this._blocked_parent_emit=!1,!0}incrementCount(t){this._count_by_event_name[t]=this._count_by_event_name[t]||0,this._count_by_event_name[t]+=1}eventsCount(t){return this._count_by_event_name[t]||0}emit(t){this.emitAllowed()&&(this.param.emit(t),null!=this.param.parent_param&&!0!==this._blocked_parent_emit&&this.param.parent_param.emit(t))}}class a{constructor(t){this.param=t}toJSON(){const t={name:this.param.name(),type:this.param.type(),raw_input:this.rawInput(),value:this.value(),value_pre_conversion:this.value_pre_conversion(),expression:this.expression(),graph_node_id:this.param.graphNodeId(),error_message:this.error_message(),is_visible:this.is_visible(),components:void 0};return this.param.isMultiple()&&this.param.components&&(t.components=this.param.components.map(t=>t.graphNodeId())),t}rawInput(){return this.param.rawInputSerialized()}value(){return this.param.valueSerialized()}value_pre_conversion(){return this.param.valuePreConversionSerialized()}expression(){var t;return this.param.hasExpression()?null===(t=this.param.expressionController)||void 0===t?void 0:t.expression():void 0}error_message(){return this.param.states.error.message()}is_visible(){return this.param.options.is_visible()}}class _{constructor(t){this.param=t}active(){const t=this.param.scene().timeController.graphNode.graphNodeId();return this.param.graphPredecessorIds().includes(t)}}var u=n(36);class c{constructor(t){this.param=t}set(t){this._message!=t&&(this._message=t,this._message&&console.warn(this.param.fullPath(),this._message),this.param.emitController.emit(u.a.ERROR_UPDATED))}message(){return this._message}clear(){this.set(void 0)}active(){return null!=this._message}}class l{constructor(t){this.param=t,this.time_dependent=new _(this.param),this.error=new c(this.param)}}var h=n(12),d=n(122);const p=[];class m extends r.a{constructor(t,e){super(t,"BaseParam"),this._options=new i.b(this),this._emit_controller=new o(this),this._is_computing=!1,this._node=e,this.initialize_param()}get options(){return this._options=this._options||new i.b(this)}get emitController(){return this._emit_controller=this._emit_controller||new o(this)}get expressionController(){return this._expression_controller}get serializer(){return this._serializer=this._serializer||new a(this)}get states(){return this._states=this._states||new l(this)}dispose(){var t,e;const n=this.graphPredecessors();for(let t of n)t instanceof d.a&&t.dispose();null===(t=this._expression_controller)||void 0===t||t.dispose(),super.dispose(),null===(e=this._options)||void 0===e||e.dispose()}initialize_param(){}static type(){return h.a.FLOAT}type(){return this.constructor.type()}isNumeric(){return!1}setName(t){super.setName(t)}get value(){return this._value}copy_value(t){t.type()==this.type()?this._copy_value(t):console.warn(`cannot copy value from ${t.type()} to ${this.type()}`)}_copy_value(t){throw"abstract method param._copy_value"}valuePreConversionSerialized(){}convert(t){return null}static are_raw_input_equal(t,e){return!1}is_raw_input_equal(t){return this.constructor.are_raw_input_equal(this._raw_input,t)}static are_values_equal(t,e){return!1}is_value_equal(t){return this.constructor.are_values_equal(this.value,t)}_clone_raw_input(t){return t}set(t){this._raw_input=this._clone_raw_input(this._prefilter_invalid_raw_input(t)),this.emitController.emit(u.a.RAW_INPUT_UPDATED),this.processRawInput()}_prefilter_invalid_raw_input(t){return t}defaultValue(){return this._default_value}isDefault(){return this._raw_input==this._default_value}rawInput(){return this._raw_input}processRawInput(){}async compute(){if(this.scene().loadingController.isLoading()&&console.warn("param attempt to compute "+this.fullPath()),this.isDirty()){if(this._is_computing)return new Promise((t,e)=>{this._compute_resolves=this._compute_resolves||[],this._compute_resolves.push(t)});if(this._is_computing=!0,await this.process_computation(),this._is_computing=!1,this._compute_resolves){let t;for(;t=this._compute_resolves.pop();)t()}}}async process_computation(){}setInitValue(t){this._default_value=this._clone_raw_input(this._prefilter_invalid_raw_input(t))}_setup_node_dependencies(t){var e,n;if(t?(this.options.allowCallback(),this.options.makes_node_dirty_when_dirty()&&!this.parent_param&&(null===(n=t.params.params_node)||void 0===n||n.addGraphInput(this,!1))):this._node&&(null===(e=this._node.params.params_node)||void 0===e||e.removeGraphInput(this)),this.components)for(let e of this.components)e._setup_node_dependencies(t)}get node(){return this._node}parent(){return this.node}set_parent_param(t){t.addGraphInput(this,!1),this._parent_param=t}get parent_param(){return this._parent_param}has_parent_param(){return null!=this._parent_param}fullPath(){var t;return(null===(t=this.node)||void 0===t?void 0:t.fullPath())+"/"+this.name()}pathRelativeTo(t){const e=s.a.relativePath(t,this.node);return e.length>0?`${e}${s.a.SEPARATOR}${this.name()}`:this.name()}emit(t){this.emitController.emitAllowed()&&(this.emitController.incrementCount(t),this.scene().dispatchController.dispatch(this,t))}get components(){return this._components}componentNames(){return p}isMultiple(){return this.componentNames().length>0}initComponents(){}hasExpression(){return null!=this.expressionController&&this.expressionController.active()}toJSON(){return this.serializer.toJSON()}}},52:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{static push_on_array_at_entry(t,e,n){t.has(e)?t.get(e).push(n):t.set(e,[n])}static pop_from_array_at_entry(t,e,n){if(t.has(e)){const s=t.get(e),r=s.indexOf(n);r>=0&&s.splice(r,1)}}static unshift_on_array_at_entry(t,e,n){t.has(e)?t.get(e).unshift(n):t.set(e,[n])}static concat_on_array_at_entry(t,e,n){if(t.has(e)){let s=t.get(e);for(let t of n)s.push(t)}else t.set(e,n)}}},53:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return o}));var s,r=n(103),i=n(12);!function(t){t.BASE="base",t.KEYBOARD="keyboard",t.MOUSE="mouse",t.POINTER="pointer"}(s||(s={}));class o extends r.a{constructor(t,e,n){super(t,e),this._name=t,this._type=e,this._event_listener=n}type(){return this._type}get param_type(){return i.a.FLOAT}are_types_matched(t,e){return e==s.BASE||t==e}get event_listener(){return this._event_listener}toJSON(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type}}}},58:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var s=n(3),r=n(127),i=n(7);const o=Math.PI/180;class a{static clamp(t,e,n){return t<e?e:t>n?n:t}static fit01(t,e,n){return this.fit(t,0,1,e,n)}static fit(t,e,n,s,r){return(t-e)/(n-e)*(r-s)+s}static blend(t,e,n){return(1-n)*t+n*e}static degrees_to_radians(t){return t*o}static radians_to_degrees(t){return t/o}static deg2rad(t){return this.degrees_to_radians(t)}static rad2deg(t){return this.radians_to_degrees(t)}static rand(t){return i.a.isNumber(t)?this.randFloat(t):this.randVec2(t)}static round(t,e){const n=t/e;return(t<0?Math.ceil(n):Math.floor(n))*e}static highest_even(t){return 2*Math.ceil(.5*t)}static randFloat(t,e=136574){return this._vec.x=t,this._vec.y=e,this.randVec2(this._vec)}static randVec2(t){const e=(12.9898*t.x+78.233*t.y)%Math.PI;return this.fract(43758.5453*Math.sin(e))}static geodesic_distance(t,e){var n=this.deg2rad(t.lat),s=this.deg2rad(e.lat),r=this.deg2rad(e.lat-t.lat),i=this.deg2rad(e.lng-t.lng),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(n)*Math.cos(s)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}static expand_triangle(t,e){t.getMidpoint(this._triangle_mid),this._triangle_mid_to_corner.copy(t.a).sub(this._triangle_mid),this._triangle_mid_to_corner.normalize().multiplyScalar(e),t.a.add(this._triangle_mid_to_corner),this._triangle_mid_to_corner.copy(t.b).sub(this._triangle_mid),this._triangle_mid_to_corner.normalize().multiplyScalar(e),t.b.add(this._triangle_mid_to_corner),this._triangle_mid_to_corner.copy(t.c).sub(this._triangle_mid),this._triangle_mid_to_corner.normalize().multiplyScalar(e),t.c.add(this._triangle_mid_to_corner)}static nearestPower2(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))}}a.Easing=r.a,a.fract=t=>t-Math.floor(t),a._vec={x:0,y:136574},a._triangle_mid=new s.a,a._triangle_mid_to_corner=new s.a},59:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var s=n(25),r=n(7),i=n(185),o=n.n(i),a=n(256),_=n.n(a);class u{static isEqual(t,e){if(r.a.isObject(t)&&r.a.isObject(e)){const n=Object.keys(t),r=Object.keys(e);return!!s.a.isEqual(n,r)&&JSON.stringify(t)==JSON.stringify(e)}return!1}static merge(t,e){return Object.assign(t,e)}static clone(t){return _()(t)}static cloneDeep(t){return o()(t)}}},62:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var s=n(43),r=n(149),i=n(36),o=n(7);class a extends s.a{constructor(){super(...arguments),this._components_contructor=r.a}get components(){return this._components}isNumeric(){return!0}isDefault(){for(let t of this.components)if(!t.isDefault())return!1;return!0}rawInput(){return this._components.map(t=>t.rawInput())}rawInputSerialized(){return this._components.map(t=>t.rawInputSerialized())}_copy_value(t){for(let e=0;e<this.components.length;e++){const n=this.components[e],s=t.components[e];n.copy_value(s)}}initComponents(){if(null!=this._components)return;let t=0;this._components=new Array(this.componentNames().length);for(let e of this.componentNames()){const n=new this._components_contructor(this.scene(),this._node);let s;s=o.a.isArray(this._default_value)?this._default_value[t]:this._default_value[e],n.options.copy(this.options),n.setInitValue(s),n.setName(`${this.name()}${e}`),n.set_parent_param(this),this._components[t]=n,t++}}async process_computation(){await this.compute_components(),this.set_value_from_components()}set_value_from_components(){}hasExpression(){var t;for(let e of this.components)if(null===(t=e.expressionController)||void 0===t?void 0:t.active())return!0;return!1}async compute_components(){const t=this.components,e=[];for(let n of t)n.isDirty()&&e.push(n.compute());await Promise.all(e),this.removeDirtyState()}_prefilter_invalid_raw_input(t){if(o.a.isArray(t))return t;{const e=t;return this.componentNames().map(()=>e)}}processRawInput(){const t=this.scene().cooker;t.block();const e=this.components;for(let t of e)t.emitController.blockParentEmit();const n=this._raw_input;let s=0;if(o.a.isArray(n))for(let t=0;t<e.length;t++){let r=n[t];null==r&&(r=s),e[t].set(r),s=r}else for(let t=0;t<e.length;t++){let r=n[this.componentNames()[t]];null==r&&(r=s),e[t].set(r),s=r}t.unblock();for(let t=0;t<e.length;t++)e[t].emitController.unblockParentEmit();this.emitController.emit(i.a.VALUE_UPDATED)}}},7:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n(6),r=n(3),i=n(16);class o{static isNumber(t){return"number"==typeof t}static isVector(t){return t instanceof s.a||t instanceof r.a||t instanceof i.a}static isString(t){return"string"==typeof t}static isBoolean(t){return!0===t||!1===t}static isNaN(t){return isNaN(t)}static isArray(t){return Array.isArray(t)}static isObject(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}}},76:function(t,e,n){"use strict";n.d(e,"a",(function(){return m}));var s=n(6),r=n(3),i=n(16),o=n(9),a=n(42),_=n(31),u=n(15),c=n(97),l=n(22),h=n(126),d=n(7),p=n(59);class m extends h.a{constructor(t,e){super(e),this._object=t,null==this._object.userData.attributes&&(this._object.userData.attributes={})}object(){return this._object}geometry(){return this._object.geometry}coreGeometry(){const t=this.geometry();return t?new a.a(t):null}points(){var t;return(null===(t=this.coreGeometry())||void 0===t?void 0:t.points())||[]}pointsFromGroup(t){if(t){const e=l.a.indices(t);if(e){const t=this.points();return e.map(e=>t[e])}return[]}return this.points()}static isInGroup(t,e){const n=t.trim();if(0==n.length)return!0;const s=n.split("="),r=s[0];if("@"==r[0]){const t=r.substr(1);return s[1]==this.attribValue(e,t)}return!1}computeVertexNormals(){var t;null===(t=this.coreGeometry())||void 0===t||t.computeVertexNormals()}static _convert_array_to_vector(t){switch(t.length){case 1:return t[0];case 2:return new s.a(t[0],t[1]);case 3:return new r.a(t[0],t[1],t[2]);case 4:return new i.a(t[0],t[1],t[2],t[3])}}static addAttribute(t,e,n){if(d.a.isArray(n)){if(!this._convert_array_to_vector(n)){const t="attribute_value invalid";throw console.error(t,n),new Error(t)}}const s=n,r=t.userData;r.attributes=r.attributes||{},r.attributes[e]=s}addAttribute(t,e){m.addAttribute(this._object,t,e)}addNumericAttrib(t,e){this.addAttribute(t,e)}setAttribValue(t,e){this.addAttribute(t,e)}addNumericVertexAttrib(t,e,n){var s;null==n&&(n=_.b.default_value(e)),null===(s=this.coreGeometry())||void 0===s||s.addNumericAttrib(t,e,n)}attributeNames(){return Object.keys(this._object.userData.attributes)}attribNames(){return this.attributeNames()}hasAttrib(t){return this.attributeNames().includes(t)}renameAttrib(t,e){const n=this.attribValue(t);null!=n?(this.addAttribute(e,n),this.deleteAttribute(t)):console.warn(`attribute ${t} not found`)}deleteAttribute(t){delete this._object.userData.attributes[t]}static attribValue(t,e,n=0,s){if("ptnum"===e)return n;if(t.userData&&t.userData.attributes){const n=t.userData.attributes[e];if(null==n){if("name"==e)return t.name}else if(d.a.isArray(n)&&s)return s.fromArray(n),s;return n}return"name"==e?t.name:void 0}static stringAttribValue(t,e,n=0){const s=this.attribValue(t,e,n);if(null!=s)return d.a.isString(s)?s:""+s}attribValue(t,e){return m.attribValue(this._object,t,this._index,e)}stringAttribValue(t){return m.stringAttribValue(this._object,t,this._index)}name(){return this.attribValue("name")}humanType(){return u.j.CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME[this._object.constructor.name]}attribTypes(){const t={};for(let e of this.attribNames()){const n=this.attribType(e);null!=n&&(t[e]=n)}return t}attribType(t){const e=this.attribValue(t);return d.a.isString(e)?u.h.STRING:u.h.NUMERIC}attribSizes(){const t={};for(let e of this.attribNames()){const n=this.attribSize(e);null!=n&&(t[e]=n)}return t}attribSize(t){const e=this.attribValue(t);return null==e?null:_.b.attribSizeFromValue(e)}clone(){return m.clone(this._object)}static clone(t){const e=t.clone();var n=new Map,s=new Map;return m.parallelTraverse(t,e,(function(t,e){n.set(e,t),s.set(t,e)})),e.traverse((function(e){const r=n.get(e),i=e;if(i.geometry){const t=r.geometry;i.geometry=a.a.clone(t);const e=i.geometry;e.userData&&(e.userData=p.a.cloneDeep(t.userData))}if(i.material){i.material=r.material,c.a.apply_custom_materials(e,i.material);const t=i.material;null==t.color&&(t.color=new o.a(1,1,1))}t.userData&&(e.userData=p.a.cloneDeep(r.userData));const _=r;_.animations&&(e.animations=_.animations.map(t=>t.clone()));const u=e;if(u.isSkinnedMesh){var l=u,h=r,d=h.skeleton.bones;l.skeleton=h.skeleton.clone(),l.bindMatrix.copy(h.bindMatrix);const t=d.map((function(t){return s.get(t)}));l.skeleton.bones=t,l.bind(l.skeleton,l.bindMatrix)}})),e}static parallelTraverse(t,e,n){n(t,e);for(var s=0;s<t.children.length;s++)this.parallelTraverse(t.children[s],e.children[s],n)}}},79:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var s,r=n(5),i=n(101),o=n(316),a=n(43),_=n(18);class u{constructor(t=0,e=0){this._position=t,this._value=e}toJSON(){return{position:this._position,value:this._value}}get position(){return this._position}get value(){return this._value}copy(t){this._position=t.position,this._value=t.value}clone(){const t=new u;return t.copy(this),t}is_equal(t){return this._position==t.position&&this._value==t.value}is_equal_json(t){return this._position==t.position&&this._value==t.value}from_json(t){this._position=t.position,this._value=t.value}static are_equal_json(t,e){return t.position==e.position&&t.value==e.value}static from_json(t){return new u(t.position,t.value)}}!function(t){t.LINEAR="linear"}(s||(s={}));class c{constructor(t=s.LINEAR,e=[]){this._interpolation=t,this._points=e,this._uuid=_.a.generateUUID()}get uuid(){return this._uuid}get interpolation(){return this._interpolation}get points(){return this._points}static from_json(t){const e=[];for(let n of t.points)e.push(u.from_json(n));return new c(t.interpolation,e)}toJSON(){return{interpolation:this._interpolation,points:this._points.map(t=>t.toJSON())}}clone(){const t=new c;return t.copy(this),t}copy(t){this._interpolation=t.interpolation;let e=0;for(let n of t.points){const t=this._points[e];t?t.copy(n):this._points.push(n.clone()),e+=1}}is_equal(t){if(this._interpolation!=t.interpolation)return!1;const e=t.points;if(this._points.length!=e.length)return!1;let n=0;for(let t of this._points){const s=e[n];if(!t.is_equal(s))return!1;n+=1}return!0}is_equal_json(t){if(this._interpolation!=t.interpolation)return!1;if(this._points.length!=t.points.length)return!1;let e=0;for(let n of this._points){const s=t.points[e];if(!n.is_equal_json(s))return!1;e+=1}return!0}static are_json_equal(t,e){if(t.interpolation!=e.interpolation)return!1;if(t.points.length!=e.points.length)return!1;let n=0;for(let s of t.points){const t=e.points[n];if(!u.are_equal_json(s,t))return!1;n+=1}return!0}from_json(t){this._interpolation=t.interpolation;let e=0;for(let n of t.points){const t=this._points[e];t?t.from_json(n):this._points.push(u.from_json(n)),e+=1}}}var l=n(12),h=n(36),d=n(25);class p extends a.a{constructor(){super(...arguments),this._texture_data=new Uint8Array(3072),this._ramp_texture=new i.a(this._texture_data,1024,1,r.Zb)}static type(){return l.a.RAMP}defaultValueSerialized(){return this._default_value instanceof c?this._default_value.toJSON():this._default_value}_clone_raw_input(t){return t instanceof c?t.clone():c.from_json(t).toJSON()}rawInputSerialized(){return this._raw_input instanceof c?this._raw_input.toJSON():c.from_json(this._raw_input).toJSON()}valueSerialized(){return this.value.toJSON()}_copy_value(t){this.set(t.valueSerialized())}static are_raw_input_equal(t,e){return t instanceof c?e instanceof c?t.is_equal(e):t.is_equal_json(e):e instanceof c?e.is_equal_json(t):c.are_json_equal(t,e)}static are_values_equal(t,e){return t.is_equal(e)}isDefault(){return this._default_value instanceof c?this.value.is_equal(this._default_value):this.value.is_equal_json(this._default_value)}processRawInput(){this._raw_input instanceof c?this._value?this._value.copy(this._raw_input):this._value=this._raw_input:this._value?this._value.from_json(this._raw_input):this._value=c.from_json(this._raw_input),this._reset_ramp_interpolant(),this._update_ramp_texture(),this.options.execute_callback(),this.emitController.emit(h.a.VALUE_UPDATED),this.setSuccessorsDirty(this)}hasExpression(){return!1}_reset_ramp_interpolant(){this._ramp_interpolant=void 0}ramp_texture(){return this._ramp_texture}_update_ramp_texture(){this._update_ramp_texture_data(),this.ramp_texture().needsUpdate=!0}_update_ramp_texture_data(){let t=0,e=0,n=0;for(var s=0;s<1024;s++)t=3*s,e=s/1024,n=this.value_at_position(e),this._texture_data[t]=255*n}static create_interpolant(t,e){const n=new Float32Array(1);return new o.a(t,e,1,n)}interpolant(){return this._ramp_interpolant=this._ramp_interpolant||this._create_interpolant()}_create_interpolant(){const t=this.value.points,e=d.a.sortBy(t,t=>t.position),n=new Float32Array(e.length),s=new Float32Array(e.length);let r=0;for(let t of e)n[r]=t.position,s[r]=t.value,r++;return p.create_interpolant(n,s)}value_at_position(t){return this.interpolant().evaluate(t)[0]}}p.DEFAULT_VALUE=new c(s.LINEAR,[new u(0,0),new u(1,1)]),p.DEFAULT_VALUE_JSON=p.DEFAULT_VALUE.toJSON()},8:function(t,e,n){"use strict";var s,r,i,o,a,_;n.d(e,"g",(function(){return s})),n.d(e,"f",(function(){return r})),n.d(e,"e",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return a})),n.d(e,"b",(function(){return _})),n.d(e,"a",(function(){return u})),function(t){t.ANIM="anim",t.COP="cop",t.EVENT="event",t.GL="gl",t.JS="js",t.MANAGER="manager",t.MAT="mat",t.OBJ="obj",t.POST="post",t.ROP="rop",t.SOP="sop"}(s||(s={})),function(t){t.ANIM="animations",t.COP="cop",t.EVENT="events",t.MAT="materials",t.POST="postProcess",t.ROP="renderers"}(r||(r={})),function(t){t.INPUT="subnetInput",t.OUTPUT="subnetOutput"}(i||(i={})),function(t){t.PERSPECTIVE="perspectiveCamera",t.ORTHOGRAPHIC="orthographicCamera"}(o||(o={})),function(t){t.ATTRIBUTE="attribute"}(a||(a={})),function(t){t.DEVICE_ORIENTATION="cameraDeviceOrientationControls",t.MAP="cameraMapControls",t.ORBIT="cameraOrbitControls",t.FIRST_PERSON="firstPersonControls"}(_||(_={}));const u=[_.DEVICE_ORIENTATION,_.MAP,_.ORBIT,_.FIRST_PERSON]},81:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var s=n(21);class r{constructor(){this._index=-1,this._path_elements=[],this._named_nodes=[],this._graph_node_ids=[],this._node_element_by_graph_node_id=new Map}reset(){this._index=-1,this._path_elements=[],this._named_nodes=[],this._graph_node_ids=[],this._node_element_by_graph_node_id.clear()}add_node(t,e){this._index+=1,t==e.name()&&(this._named_nodes[this._index]=e),this._graph_node_ids[this._index]=e.graphNodeId(),this._node_element_by_graph_node_id.set(e.graphNodeId(),t)}add_path_element(t){this._index+=1,this._path_elements[this._index]=t}named_graph_nodes(){return this._named_nodes}named_nodes(){const t=[];for(let e of this._named_nodes)if(e){const n=e;n.nameController&&t.push(n)}return t}update_from_name_change(t){this._named_nodes.map(t=>null==t?void 0:t.graphNodeId()).includes(t.graphNodeId())&&this._node_element_by_graph_node_id.set(t.graphNodeId(),t.name())}to_path(){const t=new Array(this._index);for(let e=0;e<=this._index;e++){const n=this._named_nodes[e];if(n){const s=this._node_element_by_graph_node_id.get(n.graphNodeId());s&&(t[e]=s)}else{const n=this._path_elements[e];n&&(t[e]=n)}}let e=t.join(s.a.SEPARATOR);const n=e[0];return n&&(s.a.NON_LETTER_PREFIXES.includes(n)||(e=`${s.a.SEPARATOR}${e}`)),e}}},89:function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},97:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s,r=n(49);!function(t){t.customDistanceMaterial="customDistanceMaterial",t.customDepthMaterial="customDepthMaterial",t.customDepthDOFMaterial="customDepthDOFMaterial"}(s||(s={}));const i=(t,e,n,s,r,i)=>{};class o{static node(t,e){return t.node(e.name)}static clone(t){const e=t.clone(),n=t.uniforms;return n&&(e.uniforms=r.a.clone(n)),e}static add_user_data_render_hook(t,e){t.userData.POLY_render_hook=e}static apply_render_hook(t,e){if(e.userData){const n=e.userData.POLY_render_hook;if(n)return void(t.onBeforeRender=(e,s,r,i,o,a)=>{n(e,s,r,i,o,a,t)})}t.onBeforeRender=i}static apply_custom_materials(t,e){const n=e;if(n.custom_materials)for(let e of Object.keys(n.custom_materials)){const s=e,r=n.custom_materials[s];r&&(t[s]=r,r.needsUpdate=!0)}}static assign_custom_uniforms(t,e,n){const s=t;if(s.custom_materials)for(let t of Object.keys(s.custom_materials)){const r=t,i=s.custom_materials[r];i&&(i.uniforms[e].value=n)}}static init_custom_material_uniforms(t,e,n){const s=t;if(s.custom_materials)for(let t of Object.keys(s.custom_materials)){const r=t,i=s.custom_materials[r];i&&(i.uniforms[e]=i.uniforms[e]||n)}}}},98:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var s=n(43),r=n(176),i=n(36),o=n(7);class a extends s.a{isNumeric(){return!0}isDefault(){return this._raw_input==this._default_value}_prefilter_invalid_raw_input(t){return o.a.isArray(t)?t[0]:t}processRawInput(){this.states.error.clear();const t=this.convert(this._raw_input);null!=t?(this._expression_controller&&(this._expression_controller.set_expression(void 0,!1),this.emitController.emit(i.a.EXPRESSION_UPDATED)),t!=this._value&&(this._update_value(t),this.setSuccessorsDirty(this))):o.a.isString(this._raw_input)?(this._expression_controller=this._expression_controller||new r.a(this),this._raw_input!=this._expression_controller.expression()&&(this._expression_controller.set_expression(this._raw_input),this.emitController.emit(i.a.EXPRESSION_UPDATED))):this.states.error.set(`param input is invalid (${this.fullPath()})`)}async process_computation(){var t;if((null===(t=this.expressionController)||void 0===t?void 0:t.active())&&!this.expressionController.requires_entities()){const t=await this.expressionController.compute_expression();if(this.expressionController.is_errored())this.states.error.set(`expression error: "${this.expressionController.expression()}" (${this.expressionController.error_message()})`);else{const e=this.convert(t);null!=e?(this.states.error.active()&&this.states.error.clear(),this._update_value(e)):this.states.error.set(`expression returns an invalid type (${t}) (${this.expressionController.expression()})`)}}}_update_value(t){this._value=t,this.parent_param&&this.parent_param.set_value_from_components(),this.options.execute_callback(),this.emitController.emit(i.a.VALUE_UPDATED),this.removeDirtyState()}}},99:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var s;n(18);!function(t){t.NONE="no conversion",t.GAMMA_TO_LINEAR="gamma -> linear",t.LINEAR_TO_GAMMA="linear -> gamma",t.SRGB_TO_LINEAR="sRGB -> linear",t.LINEAR_TO_SRGB="linear -> sRGB"}(s||(s={}));s.NONE,s.GAMMA_TO_LINEAR,s.LINEAR_TO_GAMMA,s.SRGB_TO_LINEAR,s.LINEAR_TO_SRGB}}]);
//# sourceMappingURL=vendors~PolyRegister~SceneJsonImporter.bundle.fda87c5a7877e101b399.js.map