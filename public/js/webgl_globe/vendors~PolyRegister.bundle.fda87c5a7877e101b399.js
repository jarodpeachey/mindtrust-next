(window.webpackJsonp=window.webpackJsonp||[]).push([["vendors~PolyRegister"],[,,,,,,,,,,function(t,e,s){"use strict";function r(t){return t}s.d(e,"a",(function(){return r}))},,,,,,,function(t,e,s){"use strict";s.d(e,"a",(function(){return c}));var r=s(104),i=s(105),n=s(8),o=s(15),a=s(128);class c extends i.a{static context(){return n.g.SOP}cook(t,e){}create_core_group_from_objects(t){const e=new r.a;return e.setObjects(t),e}create_core_group_from_geometry(t,e=o.l.MESH){const s=c.create_object(t,e);return this.create_core_group_from_objects([s])}create_object(t,e,s){return c.create_object(t,e,s)}static create_object(t,e,s){this.create_index_if_none(t);const r=new(0,o.k[e])(t,s=s||o.j.MATERIALS[e].clone());return r.castShadow=!0,r.receiveShadow=!0,r.frustumCulled=!1,r.matrixAutoUpdate=!1,r}create_index_if_none(t){c.create_index_if_none(t)}static create_index_if_none(t){a.a.create_index_if_none(t)}}},,,,,,,,,,,,,function(t,e,s){"use strict";s.d(e,"a",(function(){return h}));var r,i=s(38),n=s(104),o=s(15),a=s(8),c=s(39),_=s(17);!function(t){t.FROM_SET_CORE_GROUP="from set_core_group",t.FROM_SET_GROUP="from set_group",t.FROM_SET_OBJECTS="from set_objects",t.FROM_SET_OBJECT="from set_object",t.FROM_SET_GEOMETRIES="from set_geometries",t.FROM_SET_GEOMETRY="from set_geometry"}(r||(r={}));const l=["input geometry","input geometry","input geometry","input geometry"];class h extends i.a{constructor(){super(...arguments),this.flags=new c.d(this)}static nodeContext(){return a.g.SOP}static displayedInputNames(){return l}initializeBaseNode(){this.flags.display.set(!1),this.flags.display.onUpdate(()=>{if(this.flags.display.active()){const t=this.parent();t&&t.displayNodeController&&t.displayNodeController.setDisplayNode(this)}}),this.io.outputs.set_has_one_output()}setCoreGroup(t){this.setContainer(t,r.FROM_SET_CORE_GROUP)}setObject(t){this.set_container_objects([t],r.FROM_SET_OBJECT)}setObjects(t){this.set_container_objects(t,r.FROM_SET_OBJECTS)}setGeometry(t,e=o.l.MESH){const s=this.create_object(t,e);this.set_container_objects([s],r.FROM_SET_GEOMETRY)}setGeometries(t,e=o.l.MESH){const s=[];let i;for(let r of t)i=this.create_object(r,e),s.push(i);this.set_container_objects(s,r.FROM_SET_GEOMETRIES)}set_container_objects(t,e){const s=this.containerController.container.coreContent()||new n.a;s.setObjects(t),s.touch(),this.setContainer(s)}static create_object(t,e,s){return _.a.create_object(t,e,s)}create_object(t,e,s){return h.create_object(t,e,s)}static create_index_if_none(t){_.a.create_index_if_none(t)}_create_index_if_none(t){h.create_index_if_none(t)}_add_index(t){const e=t.getAttribute("position").array.length/3,s=new Array(e);for(let t=0;t<e;t++)s[t]=t;t.setIndex(s)}}},,function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var r=s(38),i=(s(14),s(8));class n extends r.a{constructor(){super(...arguments),this._cook_main_without_inputs_when_dirty_bound=this._cook_main_without_inputs_when_dirty.bind(this)}static nodeContext(){return i.g.MAT}initializeBaseNode(){super.initializeBaseNode(),this.nameController.add_post_set_fullPath_hook(this.set_material_name.bind(this)),this.addPostDirtyHook("_cook_main_without_inputs_when_dirty",()=>{setTimeout(this._cook_main_without_inputs_when_dirty_bound,0)})}async _cook_main_without_inputs_when_dirty(){await this.cookController.cook_main_without_inputs()}set_material_name(){this._material&&(this._material.name=this.fullPath())}get material(){return this._material=this._material||this.createMaterial()}set_material(t){this.setContainer(t)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return c})),s.d(e,"b",(function(){return _}));var r=s(24),i=s(38),n=s(8),o=s(34);const a=["parent object","parent object","parent object","parent object"];var c;!function(t){t[t.MANAGER=0]="MANAGER",t[t.CAMERA=2]="CAMERA",t[t.LIGHT=3]="LIGHT"}(c||(c={}));class _ extends i.a{constructor(){super(...arguments),this.renderOrder=c.MANAGER,this._children_group=this._create_children_group(),this._attachableToHierarchy=!0,this._used_in_scene=!0}static nodeContext(){return n.g.OBJ}static displayedInputNames(){return a}_create_children_group(){const t=new o.a;return t.matrixAutoUpdate=!1,t}attachableToHierarchy(){return this._attachableToHierarchy}usedInScene(){return this._used_in_scene}addObjectToParent(t){this.attachableToHierarchy()&&t.add(this.object)}removeObjectFromParent(){if(this.attachableToHierarchy()){const t=this.object.parent;t&&t.remove(this.object)}}initializeBaseNode(){this._object=this._create_object_with_attributes(),this.nameController.add_post_set_fullPath_hook(this.set_object_name.bind(this)),this.set_object_name()}get children_group(){return this._children_group}get object(){return this._object}_create_object_with_attributes(){const t=this.create_object();return t.node=this,t.add(this._children_group),t}set_object_name(){this._object&&(this._object.name=this.fullPath(),this._children_group.name=this.fullPath()+":parented_outputs")}create_object(){const t=new r.a;return t.matrixAutoUpdate=!1,t}isDisplayNodeCooking(){if(this.displayNodeController){const t=this.displayNodeController.displayNode();if(t)return t.cookController.isCooking()}return!1}isDisplayed(){var t,e;return(null===(e=null===(t=this.flags)||void 0===t?void 0:t.display)||void 0===e?void 0:e.active())||!1}}},,,,function(t,e,s){"use strict";s.d(e,"e",(function(){return r})),s.d(e,"d",(function(){return _})),s.d(e,"c",(function(){return l})),s.d(e,"b",(function(){return h})),s.d(e,"a",(function(){return u}));var r,i=s(3),n=s(29),o=s(23),a=s(66),c=s(18);!function(t){t.OBJECTS="objects",t.GEOMETRIES="geometries"}(r||(r={}));const _=[r.GEOMETRIES,r.OBJECTS];var l;!function(t){t.XYZ="XYZ",t.XZY="XZY",t.YXZ="YXZ",t.YZX="YZX",t.ZYX="ZYX",t.ZXY="ZXY"}(l||(l={}));const h=[l.XYZ,l.XZY,l.YXZ,l.YZX,l.ZXY,l.ZYX];l.XYZ;class u{constructor(){this._translation_matrix=new o.a,this._translation_matrix_q=new n.a,this._translation_matrix_s=new i.a(1,1,1),this._matrix=(new o.a).identity(),this._matrix_q=new n.a,this._matrix_euler=new a.a,this._matrix_s=new i.a,this._rotate_geometry_m=new o.a,this._rotate_geometry_q=new n.a,this._rotate_geometry_vec_dest=new i.a}static set_params_from_matrix(t,e,s={}){let r=s.scale;null==r&&(r=!0),t.decompose(this.set_params_from_matrix_position,this.set_params_from_matrix_quaternion,this.set_params_from_matrix_scale),this.set_params_from_matrix_euler.setFromQuaternion(this.set_params_from_matrix_quaternion),this.set_params_from_matrix_euler.toVector3(this.set_params_from_matrix_rotation),this.set_params_from_matrix_rotation.divideScalar(Math.PI/180),this.set_params_from_matrix_position.toArray(this.set_params_from_matrix_t),this.set_params_from_matrix_rotation.toArray(this.set_params_from_matrix_r),this.set_params_from_matrix_scale.toArray(this.set_params_from_matrix_s),e.scene().batchUpdates(()=>{e.params.set_vector3("t",this.set_params_from_matrix_t),e.params.set_vector3("r",this.set_params_from_matrix_r),e.params.set_vector3("s",this.set_params_from_matrix_s),r&&e.params.set_float("scale",1)})}static set_params_from_object(t,e){t.position.toArray(this.set_params_from_object_position_array),t.rotation.toArray(this.set_params_from_object_rotation_array),this.set_params_from_object_rotation_deg.fromArray(this.set_params_from_object_rotation_array),this.set_params_from_object_rotation_deg.multiplyScalar(180/Math.PI),this.set_params_from_object_rotation_deg.toArray(this.set_params_from_object_rotation_array),e.scene().batchUpdates(()=>{e.params.set_vector3("t",this.set_params_from_object_position_array),e.params.set_vector3("r",this.set_params_from_object_rotation_array)})}translation_matrix(t){return this._translation_matrix.compose(t,this._translation_matrix_q,this._translation_matrix_s),this._translation_matrix}matrix(t,e,s,r,i){return this._matrix_euler.set(c.a.degToRad(e.x),c.a.degToRad(e.y),c.a.degToRad(e.z),i),this._matrix_q.setFromEuler(this._matrix_euler),this._matrix_s.copy(s).multiplyScalar(r),this._matrix.compose(t,this._matrix_q,this._matrix_s),this._matrix}rotate_geometry(t,e,s){this._rotate_geometry_vec_dest.copy(s),this._rotate_geometry_vec_dest.normalize(),this._rotate_geometry_q.setFromUnitVectors(e,this._rotate_geometry_vec_dest),this._rotate_geometry_m.makeRotationFromQuaternion(this._rotate_geometry_q),t.applyMatrix4(this._rotate_geometry_m)}static decompose_matrix(t){t.matrix.decompose(t.position,t.quaternion,t.scale)}}u.set_params_from_matrix_position=new i.a,u.set_params_from_matrix_quaternion=new n.a,u.set_params_from_matrix_scale=new i.a,u.set_params_from_matrix_euler=new a.a,u.set_params_from_matrix_rotation=new i.a,u.set_params_from_matrix_t=[0,0,0],u.set_params_from_matrix_r=[0,0,0],u.set_params_from_matrix_s=[0,0,0],u.set_params_from_object_position_array=[0,0,0],u.set_params_from_object_rotation_deg=new i.a,u.set_params_from_object_rotation_array=[0,0,0]},,,,,,,,,,,,,function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));class r{constructor(t){this.node=t}add_params(){}update(){}get material(){return this.node.material}}},function(t,e,s){"use strict";s.d(e,"b",(function(){return c})),s.d(e,"a",(function(){return l}));var r=s(33),i=s(23),n=s(37),o=s(4),a=s(10);function c(t,e){const s=(null==e?void 0:e.matrixAutoUpdate)||!1;return class extends t{constructor(){super(...arguments),this.transform=o.b.FOLDER(),this.keepPosWhenParenting=o.b.BOOLEAN(0),this.rotationOrder=o.b.INTEGER(n.b.indexOf(n.c.XYZ),{menu:{entries:n.b.map((t,e)=>({name:t,value:e}))}}),this.t=o.b.VECTOR3([0,0,0]),this.r=o.b.VECTOR3([0,0,0]),this.s=o.b.VECTOR3([1,1,1]),this.scale=o.b.FLOAT(1),this.matrixAutoUpdate=o.b.BOOLEAN(s?1:0),this.updateTransformFromObject=o.b.BUTTON(null,{callback:t=>{l.PARAM_CALLBACK_update_transform_from_object(t)}})}}}c(o.a);r.b;const _="_cook_main_without_inputs_when_dirty";class l{constructor(t){this.node=t,this._cook_main_without_inputs_when_dirty_bound=this._cook_main_without_inputs_when_dirty.bind(this),this._core_transform=new n.a,this._keep_pos_when_parenting_m_object=new i.a,this._keep_pos_when_parenting_m_new_parent_inv=new i.a}initializeNode(){this.node.dirtyController.has_hook(_)||this.node.dirtyController.addPostDirtyHook(_,this._cook_main_without_inputs_when_dirty_bound)}async _cook_main_without_inputs_when_dirty(){await this.node.cookController.cook_main_without_inputs()}update(){this.update_transform_with_matrix();this.node.object.matrixAutoUpdate=Object(a.a)(this.node.pv.matrixAutoUpdate)}update_transform_with_matrix(t){const e=this.node.object;null==t||t.equals(e.matrix)?this._update_matrix_from_params_with_core_transform():(e.matrix.copy(t),e.dispatchEvent({type:"change"}))}_update_matrix_from_params_with_core_transform(){const t=this.node.object;let e=t.matrixAutoUpdate;e&&(t.matrixAutoUpdate=!1);const s=this._core_transform.matrix(this.node.pv.t,this.node.pv.r,this.node.pv.s,this.node.pv.scale,n.b[this.node.pv.rotationOrder]);t.matrix.identity(),t.applyMatrix4(s),this._apply_look_at(),t.updateMatrix(),e&&(t.matrixAutoUpdate=!0),t.dispatchEvent({type:"change"})}_apply_look_at(){}set_params_from_matrix(t,e={}){n.a.set_params_from_matrix(t,this.node,e)}static update_node_transform_params_if_required(t,e){t.transformController.update_node_transform_params_if_required(e)}update_node_transform_params_if_required(t){if(!Object(a.a)(this.node.pv.keepPosWhenParenting))return;if(!this.node.scene().loadingController.loaded())return;if(t==this.node.object.parent)return;const e=this.node.object;e.updateMatrixWorld(!0),t.updateMatrixWorld(!0),this._keep_pos_when_parenting_m_object.copy(e.matrixWorld),this._keep_pos_when_parenting_m_new_parent_inv.copy(t.matrixWorld),this._keep_pos_when_parenting_m_new_parent_inv.invert(),this._keep_pos_when_parenting_m_object.premultiply(this._keep_pos_when_parenting_m_new_parent_inv),n.a.set_params_from_matrix(this._keep_pos_when_parenting_m_object,this.node,{scale:!0})}update_node_transform_params_from_object(t=!1){const e=this.node.object;t&&e.updateMatrix(),n.a.set_params_from_matrix(e.matrix,this.node,{scale:!0})}static PARAM_CALLBACK_update_transform_from_object(t){t.transformController.update_node_transform_params_from_object()}}},,,,,,,,,,,,,function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var r=s(4),i=s(33),n=s(51);r.a;i.b;class o{constructor(t){this.node=t}initializeNode(){this.node.io.inputs.setCount(0,1),this.node.io.inputs.set_depends_on_inputs(!1),this.node.io.outputs.set_has_one_output(),this.node.io.inputs.add_on_set_input_hook("on_input_updated:update_parent",()=>{this.on_input_updated()})}static on_input_updated(t){const e=t.root().getParentForNode(t);t.transformController&&e&&n.a.update_node_transform_params_if_required(t,e),null!=t.io.inputs.input(0)?t.root().addToParentTransform(t):t.root().removeFromParentTransform(t)}on_input_updated(){o.on_input_updated(this.node)}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,s){"use strict";s.d(e,"a",(function(){return d}));var r=s(3),i=s(34),n=s(65),o=s(76),a=s(42),c=s(31),_=s(22),l=s(15),h=s(7),u=s(25);class d{constructor(){this._objects=[],this._objects_with_geo=[],this.touch()}timestamp(){return this._timestamp}touch(){this._timestamp=performance.now(),this.reset()}reset(){this._bounding_box=void 0,this._core_geometries=void 0,this._core_objects=void 0}clone(){const t=new d;if(this._objects){const e=[];for(let t of this._objects)e.push(o.a.clone(t));t.setObjects(e)}return t}setObjects(t){this._objects=t,this._objects_with_geo=t.filter(t=>null!=t.geometry),this.touch()}objects(){return this._objects}objectsWithGeo(){return this._objects_with_geo}coreObjects(){return this._core_objects=this._core_objects||this._create_core_objects()}_create_core_objects(){return this._objects?this._objects.map((t,e)=>new o.a(t,e)):[]}objectsData(){return this._objects?this._objects.map(t=>this._objectData(t)):[]}_objectData(t){let e=0;return t.geometry&&(e=a.a.pointsCount(t.geometry)),{type:Object(l.p)(t.constructor),name:t.name,children_count:t.children.length,points_count:e}}geometries(){const t=[];for(let e of this.coreObjects()){const s=e.object().geometry;s&&t.push(s)}return t}coreGeometries(){return this._core_geometries=this._core_geometries||this._createCoreGeometries()}_createCoreGeometries(){const t=[];for(let e of this.geometries())t.push(new a.a(e));return t}static geometryFromObject(t){return t.isMesh||t.isLine||t.isPoints?t.geometry:null}faces(){const t=[];for(let e of this.objectsWithGeo())if(e.geometry){const s=new a.a(e.geometry).faces();for(let r of s)r.applyMatrix4(e.matrix),t.push(r)}return t}points(){return this.coreGeometries().map(t=>t.points()).flat()}pointsCount(){return u.a.sum(this.coreGeometries().map(t=>t.pointsCount()))}totalPointsCount(){if(this._objects){let t=0;for(let e of this._objects)e.traverse(e=>{const s=e.geometry;s&&(t+=a.a.pointsCount(s))});return t}return 0}pointsFromGroup(t){if(t){const e=_.a.indices(t),s=this.points();return u.a.compact(e.map(t=>s[t]))}return this.points()}static _fromObjects(t){const e=new d;return e.setObjects(t),e}objectsFromGroup(t){return this.coreObjectsFromGroup(t).map(t=>t.object())}coreObjectsFromGroup(t){if(""!==(t=t.trim())){const e=parseInt(t);return h.a.isNaN(e)?this.coreObjects().filter(e=>_.a.matchMask(t,e.name())):u.a.compact([this.coreObjects()[e]])}return this.coreObjects()}boundingBox(){return this._bounding_box=this._bounding_box||this._compute_bounding_box()}center(){const t=new r.a;return this.boundingBox().getCenter(t),t}size(){const t=new r.a;return this.boundingBox().getSize(t),t}_compute_bounding_box(){let t;if(this._objects)for(let e of this._objects){const s=e.geometry;s&&(s.computeBoundingBox(),t?t.expandByObject(e):s.boundingBox&&(t=s.boundingBox.clone()))}return t=t||new n.a(new r.a(-1,-1,-1),new r.a(1,1,1)),t}computeVertexNormals(){for(let t of this.coreObjects())t.computeVertexNormals()}hasAttrib(t){let e;return null!=(e=this.coreGeometries()[0])&&e.hasAttrib(t)}attribType(t){const e=this.coreGeometries()[0];return null!=e?e.attribType(t):null}objectAttribType(t){const e=this.coreObjects()[0];return null!=e?e.attribType(t):null}renameAttrib(t,e,s){switch(s){case l.j.ATTRIB_CLASS.VERTEX:if(this.hasAttrib(t)&&this._objects)for(let s of this._objects)s.traverse(s=>{const r=d.geometryFromObject(s);if(r){new a.a(r).renameAttrib(t,e)}});break;case l.j.ATTRIB_CLASS.OBJECT:if(this.hasAttrib(t)&&this._objects)for(let s of this._objects)s.traverse(s=>{new o.a(s,0).renameAttrib(t,e)})}}attribNames(){let t;return null!=(t=this.coreGeometries()[0])?t.attribNames():[]}objectAttribNames(){let t;return null!=(t=this.coreObjects()[0])?t.attribNames():[]}attribNamesMatchingMask(t){const e=_.a.attribNames(t),s=[];for(let t of this.attribNames())for(let r of e)_.a.matchMask(t,r)&&s.push(t);return u.a.uniq(s)}attribSizes(){let t;return null!=(t=this.coreGeometries()[0])?t.attribSizes():{}}objectAttribSizes(){let t;return null!=(t=this.coreObjects()[0])?t.attribSizes():{}}attribSize(t){let e;return null!=(e=this.coreGeometries()[0])?e.attribSize(t):0}addNumericVertexAttrib(t,e,s){null==s&&(s=c.b.default_value(e));for(let r of this.coreGeometries())r.addNumericAttrib(t,e,s)}static clone(t){const e=new i.a;return t.children.forEach(t=>{const s=o.a.clone(t);e.add(s)}),e}}},,,,,function(t,e,s){"use strict";s.d(e,"b",(function(){return _})),s.d(e,"a",(function(){return l}));var r=s(50),i=s(5),n=s(14),o=s(32),a=s(4),c=s(10);function _(t){return class extends t{constructor(){super(...arguments),this.doubleSided=a.b.BOOLEAN(0),this.front=a.b.BOOLEAN(1,{visibleIf:{doubleSided:!1}})}}}n.a;_(a.a);o.a;class l extends r.a{constructor(t){super(t),this.node=t}static update(t){const e=Object(c.a)(t.pv.front)?i.G:i.h,s=Object(c.a)(t.pv.doubleSided)?i.y:e,r=t.material;s!=r.side&&(r.side=s,r.needsUpdate=!0)}}},function(t,e,s){"use strict";s.d(e,"b",(function(){return o})),s.d(e,"a",(function(){return a}));var r=s(32),i=s(50),n=s(4);function o(t){return class extends t{constructor(){super(...arguments),this.depthWrite=n.b.BOOLEAN(1,{cook:!1,callback:(t,e)=>{a.update(t)}}),this.depthTest=n.b.BOOLEAN(1,{cook:!1,callback:(t,e)=>{a.update(t)}})}}}o(n.a);r.a;class a extends i.a{constructor(t){super(t),this.node=t}async update(){this.node.material.depthWrite=this.node.pv.depthWrite,this.node.material.depthTest=this.node.pv.depthTest}static async update(t){t.depth_controller.update()}}},function(t,e,s){"use strict";s.d(e,"b",(function(){return c})),s.d(e,"a",(function(){return _}));var r=s(50),i=s(14),n=s(4),o=s(32),a=s(10);function c(t){return class extends t{constructor(){super(...arguments),this.skinning=n.b.BOOLEAN(0)}}}i.a;c(n.a);o.a;class _ extends r.a{constructor(t){super(t),this.node=t}static update(t){const e=Object(a.a)(t.pv.skinning);e!=t.material.skinning&&(t.material.skinning=e,t.material.needsUpdate=!0)}}},function(t,e,s){"use strict";s.d(e,"b",(function(){return c})),s.d(e,"a",(function(){return _}));var r=s(14),i=s(32),n=s(159),o=s(4),a=s(21);function c(t){return class extends t{constructor(){super(...arguments),this.useMap=o.b.BOOLEAN(0,Object(n.b)(_)),this.map=o.b.OPERATOR_PATH(a.b.NODE.UV,Object(n.c)(_,"useMap"))}}}r.a;c(o.a);i.a;class _ extends n.a{constructor(t,e){super(t,e),this.node=t}initializeNode(){this.add_hooks(this.node.p.useMap,this.node.p.map)}async update(){this._update(this.node.material,"map",this.node.p.useMap,this.node.p.map)}static async update(t){t.texture_map_controller.update()}}},function(t,e,s){"use strict";s.d(e,"b",(function(){return c})),s.d(e,"a",(function(){return _}));var r=s(14),i=s(32),n=s(159),o=s(4),a=s(21);function c(t){return class extends t{constructor(){super(...arguments),this.useAlphaMap=o.b.BOOLEAN(0,Object(n.b)(_)),this.alphaMap=o.b.OPERATOR_PATH(a.b.NODE.UV,Object(n.c)(_,"useAlphaMap"))}}}r.a;c(o.a);i.a;class _ extends n.a{constructor(t,e){super(t,e),this.node=t}initializeNode(){this.add_hooks(this.node.p.useAlphaMap,this.node.p.alphaMap)}async update(){this._update(this.node.material,"alphaMap",this.node.p.useAlphaMap,this.node.p.alphaMap)}static async update(t){t.texture_alpha_map_controller.update()}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));var r=s(28);class i{constructor(t,e){this.node=t,this._initialized=!1,this._display_node=void 0,this._graph_node=new r.a(t.scene(),"DisplayNodeController"),this._graph_node.node=t,this._on_display_node_remove_callback=e.onDisplayNodeRemove,this._on_display_node_set_callback=e.onDisplayNodeSet,this._on_display_node_update_callback=e.onDisplayNodeUpdate}dispose(){this._graph_node.dispose()}displayNode(){return this._display_node}initializeNode(){this._initialized?console.error("display node controller already initialed",this.node):(this._initialized=!0,this.node.lifecycle.add_on_child_add_hook(t=>{var e,s;this._display_node||null===(s=null===(e=t.flags)||void 0===e?void 0:e.display)||void 0===s||s.set(!0)}),this.node.lifecycle.add_on_child_remove_hook(t=>{var e,s,r;if(t.graphNodeId()==(null===(e=this._display_node)||void 0===e?void 0:e.graphNodeId())){const t=this.node.children(),e=t[t.length-1];e?null===(r=null===(s=e.flags)||void 0===s?void 0:s.display)||void 0===r||r.set(!0):this.setDisplayNode(void 0)}}),this._graph_node.dirtyController.addPostDirtyHook("_request_display_node_container",()=>{this._on_display_node_update_callback&&this._on_display_node_update_callback()}))}async setDisplayNode(t){if(this._initialized||console.error("display node controller not initialized",this.node),this._display_node!=t){const e=this._display_node;e&&(e.flags.display.set(!1),this._graph_node.removeGraphInput(e),this._on_display_node_remove_callback&&this._on_display_node_remove_callback()),this._display_node=t,this._display_node&&(this._graph_node.addGraphInput(this._display_node),this._on_display_node_set_callback&&this._on_display_node_set_callback())}}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return b})),s.d(e,"c",(function(){return w})),s.d(e,"b",(function(){return N})),s.d(e,"d",(function(){return M}));var r,i,n,o,a=s(167),c=s(117),_=s(116),l=s(5),h=s(4),u=s(7),d=s(118),p=s(20);!function(t){t.lowp="lowp",t.mediump="mediump",t.highp="highp"}(r||(r={})),function(t){t.HIGH="high-performance",t.LOW="low-power",t.DEFAULT="default"}(i||(i={})),function(t){t.Linear="Linear",t.sRGB="sRGB",t.Gamma="Gamma",t.RGBE="RGBE",t.LogLuv="LogLuv",t.RGBM7="RGBM7",t.RGBM16="RGBM16",t.RGBD="RGBD"}(n||(n={})),function(t){t[t.Linear=l.Q]="Linear",t[t.sRGB=l.cd]="sRGB",t[t.Gamma=l.I]="Gamma",t[t.RGBE=l.Yb]="RGBE",t[t.LogLuv=l.X]="LogLuv",t[t.RGBM7=l.cc]="RGBM7",t[t.RGBM16=l.bc]="RGBM16",t[t.RGBD=l.Xb]="RGBD"}(o||(o={}));const m=[n.Linear,n.sRGB,n.Gamma,n.RGBE,n.LogLuv,n.RGBM7,n.RGBM16,n.RGBD],f=[o.Linear,o.sRGB,o.Gamma,o.RGBE,o.LogLuv,o.RGBM7,o.RGBM16,o.RGBD],b=o.sRGB;var g,v;!function(t){t.No="No",t.Linear="Linear",t.Reinhard="Reinhard",t.Cineon="Cineon",t.ACESFilmic="ACESFilmic"}(g||(g={})),function(t){t[t.No=l.ob]="No",t[t.Linear=l.W]="Linear",t[t.Reinhard=l.mc]="Reinhard",t[t.Cineon=l.l]="Cineon",t[t.ACESFilmic=l.a]="ACESFilmic"}(v||(v={}));const y=[g.No,g.Linear,g.Reinhard,g.Cineon,g.ACESFilmic],x=[v.No,v.Linear,v.Reinhard,v.Cineon,v.ACESFilmic],w=v.ACESFilmic,E=y.map((t,e)=>({name:t,value:x[e]}));var O,A;!function(t){t.Basic="Basic",t.PCF="PCF",t.PCFSoft="PCFSoft",t.VSM="VSM"}(O||(O={})),function(t){t[t.Basic=l.j]="Basic",t[t.PCF=l.xb]="PCF",t[t.PCFSoft=l.yb]="PCFSoft",t[t.VSM=l.Xc]="VSM"}(A||(A={}));const T=[O.Basic,O.PCF,O.PCFSoft,O.VSM],C=[A.Basic,A.PCF,A.PCFSoft,A.VSM],N=(l.j,l.xb,l.yb,l.Xc,A.PCFSoft),R={alpha:!0,precision:r.highp,premultipliedAlpha:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,powerPreference:i.DEFAULT,depth:!0,logarithmicDepthBuffer:!1};class j extends h.a{constructor(){super(...arguments),this.alpha=h.b.BOOLEAN(1),this.antialias=h.b.BOOLEAN(1),this.toneMapping=h.b.INTEGER(w,{menu:{entries:E}}),this.toneMappingExposure=h.b.FLOAT(1,{range:[0,2]}),this.outputEncoding=h.b.INTEGER(b,{menu:{entries:m.map((t,e)=>({name:t,value:f[e]}))}}),this.physicallyCorrectLights=h.b.BOOLEAN(1),this.sortObjects=h.b.BOOLEAN(1),this.tpixelRatio=h.b.BOOLEAN(0),this.pixelRatio=h.b.INTEGER(2,{visibleIf:{tpixelRatio:!0},range:[1,4],rangeLocked:[!0,!1]}),this.tshadowMap=h.b.BOOLEAN(1),this.shadowMapAutoUpdate=h.b.BOOLEAN(1,{visibleIf:{tshadowMap:1}}),this.shadowMapNeedsUpdate=h.b.BOOLEAN(0,{visibleIf:{tshadowMap:1}}),this.shadowMapType=h.b.INTEGER(N,{visibleIf:{tshadowMap:1},menu:{entries:T.map((t,e)=>({name:t,value:C[e]}))}})}}const S=new j;class M extends a.a{constructor(){super(...arguments),this.params_config=S,this._renderers_by_canvas_id={}}static type(){return c.a.WEBGL}create_renderer(t,e){const s={},r=Object.keys(R);let i;for(i of r)s[i]=R[i];s.antialias=this.pv.antialias,s.alpha=this.pv.alpha,s.canvas=t,s.context=e;const n=new _.a(s);return p.a.renderersController.printDebug()&&(p.a.renderersController.printDebugMessage(`create renderer from node '${this.fullPath()}'`),p.a.renderersController.printDebugMessage({params:s})),this._update_renderer(n),this._renderers_by_canvas_id[t.id]=n,n}cook(){const t=Object.keys(this._renderers_by_canvas_id);for(let e of t){const t=this._renderers_by_canvas_id[e];this._update_renderer(t)}this._traverse_scene_and_update_materials(),this.cookController.end_cook()}_update_renderer(t){t.physicallyCorrectLights=this.pv.physicallyCorrectLights,t.outputEncoding=this.pv.outputEncoding,t.toneMapping=this.pv.toneMapping,t.toneMappingExposure=this.pv.toneMappingExposure,t.shadowMap.enabled=this.pv.tshadowMap,t.shadowMap.autoUpdate=this.pv.shadowMapAutoUpdate,t.shadowMap.needsUpdate=this.pv.shadowMapNeedsUpdate,t.shadowMap.type=this.pv.shadowMapType,t.sortObjects=this.pv.sortObjects;const e=this.pv.tpixelRatio?this.pv.pixelRatio:d.b.defaultPixelRatio();p.a.renderersController.printDebug()&&(p.a.renderersController.printDebugMessage(`set renderer pixelRatio from '${this.fullPath()}'`),p.a.renderersController.printDebugMessage({pixelRatio:e})),t.setPixelRatio(e)}_traverse_scene_and_update_materials(){this.scene().threejsScene().traverse(t=>{const e=t.material;if(e)if(u.a.isArray(e))for(let t of e)t.needsUpdate=!0;else e.needsUpdate=!0})}}},,function(t,e,s){"use strict";s.d(e,"a",(function(){return T}));s(8);var r=s(4),i=s(38);r.a;i.a;s(178);s(114);var n,o,a,c=s(272),_=s(5),l=s(41),h=s(169),u=s(77),d=s(6),p=s(55),m={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},f=s(44),b=s(49);function g(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(g.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),g.FullScreenQuad=(n=new h.a(-1,1,1,-1,0,1),o=new u.b(2,2),a=function(t){this._mesh=new l.a(o,t)},Object.defineProperty(a.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(a.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,n)}}),a);var v=function(t,e){g.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof f.a?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=b.a.clone(t.uniforms),this.material=new f.a({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new g.FullScreenQuad(this.material)};v.prototype=Object.assign(Object.create(g.prototype),{constructor:v,render:function(t,e,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}});var y=function(t,e){g.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};y.prototype=Object.assign(Object.create(g.prototype),{constructor:y,render:function(t,e,s){var r,i,n=t.getContext(),o=t.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(r=0,i=1):(r=1,i=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),o.buffers.stencil.setFunc(n.ALWAYS,r,4294967295),o.buffers.stencil.setClear(i),o.buffers.stencil.setLocked(!0),t.setRenderTarget(s),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(n.EQUAL,1,4294967295),o.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),o.buffers.stencil.setLocked(!0)}});var x=function(){g.call(this),this.needsSwap=!1};x.prototype=Object.create(g.prototype),Object.assign(x.prototype,{render:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}});var w=function(t,e){if(this.renderer=t,void 0===e){var s={minFilter:_.R,magFilter:_.R,format:_.Ab},r=t.getSize(new d.a);this._pixelRatio=t.getPixelRatio(),this._width=r.width,this._height=r.height,(e=new p.a(this._width*this._pixelRatio,this._height*this._pixelRatio,s)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===m&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===v&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new v(m),this.clock=new c.a};Object.assign(w.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},removePass:function(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)},isLastEnabledPass:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0},render:function(t){void 0===t&&(t=this.clock.getDelta());var e,s,r=this.renderer.getRenderTarget(),i=!1,n=this.passes.length;for(s=0;s<n;s++)if(!1!==(e=this.passes[s]).enabled){if(e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),e.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),e.needsSwap){if(i){var o=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),a.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==y&&(e instanceof y?i=!0:e instanceof x&&(i=!1))}this.renderer.setRenderTarget(r)},reset:function(t){if(void 0===t){var e=this.renderer.getSize(new d.a);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this._width=t,this._height=e;var s=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(s,r),this.renderTarget2.setSize(s,r);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(s,r)},setPixelRatio:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}});var E=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(E.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),E.FullScreenQuad=function(){var t=new h.a(-1,1,1,-1,0,1),e=new u.b(2,2),s=function(t){this._mesh=new l.a(e,t)};return Object.defineProperty(s.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(s.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),s}();var O=s(9),A=function(t,e,s,r,i){g.call(this),this.scene=t,this.camera=e,this.overrideMaterial=s,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new O.a};A.prototype=Object.assign(Object.create(g.prototype),{constructor:A,render:function(t,e,s){var r,i,n=t.autoClear;t.autoClear=!1,void 0!==this.overrideMaterial&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:s),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=i),t.autoClear=n}});s(20),s(155),s(10);r.a;var T;s(115);!function(t){t.CSS2D="CSS2DRenderer",t.CSS3D="CSS3DRenderer",t.WEBGL="WebGLRenderer"}(T||(T={}))},function(t,e,s){"use strict";s.d(e,"a",(function(){return O})),s.d(e,"b",(function(){return A}));var r,i=s(116),n=s(6),o=s(8),a=s(33),c=s(84),_=s(270),l=s(271),h=s(64),u=s(4),d=s(10);!function(t){t.NONE="none",t.COLOR="color",t.TEXTURE="texture"}(r||(r={}));const p=[r.NONE,r.COLOR,r.TEXTURE];var m;!function(t){t.LINEAR="linear",t.EXPONENTIAL="exponential"}(m||(m={}));const f=[m.LINEAR,m.EXPONENTIAL];class b extends u.a{constructor(){super(...arguments),this.autoUpdate=u.b.BOOLEAN(1),this.backgroundMode=u.b.INTEGER(p.indexOf(r.NONE),{menu:{entries:p.map((t,e)=>({name:t,value:e}))}}),this.bgColor=u.b.COLOR([0,0,0],{visibleIf:{backgroundMode:p.indexOf(r.COLOR)}}),this.bgTexture=u.b.OPERATOR_PATH("",{visibleIf:{backgroundMode:p.indexOf(r.TEXTURE)},nodeSelection:{context:o.g.COP},dependentOnFoundNode:!1}),this.useEnvironment=u.b.BOOLEAN(0),this.environment=u.b.OPERATOR_PATH("",{visibleIf:{useEnvironment:1},nodeSelection:{context:o.g.COP},dependentOnFoundNode:!1}),this.useFog=u.b.BOOLEAN(0),this.fogType=u.b.INTEGER(f.indexOf(m.EXPONENTIAL),{visibleIf:{useFog:1},menu:{entries:f.map((t,e)=>({name:t,value:e}))}}),this.fogColor=u.b.COLOR([1,1,1],{visibleIf:{useFog:1}}),this.fogNear=u.b.FLOAT(1,{range:[0,100],rangeLocked:[!0,!1],visibleIf:{useFog:1,fogType:f.indexOf(m.LINEAR)}}),this.fogFar=u.b.FLOAT(100,{range:[0,100],rangeLocked:[!0,!1],visibleIf:{useFog:1,fogType:f.indexOf(m.LINEAR)}}),this.fogDensity=u.b.FLOAT(25e-5,{visibleIf:{useFog:1,fogType:f.indexOf(m.EXPONENTIAL)}}),this.useOverrideMaterial=u.b.BOOLEAN(0),this.overrideMaterial=u.b.OPERATOR_PATH("/MAT/mesh_standard1",{visibleIf:{useOverrideMaterial:1},nodeSelection:{context:o.g.MAT},dependentOnFoundNode:!1})}}const g=new b;class v extends a.b{constructor(){super(...arguments),this.params_config=g,this.hierarchyController=new h.a(this)}static type(){return"scene"}create_object(){const t=new c.a;return t.matrixAutoUpdate=!1,t}initializeNode(){this.hierarchyController.initializeNode()}cook(){Object(d.a)(this.pv.autoUpdate)!=this.object.autoUpdate&&(this.object.autoUpdate=Object(d.a)(this.pv.autoUpdate)),this._update_background(),this._update_fog(),this._update_enviromment(),this._update_material_override(),this.cookController.end_cook()}_update_background(){if(this.pv.backgroundMode==p.indexOf(r.NONE))this.object.background=null;else if(this.pv.backgroundMode==p.indexOf(r.COLOR))this.object.background=this.pv.bgColor;else{const t=this.p.bgTexture.found_node();t?t.nodeContext()==o.g.COP?t.requestContainer().then(t=>{this.object.background=t.texture()}):this.states.error.set("bgTexture node is not a texture"):this.states.error.set("bgTexture node not found")}}_update_fog(){if(Object(d.a)(this.pv.useFog))if(this.pv.fogType==f.indexOf(m.LINEAR)){const t=this.fog2();this.object.fog=t,t.color=this.pv.fogColor,t.near=this.pv.fogNear,t.far=this.pv.fogFar}else{const t=this.fogExp2();this.object.fog=this.fogExp2(),t.color=this.pv.fogColor,t.density=this.pv.fogDensity}else{this.object.fog&&(this.object.fog=null)}}fog2(){return this._fog=this._fog||new _.a(16777215,this.pv.fogNear,this.pv.fogFar)}fogExp2(){return this._fogExp2=this._fogExp2||new l.a(16777215,this.pv.fogDensity)}_update_enviromment(){if(Object(d.a)(this.pv.useEnvironment)){const t=this.p.environment.found_node();t?t.nodeContext()==o.g.COP?t.requestContainer().then(t=>{this.object.environment=t.texture()}):this.states.error.set("bgTexture node is not a texture"):this.states.error.set("bgTexture node not found")}else this.object.environment=null}_update_material_override(){if(Object(d.a)(this.pv.useOverrideMaterial)){const t=this.p.overrideMaterial.found_node();t?t.nodeContext()==o.g.MAT?t.requestContainer().then(t=>{this.object.overrideMaterial=t.material()}):this.states.error.set("bgTexture node is not a material"):this.states.error.set("bgTexture node not found")}else this.object.overrideMaterial=null}}var y=s(20),x=s(115),w=s(117),E=s(154);function O(t){return class extends t{constructor(){super(...arguments),this.render=u.b.FOLDER(),this.setScene=u.b.BOOLEAN(0),this.scene=u.b.OPERATOR_PATH("/scene1",{visibleIf:{setScene:1},nodeSelection:{context:o.g.OBJ,types:[v.type()]}}),this.setRenderer=u.b.BOOLEAN(0),this.renderer=u.b.OPERATOR_PATH("./renderers1/webGLRenderer1",{visibleIf:{setRenderer:1},nodeSelection:{context:o.g.ROP,types:[x.d.type()]}}),this.setCSSRenderer=u.b.BOOLEAN(0),this.CSSRenderer=u.b.OPERATOR_PATH("./renderers1/CSS2DRenderer1",{visibleIf:{setCSSRenderer:1},nodeSelection:{context:o.g.ROP,types:[w.a.CSS2D,w.a.CSS3D]}})}}}class A{constructor(t){this.node=t,this._renderers_by_canvas_id={},this._resolution_by_canvas_id={},this._super_sampling_size=new n.a}render(t,e,s){if(Object(d.a)(this.node.pv.doPostProcess)?this.node.postProcessController.render(t,e):this.render_with_renderer(t),this._resolved_cssRenderer_rop&&this._resolved_scene&&Object(d.a)(this.node.pv.setCSSRenderer)){const e=this.cssRenderer(t);e&&e.render(this._resolved_scene,this.node.object)}}render_with_renderer(t){const e=this.renderer(t);e&&this._resolved_scene&&e.render(this._resolved_scene,this.node.object)}async update(){this.update_scene(),this.update_renderer(),this.update_cssRenderer()}get resolved_scene(){return this._resolved_scene}update_scene(){if(Object(d.a)(this.node.pv.setScene)){const t=this.node.p.scene;t.isDirty()&&t.find_target();const e=t.found_node_with_context_and_type(o.g.OBJ,v.type());e&&(e.isDirty()&&e.cookController.cook_main_without_inputs(),this._resolved_scene=e.object)}else this._resolved_scene=this.node.scene().threejsScene()}update_renderer(){if(Object(d.a)(this.node.pv.setRenderer)){const t=this.node.p.renderer;t.isDirty()&&t.find_target(),this._resolved_renderer_rop=t.found_node_with_context_and_type(o.g.ROP,w.a.WEBGL)}else this._resolved_renderer_rop=void 0}update_cssRenderer(){if(Object(d.a)(this.node.pv.setCSSRenderer)){const t=this.node.p.CSSRenderer;t.isDirty()&&t.find_target(),this._resolved_cssRenderer_rop=t.found_node_with_context_and_type(o.g.ROP,[w.a.CSS2D,w.a.CSS3D])}else this._resolved_cssRenderer_rop,this._resolved_cssRenderer_rop=void 0}renderer(t){return this._renderers_by_canvas_id[t.id]}cssRenderer(t){if(this._resolved_cssRenderer_rop&&Object(d.a)(this.node.pv.setCSSRenderer))return this._resolved_cssRenderer_rop.renderer(t)}createRenderer(t,e){const s=y.a.renderersController.renderingContext(t);if(!s)return void console.error("failed to create webgl context");let r;return Object(d.a)(this.node.pv.setRenderer)&&(this.update_renderer(),this._resolved_renderer_rop&&(r=this._resolved_renderer_rop.create_renderer(t,s))),r||(r=A._createDefaultRenderer(t,s)),y.a.renderersController.registerRenderer(r),this._renderers_by_canvas_id[t.id]=r,this._super_sampling_size.copy(e),this.set_renderer_size(t,this._super_sampling_size),r}static defaultPixelRatio(){return E.a.isMobile()?1:Math.max(2,window.devicePixelRatio)}static _createDefaultRenderer(t,e){const s={canvas:t,antialias:!1,alpha:!0,context:e},r=new i.a(s),n=this.defaultPixelRatio();return r.setPixelRatio(n),r.shadowMap.enabled=!0,r.shadowMap.type=x.b,r.physicallyCorrectLights=!0,r.toneMapping=x.c,r.toneMappingExposure=1,r.outputEncoding=x.a,y.a.renderersController.printDebug()&&(y.a.renderersController.printDebugMessage("create default renderer"),y.a.renderersController.printDebugMessage({params:s,pixelRatio:n})),r}delete_renderer(t){const e=this.renderer(t);e&&y.a.renderersController.deregisterRenderer(e)}canvas_resolution(t){return this._resolution_by_canvas_id[t.id]}set_renderer_size(t,e){this._resolution_by_canvas_id[t.id]=this._resolution_by_canvas_id[t.id]||new n.a,this._resolution_by_canvas_id[t.id].copy(e);const s=this.renderer(t);if(s){const t=!1;s.setSize(e.x,e.y,t)}if(this._resolved_cssRenderer_rop){const s=this.cssRenderer(t);s&&s.setSize(e.x,e.y)}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,s){"use strict";s.d(e,"a",(function(){return p}));var r=s(3),i=s(6),n=s(29),o=s(23),a=s(258),c=s(259),_=s(42),l=s(7);const h={SCALE:new r.a(1,1,1),PSCALE:1,EYE:new r.a(0,0,0),UP:new r.a(0,1,0)},u=new r.a(1,1,1),d=new i.a(0,0);class p{constructor(t){this._group_wrapper=t,this._matrices={},this._point_scale=new r.a,this._point_normal=new r.a,this._point_up=new r.a,this._is_pscale_present=this._group_wrapper.hasAttrib("pscale"),this._is_scale_present=this._group_wrapper.hasAttrib("scale"),this._is_normal_present=this._group_wrapper.hasAttrib("normal"),this._is_up_present=this._group_wrapper.hasAttrib("up"),this._do_rotate_matrices=this._is_normal_present}matrices(){return this._matrices={},this._matrices.translate=new o.a,this._matrices.rotate=new o.a,this._matrices.scale=new o.a,this._group_wrapper.points().map(t=>{const e=new o.a;return this._matrix_from_point(t,e),e})}_matrix_from_point(t,e){const s=t.position();this._is_scale_present?t.attribValue("scale",this._point_scale):this._point_scale.copy(h.SCALE);const r=this._is_pscale_present?t.attribValue("pscale"):h.PSCALE;this._point_scale.multiplyScalar(r);const i=this._matrices.scale;i.makeScale(this._point_scale.x,this._point_scale.y,this._point_scale.z);const n=this._matrices.translate;if(n.makeTranslation(s.x,s.y,s.z),e.multiply(n),this._do_rotate_matrices){const s=this._matrices.rotate,r=h.EYE;t.attribValue("normal",this._point_normal),this._point_normal.multiplyScalar(-1),this._is_up_present?t.attribValue("up",this._point_up):this._point_up.copy(h.UP),this._point_up.normalize(),s.lookAt(r,this._point_normal,this._point_up),e.multiply(s)}e.multiply(i)}static create_instance_buffer_geo(t,e,s){const i=e.points(),o=new a.a;o.copy(t),o.instanceCount=1/0;const h=i.length,m=new Float32Array(3*h),f=new Float32Array(3*h),b=new Float32Array(3*h),g=new Float32Array(4*h),v=e.hasAttrib("color"),y=new r.a(0,0,0),x=new n.a,w=new r.a(1,1,1),E=new p(e).matrices();i.forEach((t,e)=>{const s=3*e,r=4*e;E[e].decompose(y,x,w),y.toArray(m,s),x.toArray(g,r),w.toArray(b,s);(v?t.attribValue("color",this._point_color):u).toArray(f,s)});const O=e.hasAttrib("uv");if(O){const t=new Float32Array(2*h);i.forEach((e,s)=>{const r=2*s;(O?e.attribValue("uv",this._point_uv):d).toArray(t,r)}),o.setAttribute("instanceUv",new c.a(t,2))}o.setAttribute("instancePosition",new c.a(m,3)),o.setAttribute("instanceScale",new c.a(b,3)),o.setAttribute("instanceOrientation",new c.a(g,4)),o.setAttribute("instanceColor",new c.a(f,3));e.attribNamesMatchingMask(s).forEach(t=>{const s=e.attribSize(t),r=new Float32Array(h*s);i.forEach((e,i)=>{const n=e.attribValue(t);l.a.isNumber(n)?r[i]=n:n.toArray(r,i*s)}),o.setAttribute(t,new c.a(r,s))});return new _.a(o).markAsInstance(),o}}p._point_color=new r.a,p._point_uv=new i.a},,function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));class r{static isChrome(){return-1!=navigator.userAgent.indexOf("Chrome")}static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return o})),s.d(e,"c",(function(){return a})),s.d(e,"b",(function(){return c})),s.d(e,"d",(function(){return _}));var r=s(5);const i=[{LinearFilter:r.R},{NearestFilter:r.hb}],n=[{NearestFilter:r.hb},{NearestMipMapNearestFilter:r.jb},{NearestMipMapLinearFilter:r.ib},{LinearFilter:r.R},{LinearMipMapNearestFilter:r.T},{LinearMipMapLinearFilter:r.S}],o=Object.values(i[0])[0],a=Object.values(n[5])[0],c=i.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]})),_=n.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))},,,function(t,e,s){"use strict";s.d(e,"a",(function(){return c})),s.d(e,"b",(function(){return _}));var r=s(50),i=s(32),n=s(14),o=s(4),a=s(10);function c(t){return class extends t{constructor(){super(...arguments),this.color=o.b.COLOR([1,1,1]),this.useVertexColors=o.b.BOOLEAN(0),this.transparent=o.b.BOOLEAN(0),this.opacity=o.b.FLOAT(1),this.alphaTest=o.b.FLOAT(0),this.useFog=o.b.BOOLEAN(0)}}}n.a;c(o.a);i.a;class _ extends r.a{constructor(t){super(t),this.node=t}static update(t){const e=t.material,s=t.pv;e.color.copy(s.color);const r=Object(a.a)(s.useVertexColors);r!=e.vertexColors&&(e.vertexColors=r,e.needsUpdate=!0),e.opacity=s.opacity,e.transparent=Object(a.a)(s.transparent)||s.opacity<1,e.depthTest=!0,e.alphaTest=s.alphaTest,e.fog=Object(a.a)(s.useFog)}}},function(t,e,s){"use strict";s.d(e,"b",(function(){return n})),s.d(e,"c",(function(){return o})),s.d(e,"a",(function(){return a}));var r=s(50),i=(s(4),s(8));s(21);function n(t){return{cook:!1,callback:(e,s)=>{t.update(e)}}}function o(t,e){return{visibleIf:{[e]:1},nodeSelection:{context:i.g.COP},cook:!1,callback:(e,s)=>{t.update(e)}}}class a extends r.a{constructor(t,e){super(t),this.node=t,this._update_options=e}add_hooks(t,e){t.addPostDirtyHook("TextureController",()=>{this.update()}),e.addPostDirtyHook("TextureController",()=>{this.update()})}static update(t){}async _update(t,e,s,r){if(this._update_options.uniforms){const i=t,n=e;await this._update_texture_on_uniforms(i,n,s,r)}if(this._update_options.direct_params){const i=t,n=e;await this._update_texture_on_material(i,n,s,r)}}async _update_texture_on_uniforms(t,e,s,r){this._update_required_attribute(t,t.uniforms,e,s,r,this._apply_texture_on_uniforms.bind(this),this._remove_texture_from_uniforms.bind(this))}_apply_texture_on_uniforms(t,e,s,r){const i=null!=e[s]&&null!=e[s].value;let n=!1;if(i){e[s].value.uuid!=r.uuid&&(n=!0)}i&&!n||(e[s].value=r,this._apply_texture_on_material(t,t,s,r),t.needsUpdate=!0)}_remove_texture_from_uniforms(t,e,s){e[s].value&&(e[s].value=null,this._remove_texture_from_material(t,t,s),t.needsUpdate=!0)}async _update_texture_on_material(t,e,s,r){this._update_required_attribute(t,t,e,s,r,this._apply_texture_on_material.bind(this),this._remove_texture_from_material.bind(this))}_apply_texture_on_material(t,e,s,r){const i=null!=e[s];let n=!1;if(i){e[s].uuid!=r.uuid&&(n=!0)}i&&!n||(e[s]=r,t.needsUpdate=!0)}_remove_texture_from_material(t,e,s){e[s]&&(e[s]=null,t.needsUpdate=!0)}async _update_required_attribute(t,e,s,r,n,o,a){r.isDirty()&&await r.compute();if(r.value){n.isDirty()&&await n.compute();const r=n.found_node();if(r)if(r.nodeContext()==i.g.COP){const i=r,n=(await i.requestContainer()).texture();if(n)return void o(t,e,s,n);this.node.states.error.set("found node has no texture")}else this.node.states.error.set("found map node is not a COP node");else this.node.states.error.set(`could not find map node ${n.name()} with path ${n.value}`)}a(t,e,s)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var r=s(33),i=s(34),n=s(4);class o extends r.b{constructor(){super(...arguments),this._attachableToHierarchy=!1}create_object(){const t=new i.a;return t.matrixAutoUpdate=!1,t}cook(){this.cookController.end_cook()}}n.a;class a extends o{}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));var r=s(34);class i{constructor(t){this.node=t,this._children_uuids_dict={},this._children_length=0,this._sop_group=this._create_sop_group()}_create_sop_group(){const t=new r.a;return t.matrixAutoUpdate=!1,t}sopGroup(){return this._sop_group}set_sop_group_name(){this._sop_group.name=this.node.name()+":sop_group"}displayNodeControllerCallbacks(){return{onDisplayNodeRemove:()=>{this.remove_children()},onDisplayNodeSet:()=>{setTimeout(()=>{this.request_display_node_container()},0)},onDisplayNodeUpdate:()=>{this.request_display_node_container()}}}initializeNode(){var t;this.node.object.add(this.sopGroup()),this.node.nameController.add_post_set_fullPath_hook(this.set_sop_group_name.bind(this)),this._create_sop_group();const e=null===(t=this.node.flags)||void 0===t?void 0:t.display;e&&e.onUpdate(()=>{this._updateSopGroupHierarchy(),e.active()&&this.request_display_node_container()})}_updateSopGroupHierarchy(){var t;if(null===(t=this.node.flags)||void 0===t?void 0:t.display){const t=this.sopGroup();this.usedInScene()?(t.visible=!0,this.node.object.add(t)):(t.visible=!1,this.node.object.remove(t))}}usedInScene(){var t,e;const s=this.node.params.has("display"),r=this.node.params.boolean("display"),i=this.node.usedInScene(),n=(null===(e=null===(t=this.node.flags)||void 0===t?void 0:t.display)||void 0===e?void 0:e.active())||!1;return i&&n&&(!s||r)}async request_display_node_container(){this.node.scene().loadingController.loaded()&&this.usedInScene()&&await this._set_content_under_sop_group()}remove_children(){if(0==this._sop_group.children.length)return;let t;for(;t=this._sop_group.children[0];)this._sop_group.remove(t);this._children_uuids_dict={},this._children_length=0}async _set_content_under_sop_group(){var t;const e=this.node.displayNodeController.displayNode();if(e&&(null===(t=e.parent())||void 0===t?void 0:t.graphNodeId())==this.node.graphNodeId()){const t=(await e.requestContainer()).coreContent();if(t){const e=t.objects();let s=e.length!=this._children_length;if(!s)for(let t of e)t.uuid in this._children_uuids_dict||(s=!0);if(s){this.remove_children();for(let t of e)this._sop_group.add(t),t.updateMatrix(),this._children_uuids_dict[t.uuid]=!0;this._children_length=e.length}return}}this.remove_children()}}},,,function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var r=s(57),i=s(4),n=s(33);s(39);o=i.a;var o;n.b;class a{constructor(t,e){this.node=t,this._name=e,this._object=this.createObject(),this._material=new r.a({wireframe:!0,fog:!1})}build(){this._object.matrixAutoUpdate=!1,this._object.name=this._name,this.buildHelper()}get object(){return this._object}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var r=s(33),i=s(9),n=s(39);class o extends r.b{constructor(){super(...arguments),this.flags=new n.c(this),this.renderOrder=r.a.LIGHT,this._color_with_intensity=new i.a(0),this._used_in_scene=!0,this._cook_main_without_inputs_when_dirty_bound=this._cook_main_without_inputs_when_dirty.bind(this)}get light(){return this._light}initializeBaseNode(){super.initializeBaseNode(),this._light=this.create_light(),this.object.add(this._light),this.flags.display.onUpdate(()=>{this.update_light_attachment()}),this.dirtyController.addPostDirtyHook("_cook_main_without_inputs_when_dirty",this._cook_main_without_inputs_when_dirty_bound)}async _cook_main_without_inputs_when_dirty(){await this.cookController.cook_main_without_inputs()}set_object_name(){super.set_object_name(),this._light&&(this._light.name=this.fullPath()+":light")}update_light_attachment(){this.flags.display.active()?(this.object.add(this.light),this._cook_main_without_inputs_when_dirty()):this.object.remove(this.light)}create_shadow_params_main(){if(null!=this._light.shadow)return this.create_shadow_params()}create_light_params(){}update_light_params(){}create_shadow_params(){}cook(){this.update_light_params(),this.update_shadow_params(),this.cookController.end_cook()}update_shadow_params(){}get color_with_intensity(){const t=this.params.color("color"),e=this.params.float("intensity");return this._color_with_intensity.copy(t).multiplyScalar(e),this._color_with_intensity}get active(){return this.flags.display.active()}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));class r{constructor(t,e,s){this.node=t,this._helper_constructor=e,this._name=s}initializeNode(){this.node.flags.display.onUpdate(()=>{this.update()})}get helper(){if(this.node.flags.display.active())return this._helper=this._helper||this._create_helper()}get visible(){return this.node.flags.display.active()&&this.node.pv.showHelper}_create_helper(){const t=new this._helper_constructor(this.node,this._name);return t.build(),t}update(){this.visible?(this._helper||(this._helper=this._create_helper()),this._helper&&(this.node.light.add(this._helper.object),this._helper.update())):this._helper&&this.node.light.remove(this._helper.object)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var r=s(38),i=s(8),n=s(39);class o extends r.a{constructor(){super(...arguments),this.flags=new n.a(this)}static nodeContext(){return i.g.ROP}initializeBaseNode(){this.dirtyController.addPostDirtyHook("cook_immediately",()=>{this.cookController.cook_main_without_inputs()})}cook(){this.cookController.end_cook()}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));var r=s(24);class i extends r.a{constructor(t){super(),this._element=t,this._element.style.position="absolute",this.addEventListener("removed",this._on_removed.bind(this))}_on_removed(){this.traverse((function(t){t instanceof i&&t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}get element(){return this._element}copy(t,e){return r.a.prototype.copy.call(this,t,e),this._element=t.element.cloneNode(!0),this.matrixAutoUpdate=t.matrixAutoUpdate,this}}},,function(t,e,s){"use strict";s.d(e,"a",(function(){return h}));var r=s(17),i=s(6),n=s(3),o=s(16),a=s(15),c=s(13),_=s(27),l=s(31);class h extends r.a{static type(){return"attribCreate"}cook(t,e){var s;const r=t[0];return e.name&&""!=e.name.trim()?this._add_attribute(a.a[e.class],r,e):null===(s=this.states)||void 0===s||s.error.set("attribute name is not valid"),r}async _add_attribute(t,e,s){const r=a.d[s.type];switch(t){case a.e.VERTEX:return void await this.add_point_attribute(r,e,s);case a.e.OBJECT:return void await this.add_object_attribute(r,e,s)}_.a.unreachable(t)}async add_point_attribute(t,e,s){const r=e.coreObjects();switch(t){case a.h.NUMERIC:for(let t=0;t<r.length;t++)await this.add_numeric_attribute_to_points(r[t],s);return;case a.h.STRING:for(let t=0;t<r.length;t++)await this.add_string_attribute_to_points(r[t],s);return}_.a.unreachable(t)}async add_object_attribute(t,e,s){const r=e.coreObjectsFromGroup(s.group);switch(t){case a.h.NUMERIC:return void await this.add_numeric_attribute_to_object(r,s);case a.h.STRING:return void await this.add_string_attribute_to_object(r,s)}_.a.unreachable(t)}async add_numeric_attribute_to_points(t,e){if(!t.coreGeometry())return;const s=[e.value1,e.value2,e.value3,e.value4][e.size-1];t.addNumericVertexAttrib(e.name,e.size,s)}async add_numeric_attribute_to_object(t,e){const s=[e.value1,e.value2,e.value3,e.value4][e.size-1];for(let r of t)r.setAttribValue(e.name,s)}async add_string_attribute_to_points(t,e){const s=t.pointsFromGroup(e.group),r=e.string,i=new Array(s.length);for(let t=0;t<s.length;t++)i[t]=r;const n=l.b.array_to_indexed_arrays(i),o=t.coreGeometry();o&&o.setIndexedAttribute(e.name,n.values,n.indices)}async add_string_attribute_to_object(t,e){const s=e.string;for(let r of t)r.setAttribValue(e.name,s)}}h.DEFAULT_PARAMS={group:"",class:a.a.indexOf(a.e.VERTEX),type:a.d.indexOf(a.h.NUMERIC),name:"new_attrib",size:1,value1:0,value2:new i.a(0,0),value3:new n.a(0,0,0),value4:new o.a(0,0,0,0),string:""},h.INPUT_CLONED_STATE=c.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var r=s(8),i=s(4),n=s(38);i.a;class o extends n.a{static nodeContext(){return r.g.SOP}cook(){this.cookController.end_cook()}}class a extends o{}},function(t,e,s){"use strict";s.d(e,"a",(function(){return l}));var r=s(17),i=s(15),n=s(52),o=s(42),a=s(34),c=s(13),_=s(10);class l extends r.a{static type(){return"merge"}cook(t,e){let s=[];for(let r of t)if(r){const t=r.objects();if(Object(_.a)(e.compact))for(let e of t)e.traverse(t=>{s.push(t)});else for(let t of r.objects())s.push(t)}Object(_.a)(e.compact)&&(s=this._make_compact(s));for(let t of s)t.traverse(t=>{t.matrixAutoUpdate=!1});return this.create_core_group_from_objects(s)}_make_compact(t){const e=new Map,s=new Map,r=[];for(let o of t)o.traverse(t=>{if(t instanceof a.a)return;const o=t;if(o.geometry){const t=Object(i.p)(o.constructor);if(r.includes(t)||r.push(t),t){e.get(t)||e.set(t,o.material),n.a.push_on_array_at_entry(s,t,o)}}});const c=[];return r.forEach(t=>{var r,i;const n=s.get(t);if(n){const s=[];for(let t of n){const e=t.geometry;e.applyMatrix4(t.matrix),s.push(e)}try{const i=o.a.merge_geometries(s);if(i){const s=e.get(t),r=this.create_object(i,t,s);c.push(r)}else null===(r=this.states)||void 0===r||r.error.set("merge failed, check that input geometries have the same attributes")}catch(t){null===(i=this.states)||void 0===i||i.error.set(t)}}}),c}}l.DEFAULT_PARAMS={compact:!1},l.INPUT_CLONED_STATE=c.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var r=s(17),i=s(13);class n extends r.a{static type(){return"null"}cook(t,e){const s=t[0];return s||this.create_core_group_from_objects([])}}n.DEFAULT_PARAMS={},n.INPUT_CLONED_STATE=i.a.FROM_NODE},,function(t,e,s){"use strict";s.d(e,"a",(function(){return j}));class r{constructor(){this._id=r.__next_id++}id(){return this._id}handle_globals_node(t,e,s){}}r.__next_id=0;var i=s(38),n=s(22),o=s(6),a=s(3),c=s(16),_=s(9),l=s(7);class h{static any(t){return l.a.isString(t)?t:l.a.isBoolean(t)?""+t:l.a.isNumber(t)?""+n.a.ensureFloat(t):l.a.isArray(t)?this.numeric_array(t):t instanceof o.a||t instanceof a.a||t instanceof c.a||t instanceof _.a?this.numeric_array(t.toArray()):`ThreeToGl error: unknown value type '${t}'`}static numeric_array(t){const e=new Array(t.length);for(let s=0;s<t.length;s++)e[s]=""+n.a.ensureFloat(t[s]);return`${"vec"+t.length}(${e.join(", ")})`}static vector4(t){if(l.a.isString(t))return t;return`vec4(${t.toArray().map(t=>""+n.a.ensureFloat(t)).join(", ")})`}static vector3(t){if(l.a.isString(t))return t;return`vec3(${t.toArray().map(t=>""+n.a.ensureFloat(t)).join(", ")})`}static vector2(t){if(l.a.isString(t))return t;return`vec2(${t.toArray().map(t=>""+n.a.ensureFloat(t)).join(", ")})`}static vector3_float(t,e){return l.a.isString(e)||(e=n.a.ensureFloat(e)),`vec4(${this.vector3(t)}, ${e})`}static float4(t,e,s,r){return l.a.isString(t)||(t=n.a.ensureFloat(t)),l.a.isString(e)||(e=n.a.ensureFloat(e)),l.a.isString(s)||(s=n.a.ensureFloat(s)),l.a.isString(r)||(r=n.a.ensureFloat(r)),`vec4(${t}, ${e}, ${s}, ${r})`}static float3(t,e,s){return l.a.isString(t)||(t=n.a.ensureFloat(t)),l.a.isString(e)||(e=n.a.ensureFloat(e)),l.a.isString(s)||(s=n.a.ensureFloat(s)),`vec3(${t}, ${e}, ${s})`}static float2(t,e){return l.a.isString(t)||(t=n.a.ensureFloat(t)),l.a.isString(e)||(e=n.a.ensureFloat(e)),`vec2(${t}, ${e})`}static float(t){return l.a.isString(t)||(t=n.a.ensureFloat(t)),""+t}static int(t){return""+t}static bool(t){return""+t}}var u=s(8),d=s(4);const p=/\/+/g;class m extends i.a{static nodeContext(){return u.g.GL}initializeBaseNode(){this.uiData.setLayoutHorizontal(),this.io.connections.initInputs(),this.io.connection_points.spare_params.initializeNode()}cook(){console.warn("gl nodes should never cook")}_set_mat_to_recompile(){var t,e;null===(e=null===(t=this.material_node)||void 0===t?void 0:t.assemblerController)||void 0===e||e.set_compilation_required_and_dirty(this)}get material_node(){var t;const e=this.parent();if(e)return e.nodeContext()==u.g.GL?null===(t=e)||void 0===t?void 0:t.material_node:e}gl_var_name(t){return`v_POLY_${this.fullPath(this.material_node).replace(p,"_")}_${t}`}variable_for_input(t){var e;const s=this.io.inputs.get_input_index(t),r=this.io.connections.inputConnection(s);if(r){const e=r.node_src,s=e.io.outputs.named_output_connection_points[r.output_index];if(s){const t=s.name();return e.gl_var_name(t)}throw console.warn(`no output called '${t}' for gl node ${e.fullPath()}`),"variable_for_input ERROR"}if(this.params.has(t))return h.any(null===(e=this.params.get(t))||void 0===e?void 0:e.value);{const t=this.io.inputs.named_input_connection_points[s];return h.any(t.init_value)}}set_lines(t){}reset_code(){var t;null===(t=this._param_configs_controller)||void 0===t||t.reset()}set_param_configs(){}param_configs(){var t;return null===(t=this._param_configs_controller)||void 0===t?void 0:t.list}param_default_value(t){return null}}class f extends d.a{}new f;var b=s(102);const g=[b.c.FLOAT,b.c.VEC2,b.c.VEC3,b.c.VEC4];class v extends d.a{constructor(){super(...arguments),this.name=d.b.STRING(""),this.type=d.b.INTEGER(0,{menu:{entries:g.map((t,e)=>({name:t,value:e}))}}),this.texport_when_connected=d.b.BOOLEAN(0,{hidden:!0}),this.export_when_connected=d.b.BOOLEAN(0,{visibleIf:{texport_when_connected:1}})}}const y=new v;class x extends m{constructor(){super(...arguments),this.params_config=y,this._on_create_set_name_if_none_bound=this._on_create_set_name_if_none.bind(this)}static type(){return u.d.ATTRIBUTE}initializeNode(){this.addPostDirtyHook("_set_mat_to_recompile",this._set_mat_to_recompile_if_is_exporting.bind(this)),this.lifecycle.add_on_create_hook(this._on_create_set_name_if_none_bound),this.io.connection_points.initializeNode(),this.io.connection_points.set_expected_input_types_function(()=>{var t,e;return(null===(e=null===(t=this.material_node)||void 0===t?void 0:t.assemblerController)||void 0===e?void 0:e.allow_attribute_exports())?[g[this.pv.type]]:[]}),this.io.connection_points.set_input_name_function(t=>x.INPUT_NAME),this.io.connection_points.set_expected_output_types_function(()=>[g[this.pv.type]]),this.scene().dispatchController.onAddListener(()=>{this.params.onParamsCreated("params_label",()=>{this.params.label.init([this.p.name,this.p.export_when_connected],()=>this.pv.export_when_connected?this.pv.name+" (EXPORTED)":this.pv.name)})}),this.params.addOnSceneLoadHook("prepare params",()=>{var t,e;(null===(e=null===(t=this.material_node)||void 0===t?void 0:t.assemblerController)||void 0===e?void 0:e.allow_attribute_exports())&&this.p.texport_when_connected.set(1)})}get input_name(){return x.INPUT_NAME}get output_name(){return x.OUTPUT_NAME}set_lines(t){var e,s;null===(s=null===(e=this.material_node)||void 0===e?void 0:e.assemblerController)||void 0===s||s.assembler.set_node_lines_attribute(this,t)}get attribute_name(){return this.pv.name.trim()}gl_type(){return this.io.outputs.named_output_connection_points[0].type()}set_gl_type(t){this.p.type.set(g.indexOf(t))}connected_input_node(){return this.io.inputs.named_input(x.INPUT_NAME)}connected_input_connection_point(){return this.io.inputs.named_input_connection_point(x.INPUT_NAME)}output_connection_point(){return this.io.outputs.named_output_connection_points_by_name(this.output_name)}get is_importing(){return this.io.outputs.used_output_names().length>0}get is_exporting(){if(this.pv.export_when_connected){return null!=this.io.inputs.named_input(x.INPUT_NAME)}return!1}_set_mat_to_recompile_if_is_exporting(){this.is_exporting&&this._set_mat_to_recompile()}_on_create_set_name_if_none(){""==this.pv.name&&this.p.name.set(this.name())}}x.INPUT_NAME="in",x.OUTPUT_NAME="val";class w{constructor(t=[]){this._definitions=t,this._errored=!1}get errored(){return this._errored}get error_message(){return this._error_message}uniq(){const t=new Map,e=[];for(let s of this._definitions)if(!this._errored){const r=s.name(),i=t.get(r);i?i.data_type!=s.data_type&&(this._errored=!0,this._error_message=`attempt to create '${s.name()}' with types '${s.data_type}' by node '${s.node.fullPath()}', when there is already an existing with type ${i.data_type} from node '${i.node.fullPath()}'`,console.warn("emitting error message:",this._error_message)):(t.set(r,s),e.push(r))}const s=[];for(let r of e){const e=t.get(r);e&&s.push(e)}return s}}var E;!function(t){t.ATTRIBUTE="attribute",t.FUNCTION="function",t.UNIFORM="uniform",t.VARYING="varying"}(E||(E={}));class O{constructor(t,e,s,r){this._definition_type=t,this._data_type=e,this._node=s,this._name=r}get definition_type(){return this._definition_type}get data_type(){return this._data_type}get node(){return this._node}name(){return this._name}collection_instance(){return new w}}class A extends O{constructor(t,e,s){super(E.ATTRIBUTE,e,t,s),this._node=t,this._data_type=e,this._name=s}get line(){return`attribute ${this.data_type} ${this.name()}`}}class T extends O{constructor(t,e,s){super(E.VARYING,e,t,s),this._node=t,this._data_type=e,this._name=s}get line(){return`varying ${this.data_type} ${this.name()}`}}var C,N=s(52);!function(t){t.VERTEX="vertex",t.FRAGMENT="fragment",t.LEAVES_FROM_NODES_SHADER="leaves_from_nodes_shader",t.PARTICLES_0="particles_0",t.PARTICLES_1="particles_1",t.PARTICLES_2="particles_2",t.PARTICLES_3="particles_3",t.PARTICLES_4="particles_4",t.PARTICLES_5="particles_5",t.PARTICLES_6="particles_6",t.PARTICLES_7="particles_7",t.PARTICLES_8="particles_8",t.PARTICLES_9="particles_9"}(C||(C={}));C.PARTICLES_0,C.PARTICLES_1,C.PARTICLES_2,C.PARTICLES_3,C.PARTICLES_4,C.PARTICLES_5,C.PARTICLES_6,C.PARTICLES_7,C.PARTICLES_8,C.PARTICLES_9;const R={position:"vec3( position )"};class j extends r{handle_globals_node(t,e,s){var r,i;const n=t.io.outputs.named_output_connection_points_by_name(e);if(!n)return;const o=t.gl_var_name(e),a=n.type(),c=new T(t,a,o);s.add_definitions(t,[c]);const _=null===(i=null===(r=t.material_node)||void 0===r?void 0:r.assemblerController)||void 0===i?void 0:i.assembler;if(!_)return;const l=_.shader_config(s.current_shader_name);if(!l)return;const h=l.dependencies(),u=`${o} = ${a}(${e})`;for(let e of h)s.add_definitions(t,[c],e),s.add_body_lines(t,[u],e);0==h.length&&s.add_body_lines(t,[u])}static variable_config_default(t){return R[t]}variable_config_default(t){return j.variable_config_default(t)}read_attribute(t,e,s,r){return j.read_attribute(t,e,s,r)}static read_attribute(t,e,s,r){var i,n;j.PRE_DEFINED_ATTRIBUTES.indexOf(s)<0&&r.add_definitions(t,[new A(t,e,s)],C.VERTEX);const o=r.current_shader_name;switch(o){case C.VERTEX:return s;case C.FRAGMENT:{if(!(t instanceof x))return;const a="varying_"+t.gl_var_name(t.output_name),c=new T(t,e,a),_=new Map;_.set(C.FRAGMENT,[]);const l=new Map;l.set(C.FRAGMENT,[]),N.a.push_on_array_at_entry(_,o,c);const h=`${a} = ${e}(${s})`,u=null===(n=null===(i=t.material_node)||void 0===i?void 0:i.assemblerController)||void 0===n?void 0:n.assembler.shader_config(o);if(u){const e=u.dependencies();for(let t of e)N.a.push_on_array_at_entry(_,t,c),N.a.push_on_array_at_entry(l,t,h);_.forEach((e,s)=>{r.add_definitions(t,e,s)}),l.forEach((e,s)=>{r.add_body_lines(t,e,s)})}return a}}}handle_attribute_node(t,e,s,r){return j.read_attribute(t,e,s,r)}}j.PRE_DEFINED_ATTRIBUTES=["position","color","normal","uv","uv2","morphTarget0","morphTarget1","morphTarget2","morphTarget3","skinIndex","skinWeight"],j.IF_RULE={uv:"defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )"}},,function(t,e,s){"use strict";s.d(e,"a",(function(){return w}));var r=s(30),i=s(76),n=s(152),o=s(22),a=s(28);class c extends a.a{constructor(t){super(t,"CopyStamp"),this._global_index=0}set_global_index(t){this._global_index=t,this.setDirty(),this.removeDirtyState()}value(t){return this._global_index}}class _ extends c{set_point(t){this._point=t,this.setDirty(),this.removeDirtyState()}value(t){return this._point?t?this._point.attribValue(t):this._point.index():this._global_index}}var l,h=s(4),u=s(13),d=s(3),p=s(29),m=s(25),f=s(27),b=s(10);!function(t){t[t.OBJECT=0]="OBJECT",t[t.GEOMETRY=1]="GEOMETRY"}(l||(l={}));const g=[l.OBJECT,l.GEOMETRY],v=[{name:"object",value:l.OBJECT},{name:"geometry",value:l.GEOMETRY}];class y extends h.a{constructor(){super(...arguments),this.count=h.b.INTEGER(1,{range:[1,20],rangeLocked:[!0,!1]}),this.transformOnly=h.b.BOOLEAN(0),this.transformMode=h.b.INTEGER(0,{menu:{entries:v}}),this.copyAttributes=h.b.BOOLEAN(0),this.attributesToCopy=h.b.STRING("",{visibleIf:{copyAttributes:!0}}),this.useCopyExpr=h.b.BOOLEAN(0)}}const x=new y;class w extends r.a{constructor(){super(...arguments),this.params_config=x,this._attribute_names_to_copy=[],this._objects=[],this._object_position=new d.a}static type(){return"copy"}static displayedInputNames(){return["geometry to be copied","points to copy to"]}initializeNode(){this.io.inputs.setCount(1,2),this.io.inputs.initInputsClonedState([u.a.ALWAYS,u.a.NEVER])}async cook(t){const e=t[0];if(!this.io.inputs.has_input(1))return void await this.cook_without_template(e);const s=t[1];s?await this.cook_with_template(e,s):this.states.error.set("second input invalid")}async cook_with_template(t,e){this._objects=[];const s=e.points();let r=new n.a(e).matrices();const i=new d.a,a=new p.a,c=new d.a;r[0].decompose(i,a,c),this._attribute_names_to_copy=o.a.attribNames(this.pv.attributesToCopy).filter(t=>e.hasAttrib(t)),await this._copy_moved_objects_on_template_points(t,r,s),this.setObjects(this._objects)}async _copy_moved_objects_on_template_points(t,e,s){for(let r=0;r<s.length;r++)await this._copy_moved_object_on_template_point(t,e,s,r)}async _copy_moved_object_on_template_point(t,e,s,r){const i=e[r],n=s[r];this.stamp_node.set_point(n);const o=await this._get_moved_objects_for_template_point(t,r);for(let t of o)Object(b.a)(this.pv.copyAttributes)&&this._copyAttributes_from_template(t,n),Object(b.a)(this.pv.transformOnly)?t.applyMatrix4(i):this._apply_matrix_to_object_or_geometry(t,i),this._objects.push(t)}_apply_matrix_to_object_or_geometry(t,e){const s=g[this.pv.transformMode];switch(s){case l.OBJECT:return void this._apply_matrix_to_object(t,e);case l.GEOMETRY:{const s=t.geometry;return void(s&&s.applyMatrix4(e))}}f.a.unreachable(s)}_apply_matrix_to_object(t,e){this._object_position.copy(t.position),t.position.multiplyScalar(0),t.updateMatrix(),t.applyMatrix4(e),t.position.add(this._object_position),t.updateMatrix()}async _get_moved_objects_for_template_point(t,e){const s=await this._stamp_instance_group_if_required(t);if(s){return Object(b.a)(this.pv.transformOnly)?m.a.compact([s.objects()[e]]):s.clone().objects()}return[]}async _stamp_instance_group_if_required(t){if(!Object(b.a)(this.pv.useCopyExpr))return t;{const t=await this.containerController.requestInputContainer(0);if(t){const e=t.coreContent();return e||void 0}this.states.error.set("input failed for index "+this.stamp_value())}}async _copy_moved_objects_for_each_instance(t){for(let e=0;e<this.pv.count;e++)await this._copy_moved_objects_for_instance(t,e)}async _copy_moved_objects_for_instance(t,e){this.stamp_node.set_global_index(e);const s=await this._stamp_instance_group_if_required(t);s&&s.objects().forEach(t=>{const e=i.a.clone(t);this._objects.push(e)})}async cook_without_template(t){this._objects=[],await this._copy_moved_objects_for_each_instance(t),this.setObjects(this._objects)}_copyAttributes_from_template(t,e){this._attribute_names_to_copy.forEach((s,r)=>{const n=e.attribValue(s);new i.a(t,r).addAttribute(s,n)})}stamp_value(t){return this.stamp_node.value(t)}get stamp_node(){return this._stamp_node=this._stamp_node||this.create_stamp_node()}create_stamp_node(){const t=new _(this.scene());return this.dirtyController.set_forbidden_trigger_nodes([t]),t}dispose(){super.dispose(),this._stamp_node&&this._stamp_node.dispose()}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return d}));var r=s(167),i=s(23),n=s(3),o=s(168),a=s(58);class c{constructor(){this._width=0,this._height=0,this._widthHalf=0,this._heightHalf=0,this.vector=new n.a,this.viewMatrix=new i.a,this.viewProjectionMatrix=new i.a,this.cache_distanceToCameraSquared=new WeakMap,this.domElement=document.createElement("div"),this._sort_objects=!1,this._use_fog=!1,this._fog_near=1,this._fog_far=100,this.a=new n.a,this.b=new n.a,this.domElement.classList.add("polygonjs-CSS2DRenderer")}getSize(){return{width:this._width,height:this._height}}setSize(t,e){this._width=t,this._height=e,this._widthHalf=this._width/2,this._heightHalf=this._height/2,this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"}renderObject(t,e,s){if(t instanceof o.a){this.vector.setFromMatrixPosition(t.matrixWorld),this.vector.applyMatrix4(this.viewProjectionMatrix);var r=t.element,i="translate(-50%,-50%) translate("+(this.vector.x*this._widthHalf+this._widthHalf)+"px,"+(-this.vector.y*this._heightHalf+this._heightHalf)+"px)";if(r.style.webkitTransform=i,r.style.transform=i,r.style.display=t.visible&&this.vector.z>=-1&&this.vector.z<=1?"":"none",this._sort_objects||this._use_fog){const e=this.getDistanceToSquared(s,t);if(this._use_fog){const t=Math.sqrt(e),s=a.a.fit(t,this._fog_near,this._fog_far,0,1),i=a.a.clamp(1-s,0,1);r.style.opacity=""+i,0==i&&(r.style.display="none")}this.cache_distanceToCameraSquared.set(t,e)}r.parentNode!==this.domElement&&this.domElement.appendChild(r)}for(var n=0,c=t.children.length;n<c;n++)this.renderObject(t.children[n],e,s)}getDistanceToSquared(t,e){return this.a.setFromMatrixPosition(t.matrixWorld),this.b.setFromMatrixPosition(e.matrixWorld),this.a.distanceToSquared(this.b)}filterAndFlatten(t){const e=[];return t.traverse((function(t){t instanceof o.a&&e.push(t)})),e}render(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),this.viewMatrix.copy(e.matrixWorldInverse),this.viewProjectionMatrix.multiplyMatrices(e.projectionMatrix,this.viewMatrix),this.renderObject(t,t,e),this._sort_objects&&this.zOrder(t)}set_sorting(t){this._sort_objects=t}zOrder(t){const e=this.filterAndFlatten(t).sort((t,e)=>{const s=this.cache_distanceToCameraSquared.get(t),r=this.cache_distanceToCameraSquared.get(e);return null!=s&&null!=r?s-r:0}),s=e.length;for(let t=0,r=e.length;t<r;t++)e[t].element.style.zIndex=""+(s-t)}set_use_fog(t){this._use_fog=t}set_fog_range(t,e){this._fog_near=t,this._fog_far=e}}var _=s(117),l=s(4);class h extends l.a{constructor(){super(...arguments),this.css=l.b.STRING("",{multiline:!0}),this.sortObjects=l.b.BOOLEAN(0),this.useFog=l.b.BOOLEAN(0),this.fogNear=l.b.FLOAT(1,{range:[0,100],rangeLocked:[!0,!1],visibleIf:{useFog:1}}),this.fogFar=l.b.FLOAT(100,{range:[0,100],rangeLocked:[!0,!1],visibleIf:{useFog:1}})}}const u=new h;class d extends r.a{constructor(){super(...arguments),this.params_config=u,this._renderers_by_canvas_id=new Map}static type(){return _.a.CSS2D}create_renderer(t){const e=new c;this._renderers_by_canvas_id.set(t.id,e);const s=t.parentElement;return s&&(s.prepend(e.domElement),s.style.position="relative"),e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.left="0px",e.domElement.style.pointerEvents="none",e.setSize(t.width/window.devicePixelRatio,t.height/window.devicePixelRatio),this._update_renderer(e),e}renderer(t){return this._renderers_by_canvas_id.get(t.id)||this.create_renderer(t)}cook(){this._update_css(),this._renderers_by_canvas_id.forEach(t=>{this._update_renderer(t)}),this.cookController.end_cook()}_update_renderer(t){t.set_sorting(this.pv.sortObjects),t.set_use_fog(this.pv.useFog),t.set_fog_range(this.pv.fogNear,this.pv.fogFar)}_update_css(){this.css_element().innerHTML=this.pv.css}css_element(){return this._css_element=this._css_element||this._find_element()||this._create_element()}_find_element(){return document.getElementById(this._css_element_id())}_create_element(){const t=document.createElement("style");return t.appendChild(document.createTextNode("")),document.head.appendChild(t),t.id=this._css_element_id(),t}_css_element_id(){return"css_2d_renderer-"+this.graphNodeId()}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,s){"use strict";s.d(e,"a",(function(){return m}));var r=s(69),i=s(5),n=s(32),o=s(4),a=s(158),c=s(109),_=s(110),l=s(111),h=s(112),u=s(113);class d extends(Object(u.b)(Object(h.b)(Object(l.b)(Object(_.b)(Object(c.b)(Object(a.a)(o.a))))))){}const p=new d;class m extends n.a{constructor(){super(...arguments),this.params_config=p,this.texture_map_controller=new h.a(this,{direct_params:!0}),this.texture_alpha_map_controller=new u.a(this,{direct_params:!0}),this.depth_controller=new _.a(this)}static type(){return"meshLambert"}createMaterial(){return new r.a({vertexColors:!1,side:i.G,color:16777215,opacity:1})}initializeNode(){this.params.onParamsCreated("init controllers",()=>{this.texture_map_controller.initializeNode(),this.texture_alpha_map_controller.initializeNode()})}async cook(){a.b.update(this),c.a.update(this),l.a.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.depth_controller.update(),this.set_material(this.material)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var r=s(160),i=s(8);class n extends r.a{constructor(){super(...arguments),this._children_controller_context=i.g.COP}static type(){return i.f.COP}createNode(t,e){return super.createNode(t,e)}children(){return super.children()}nodesByType(t){return super.nodesByType(t)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return m}));var r=s(33),i=s(34),n=s(114),o=s(8),a=s(51),c=s(39),_=s(64),l=s(4),h=s(161),u=s(10);class d extends(Object(a.b)(l.a)){constructor(){super(...arguments),this.display=l.b.BOOLEAN(1),this.renderOrder=l.b.INTEGER(0,{range:[0,10],rangeLocked:[!0,!1]})}}const p=new d;class m extends r.b{constructor(){super(...arguments),this.params_config=p,this.hierarchyController=new _.a(this),this.transformController=new a.a(this),this.flags=new c.c(this),this.childrenDisplayController=new h.a(this),this.displayNodeController=new n.a(this,this.childrenDisplayController.displayNodeControllerCallbacks()),this._children_controller_context=o.g.SOP,this._on_child_add_bound=this._on_child_add.bind(this)}static type(){return"geo"}create_object(){const t=new i.a;return t.matrixAutoUpdate=!1,t}initializeNode(){this.lifecycle.add_on_child_add_hook(this._on_child_add_bound),this.hierarchyController.initializeNode(),this.transformController.initializeNode(),this.childrenDisplayController.initializeNode()}isDisplayNodeCooking(){if(this.flags.display.active()){const t=this.displayNodeController.displayNode();return!!t&&t.isDirty()}return!1}createNode(t,e){return super.createNode(t,e)}children(){return super.children()}nodesByType(t){return super.nodesByType(t)}_on_child_add(t){var e,s;this.scene().loadingController.loaded()&&1==this.children().length&&(null===(s=null===(e=t.flags)||void 0===e?void 0:e.display)||void 0===s||s.set(!0))}cook(){this.transformController.update(),this.object.visible=Object(u.a)(this.pv.display),this.object.renderOrder=this.pv.renderOrder,this.cookController.end_cook()}}},,,function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var r=s(160),i=s(8),n=s(33);class o extends r.a{constructor(){super(...arguments),this.renderOrder=n.a.MANAGER,this._children_controller_context=i.g.MAT}static type(){return i.f.MAT}createNode(t,e){return super.createNode(t,e)}children(){return super.children()}nodesByType(t){return super.nodesByType(t)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return u}));var r=s(33),i=s(34),n=s(51),o=s(39),a=s(269),c=s(4),_=s(64);class l extends(Object(n.b)(c.a)){}const h=new l;class u extends r.b{constructor(){super(...arguments),this.params_config=h,this.hierarchyController=new _.a(this),this.transformController=new n.a(this),this.flags=new o.c(this),this._helper=new a.a(1)}static type(){return"null"}create_object(){const t=new i.a;return t.matrixAutoUpdate=!1,t}initializeNode(){this.hierarchyController.initializeNode(),this.transformController.initializeNode(),this._updateHelperHierarchy(),this._helper.matrixAutoUpdate=!1,this.flags.display.onUpdate(()=>{this._updateHelperHierarchy()})}_updateHelperHierarchy(){this.flags.display.active()?this.object.add(this._helper):this.object.remove(this._helper)}cook(){this.transformController.update(),this.cookController.end_cook()}}},,,,,function(t,e,s){"use strict";s.d(e,"a",(function(){return f}));var r=s(30),i=s(15),n=s(31),o=s(27),a=s(6),c=s(3),_=s(16),l=s(170),h=s(4);const u=["x","y","z","w"],d=l.a.DEFAULT_PARAMS;class p extends h.a{constructor(){super(...arguments),this.group=h.b.STRING(d.group),this.class=h.b.INTEGER(d.class,{menu:{entries:i.f}}),this.type=h.b.INTEGER(d.type,{menu:{entries:i.i}}),this.name=h.b.STRING(d.name),this.size=h.b.INTEGER(d.size,{range:[1,4],rangeLocked:[!0,!0],visibleIf:{type:i.h.NUMERIC}}),this.value1=h.b.FLOAT(d.value1,{visibleIf:{type:i.h.NUMERIC,size:1},expression:{forEntities:!0}}),this.value2=h.b.VECTOR2(d.value2,{visibleIf:{type:i.h.NUMERIC,size:2},expression:{forEntities:!0}}),this.value3=h.b.VECTOR3(d.value3,{visibleIf:{type:i.h.NUMERIC,size:3},expression:{forEntities:!0}}),this.value4=h.b.VECTOR4(d.value4,{visibleIf:{type:i.h.NUMERIC,size:4},expression:{forEntities:!0}}),this.string=h.b.STRING(d.string,{visibleIf:{type:i.h.STRING},expression:{forEntities:!0}})}}const m=new p;class f extends r.a{constructor(){super(...arguments),this.params_config=m,this._x_arrays_by_geometry_uuid={},this._y_arrays_by_geometry_uuid={},this._z_arrays_by_geometry_uuid={},this._w_arrays_by_geometry_uuid={}}static type(){return"attribCreate"}initializeNode(){this.io.inputs.setCount(1),this.io.inputs.initInputsClonedState(l.a.INPUT_CLONED_STATE),this.scene().dispatchController.onAddListener(()=>{this.params.onParamsCreated("params_label",()=>{this.params.label.init([this.p.name])})})}cook(t){if(this._is_using_expression())this.pv.name&&""!=this.pv.name.trim()?this._add_attribute(i.a[this.pv.class],t[0]):this.states.error.set("attribute name is not valid");else{this._operation=this._operation||new l.a(this.scene(),this.states);const e=this._operation.cook(t,this.pv);this.setCoreGroup(e)}}async _add_attribute(t,e){const s=i.d[this.pv.type];switch(t){case i.e.VERTEX:return await this.add_point_attribute(s,e),this.setCoreGroup(e);case i.e.OBJECT:return await this.add_object_attribute(s,e),this.setCoreGroup(e)}o.a.unreachable(t)}async add_point_attribute(t,e){const s=e.coreObjects();switch(t){case i.h.NUMERIC:for(let t=0;t<s.length;t++)await this.add_numeric_attribute_to_points(s[t]);return;case i.h.STRING:for(let t=0;t<s.length;t++)await this.add_string_attribute_to_points(s[t]);return}o.a.unreachable(t)}async add_object_attribute(t,e){const s=e.coreObjectsFromGroup(this.pv.group);switch(t){case i.h.NUMERIC:return void await this.add_numeric_attribute_to_object(s);case i.h.STRING:return void await this.add_string_attribute_to_object(s)}o.a.unreachable(t)}async add_numeric_attribute_to_points(t){const e=t.coreGeometry();if(!e)return;const s=t.pointsFromGroup(this.pv.group),r=[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1];if(r.hasExpression()){e.hasAttrib(this.pv.name)||e.addNumericAttrib(this.pv.name,this.pv.size,r.value);const t=e.geometry(),i=t.getAttribute(this.pv.name).array;if(1==this.pv.size)this.p.value1.expressionController&&await this.p.value1.expressionController.compute_expression_for_points(s,(t,e)=>{i[t.index()*this.pv.size+0]=e});else{let e=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2].components;const r=new Array(e.length);let n;const o=[this._x_arrays_by_geometry_uuid,this._y_arrays_by_geometry_uuid,this._z_arrays_by_geometry_uuid,this._w_arrays_by_geometry_uuid];for(let a=0;a<e.length;a++)if(n=e[a],n.hasExpression()&&n.expressionController)r[a]=this._init_array_if_required(t,o[a],s.length),await n.expressionController.compute_expression_for_points(s,(t,e)=>{r[a][t.index()]=e});else{const t=n.value;for(let e of s)i[e.index()*this.pv.size+a]=t}for(let t=0;t<r.length;t++){const e=r[t];if(e)for(let s=0;s<e.length;s++)i[s*this.pv.size+t]=e[s]}}}}async add_numeric_attribute_to_object(t){if([this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1].hasExpression())if(1==this.pv.size)this.p.value1.expressionController&&await this.p.value1.expressionController.compute_expression_for_objects(t,(t,e)=>{t.setAttribValue(this.pv.name,e)});else{let e=[this.p.value2,this.p.value3,this.p.value4][this.pv.size-2].components,s={};const r=this._vector_by_attrib_size(this.pv.size);if(r){for(let e of t)s[e.index()]=r;for(let r=0;r<e.length;r++){const i=e[r],n=u[r];if(i.hasExpression()&&i.expressionController)await i.expressionController.compute_expression_for_objects(t,(t,e)=>{s[t.index()][n]=e});else for(let e of t){s[e.index()][n]=i.value}}for(let e=0;e<t.length;e++){const r=t[e],i=s[r.index()];r.setAttribValue(this.pv.name,i)}}}}_vector_by_attrib_size(t){switch(t){case 2:return new a.a(0,0);case 3:return new c.a(0,0,0);case 4:return new _.a(0,0,0,0)}}async add_string_attribute_to_points(t){const e=t.pointsFromGroup(this.pv.group),s=this.p.string,r=new Array(e.length);s.hasExpression()&&s.expressionController&&await s.expressionController.compute_expression_for_points(e,(t,e)=>{r[t.index()]=e});const i=n.b.array_to_indexed_arrays(r),o=t.coreGeometry();o&&o.setIndexedAttribute(this.pv.name,i.values,i.indices)}async add_string_attribute_to_object(t){const e=this.p.string;e.hasExpression()&&e.expressionController&&await e.expressionController.compute_expression_for_objects(t,(t,e)=>{t.setAttribValue(this.pv.name,e)})}_init_array_if_required(t,e,s){const r=t.uuid,i=e[r];return i?i.length<s&&(e[r]=new Array(s)):e[r]=new Array(s),e[r]}_is_using_expression(){switch(i.d[this.pv.type]){case i.h.NUMERIC:return[this.p.value1,this.p.value2,this.p.value3,this.p.value4][this.pv.size-1].hasExpression();case i.h.STRING:return this.p.string.hasExpression()}}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var r=s(171),i=s(8);class n extends r.a{constructor(){super(...arguments),this._children_controller_context=i.g.EVENT}static type(){return i.f.EVENT}createNode(t,e){return super.createNode(t,e)}children(){return super.children()}nodesByType(t){return super.nodesByType(t)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return h}));var r=s(30),i=s(172),n=s(4),o=s(26);const a="geometry to merge",c=i.a.DEFAULT_PARAMS;class _ extends n.a{constructor(){super(...arguments),this.compact=n.b.BOOLEAN(c.compact),this.inputsCount=n.b.INTEGER(4,{range:[1,32],rangeLocked:[!0,!1],callback:t=>{h.PARAM_CALLBACK_setInputsCount(t)}})}}const l=new _;class h extends r.a{constructor(){super(...arguments),this.params_config=l}static type(){return"merge"}static displayedInputNames(){return[a,a,a,a]}initializeNode(){this.io.inputs.setCount(1,4),this.io.inputs.initInputsClonedState(i.a.INPUT_CLONED_STATE),this.scene().dispatchController.onAddListener(()=>{this.params.onParamsCreated("params_label",()=>{this.params.label.init([this.p.compact],()=>this.pv.compact?"compact":"separate objects")}),this.params.addOnSceneLoadHook("update inputs",()=>{this._callbackUpdateInputsCount()})})}cook(t){this._operation=this._operation||new i.a(this.scene(),this.states);const e=this._operation.cook(t,this.pv);this.setCoreGroup(e)}_callbackUpdateInputsCount(){this.io.inputs.setCount(1,this.pv.inputsCount),this.emit(o.a.INPUTS_UPDATED)}static PARAM_CALLBACK_setInputsCount(t){t._callbackUpdateInputsCount()}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return h}));var r=s(30),i=s(13),n=s(31),o=s(42),a=s(4),c=s(10);class _ extends a.a{constructor(){super(...arguments),this.edit=a.b.BOOLEAN(0),this.updateX=a.b.BOOLEAN(0,{visibleIf:{edit:1}}),this.x=a.b.FLOAT("@N.x",{visibleIf:{updateX:1,edit:1},expression:{forEntities:!0}}),this.updateY=a.b.BOOLEAN(0,{visibleIf:{edit:1}}),this.y=a.b.FLOAT("@N.y",{visibleIf:{updateY:1,edit:1},expression:{forEntities:!0}}),this.updateZ=a.b.BOOLEAN(0,{visibleIf:{edit:1}}),this.z=a.b.FLOAT("@N.z",{visibleIf:{updateZ:1,edit:1},expression:{forEntities:!0}}),this.recompute=a.b.BOOLEAN(1,{visibleIf:{edit:0}}),this.invert=a.b.BOOLEAN(0)}}const l=new _;class h extends r.a{constructor(){super(...arguments),this.params_config=l}static type(){return"normals"}static displayedInputNames(){return["geometry to update normals of"]}initializeNode(){this.io.inputs.setCount(1),this.io.inputs.initInputsClonedState(i.a.FROM_NODE)}async cook(t){const e=t[0];Object(c.a)(this.pv.edit)?await this._eval_expressions_for_core_group(e):this.pv.recompute&&e.computeVertexNormals(),Object(c.a)(this.pv.invert)&&this._invert_normals(e),this.setCoreGroup(e)}async _eval_expressions_for_core_group(t){const e=t.coreObjects();for(let t=0;t<e.length;t++)await this._eval_expressions_for_core_object(e[t])}async _eval_expressions_for_core_object(t){const e=t.object().geometry,s=t.points();let r=e.getAttribute(n.a.NORMAL);if(!r){new o.a(e).addNumericAttrib(n.a.NORMAL,3,0),r=e.getAttribute(n.a.NORMAL)}const i=r.array;if(Object(c.a)(this.pv.updateX))if(this.p.x.hasExpression()&&this.p.x.expressionController)await this.p.x.expressionController.compute_expression_for_points(s,(t,e)=>{i[3*t.index()+0]=e});else{let t;for(let e=0;e<s.length;e++)t=s[e],i[3*t.index()+0]=this.pv.x}if(Object(c.a)(this.pv.updateY))if(this.p.y.hasExpression()&&this.p.y.expressionController)await this.p.y.expressionController.compute_expression_for_points(s,(t,e)=>{i[3*t.index()+1]=e});else{let t;for(let e=0;e<s.length;e++)t=s[e],i[3*t.index()+1]=this.pv.y}if(Object(c.a)(this.pv.updateZ))if(this.p.z.hasExpression()&&this.p.z.expressionController)await this.p.z.expressionController.compute_expression_for_points(s,(t,e)=>{i[3*t.index()+2]=e});else{let t;for(let e=0;e<s.length;e++)t=s[e],i[3*t.index()+2]=this.pv.z}}_invert_normals(t){var e;for(let s of t.coreObjects()){const t=null===(e=s.coreGeometry())||void 0===e?void 0:e.geometry();if(t){const e=t.attributes[n.a.NORMAL];if(e){const t=e.array;for(let e=0;e<t.length;e++)t[e]*=-1}}}}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return c}));var r=s(30),i=s(173),n=s(4);class o extends n.a{}const a=new o;class c extends r.a{constructor(){super(...arguments),this.params_config=a}static type(){return"null"}initializeNode(){this.io.inputs.setCount(0,1),this.io.inputs.initInputsClonedState(i.a.INPUT_CLONED_STATE)}cook(t){this._operation=this._operation||new i.a(this.scene(),this.states);const e=this._operation.cook(t,this.pv);this.setCoreGroup(e)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return c}));var r=s(30),i=s(8),n=s(4);class o extends n.a{constructor(){super(...arguments),this.geometry=n.b.OPERATOR_PATH("",{nodeSelection:{context:i.g.SOP}})}}const a=new o;class c extends r.a{constructor(){super(...arguments),this.params_config=a}static type(){return"objectMerge"}initializeNode(){}async cook(t){const e=this.p.geometry.found_node();if(e)if(e.nodeContext()==i.g.SOP){const t=await e.requestContainer();this.import_input(e,t)}else this.states.error.set("found node is not a geometry");else this.states.error.set(`node not found at path '${this.pv.geometry}'`)}import_input(t,e){let s;null!=(s=e.coreContentCloned())?this.setCoreGroup(s):this.states.error.set("invalid target")}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return _}));var r=s(30),i=s(105),n=s(13),o=s(4);class a extends o.a{}const c=new a;class _ extends r.a{constructor(){super(...arguments),this.params_config=c,this._input_configs_by_operation_container=new WeakMap}static type(){return i.b}initializeNode(){this.io.inputs.initInputsClonedState(n.a.FROM_NODE)}set_output_operation_container(t){this._output_operation_container=t}output_operation_container(){return this._output_operation_container}add_input_config(t,e){let s=this._input_configs_by_operation_container.get(t);s||(s=new Map,this._input_configs_by_operation_container.set(t,s)),s.set(e.operation_input_index,e.node_input_index)}add_operation_container_with_path_param_resolve_required(t){this._operation_containers_requiring_resolve||(this._operation_containers_requiring_resolve=[]),this._operation_containers_requiring_resolve.push(t)}resolve_operation_containers_path_params(){if(this._operation_containers_requiring_resolve)for(let t of this._operation_containers_requiring_resolve)t.resolve_path_params(this)}async cook(t){if(this._output_operation_container){this._output_operation_container.setDirty();const e=await this._output_operation_container.compute(t,this._input_configs_by_operation_container);e&&this.setCoreGroup(e)}}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return _}));var r=s(30),i=s(13),n=s(4),o=s(10);class a extends n.a{constructor(){super(...arguments),this.updateX=n.b.BOOLEAN(0),this.x=n.b.FLOAT("@P.x",{visibleIf:{updateX:1},expression:{forEntities:!0}}),this.updateY=n.b.BOOLEAN(0),this.y=n.b.FLOAT("@P.y",{visibleIf:{updateY:1},expression:{forEntities:!0}}),this.updateZ=n.b.BOOLEAN(0),this.z=n.b.FLOAT("@P.z",{visibleIf:{updateZ:1},expression:{forEntities:!0}}),this.updateNormals=n.b.BOOLEAN(1)}}const c=new a;class _ extends r.a{constructor(){super(...arguments),this.params_config=c,this._x_arrays_by_geometry_uuid=new Map,this._y_arrays_by_geometry_uuid=new Map,this._z_arrays_by_geometry_uuid=new Map}static type(){return"point"}static displayedInputNames(){return["points to move"]}initializeNode(){this.io.inputs.setCount(1),this.io.inputs.initInputsClonedState(i.a.FROM_NODE)}async cook(t){const e=t[0];await this._eval_expressions_for_core_group(e)}async _eval_expressions_for_core_group(t){const e=t.coreObjects();for(let t=0;t<e.length;t++)await this._eval_expressions_for_core_object(e[t]);Object(o.a)(this.pv.updateNormals)&&t.computeVertexNormals();const s=t.geometries();for(let t of s)t.computeBoundingBox();if(!this.io.inputs.cloneRequired(0)){const e=t.geometries();for(let t of e){t.getAttribute("position").needsUpdate=!0}}this.setCoreGroup(t)}async _eval_expressions_for_core_object(t){const e=t.object().geometry,s=t.points(),r=e.getAttribute("position").array,i=await this._update_from_param(e,r,s,this.p.updateX,this.p.x,this.pv.x,this._x_arrays_by_geometry_uuid,0),n=await this._update_from_param(e,r,s,this.p.updateY,this.p.y,this.pv.y,this._y_arrays_by_geometry_uuid,1),o=await this._update_from_param(e,r,s,this.p.updateZ,this.p.z,this.pv.z,this._z_arrays_by_geometry_uuid,2);i&&this._commit_tmp_values(i,r,0),n&&this._commit_tmp_values(n,r,1),o&&this._commit_tmp_values(o,r,2)}async _update_from_param(t,e,s,r,i,n,o,a){const c=r,_=i;let l=this._init_array_if_required(t,o,s.length,a);if(c.value)if(_.hasExpression()&&_.expressionController)await _.expressionController.compute_expression_for_points(s,(t,e)=>{l[t.index()]=e});else{let t;for(let e=0;e<s.length;e++)t=s[e],l[t.index()]=n}return l}_init_array_if_required(t,e,s,r){const i=t.uuid,n=e.get(i);if(n){if(n.length<s){const n=this._array_for_component(t,s,r);return e.set(i,n),n}return n}{const n=this._array_for_component(t,s,r);return e.set(i,n),n}}_array_for_component(t,e,s){const r=new Array(e),i=t.getAttribute("position").array;for(let t=0;t<r.length;t++)r[t]=i[3*t+s];return r}_commit_tmp_values(t,e,s){for(let r=0;r<t.length;r++)e[3*r+s]=t[r]}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var r=s(171),i=s(8);class n extends r.a{constructor(){super(...arguments),this._children_controller_context=i.g.ROP}static type(){return i.f.ROP}createNode(t,e){return super.createNode(t,e)}children(){return super.children()}nodesByType(t){return super.nodesByType(t)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return u}));var r=s(17),i=s(13),n=s(168),o=s(22),a=s(7),c=s(10);const _="id",l="class",h="html";class u extends r.a{static type(){return"CSS2DObject"}cook(t,e){const s=t[0];if(s){const t=this._create_objects_from_input_points(s,e);return this.create_core_group_from_objects(t)}{const t=this._create_object_from_scratch(e);return this.create_core_group_from_objects([t])}}_create_objects_from_input_points(t,e){const s=t.points(),r=[];for(let t of s){const s=Object(c.a)(e.useIdAttrib)?t.attribValue(_):e.className,i=Object(c.a)(e.useClassAttrib)?t.attribValue(l):e.className,n=Object(c.a)(e.useHtmlAttrib)?t.attribValue(h):e.html,d=u.create_css_object({id:s,className:i,html:n}),p=d.element;if(Object(c.a)(e.copyAttributes)){const s=o.a.attribNames(e.attributesToCopy);for(let e of s){const s=t.attribValue(e);a.a.isString(s)?p.setAttribute(e,s):a.a.isNumber(s)&&p.setAttribute(e,""+s)}}d.position.copy(t.position()),d.updateMatrix(),r.push(d)}return r}_create_object_from_scratch(t){return u.create_css_object({id:t.id,className:t.className,html:t.html})}static create_css_object(t){const e=document.createElement("div");e.id=t.id,e.className=t.className,e.innerHTML=t.html;const s=new n.a(e);return s.matrixAutoUpdate=!1,s}}u.DEFAULT_PARAMS={useIdAttrib:!1,id:"my_css_object",useClassAttrib:!1,className:"CSS2DObject",useHtmlAttrib:!1,html:"<div>default html</div>",copyAttributes:!1,attributesToCopy:""},u.INPUT_CLONED_STATE=i.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return _}));var r=s(17),i=s(3),n=s(15),o=s(19),a=s(11),c=s(10);class _ extends r.a{static type(){return"add"}cook(t,e){const s=[];return this._create_point(s,e),this._create_polygon(t[0],s,e),this.create_core_group_from_objects(s)}_create_point(t,e){if(!Object(c.a)(e.createPoint))return;const s=new o.a,r=[];for(let t=0;t<e.pointsCount;t++)e.position.toArray(r,3*t);s.setAttribute("position",new a.a(new Float32Array(r),3));const i=this.create_object(s,n.l.POINTS);t&&t.push(i)}_create_polygon(t,e,s){if(!Object(c.a)(s.connectInputPoints))return;t.points().length>0&&this._create_polygon_open(t,e,s)}_create_polygon_open(t,e,s){const r=t.points();let i=[];const c=[];let _;for(let t=0;t<r.length;t++)_=r[t],_.position().toArray(i,3*t),t>0&&(c.push(t-1),c.push(t));if(r.length>2&&s.connectToLastPoint){r[0].position().toArray(i,i.length);const t=c[c.length-1];c.push(t),c.push(0)}const l=new o.a;l.setAttribute("position",new a.b(i,3)),l.setIndex(c);const h=this.create_object(l,n.l.LINE_SEGMENTS);e.push(h)}}_.DEFAULT_PARAMS={createPoint:!0,pointsCount:1,position:new i.a(0,0,0),connectInputPoints:!1,connectToLastPoint:!1}},function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var r=s(17),i=s(13);class n extends r.a{static type(){return"attribAddMult"}cook(t,e){const s=t[0],r=s.attribNamesMatchingMask(e.name);for(let t of r){const r=s.geometries();for(let s of r)this._update_attrib(t,s,e)}return s}_update_attrib(t,e,s){const r=e.getAttribute(t);if(r){const t=r.array,e=s.preAdd,i=s.mult,n=s.postAdd;for(let s=0;s<t.length;s++){const r=t[s];t[s]=(r+e)*i+n}r.needsUpdate=!0}}}n.DEFAULT_PARAMS={name:"",preAdd:0,mult:1,postAdd:0},n.INPUT_CLONED_STATE=i.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var r=s(17),i=s(11),n=s(13),o=s(10);class a extends r.a{static type(){return"attribCopy"}cook(t,e){const s=t[0],r=t[1]||s,i=r.attribNamesMatchingMask(e.name);for(let t of i)this.copy_vertex_attribute_between_core_groups(s,r,t,e);return s}copy_vertex_attribute_between_core_groups(t,e,s,r){var i;const n=e.objectsWithGeo(),o=t.objectsWithGeo();if(o.length>n.length)null===(i=this.states)||void 0===i||i.error.set("second input does not have enough objects to copy attributes from");else for(let t=0;t<o.length;t++){const e=o[t].geometry,i=o[t].geometry;this.copy_vertex_attribute_between_geometries(e,i,s,r)}}copy_vertex_attribute_between_geometries(t,e,s,r){var n,a;const c=e.getAttribute(s);if(c){const a=c.itemSize,_=e.getAttribute("position").array.length/3,l=t.getAttribute("position").array.length/3;l>_&&(null===(n=this.states)||void 0===n||n.error.set("not enough points in second input"));const h=Object(o.a)(r.tnewName)?r.newName:s;let u=t.getAttribute(h);if(u)this._fill_dest_array(u,c,r),u.needsUpdate=!0;else{const e=c.array.slice(0,l*a);t.setAttribute(h,new i.b(e,a))}}else null===(a=this.states)||void 0===a||a.error.set(`attribute '${s}' does not exist on second input`)}_fill_dest_array(t,e,s){const r=t.array,i=e.array,n=r.length,o=t.itemSize,a=e.itemSize,c=s.srcOffset,_=s.destOffset;if(t.itemSize==e.itemSize){t.copyArray(e.array);for(let t=0;t<n;t++)r[t]=i[t]}else{const t=r.length/o;if(o<a)for(let e=0;e<t;e++)for(let t=0;t<o;t++)r[e*o+t+_]=i[e*a+t+c];else for(let e=0;e<t;e++)for(let t=0;t<a;t++)r[e*o+t+_]=i[e*a+t+c]}}}a.DEFAULT_PARAMS={name:"",tnewName:!1,newName:"",srcOffset:0,destOffset:0},a.INPUT_CLONED_STATE=[n.a.FROM_NODE,n.a.NEVER]},function(t,e,s){"use strict";s.d(e,"a",(function(){return l}));var r,i=s(17),n=s(13),o=s(3),a=s(22),c=s(10);!function(t){t.MIN_MAX_TO_01="min/max to 0/1",t.VECTOR_TO_LENGTH_1="vectors to length 1"}(r||(r={}));const _=[r.MIN_MAX_TO_01,r.VECTOR_TO_LENGTH_1];class l extends i.a{constructor(){super(...arguments),this.min3=new o.a,this.max3=new o.a,this._vec=new o.a}static type(){return"attribNormalize"}cook(t,e){const s=t[0],r=t[0].objectsWithGeo(),i=a.a.attribNames(e.name);for(let t of r){const s=t.geometry;for(let t of i){const r=s.getAttribute(t);if(r){let t=r;Object(c.a)(e.changeName)&&""!=e.newName&&(t=s.getAttribute(e.newName),t&&(t.needsUpdate=!0),t=t||r.clone()),this._normalize_attribute(r,t,e)}}}return s}_normalize_attribute(t,e,s){switch(_[s.mode]){case r.MIN_MAX_TO_01:return this._normalize_from_min_max_to_01(t,e);case r.VECTOR_TO_LENGTH_1:return this._normalize_vectors(t,e)}}_normalize_from_min_max_to_01(t,e){const s=t.itemSize,r=t.array,i=e.array;switch(s){case 1:{const t=Math.min(...r),e=Math.max(...r);for(let s=0;s<i.length;s++)i[s]=(r[s]-t)/(e-t);return}case 3:{const t=r.length/s,e=new Array(t),n=new Array(t),o=new Array(t);let a=0;for(let i=0;i<t;i++)a=i*s,e[i]=r[a+0],n[i]=r[a+1],o[i]=r[a+2];this.min3.set(Math.min(...e),Math.min(...n),Math.min(...o)),this.max3.set(Math.max(...e),Math.max(...n),Math.max(...o));for(let r=0;r<t;r++)a=r*s,i[a+0]=(e[r]-this.min3.x)/(this.max3.x-this.min3.x),i[a+1]=(n[r]-this.min3.y)/(this.max3.y-this.min3.y),i[a+2]=(o[r]-this.min3.z)/(this.max3.z-this.min3.z);return}}}_normalize_vectors(t,e){const s=t.array,r=e.array,i=s.length;if(3==t.itemSize)for(let t=0;t<i;t+=3)this._vec.fromArray(s,t),this._vec.normalize(),this._vec.toArray(r,t)}}l.DEFAULT_PARAMS={mode:0,name:"position",changeName:!1,newName:""},l.INPUT_CLONED_STATE=n.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return l}));var r,i=s(17),n=s(13),o=s(15),a=s(22),c=s(25),_=s(31);!function(t){t[t.MIN=0]="MIN",t[t.MAX=1]="MAX",t[t.FIRST_FOUND=2]="FIRST_FOUND"}(r||(r={}));class l extends i.a{constructor(){super(...arguments),this._values_per_attrib_name={},this._filtered_values_per_attrib_name={}}static type(){return"attribPromote"}cook(t,e){this._core_group=t[0],this._values_per_attrib_name={},this._filtered_values_per_attrib_name={};for(let t of this._core_group.coreObjects())this._core_object=t,this.find_values(e),this.filter_values(e),this.set_values(e);return this._core_group}find_values(t){const e=a.a.attribNames(t.name);for(let s of e)this._find_values_for_attrib_name(s,t)}_find_values_for_attrib_name(t,e){switch(e.classFrom){case o.e.VERTEX:return this.find_values_from_points(t,e);case o.e.OBJECT:return this.find_values_from_object(t,e)}}find_values_from_points(t,e){if(this._core_object){const e=this._core_object.points(),s=e[0];if(s&&!s.isAttribIndexed(t)){const s=new Array(e.length);let r;for(let i=0;i<e.length;i++)r=e[i],s[i]=r.attribValue(t);this._values_per_attrib_name[t]=s}}}find_values_from_object(t,e){this._values_per_attrib_name[t]=[],this._core_object&&this._values_per_attrib_name[t].push(this._core_object.attribValue(t))}filter_values(t){const e=Object.keys(this._values_per_attrib_name);for(let s of e){const e=this._values_per_attrib_name[s];switch(t.mode){case r.MIN:this._filtered_values_per_attrib_name[s]=c.a.min(e);break;case r.MAX:this._filtered_values_per_attrib_name[s]=c.a.max(e);break;case r.FIRST_FOUND:this._filtered_values_per_attrib_name[s]=e[0]}}}set_values(t){const e=Object.keys(this._filtered_values_per_attrib_name);for(let s of e){const e=this._filtered_values_per_attrib_name[s];if(null!=e)switch(t.classTo){case o.e.VERTEX:this.set_values_to_points(s,e,t);break;case o.e.OBJECT:this.set_values_to_object(s,e,t)}}}set_values_to_points(t,e,s){if(this._core_group&&this._core_object){if(!this._core_group.hasAttrib(t)){const s=_.b.attribSizeFromValue(e);s&&this._core_group.addNumericVertexAttrib(t,s,e)}const s=this._core_object.points();for(let r of s)r.setAttribValue(t,e)}}set_values_to_object(t,e,s){var r;null===(r=this._core_object)||void 0===r||r.setAttribValue(t,e)}}l.DEFAULT_PARAMS={classFrom:o.e.VERTEX,classTo:o.e.OBJECT,mode:r.FIRST_FOUND,name:""},l.INPUT_CLONED_STATE=n.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return _}));var r=s(17),i=s(3),n=s(15),o=s(13),a=s(11),c=s(19);class _ extends r.a{constructor(){super(...arguments),this._geo_center=new i.a}static type(){return"center"}cook(t,e){var s;const r=t[0].objectsWithGeo(),i=new Array(3*r.length);i.fill(0);for(let t=0;t<r.length;t++){const e=r[t],n=e.geometry;n.computeBoundingBox(),n.boundingBox&&(null===(s=n.boundingBox)||void 0===s||s.getCenter(this._geo_center),e.updateMatrixWorld(),this._geo_center.applyMatrix4(e.matrixWorld),this._geo_center.toArray(i,3*t))}const o=new c.a;o.setAttribute("position",new a.a(new Float32Array(i),3));const _=this.create_object(o,n.l.POINTS);return this.create_core_group_from_objects([_])}}_.DEFAULT_PARAMS={},_.INPUT_CLONED_STATE=o.a.FROM_NODE},,function(t,e,s){"use strict";s.d(e,"a",(function(){return u}));var r=s(17),i=s(21),n=s(175),o=s(15),a=s(97),c=s(8),_=s(152),l=s(13),h=s(10);class u extends r.a{static type(){return"instance"}async cook(t,e){const s=t[0];this._geometry=void 0;const r=s.objectsWithGeo()[0];if(r){const s=r.geometry;if(s){const r=t[1];this._create_instance(s,r,e)}}if(this._geometry){const t=Object(o.m)(r);if(t){const s=this.create_object(this._geometry,t);if(Object(h.a)(e.applyMaterial)){const t=await this._get_material(e);t&&await this._applyMaterial(s,t)}return this.create_core_group_from_objects([s])}}return this.create_core_group_from_objects([])}async _get_material(t){var e;if(Object(h.a)(t.applyMaterial)){const s=t.material.ensure_node_context(c.g.MAT,null===(e=this.states)||void 0===e?void 0:e.error);if(s){this._globals_handler=this._globals_handler||new n.a;const t=s.assemblerController;t&&t.set_assembler_globals_handler(this._globals_handler);return(await s.requestContainer()).material()}}}async _applyMaterial(t,e){t.material=e,a.a.apply_custom_materials(t,e)}_create_instance(t,e,s){this._geometry=_.a.create_instance_buffer_geo(t,e,s.attributesToCopy)}}u.DEFAULT_PARAMS={attributesToCopy:"instance*",applyMaterial:!0,material:new i.c("")},u.INPUT_CLONED_STATE=[l.a.ALWAYS,l.a.NEVER]},function(t,e,s){"use strict";s.d(e,"a",(function(){return u}));var r=s(17),i=s(21),n=s(8),o=s(97),a=s(175),c=s(13),_=s(44),l=s(76),h=s(10);class u extends r.a{constructor(){super(...arguments),this._globals_handler=new a.a,this._old_mat_by_old_new_id=new Map,this._materials_by_uuid=new Map}static type(){return"material"}async cook(t,e){const s=t[0];return this._old_mat_by_old_new_id.clear(),await this._apply_materials(s,e),this._swap_textures(s,e),s}async _apply_materials(t,e){var s,r,i;if(!Object(h.a)(e.assignMat))return;const o=e.material.ensure_node_context(n.g.MAT,null===(s=this.states)||void 0===s?void 0:s.error);if(o){const s=o.material,i=o.assemblerController;if(i&&i.set_assembler_globals_handler(this._globals_handler),await o.requestContainer(),s){if(Object(h.a)(e.applyToChildren))for(let r of t.objects())r.traverse(t=>{this._apply_material(t,s,e)});else for(let r of t.objectsFromGroup(e.group))this._apply_material(r,s,e);return t}null===(r=this.states)||void 0===r||r.error.set(`material invalid. (error: '${o.states.error.message()}')`)}else null===(i=this.states)||void 0===i||i.error.set("no material node found")}_swap_textures(t,e){if(Object(h.a)(e.swapCurrentTex)){this._materials_by_uuid.clear();for(let s of t.objectsFromGroup(e.group))if(e.applyToChildren)s.traverse(t=>{const e=s.material;this._materials_by_uuid.set(e.uuid,e)});else{const t=s.material;this._materials_by_uuid.set(t.uuid,t)}this._materials_by_uuid.forEach((t,s)=>{this._swap_texture(t,e)})}}_apply_material(t,e,s){if(s.group&&!l.a.isInGroup(s.group,t))return;const r=Object(h.a)(s.cloneMat)?o.a.clone(e):e;if(e instanceof _.a&&r instanceof _.a)for(let t in e.uniforms)r.uniforms[t]=e.uniforms[t];const i=t;this._old_mat_by_old_new_id.set(r.uuid,i.material),i.material=r,o.a.apply_render_hook(t,r),o.a.apply_custom_materials(t,r)}_swap_texture(t,e){if(""==e.texSrc0||""==e.texDest0)return;let s=this._old_mat_by_old_new_id.get(t.uuid);s=s||t;const r=s[e.texSrc0];if(r){t[e.texDest0]=r;const s=t.uniforms;if(s){s[e.texDest0]&&(s[e.texDest0]={value:r})}}}}u.DEFAULT_PARAMS={group:"",assignMat:!0,material:new i.c("/MAT/mesh_standard1"),applyToChildren:!0,cloneMat:!1,shareUniforms:!0,swapCurrentTex:!1,texSrc0:"emissiveMap",texDest0:"map"},u.INPUT_CLONED_STATE=c.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var r=s(17),i=s(13),n=s(10);class o extends r.a{static type(){return"objectProperties"}cook(t,e){const s=t[0];for(let t of s.objects())e.applyToChildren?t.traverse(t=>{this._update_object(t,e)}):this._update_object(t,e);return s}_update_object(t,e){Object(n.a)(e.tname)&&(t.name=e.name),Object(n.a)(e.trenderOrder)&&(t.renderOrder=e.renderOrder),Object(n.a)(e.tfrustumCulled)&&(t.frustumCulled=e.frustumCulled),Object(n.a)(e.tmatrixAutoUpdate)&&(t.matrixAutoUpdate=e.matrixAutoUpdate),Object(n.a)(e.tvisible)&&(t.visible=e.visible),Object(n.a)(e.tcastShadow)&&(t.castShadow=e.castShadow),Object(n.a)(e.treceiveShadow)&&(t.receiveShadow=e.receiveShadow)}}o.DEFAULT_PARAMS={applyToChildren:!1,tname:!1,name:"",trenderOrder:!1,renderOrder:0,tfrustumCulled:!1,frustumCulled:!0,tmatrixAutoUpdate:!1,matrixAutoUpdate:!1,tvisible:!1,visible:!0,tcastShadow:!1,castShadow:!0,treceiveShadow:!1,receiveShadow:!0},o.INPUT_CLONED_STATE=i.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return d}));var r=s(17),i=s(6),n=s(3),o=s(77),a=s(37),c=s(13),_=s(10);const l=new n.a(0,0,1),h=new n.a(0,0,1),u=new n.a(0,1,0);class d extends r.a{constructor(){super(...arguments),this._core_transform=new a.a}static type(){return"plane"}cook(t,e){const s=t[0];return s?this._cook_with_input(s,e):this._cook_without_input(e)}_cook_without_input(t){const e=this._create_plane(t.size,t);this._core_transform.rotate_geometry(e,l,t.direction);const s=this._core_transform.translation_matrix(t.center);return e.applyMatrix4(s),this.create_core_group_from_geometry(e)}_cook_with_input(t,e){const s=t.boundingBox(),r=new n.a;s.getSize(r);const o=new n.a;s.getCenter(o);const a=new i.a(r.x,r.z),c=this._create_plane(a,e);this._core_transform.rotate_geometry(c,h,u);const _=this._core_transform.translation_matrix(o);return c.applyMatrix4(_),this.create_core_group_from_geometry(c)}_create_plane(t,e){let s=new i.a(1,1);return t=t.clone(),Object(_.a)(e.useSegmentsCount)?(s.x=Math.floor(e.segments.x),s.y=Math.floor(e.segments.y)):e.stepSize>0&&(s.x=Math.floor(t.x/e.stepSize),s.y=Math.floor(t.y/e.stepSize),t.x=s.x*e.stepSize,t.y=s.y*e.stepSize),new o.a(t.x,t.y,s.x,s.y)}}d.DEFAULT_PARAMS={size:new i.a(1,1),useSegmentsCount:!1,stepSize:1,segments:new i.a(1,1),direction:new n.a(0,1,0),center:new n.a(0,0,0)},d.INPUT_CLONED_STATE=c.a.NEVER},function(t,e,s){"use strict";s.d(e,"a",(function(){return d}));var r=s(17),i=s(3),n=s(23),o=s(27),a=s(37),c=s(13),_=s(29),l=s(295);const h=new i.a(0,1,0),u=new i.a(-1,0,0);class d extends r.a{constructor(){super(...arguments),this._centerMatrix=new n.a,this._longitudeMatrix=new n.a,this._latitudeMatrix=new n.a,this._depthMatrix=new n.a,this._fullMatrix=new n.a,this._decomposed={t:new i.a,q:new _.a,s:new i.a}}static type(){return"polarTransform"}cook(t,e){const s=t[0].objects(),r=this.matrix(e);return this._apply_transform(s,e,r),t[0]}_apply_transform(t,e,s){const r=a.d[e.applyOn];switch(r){case a.e.GEOMETRIES:return this._apply_matrix_to_geometries(t,s);case a.e.OBJECTS:return this._apply_matrix_to_objects(t,s)}o.a.unreachable(r)}_apply_matrix_to_geometries(t,e){for(let s of t){const t=s.geometry;t&&t.applyMatrix4(e)}}_apply_matrix_to_objects(t,e){for(let s of t)e.decompose(this._decomposed.t,this._decomposed.q,this._decomposed.s),s.position.copy(this._decomposed.t),s.quaternion.copy(this._decomposed.q),s.scale.copy(this._decomposed.s),s.updateMatrix()}matrix(t){return this._centerMatrix.identity(),this._longitudeMatrix.identity(),this._latitudeMatrix.identity(),this._depthMatrix.identity(),this._centerMatrix.makeTranslation(t.center.x,t.center.y,t.center.z),this._longitudeMatrix.makeRotationAxis(h,l.a.degToRad(t.longitude)),this._latitudeMatrix.makeRotationAxis(u,l.a.degToRad(t.latitude)),this._depthMatrix.makeTranslation(0,0,t.depth),this._fullMatrix.copy(this._centerMatrix).multiply(this._longitudeMatrix).multiply(this._latitudeMatrix).multiply(this._depthMatrix),this._fullMatrix}}d.DEFAULT_PARAMS={applyOn:a.d.indexOf(a.e.GEOMETRIES),center:new i.a(0,0,0),longitude:0,latitude:0,depth:1},d.INPUT_CLONED_STATE=c.a.FROM_NODE},,function(t,e,s){"use strict";s.d(e,"a",(function(){return u}));var r,i=s(17),n=s(297),o=s(298),a=s(6),c=s(3),_=s(13),l=s(10);!function(t){t.DEFAULT="default",t.ISOCAHEDRON="isocahedron"}(r||(r={}));const h=0;r.DEFAULT,r.ISOCAHEDRON;class u extends i.a{static type(){return"sphere"}cook(t,e){const s=t[0];return s?this._cook_with_input(s,e):this._cook_without_input(e)}_cook_without_input(t){const e=this._create_required_geometry(t);return e.translate(t.center.x,t.center.y,t.center.z),this.create_core_group_from_geometry(e)}_cook_with_input(t,e){const s=t.boundingBox(),r=s.max.clone().sub(s.min),i=s.max.clone().add(s.min).multiplyScalar(.5),n=this._create_required_geometry(e);return n.translate(e.center.x,e.center.y,e.center.z),n.translate(i.x,i.y,i.z),n.scale(r.x,r.y,r.z),this.create_core_group_from_geometry(n)}_create_required_geometry(t){return t.type==h?this._create_default_sphere(t):this._create_default_isocahedron(t)}_create_default_sphere(t){return Object(l.a)(t.open)?new n.a(t.radius,t.resolution.x,t.resolution.y,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength):new n.a(t.radius,t.resolution.x,t.resolution.y)}_create_default_isocahedron(t){return new o.a(t.radius,t.detail)}}u.DEFAULT_PARAMS={type:h,radius:1,resolution:new a.a(30,30),open:!1,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI,detail:1,center:new c.a(0,0,0)},u.INPUT_CLONED_STATE=_.a.FROM_NODE},,,function(t,e,s){"use strict";s.d(e,"a",(function(){return _}));var r=s(17),i=s(104),n=s(3),o=s(27),a=s(37),c=s(13);class _ extends r.a{constructor(){super(...arguments),this._core_transform=new a.a,this._point_pos=new n.a,this._object_position=new n.a}static type(){return"transform"}cook(t,e){const s=t[0].objects(),r=this._core_transform.matrix(e.t,e.r,e.s,e.scale,a.b[e.rotationOrder]);return this._apply_transform(s,e,r),t[0]}_apply_transform(t,e,s){const r=a.d[e.applyOn];switch(r){case a.e.GEOMETRIES:return this._apply_matrix_to_geometries(t,e,s);case a.e.OBJECTS:return this._apply_matrix_to_objects(t,s)}o.a.unreachable(r)}_apply_matrix_to_geometries(t,e,s){if(""===e.group.trim())for(let r of t){const t=r.geometry;t&&(t.translate(-e.pivot.x,-e.pivot.y,-e.pivot.z),t.applyMatrix4(s),t.translate(e.pivot.x,e.pivot.y,e.pivot.z))}else{const r=i.a._fromObjects(t).pointsFromGroup(e.group);for(let t of r){const r=t.getPosition(this._point_pos).sub(e.pivot);r.applyMatrix4(s),t.setPosition(r.add(e.pivot))}}}_apply_matrix_to_objects(t,e){for(let s of t)this._object_position.copy(s.position),s.position.multiplyScalar(0),s.updateMatrix(),s.applyMatrix4(e),s.position.add(this._object_position),s.updateMatrix()}}_.DEFAULT_PARAMS={applyOn:a.d.indexOf(a.e.GEOMETRIES),group:"",rotationOrder:a.b.indexOf(a.c.XYZ),t:new n.a(0,0,0),r:new n.a(0,0,0),s:new n.a(1,1,1),scale:1,pivot:new n.a(0,0,0)},_.INPUT_CLONED_STATE=c.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return j}));var r=s(21),i=s(81),n=s(122),o=s(20),a=s(7);class c{constructor(t){this.param=t,this._require_dependency=!1}require_dependency(){return this._require_dependency}node(){return this._node=this._node||this.param.node}static required_arguments(){return console.warn("Expression.Method._Base.required_arguments virtual method call. Please override"),[]}static optional_arguments(){return[]}static min_allowed_arguments_count(){return this.required_arguments().length}static max_allowed_arguments_count(){return this.min_allowed_arguments_count()+this.optional_arguments().length}static allowed_arguments_count(t){return t>=this.min_allowed_arguments_count()&&t<=this.max_allowed_arguments_count()}process_arguments(t){throw"Expression.Method._Base.process_arguments virtual method call. Please override"}async get_referenced_node_container(t){const e=this.get_referenced_node(t);if(e){let t;if(t=e.isDirty()?await e.requestContainer():e.containerController.container,t){if(t.coreContent())return t}throw"referenced node invalid: "+e.fullPath()}throw`invalid input (${t})`}get_referenced_param(t,e){const s=this.node();return s?r.a.find_param(s,t,e):null}find_referenced_graph_node(t,e){if(!a.a.isNumber(t)){const s=t;return this.get_referenced_node(s,e)}{const e=t,s=this.node();if(s){return s.io.inputs.input_graph_node(e)}}return null}get_referenced_node(t,e){let s=null;const i=this.node();if(a.a.isString(t)){if(i){const n=t;s=r.a.find_node(i,n,e)}}else if(i){const e=t;s=i.io.inputs.input(e)}return s||null}find_dependency(t){return null}create_dependency_from_index_or_path(t){const e=new i.a,s=this.find_referenced_graph_node(t,e);return s?this.create_dependency(s,t,e):(o.a.warn("node not found for path",t),null)}create_dependency(t,e,s){return n.a.create(this.param,e,t,s)}}var _=s(3);const l=["min","max","size","center"],h=["x","y","z"];class u extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to node"],["string","vector name, min, max, size or center"],["string","component_name, x,y or z"]]}find_dependency(t){return this.create_dependency_from_index_or_path(t)}process_arguments(t){let e=0;return new Promise(async(s,r)=>{if(t.length>=1){const i=t[0],n=t[1],o=t[2];let a=null;try{a=await this.get_referenced_node_container(i)}catch(t){r(t)}a&&(e=this._get_value_from_container(a,n,o),s(e))}else s(0)})}_get_value_from_container(t,e,s){const r=t.boundingBox();if(!e)return r;if(l.indexOf(e)>=0){let t=new _.a;switch(e){case"size":r.getSize(t);break;case"center":r.getCenter(t);break;default:t=r[e]}return s?h.indexOf(s)>=0?t[s]:-1:t}return-1}}class d extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to node"],["string","component_name, x,y or z"]]}find_dependency(t){return this.create_dependency_from_index_or_path(t)}process_arguments(t){return new Promise(async(e,s)=>{if(t.length>=1){const r=t[0],i=t[1];let n=null;try{n=await this.get_referenced_node_container(r)}catch(t){s(t)}if(n){const t=n.boundingBox(),s=t.min.clone().add(t.max).multiplyScalar(.5);if(i){const t=s[i];e(null!=t?t:0)}else e(s)}}else e(0)})}}class p extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to param"]]}find_dependency(t){const e=new i.a,s=this.get_referenced_param(t,e);return s?this.create_dependency(s,t,e):null}async process_arguments(t){return new Promise(async(e,s)=>{let r=0;if(1==t.length){const i=t[0],n=this.get_referenced_param(i);if(n){n.isDirty()&&await n.compute();const t=n.value;null!=t&&(r=t,e(r))}else s(0)}})}}var m=s(177);class f extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to copy"],["integer","default value"]]}static optional_arguments(){return[["string","attribute name (optional)"]]}find_dependency(t){const e=this.find_referenced_graph_node(t);if(e&&"copy"==e.type()){const s=e.stamp_node;return this.create_dependency(s,t)}return null}process_arguments(t){return new Promise((e,s)=>{if(2==t.length||3==t.length){const s=t[0],i=t[1],n=t[2],o=this.node(),a=o?r.a.find_node(o,s):null;let c;a&&a.type()==m.a.type()&&(c=a.stamp_value(n)),null==c&&(c=i),e(c)}else e(0)})}}class b extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to node"],["string","component_name: x or y"]]}find_dependency(t){return this.create_dependency_from_index_or_path(t)}async process_arguments(t){let e=0;if(2==t.length){const s=t[0],r=t[1],i=await this.get_referenced_node_container(s);if(i){const t=i.resolution();[0,"0","x"].includes(r)?e=t[0]:[1,"1","y"].includes(r)&&(e=t[1])}}return e}}class g extends c{static required_arguments(){return[["string","javascript expression"]]}async process_arguments(t){let e=0;if(1==t.length){const s=t[0];if(this._function=this._function||this._create_function(s),this._function)try{e=this._function(this.param.scene(),this.param.node,this.param)}catch(t){console.warn("expression error"),console.warn(t)}}return e}_create_function(t){return new Function("scene","node","param","return "+t)}}class v extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to node"],["string","attribute name"],["index","object index"]]}find_dependency(t){return this.create_dependency_from_index_or_path(t)}process_arguments(t){return new Promise(async(e,s)=>{if(3==t.length){const r=t[0],i=t[1],n=t[2];let o=null;try{o=await this.get_referenced_node_container(r)}catch(t){s(t)}if(o){e(this._get_value_from_container(o,i,n))}}else console.warn(t.length+" given when expected 3"),e(0)})}_get_value_from_container(t,e,s){const r=t.coreContent();if(r){const t=r.coreObjects()[s];return t?t.attribValue(e):0}return null}}class y extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to node"]]}find_dependency(t){return this.create_dependency_from_index_or_path(t)}process_arguments(t){return new Promise(async(e,s)=>{if(1==t.length){const r=t[0];let i;try{i=await this.get_referenced_node_container(r)}catch(t){return void s(t)}if(i){e(i.objectsCount())}}else e(0)})}}var x=s(22);class w extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to node"]]}find_dependency(t){const e=this.find_referenced_graph_node(t);if(e){const s=e;if(s.nameController){const e=s.nameController.graph_node;return this.create_dependency(e,t)}}return null}process_arguments(t){return new Promise((e,s)=>{if(1==t.length){const s=t[0],r=this.get_referenced_node(s);if(r){const t=r.name();e(x.a.tailDigits(t))}else e(0)}else e(0)})}}class E extends c{static required_arguments(){return[["string","number"]]}process_arguments(t){return new Promise(e=>{const s=t[0]||2;e((""+(t[1]||0)).padStart(s,"0"))})}}class O extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to node"],["string","attribute name"],["index","point index"]]}find_dependency(t){return this.create_dependency_from_index_or_path(t)}process_arguments(t){return new Promise(async(e,s)=>{if(3==t.length){const r=t[0],i=t[1],n=t[2];let o=null;try{o=await this.get_referenced_node_container(r)}catch(t){s(t)}if(o){e(this._get_value_from_container(o,i,n))}}else console.warn(t.length+" given when expected 3"),e(0)})}_get_value_from_container(t,e,s){const r=t.coreContent();if(r){const t=r.points()[s];return t?t.attribValue(e):0}return null}}class A extends c{constructor(){super(...arguments),this._require_dependency=!0}static required_arguments(){return[["string","path to node"]]}find_dependency(t){return this.create_dependency_from_index_or_path(t)}process_arguments(t){return new Promise(async(e,s)=>{if(1==t.length){const r=t[0];let i;try{i=await this.get_referenced_node_container(r)}catch(t){return void s(t)}if(i){e(i.pointsCount())}}else e(0)})}}class T extends c{static required_arguments(){return[["string","string to count characters of"]]}async process_arguments(t){let e=0;if(1==t.length){e=t[0].length}return e}}class C extends c{static required_arguments(){return[]}async process_arguments(t){let e="";for(let s of t)null==s&&(s=""),e+=""+s;return e}}class N extends c{static required_arguments(){return[["string","string to get index from"],["string","char to find index of"]]}async process_arguments(t){let e=-1;if(2==t.length){const s=t[0],r=t[1];e=s.indexOf(r)}return e}}class R extends c{static required_arguments(){return[["string","string to get range from"],["integer","range start"],["integer","range size"]]}async process_arguments(t){let e="";const s=t[0],r=t[1]||0;let i=t[2]||1;return s&&(e=s.substr(r,i)),e}}class j{static run(t){t.expressionsRegister.register(u,"bbox"),t.expressionsRegister.register(d,"centroid"),t.expressionsRegister.register(p,"ch"),t.expressionsRegister.register(f,"copy"),t.expressionsRegister.register(b,"copRes"),t.expressionsRegister.register(g,"js"),t.expressionsRegister.register(v,"object"),t.expressionsRegister.register(y,"objectsCount"),t.expressionsRegister.register(w,"opdigits"),t.expressionsRegister.register(E,"padzero"),t.expressionsRegister.register(O,"point"),t.expressionsRegister.register(A,"pointsCount"),t.expressionsRegister.register(T,"strCharsCount"),t.expressionsRegister.register(C,"strConcat"),t.expressionsRegister.register(N,"strIndex"),t.expressionsRegister.register(R,"strSub")}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return H}));var r=s(63),i=s(37),n=s(33);class o{constructor(t,e,s){this._camera_node_id=t,this._controls_node=e,this._controls=s,this._update_required=this._controls_node.update_required()}update_required(){return this._update_required}get camera_node_id(){return this._camera_node_id}get controls(){return this._controls}get controls_node(){return this._controls_node}is_equal(t){return t.camera_node_id==this._camera_node_id&&t.controls_node.graphNodeId()==this._controls_node.graphNodeId()}}var a=s(27),c=s(8);class _{constructor(t){this.node=t,this._applied_controls_by_element_id=new Map,this._controls_node=null}controls_param(){return this.node.params.has("controls")?this.node.params.get("controls"):null}async controls_node(){const t=this.node.p.controls,e=t.rawInput();if(e&&""!=e){t.isDirty()&&await t.compute();const e=t.value.node();if(e){if(c.a.includes(e.type()))return e;this.node.states.error.set("found node is not of a camera control type")}else this.node.states.error.set("no node has been found")}return null}async update_controls(){const t=await this.controls_node();t&&this._controls_node!=t&&this._dispose_control_refs(),this._controls_node=t}async apply_controls(t){const e=t.canvas();if(!e)return;const s=await this.controls_node();if(s){this._controlsEndEventName=s.endEventName();const r=s.controls_id();let i=!1,n=this._applied_controls_by_element_id.get(e.id);if(n&&n.get(r)&&(i=!0),!i){n=new Map,this._applied_controls_by_element_id.set(e.id,n),n.set(r,s);const i=await s.apply_controls(this.node.object,t);if(!i)return;const a=new o(this.node.graphNodeId(),s,i);return this.set_controls_events(i),a}}}_dispose_control_refs(){this._applied_controls_by_element_id.forEach((t,e)=>{this._dispose_controls_for_element_id(e)}),this._applied_controls_by_element_id.clear(),this._controlsEndEventName=void 0}_dispose_controls_for_element_id(t){const e=this._applied_controls_by_element_id.get(t);e&&e.forEach((e,s)=>{e.dispose_controls_for_html_element_id(t)}),this._applied_controls_by_element_id.delete(t)}async dispose_controls(t){this._dispose_controls_for_element_id(t.id)}set_controls_events(t){const e=I[this.node.pv.updateFromControlsMode];switch(e){case P.ON_END:return this._set_controls_events_to_update_on_end(t);case P.ALWAYS:return this._set_controls_events_to_update_always(t);case P.NEVER:return this._reset(t)}a.a.unreachable(e)}_reset(t){this.controls_change_listener&&(t.removeEventListener("change",this.controls_change_listener),this.controls_change_listener=void 0),this.controls_end_listener&&this._controlsEndEventName&&(t.removeEventListener(this._controlsEndEventName,this.controls_end_listener),this.controls_end_listener=void 0)}_set_controls_events_to_update_on_end(t){this._reset(t),this._controlsEndEventName&&(this.controls_end_listener=()=>{this.node.update_transform_params_from_object()},t.addEventListener(this._controlsEndEventName,this.controls_end_listener))}_set_controls_events_to_update_always(t){this._reset(t),this.controls_change_listener=()=>{this.node.update_transform_params_from_object()},t.addEventListener("change",this.controls_change_listener)}}var l=s(4);function h(t){return class extends t{constructor(){super(...arguments),this.layer=l.b.INTEGER(0,{range:[0,31],rangeLocked:[!0,!0]})}}}class u{constructor(t){this.node=t}update(){const t=this.node.object;t.layers.set(0),t.layers.enable(this.node.params.integer("layer"))}}const d={callback:t=>{U.PARAM_CALLBACK_reset_effects_composer(t)}};function p(t){return class extends t{constructor(){super(...arguments),this.doPostProcess=l.b.BOOLEAN(0),this.postProcessNode=l.b.NODE_PATH("./postProcess1",{visibleIf:{doPostProcess:1},nodeSelection:{types:[c.f.POST]},...d})}}}class m{constructor(t){this.node=t,this._composers_by_canvas_id={},this.node.p.postProcessNode?this._add_param_dirty_hook():this.node.params.onParamsCreated("post process add param dirty hook",()=>{this._add_param_dirty_hook()})}_add_param_dirty_hook(){this.node.p.postProcessNode.addPostDirtyHook("on_post_node_dirty",()=>{this.reset()})}render(t,e){const s=this.composer(t);s&&(e&&s.setSize(e.x,e.y),s.render())}reset(){const t=Object.keys(this._composers_by_canvas_id);for(let e of t)delete this._composers_by_canvas_id[e]}composer(t){return this._composers_by_canvas_id[t.id]=this._composers_by_canvas_id[t.id]||this._create_composer(t)}_create_composer(t){const e=this.node.renderController.renderer(t);if(e){const s=this.node.renderController.resolved_scene||this.node.scene().threejsScene(),r=this.node.object,i=this.node.p.postProcessNode.value.node();if(i){if(i.type()==c.f.POST){const n=i,o=this.node.renderController.canvas_resolution(t);return n.effectsComposerController.createEffectsComposer({renderer:e,scene:s,camera:r,resolution:o,requester:this.node,camera_node:this.node})}this.node.states.error.set("found node is not a post process node")}else this.node.states.error.set("no post node found")}}}var f=s(118),b=s(51),g=s(161),v=s(114),y=s(28);class x{constructor(t){this.viewer=t,this._active=!1,this._controls=null,this._bound_on_controls_start=this._on_controls_start.bind(this),this._bound_on_controls_end=this._on_controls_end.bind(this),this._update_graph_node()}controls(){return this._controls}async create_controls(){var t;this.dispose_controls();this.viewer.canvas()&&(this._config=await(null===(t=this.viewer.cameraControlsController)||void 0===t?void 0:t.apply_controls(this.viewer)),this._config&&(this._controls=this._config.controls,this._controls&&(this.viewer.active()?(this._controls.addEventListener("start",this._bound_on_controls_start),this._controls.addEventListener("end",this._bound_on_controls_end)):this.dispose_controls())))}update(){this._config&&this._controls&&this._config.update_required()&&this._controls.update()}dispose(){var t;null===(t=this._graph_node)||void 0===t||t.graphDisconnectPredecessors(),this.dispose_controls()}dispose_controls(){var t;if(this._controls){const e=this.viewer.canvas();e&&(null===(t=this.viewer)||void 0===t||t.cameraControlsController.dispose_controls(e)),this._bound_on_controls_start&&this._controls.removeEventListener("start",this._bound_on_controls_start),this._bound_on_controls_end&&this._controls.removeEventListener("end",this._bound_on_controls_end),this._controls.dispose(),this._controls=null}}_on_controls_start(){this._active=!0}_on_controls_end(){this._active=!1}_update_graph_node(){const t=this.viewer.cameraNode().p.controls;this._graph_node=this._graph_node||this._create_graph_node(),this._graph_node&&(this._graph_node.graphDisconnectPredecessors(),this._graph_node.addGraphInput(t))}_create_graph_node(){const t=new y.a(this.viewer.cameraNode().scene(),"viewer-controls");return t.addPostDirtyHook("this.viewer.controls_controller",async()=>{await this.viewer.controlsController.create_controls()}),t}}var w=s(6);class E{constructor(t){this._viewer=t,this._size=new w.a(100,100),this._aspect=1}cameraNode(){return this._viewer.cameraNode()}get size(){return this._size}get aspect(){return this._aspect}computeSizeAndAspect(){this._update_size(),this.cameraNode().scene().uniforms_controller.update_resolution_dependent_uniform_owners(this._size),this._aspect=this._get_aspect()}_update_size(){this._size.x=this._viewer.container().offsetWidth,this._size.y=this._viewer.container().offsetHeight}_get_aspect(){return this._size.x/this._size.y}updateCameraAspect(){this.cameraNode().setup_for_aspect_ratio(this._aspect)}async prepareCurrentCamera(){await this.cameraNode().requestContainer(),await this._update_from_camera_container()}async _update_from_camera_container(){var t;this.updateCameraAspect(),await(null===(t=this._viewer.controlsController)||void 0===t?void 0:t.create_controls())}}class O{constructor(t){this.viewer=t,this._bound_process_event=this.process_event.bind(this),this._bound_listener_map_by_event_controller_type=new Map}updateEvents(t){const e=this.canvas();if(!e)return;const s=t.type();let r=this._bound_listener_map_by_event_controller_type.get(s);r||(r=new Map,this._bound_listener_map_by_event_controller_type.set(s,r)),r.forEach((t,s)=>{e.removeEventListener(s,t)}),r.clear();const i=e=>{this.process_event(e,t)};for(let s of t.activeEventTypes())e.addEventListener(s,i),r.set(s,i)}cameraNode(){return this.viewer.camerasController.cameraNode()}canvas(){return this.viewer.canvas()}init(){this.canvas&&this.viewer.scene().eventsDispatcher.traverseControllers(t=>{this.updateEvents(t)})}registeredEventTypes(){const t=[];return this._bound_listener_map_by_event_controller_type.forEach(e=>{e.forEach((e,s)=>{t.push(s)})}),t}dispose(){const t=this.canvas();this._bound_listener_map_by_event_controller_type.forEach(e=>{t&&e.forEach((e,s)=>{t.removeEventListener(s,e)})})}process_event(t,e){if(!this.canvas())return;const s={viewer:this.viewer,event:t,cameraNode:this.cameraNode()};e.processEvent(s)}}class A{constructor(t){this.viewer=t}init(){const t=this.viewer.canvas();t&&(t.onwebglcontextlost=this._on_webglcontextlost.bind(this),t.onwebglcontextrestored=this._on_webglcontextrestored.bind(this))}_on_webglcontextlost(){console.warn("context lost at frame",this.viewer.scene().frame()),this.request_animation_frame_id?cancelAnimationFrame(this.request_animation_frame_id):console.warn("request_animation_frame_id not initialized"),console.warn("not canceled",this.request_animation_frame_id)}_on_webglcontextrestored(){console.log("context restored")}}class T{constructor(t,e,s){this._container=t,this._scene=e,this._camera_node=s,this._active=!1,this._id=T._next_viewer_id++,this._scene.viewersRegister.registerViewer(this)}active(){return this._active}activate(){this._active=!0}deactivate(){this._active=!1}get camerasController(){return this._cameras_controller=this._cameras_controller||new E(this)}get controlsController(){return this._controls_controller}get eventsController(){return this._events_controller=this._events_controller||new O(this)}get webglController(){return this._webgl_controller=this._webgl_controller||new A(this)}container(){return this._container}scene(){return this._scene}canvas(){return this._canvas}cameraNode(){return this._camera_node}get cameraControlsController(){}id(){return this._id}dispose(){let t;for(this._scene.viewersRegister.unregisterViewer(this),this.eventsController.dispose();t=this._container.children[0];)this._container.removeChild(t)}resetContainerClass(){this.container().classList.remove("hovered")}setContainerClassHovered(){this.container().classList.add("hovered")}}T._next_viewer_id=0;class C extends T{constructor(t,e,s,r){super(t,e,s),this._scene=e,this._camera_node=s,this._properties=r,this._do_render=!0,this._animate_method=this.animate.bind(this),this._do_render=null==this._properties||this._properties.autoRender,this._canvas=document.createElement("canvas"),this._canvas.id=("canvas_id_"+Math.random()).replace(".","_"),this._canvas.style.display="block",this._canvas.style.outline="none",this._container.appendChild(this._canvas),this._container.classList.add("CoreThreejsViewer"),this._build(),this._set_events()}get controlsController(){return this._controls_controller=this._controls_controller||new x(this)}_build(){this._init_display(),this.activate()}onBeforeTick(t){this._onBeforeTick=t}onAfterTick(t){this._onAfterTick=t}onBeforeRender(t){this._onBeforeRender=t}onAfterRender(t){this._onAfterRender=t}dispose(){this._cancel_animate(),this.controlsController.dispose(),super.dispose()}get cameraControlsController(){return this._camera_node.controls_controller}_set_events(){this.eventsController.init(),this.webglController.init(),window.onresize=()=>{this.onResize()}}onResize(){const t=this.canvas();t&&(this.camerasController.computeSizeAndAspect(),this._camera_node.renderController.set_renderer_size(t,this.camerasController.size),this.camerasController.updateCameraAspect())}_init_display(){if(!this._canvas)return void console.warn("no canvas found for viewer");this.camerasController.computeSizeAndAspect();const t=this.camerasController.size;this._camera_node.renderController.createRenderer(this._canvas,t),this.camerasController.prepareCurrentCamera(),this.animate()}setAutoRender(t=!0){this._do_render=t,this._do_render&&this.animate()}animate(){var t;this._do_render&&(this._request_animation_frame_id=requestAnimationFrame(this._animate_method),this._onBeforeTick&&this._onBeforeTick(),this._scene.timeController.incrementTimeIfPlaying(),this._onAfterTick&&this._onAfterTick(),this.render(),null===(t=this._controls_controller)||void 0===t||t.update())}_cancel_animate(){this._do_render=!1,this._request_animation_frame_id&&cancelAnimationFrame(this._request_animation_frame_id),this._canvas&&this._camera_node.renderController.delete_renderer(this._canvas)}render(){if(this.camerasController.cameraNode&&this._canvas){this._onBeforeRender&&this._onBeforeRender();const t=this.camerasController.size,e=this.camerasController.aspect;this._camera_node.renderController.render(this._canvas,t,e),this._onAfterRender&&this._onAfterRender()}else console.warn("no camera to render with")}renderer(){if(this._canvas)return this._camera_node.renderController.renderer(this._canvas)}}var N=s(39),R=s(64),j=s(7);const S={type:"change"},M=1,L=100;var P;!function(t){t.ON_END="on move end",t.ALWAYS="always",t.NEVER="never"}(P||(P={}));const I=[P.ON_END,P.ALWAYS,P.NEVER];function k(t){return class extends t{constructor(){super(...arguments),this.setMasterCamera=l.b.BUTTON(null,{callback:(t,e)=>{D.PARAM_CALLBACK_setMasterCamera(t)}})}}}function B(t){return class extends t{constructor(){super(...arguments),this.camera=l.b.FOLDER(),this.controls=l.b.NODE_PATH("",{nodeSelection:{context:c.g.EVENT}}),this.updateFromControlsMode=l.b.INTEGER(I.indexOf(P.ON_END),{menu:{entries:I.map((t,e)=>({name:t,value:e}))}}),this.near=l.b.FLOAT(M,{range:[0,100],cook:!1,computeOnDirty:!0,callback:(t,e)=>{U.PARAM_CALLBACK_update_near_far_from_param(t,e)}}),this.far=l.b.FLOAT(L,{range:[0,100],cook:!1,computeOnDirty:!0,callback:(t,e)=>{U.PARAM_CALLBACK_update_near_far_from_param(t,e)}}),this.display=l.b.BOOLEAN(1)}}}k(l.a);p(Object(f.a)(Object(b.b)(h(B(k(l.a))))));class F extends n.b{constructor(){super(...arguments),this.renderOrder=n.a.CAMERA,this._aspect=-1}get object(){return this._object}async cook(){this.update_camera(),this._object.dispatchEvent(S),this.cookController.end_cook()}on_create(){}on_delete(){}prepare_raycaster(t,e){}camera(){return this._object}update_camera(){}static PARAM_CALLBACK_setMasterCamera(t){t.set_as_master_camera()}set_as_master_camera(){this.scene().camerasController.setMasterCameraNodePath(this.fullPath())}setup_for_aspect_ratio(t){}_update_for_aspect_ratio(){}update_transform_params_from_object(){i.a.set_params_from_object(this._object,this)}static PARAM_CALLBACK_update_from_param(t,e){t.object[e.name()]=t.pv[e.name()]}}class z extends F{constructor(){super(...arguments),this.flags=new N.c(this),this.hierarchyController=new R.a(this),this.transformController=new b.a(this),this.childrenDisplayController=new g.a(this),this.displayNodeController=new v.a(this,this.childrenDisplayController.displayNodeControllerCallbacks()),this._children_controller_context=c.g.SOP}get controls_controller(){return this._controls_controller=this._controls_controller||new _(this)}get layers_controller(){return this._layers_controller=this._layers_controller||new u(this)}get renderController(){return this._render_controller=this._render_controller||new f.b(this)}get postProcessController(){return this._post_process_controller=this._post_process_controller||new m(this)}initializeBaseNode(){super.initializeBaseNode(),this.io.outputs.set_has_one_output(),this.hierarchyController.initializeNode(),this.transformController.initializeNode(),this.childrenDisplayController.initializeNode()}createNode(t,e){return super.createNode(t,e)}children(){return super.children()}nodesByType(t){return super.nodesByType(t)}prepare_raycaster(t,e){e.setFromCamera(t,this._object)}async cook(){this.transformController.update(),this.layers_controller.update(),this.update_near_far(),this.renderController.update(),this.update_camera(),this.controls_controller.update_controls(),this._object.dispatchEvent(S),this.cookController.end_cook()}static PARAM_CALLBACK_update_near_far_from_param(t,e){t.update_near_far()}update_near_far(){this._object.near==this.pv.near&&this._object.far==this.pv.far||(this._object.near=this.pv.near,this._object.far=this.pv.far,this._object.updateProjectionMatrix())}setup_for_aspect_ratio(t){j.a.isNaN(t)||t&&this._aspect!=t&&(this._aspect=t,this._update_for_aspect_ratio())}createViewer(t,e){return new C(t,this.scene(),this,e)}static PARAM_CALLBACK_reset_effects_composer(t){t.postProcessController.reset()}}class D extends F{}class U extends z{PARAM_CALLBACK_update_effects_composer(t){}}const G=50;class V extends(p(Object(f.a)(h(k(function(t){return class extends t{constructor(){super(...arguments),this.fov=l.b.FLOAT(G,{range:[0,100]})}}}(B(Object(b.b)(l.a,{matrixAutoUpdate:!0})))))))){}const q=new V;class H extends z{constructor(){super(...arguments),this.params_config=q}static type(){return c.c.PERSPECTIVE}create_object(){return new r.a(G,1,M,L)}update_camera(){this._object.fov!=this.pv.fov&&(this._object.fov=this.pv.fov,this._object.updateProjectionMatrix()),this._update_for_aspect_ratio()}_update_for_aspect_ratio(){this._aspect&&(this._object.aspect=this._aspect,this._object.updateProjectionMatrix())}}},,function(t,e,s){"use strict";s.d(e,"a",(function(){return U}));var r=s(38),i=s(8),n=s(39),o=s(101),a=s(5);const c=["input texture","input texture","input texture","input texture"];for(var _=new Uint16Array(32),l=0;l<32;l++)_[l]=28898;const h=new o.a(_,32,1,a.Z,a.L);class u extends r.a{constructor(t){super(t,"BaseCopNode"),this.flags=new n.b(this)}static nodeContext(){return i.g.COP}static displayedInputNames(){return c}initializeBaseNode(){this.io.outputs.set_has_one_output()}set_texture(t){t.name=this.fullPath(),this.setContainer(t)}clear_texture(){this.setContainer(h)}}class d extends u{}var p=s(260),m=s(317),f=s(21),b=s(20),g=s(120),v=s(154);const y="https://raw.githubusercontent.com/polygonjs/polygonjs-assets/master/";var x;!function(t){t.JPG="jpg",t.JPEG="jpeg",t.PNG="png",t.EXR="exr",t.BASIS="basis",t.HDR="hdr"}(x||(x={}));x.JPEG,x.JPG,x.PNG,x.EXR,x.BASIS,x.HDR;class w{constructor(t,e){this._node=t,this._param=e}async load_texture_from_url_or_op(t,e){let s,r=null;if("op:"==t.substring(0,3)){const e=t.substring(3);if(s=f.a.find_node(this._node,e),s)if(s instanceof d){r=(await s.requestContainer()).texture()}else this._node.states.error.set("found node is not a texture node");else this._node.states.error.set(`no node found in path '${e}'`)}else r=await this.load_url(t,e),r?this._param.options.texture_as_env()||(r=w.set_texture_for_mapping(r)):this._node.states.error.set("could not load texture "+t);return s&&this._param.graphPredecessors()[0]!=s&&(this._param.graphDisconnectPredecessors(),this._param.addGraphInput(s)),r}async load_url(t,e){return new Promise(async(s,r)=>{const i=w.get_extension(t);if("h"!=t[0]){const e=this._node.scene().assets.root();e&&(t=`${e}${t}`)}if(w.VIDEO_EXTENSIONS.includes(i)){const e=await this._load_as_video(t);s(e)}else this.loader_for_ext(i,e).then(async e=>{e?(w.increment_in_progress_loads_count(),await w.wait_for_max_concurrent_loads_queue_freed(),e.load(t,t=>{w.decrement_in_progress_loads_count(),s(t)},void 0,t=>{w.decrement_in_progress_loads_count(),b.a.warn("error",t),r()})):r()})})}static module_names(t){switch(t){case x.EXR:return[g.b.EXRLoader];case x.HDR:return[g.b.RGBELoader];case x.BASIS:return[g.b.BasisTextureLoader]}}async loader_for_ext(t,e){switch(t.toLowerCase()){case x.EXR:return await this._exr_loader(e);case x.HDR:return await this._hdr_loader(e);case x.BASIS:return await this._basis_loader()}return new m.a}async _exr_loader(t){const e=await b.a.modulesRegister.module(g.b.EXRLoader);if(e){const s=new e.EXRLoader;return t.tdataType&&s.setDataType(t.dataType),s}}async _hdr_loader(t){const e=await b.a.modulesRegister.module(g.b.RGBELoader);if(e){const s=new e.RGBELoader;return t.tdataType&&s.setDataType(t.dataType),s}}async _basis_loader(){const t=await b.a.modulesRegister.module(g.b.BasisTextureLoader);if(t){const e=new t.BasisTextureLoader;e.setTranscoderPath("/three/js/libs/basis/");const s=await b.a.renderersController.waitForRenderer();return s?e.detectSupport(s):b.a.warn("texture loader found no renderer for basis texture loader"),e}}_load_as_video(t){return new Promise((e,s)=>{const r=document.createElement("video");r.setAttribute("crossOrigin","anonymous"),r.setAttribute("autoplay","true"),r.setAttribute("loop","true"),r.onloadedmetadata=function(){r.pause();const t=new p.a(r);e(t)};const i=document.createElement("source"),n=w.get_extension(t);let o=w.VIDEO_SOURCE_TYPE_BY_EXT[n];o=o||w._default_video_source_type(t),i.setAttribute("type",o),i.setAttribute("src",t),r.appendChild(i);let a=t;a="mp4"==n?w.replace_extension(t,"ogv"):w.replace_extension(t,"mp4");const c=document.createElement("source"),_=w.get_extension(a);o=w.VIDEO_SOURCE_TYPE_BY_EXT[_],o=o||w._default_video_source_type(t),c.setAttribute("type",o),c.setAttribute("src",t),r.appendChild(c)})}static _default_video_source_type(t){return"video/"+this.get_extension(t)}static pixel_data(t){const e=t.image,s=document.createElement("canvas");s.width=e.width,s.height=e.height;const r=s.getContext("2d");if(r)return r.drawImage(e,0,0,e.width,e.height),r.getImageData(0,0,e.width,e.height)}static get_extension(t){const e=t.split("?")[0].split(".");return e[e.length-1].toLowerCase()}static replace_extension(t,e){const s=t.split("?"),r=s[0].split(".");return r.pop(),r.push(e),[r.join("."),s[1]].join("?")}static set_texture_for_mapping(t){return t}static _init_max_concurrent_loads_count(){return v.a.isChrome()?10:4}static _init_concurrent_loads_delay(){return v.a.isChrome()?0:10}static override_max_concurrent_loads_count(t){this.MAX_CONCURRENT_LOADS_COUNT=t}static increment_in_progress_loads_count(){this.in_progress_loads_count++}static decrement_in_progress_loads_count(){this.in_progress_loads_count--;const t=this._queue.pop();if(t){const e=this.CONCURRENT_LOADS_DELAY;setTimeout(()=>{t()},e)}}static async wait_for_max_concurrent_loads_queue_freed(){return this.in_progress_loads_count<=this.MAX_CONCURRENT_LOADS_COUNT?void 0:new Promise(t=>{this._queue.push(t)})}}w.PARAM_DEFAULT=y+"/textures/uv.jpg",w.PARAM_ENV_DEFAULT=y+"/textures/piz_compressed.exr",w.VIDEO_EXTENSIONS=["mp4","webm","ogv"],w.VIDEO_SOURCE_TYPE_BY_EXT={ogg:'video/ogg; codecs="theora, vorbis"',ogv:'video/ogg; codecs="theora, vorbis"',mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'},w.MAX_CONCURRENT_LOADS_COUNT=w._init_max_concurrent_loads_count(),w.CONCURRENT_LOADS_DELAY=w._init_concurrent_loads_delay(),w.in_progress_loads_count=0,w._queue=[];var E=s(4),O=s(147),A=s(155),T=s(116),C=s(10);class N extends E.a{constructor(){super(...arguments),this.useCameraRenderer=E.b.BOOLEAN(0)}}new N;class R{constructor(t){this.node=t}async renderer(){return Object(C.a)(this.node.pv.useCameraRenderer)?await this.camera_renderer():this._renderer=this._renderer||this._create_renderer()}reset(){var t;null===(t=this._renderer)||void 0===t||t.dispose(),this._renderer=void 0}async camera_renderer(){let t=b.a.renderersController.firstRenderer();return t||await b.a.renderersController.waitForRenderer()}save_state(){this.make_linear()}make_linear(){}restore_state(){}_create_renderer(){const t=new T.a;return t.toneMapping=a.W,t.setPixelRatio(1),t}}const j=[{AlphaFormat:a.e},{RedFormat:a.kc},{RedIntegerFormat:a.lc},{RGFormat:a.ic},{RGIntegerFormat:a.jc},{RGBFormat:a.Zb},{RGBIntegerFormat:a.ac},{RGBAFormat:a.Ab},{RGBAIntegerFormat:a.Bb},{LuminanceFormat:a.Z},{LuminanceAlphaFormat:a.Y},{DepthFormat:a.w},{DepthStencilFormat:a.x}],S=[{UnsignedByteType:a.Qc},{ByteType:a.k},{ShortType:a.Dc},{UnsignedShortType:a.Wc},{IntType:a.M},{UnsignedIntType:a.Sc},{FloatType:a.F},{HalfFloatType:a.L},{UnsignedShort4444Type:a.Tc},{UnsignedShort5551Type:a.Uc},{UnsignedShort565Type:a.Vc},{UnsignedInt248Type:a.Rc}],M=[{UVMapping:a.Pc},{CubeReflectionMapping:a.n},{CubeRefractionMapping:a.o},{EquirectangularReflectionMapping:a.C},{EquirectangularRefractionMapping:a.D},{CubeUVReflectionMapping:a.p},{CubeUVRefractionMapping:a.q}],L=[{LinearEncoding:a.Q},{sRGBEncoding:a.cd},{GammaEncoding:a.I},{RGBEEncoding:a.Yb},{LogLuvEncoding:a.X},{RGBM7Encoding:a.cc},{RGBM16Encoding:a.bc},{RGBDEncoding:a.Xb},{BasicDepthPacking:a.i},{RGBADepthPacking:a.zb}],P=[{ClampToEdgeWrapping:a.m},{RepeatWrapping:a.nc},{MirroredRepeatWrapping:a.db}];function I(t){return class extends t{constructor(){super(...arguments),this.tencoding=E.b.BOOLEAN(0),this.encoding=E.b.INTEGER(a.Q,{visibleIf:{tencoding:1},menu:{entries:L.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}}),this.tmapping=E.b.BOOLEAN(0),this.mapping=E.b.INTEGER(a.Pc,{visibleIf:{tmapping:1},menu:{entries:M.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}}),this.twrap=E.b.BOOLEAN(0),this.wrapS=E.b.INTEGER(Object.values(P[0])[0],{visibleIf:{twrap:1},menu:{entries:P.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}}),this.wrapT=E.b.INTEGER(Object.values(P[0])[0],{visibleIf:{twrap:1},menu:{entries:P.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}}),this.wrapSep=E.b.SEPARATOR(null,{visibleIf:{twrap:1}}),this.tminFilter=E.b.BOOLEAN(0),this.minFilter=E.b.INTEGER(A.c,{visibleIf:{tminFilter:1},menu:{entries:A.d}}),this.tmagFilter=E.b.BOOLEAN(0),this.magFilter=E.b.INTEGER(A.a,{visibleIf:{tmagFilter:1},menu:{entries:A.b}}),this.tanisotropy=E.b.BOOLEAN(0),this.useRendererMaxAnisotropy=E.b.BOOLEAN(1,{visibleIf:{tanisotropy:1}}),this.anisotropy=E.b.INTEGER(1,{visibleIf:{tanisotropy:1,useRendererMaxAnisotropy:0},range:[0,32],rangeLocked:[!0,!1]}),this.useCameraRenderer=E.b.BOOLEAN(0,{visibleIf:{tanisotropy:1,useRendererMaxAnisotropy:1}}),this.anisotropySep=E.b.SEPARATOR(null,{visibleIf:{tanisotropy:1}}),this.tflipY=E.b.BOOLEAN(0),this.flipY=E.b.BOOLEAN(0,{visibleIf:{tflipY:1}}),this.ttransform=E.b.BOOLEAN(0),this.offset=E.b.VECTOR2([0,0],{visibleIf:{ttransform:1},cook:!1,callback:t=>{B.PARAM_CALLBACK_update_offset(t)}}),this.repeat=E.b.VECTOR2([1,1],{visibleIf:{ttransform:1},cook:!1,callback:t=>{B.PARAM_CALLBACK_update_repeat(t)}}),this.rotation=E.b.FLOAT(0,{range:[-1,1],visibleIf:{ttransform:1},cook:!1,callback:t=>{B.PARAM_CALLBACK_update_rotation(t)}}),this.center=E.b.VECTOR2([0,0],{visibleIf:{ttransform:1},cook:!1,callback:t=>{B.PARAM_CALLBACK_update_center(t)}}),this.tadvanced=E.b.BOOLEAN(0),this.tformat=E.b.BOOLEAN(0,{visibleIf:{tadvanced:1}}),this.format=E.b.INTEGER(a.Ab,{visibleIf:{tadvanced:1,tformat:1},menu:{entries:j.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}}),this.ttype=E.b.BOOLEAN(0,{visibleIf:{tadvanced:1}}),this.type=E.b.INTEGER(a.Qc,{visibleIf:{tadvanced:1,ttype:1},menu:{entries:S.map(t=>({name:Object.keys(t)[0],value:Object.values(t)[0]}))}})}}}class k extends(I(E.a)){}new k;class B{constructor(t){this.node=t}update(t){const e=this.node.pv;Object(C.a)(e.tencoding)&&(t.encoding=e.encoding),Object(C.a)(e.tadvanced)&&(Object(C.a)(e.tformat)&&(t.format=e.format),Object(C.a)(e.ttype)&&(t.type=e.type)),Object(C.a)(e.tmapping)&&(t.mapping=e.mapping),Object(C.a)(e.twrap)&&(t.wrapS=e.wrapS,t.wrapT=e.wrapT),Object(C.a)(e.tminFilter)&&(t.minFilter=e.minFilter),Object(C.a)(e.tminFilter)&&(t.magFilter=e.magFilter),this._update_anisotropy(t),t.flipY=e.tflipY&&e.flipY,this._update_texture_transform(t)}async _update_anisotropy(t){const e=this.node.pv;if(!Object(C.a)(e.tanisotropy))return;this._renderer_controller=this._renderer_controller||new R(this.node);const s=(await this._renderer_controller.renderer()).capabilities.getMaxAnisotropy();Object(C.a)(e.useRendererMaxAnisotropy)?t.anisotropy=s:t.anisotropy=Math.min(e.anisotropy,s)}_update_texture_transform(t){Object(C.a)(this.node.pv.ttransform)&&(this._update_offset(t,!1),this._update_repeat(t,!1),this._update_rotation(t,!1),this._update_center(t,!1),t.updateMatrix())}_update_offset(t,e){t.offset.copy(this.node.pv.offset),e&&t.updateMatrix()}_update_repeat(t,e){t.repeat.copy(this.node.pv.repeat),e&&t.updateMatrix()}_update_rotation(t,e){t.rotation=this.node.pv.rotation,e&&t.updateMatrix()}_update_center(t,e){t.center.copy(this.node.pv.center),e&&t.updateMatrix()}static PARAM_CALLBACK_update_offset(t){const e=t.containerController.container.texture();t.texture_params_controller._update_offset(e,!0)}static PARAM_CALLBACK_update_repeat(t){const e=t.containerController.container.texture();t.texture_params_controller._update_repeat(e,!0)}static PARAM_CALLBACK_update_rotation(t){const e=t.containerController.container.texture();t.texture_params_controller._update_rotation(e,!0)}static PARAM_CALLBACK_update_center(t){const e=t.containerController.container.texture();t.texture_params_controller._update_center(e,!0)}}const F=["mp4","ogv"];class z extends(I(function(t){return class extends t{constructor(){super(...arguments),this.url=E.b.STRING(w.PARAM_DEFAULT,{fileBrowse:{type:[O.a.TEXTURE_IMAGE]}}),this.reload=E.b.BUTTON(null,{callback:(t,e)=>{U.PARAM_CALLBACK_reload(t,e)}})}}}(E.a))){}const D=new z;class U extends u{constructor(){super(...arguments),this.params_config=D,this.texture_params_controller=new B(this)}static type(){return"image"}async requiredModules(){this.p.url.isDirty()&&await this.p.url.compute();const t=w.get_extension(this.pv.url||"");return w.module_names(t)}initializeNode(){this.scene().dispatchController.onAddListener(()=>{this.params.onParamsCreated("params_label",()=>{this.params.label.init([this.p.url],()=>{const t=this.pv.url;if(t){const e=t.split("/");return e[e.length-1]}return""})})})}async cook(){(class{static is_static_image_url(t){const e=t.split("?")[0].split("."),s=e[e.length-1];return!F.includes(s)}}).is_static_image_url(this.pv.url)?await this.cook_for_image():this.states.error.set("input is not an image")}async cook_for_image(){const t=await this._load_texture(this.pv.url);t?(this.texture_params_controller.update(t),this.set_texture(t)):this.clear_texture()}resolved_url(){return this.pv.url}static PARAM_CALLBACK_reload(t,e){t.param_callback_reload()}param_callback_reload(){this.p.url.setDirty()}async _load_texture(t){let e=null;const s=this.p.url;this._texture_loader=this._texture_loader||new w(this,s);try{e=await this._texture_loader.load_texture_from_url_or_op(t,{tdataType:this.pv.ttype&&this.pv.tadvanced,dataType:this.pv.type}),e&&(e.matrixAutoUpdate=!1)}catch(t){}return e||this.states.error.set(`could not load texture '${t}'`),e}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return L}));var r=s(4),i=s(50),n=s(32),o=s(14),a=s(10);function c(t){return class extends t{constructor(){super(...arguments),this.transparent=r.b.BOOLEAN(0),this.opacity=r.b.FLOAT(1),this.alphaTest=r.b.FLOAT(0),this.useFog=r.b.BOOLEAN(0)}}}o.a;c(r.a);n.a;class _ extends i.a{constructor(t){super(t),this.node=t}static update(t){const e=t.material,s=t.pv;e.uniforms.opacity&&(e.uniforms.opacity.value=s.opacity),e.transparent=Object(a.a)(s.transparent)||s.opacity<1,e.depthTest=!0,e.alphaTest=s.alphaTest,e.fog=Object(a.a)(s.useFog)}}var l=s(109),h=s(110),u=s(111),d=s(112),p=s(113),m=s(40),f=s(302);const b=["map","alphaMap","envMap"];var g=s(16),v=s(3),y=s(6),x=s(9),w=s(12),E=s(27),O=s(8);class A{constructor(t,e,s){this._type=t,this._name=e,this._default_value=s}static from_param(t){return new A(t.type(),t.name(),t.defaultValue())}type(){return this._type}name(){return this._name}get default_value(){return this._default_value}get param_options(){const t=this._callback.bind(this);switch(this._type){case w.a.OPERATOR_PATH:return{callback:t,nodeSelection:{context:O.g.COP}};default:return{callback:t}}}_callback(t,e){}}class T extends A{constructor(t,e,s,r){super(t,e,s),this._uniform_name=r}get uniform_name(){return this._uniform_name}get uniform(){return this._uniform=this._uniform||this._create_uniform()}_create_uniform(){return T.uniform_by_type(this._type)}execute_callback(t,e){this._callback(t,e)}_callback(t,e){T.callback(e,this.uniform)}static callback(t,e){switch(t.type()){case w.a.RAMP:return void(e.value=t.ramp_texture());case w.a.OPERATOR_PATH:return void T.set_uniform_value_from_texture(t,e);default:e.value=t.value}}static uniform_by_type(t){switch(t){case w.a.BOOLEAN:case w.a.BUTTON:return{value:0};case w.a.COLOR:return{value:new x.a(0,0,0)};case w.a.FLOAT:case w.a.FOLDER:case w.a.INTEGER:case w.a.OPERATOR_PATH:case w.a.NODE_PATH:case w.a.PARAM_PATH:return{value:0};case w.a.RAMP:return{value:null};case w.a.SEPARATOR:return{value:0};case w.a.STRING:return{value:null};case w.a.VECTOR2:return{value:new y.a(0,0)};case w.a.VECTOR3:return{value:new v.a(0,0,0)};case w.a.VECTOR4:return{value:new g.a(0,0,0,0)}}E.a.unreachable(t)}static set_uniform_value_from_texture(t,e){const s=t.found_node();if(s)if(s.isDirty())s.requestContainer().then(t=>{const s=t.texture();e.value=s});else{const t=s.containerController.container.texture();e.value=t}else e.value=null}set_uniform_value_from_ramp(t,e){e.value=t.ramp_texture()}}var C=s(20);class N extends class{constructor(t){this.node=t,this._found_uniform_texture_by_id=new Map,this._found_uniform_textures_id_by_uniform_name=new Map,this._found_param_texture_by_id=new Map,this._found_param_textures_id_by_uniform_name=new Map}toJSON(){}load(t){}_material_to_json(t){this._unassign_textures(t);let e=void 0;try{e=t.toJSON({})}catch(e){console.error("failed to save material data"),console.log(t)}return e&&null!=t.lights&&(e.lights=t.lights),this._reassign_textures(t),e}_unassign_textures(t){this._found_uniform_texture_by_id.clear(),this._found_uniform_textures_id_by_uniform_name.clear(),this._found_param_texture_by_id.clear(),this._found_param_textures_id_by_uniform_name.clear();const e=t.uniforms,s=Object.keys(e);for(let t of s){const s=e[t].value;if(s&&s.uuid){const r=s;this._found_uniform_texture_by_id.set(r.uuid,s),this._found_uniform_textures_id_by_uniform_name.set(t,r.uuid),e[t].value=null}}for(let e of b){const s=t[e];s&&(this._found_param_texture_by_id.set(s.uuid,s),this._found_param_textures_id_by_uniform_name.set(e,s.uuid),t[e]=null)}}_reassign_textures(t){const e=[],s=[];this._found_uniform_textures_id_by_uniform_name.forEach((t,s)=>{e.push(s)}),this._found_param_textures_id_by_uniform_name.forEach((t,e)=>{s.push(e)});const r=t.uniforms;for(let t of e){const e=this._found_uniform_textures_id_by_uniform_name.get(t);if(e){const s=this._found_uniform_texture_by_id.get(e);s&&(r[t].value=s)}}for(let e of s){const s=this._found_param_textures_id_by_uniform_name.get(e);if(s){const r=this._found_param_texture_by_id.get(s);r&&(t[e]=r)}}}_load_material(t){t.color=void 0;const e=(new f.a).parse(t);null!=t.lights&&(e.lights=t.lights);const s=e.uniforms.uv2Transform;s&&this.mat4_to_mat3(s);const r=e.uniforms.uvTransform;return r&&this.mat4_to_mat3(r),e}mat4_to_mat3(t){const e=t.value;if(null==e.elements[e.elements.length-1]){const s=new m.a;for(let t=0;t<s.elements.length;t++)s.elements[t]=e.elements[t];t.value=s}}}{constructor(t){super(t),this.node=t}toJSON(){const t=this.node.assemblerController;if(!t)return;const e={},s=this.node.material.custom_materials;if(s){const t=Object.keys(s);for(let r of t){const t=s[r];if(t){const s=this._material_to_json(t);s&&(e[r]=s)}}}const r=[],i=t.assembler.param_configs();for(let t of i)r.push([t.name(),t.uniform_name]);const n=this._material_to_json(this.node.material);n||console.warn("failed to save material from node",this.node.fullPath());return{material:n||{},uniforms_time_dependent:t.assembler.uniforms_time_dependent(),uniforms_resolution_dependent:t.assembler.resolution_dependent(),param_uniform_pairs:r,custom_materials:e}}load(t){if(this._material=this._load_material(t.material),this._material){if(this._material.custom_materials=this._material.custom_materials||{},t.custom_materials){const e=Object.keys(t.custom_materials);for(let s of e){const e=t.custom_materials[s],r=this._load_material(e);r&&(this._material.custom_materials[s]=r)}}if(t.uniforms_time_dependent&&this.node.scene().uniforms_controller.add_time_dependent_uniform_owner(this._material.uuid,this._material.uniforms),t.uniforms_resolution_dependent&&this.node.scene().uniforms_controller.add_resolution_dependent_uniform_owner(this._material.uuid,this._material.uniforms),t.param_uniform_pairs)for(let e of t.param_uniform_pairs){const t=this.node.params.get(e[0]),s=this._material.uniforms[e[1]];t&&s&&t.options.set_option("callback",()=>{T.callback(t,s)})}}}material(){if(C.a.playerMode())return this._material}}class R extends n.a{constructor(){super(...arguments),this._children_controller_context=O.g.GL,this.persisted_config=new N(this)}createMaterial(){var t;let e;return this.persisted_config&&(e=this.persisted_config.material()),e||(e=null===(t=this.assemblerController)||void 0===t?void 0:t.assembler.createMaterial()),e}get assemblerController(){return this._assembler_controller=this._assembler_controller||this._create_assembler_controller()}createNode(t,e){return super.createNode(t,e)}children(){return super.children()}nodesByType(t){return super.nodesByType(t)}childrenAllowed(){return this.assemblerController?super.childrenAllowed():(this.scene().markAsReadOnly(this),!1)}compile_if_required(){var t;(null===(t=this.assemblerController)||void 0===t?void 0:t.compile_required())&&this._compile()}_compile(){const t=this.assemblerController;this.material&&t&&(t.assembler.compile_material(this.material),t.post_compile())}}var j=s(121);class S extends(Object(p.b)(Object(d.b)(Object(u.b)(Object(h.b)(Object(l.b)(c(r.a))))))){}const M=new S;class L extends R{constructor(){super(...arguments),this.params_config=M,this.texture_map_controller=new d.a(this,{uniforms:!0}),this.texture_alpha_map_controller=new p.a(this,{uniforms:!0}),this.depth_controller=new h.a(this)}static type(){return"meshBasicBuilder"}usedAssembler(){return j.a.GL_MESH_BASIC}_create_assembler_controller(){return C.a.assemblersRegister.assembler(this,this.usedAssembler())}initializeNode(){this.params.onParamsCreated("init controllers",()=>{this.texture_map_controller.initializeNode(),this.texture_alpha_map_controller.initializeNode()})}async cook(){this.compile_if_required(),_.update(this),l.a.update(this),u.a.update(this),d.a.update(this),p.a.update(this),this.depth_controller.update(),this.set_material(this.material)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return A}));var r=s(30),i=s(15),n=s(42),o=s(13),a=s(4),c=s(10);class _{constructor(t){this.node=t,this.selected_state=new Map,this._entities_count=0,this._selected_entities_count=0}init(t){this.selected_state.clear();for(let e of t)this.selected_state.set(e,!1);this._entities_count=t.length,this._selected_entities_count=0}select(t){const e=this.selected_state.get(t);null!=e&&0==e&&(this.selected_state.set(t,!0),this._selected_entities_count++)}entities_to_keep(){return this._entities_for_state(Object(c.a)(this.node.pv.invert))}entities_to_delete(){return this._entities_for_state(!Object(c.a)(this.node.pv.invert))}_entities_for_state(t){const e=!!t,s=t?this._selected_entities_count:this._entities_count-this._selected_entities_count;if(0==s)return[];{const t=new Array(s);let r=0;return this.selected_state.forEach((s,i)=>{s==e&&(t[r]=i,r++)}),t}}}var l,h=s(27),u=s(6),d=s(3),p=s(16);!function(t){t.EQUAL="==",t.LESS_THAN="<",t.EQUAL_OR_LESS_THAN="<=",t.EQUAL_OR_GREATER_THAN=">=",t.GREATER_THAN=">",t.DIFFERENT="!="}(l||(l={}));const m=[l.EQUAL,l.LESS_THAN,l.EQUAL_OR_LESS_THAN,l.EQUAL_OR_GREATER_THAN,l.GREATER_THAN,l.DIFFERENT],f={[l.EQUAL]:(t,e)=>t==e,[l.LESS_THAN]:(t,e)=>t<e,[l.EQUAL_OR_LESS_THAN]:(t,e)=>t<=e,[l.EQUAL_OR_GREATER_THAN]:(t,e)=>t>=e,[l.GREATER_THAN]:(t,e)=>t>e,[l.DIFFERENT]:(t,e)=>t!=e},b=m.map((t,e)=>({name:t,value:e}));class g{constructor(t){this.node=t}eval_for_entities(t){const e=i.d[this.node.pv.attribType];switch(e){case i.h.NUMERIC:return void this._eval_for_numeric(t);case i.h.STRING:return void this._eval_for_string(t)}h.a.unreachable(e)}_eval_for_string(t){let e;for(let s of t)e=s.stringAttribValue(this.node.pv.attribName),e==this.node.pv.attrib_string&&this.node.entity_selection_helper.select(s)}_eval_for_numeric(t){const e=i.b[this.node.pv.attribSize-1];switch(e){case i.g.FLOAT:return this._eval_for_points_numeric_float(t);case i.g.VECTOR2:return this._eval_for_points_numeric_vector2(t);case i.g.VECTOR3:return this._eval_for_points_numeric_vector3(t);case i.g.VECTOR4:return this._eval_for_points_numeric_vector4(t)}h.a.unreachable(e)}_eval_for_points_numeric_float(t){let e=this.node.pv.attribName;const s=this.node.pv.attribValue1;let r;const i=m[this.node.pv.attribComparisonOperator],n=f[i];for(let i of t)r=i.attribValue(e),n(r,s)&&this.node.entity_selection_helper.select(i)}_eval_for_points_numeric_vector2(t){let e=this.node.pv.attribName;const s=this.node.pv.attribValue2;let r=new u.a;for(let i of t){const t=i.attribValue(e,r);s.equals(t)&&this.node.entity_selection_helper.select(i)}}_eval_for_points_numeric_vector3(t){let e=this.node.pv.attribName;const s=this.node.pv.attribValue3;let r=new d.a;for(let i of t){const t=i.attribValue(e,r);s.equals(t)&&this.node.entity_selection_helper.select(i)}}_eval_for_points_numeric_vector4(t){let e=this.node.pv.attribName;const s=this.node.pv.attribValue4;let r=new p.a;for(let i of t){const t=i.attribValue(e,r);s.equals(t)&&this.node.entity_selection_helper.select(i)}}}class v{constructor(t){this.node=t}async eval_for_entities(t){const e=this.node.p.expression;this.node.p.expression.hasExpression()&&e.expressionController?await this.eval_expressions_for_points_with_expression(t):this.eval_expressions_without_expression(t)}async eval_expressions_for_points_with_expression(t){const e=this.node.p.expression;e.expressionController&&await e.expressionController.compute_expression_for_entities(t,(t,e)=>{e&&this.node.entity_selection_helper.select(t)})}eval_expressions_without_expression(t){if(Object(c.a)(this.node.pv.expression))for(let e of t)this.node.entity_selection_helper.select(e)}}var y=s(65);class x{constructor(t){this.node=t,this._point_position=new d.a}eval_for_points(t){for(let e of t){this._bbox.containsPoint(e.getPosition(this._point_position))&&this.node.entity_selection_helper.select(e)}}get _bbox(){return null!=this._bbox_cache?this._bbox_cache:this._bbox_cache=new y.a(this.node.pv.bboxCenter.clone().sub(this.node.pv.bboxSize.clone().multiplyScalar(.5)),this.node.pv.bboxCenter.clone().add(this.node.pv.bboxSize.clone().multiplyScalar(.5)))}}class w{constructor(t){this.node=t}eval_for_objects(t){const e=i.o[this.node.pv.objectType];for(let s of t){const t=s.object();Object(i.p)(t.constructor)==e&&this.node.entity_selection_helper.select(s)}}}class E extends a.a{constructor(){super(...arguments),this.class=a.b.INTEGER(i.a.indexOf(i.e.VERTEX),{menu:{entries:i.f}}),this.invert=a.b.BOOLEAN(0),this.byObjectType=a.b.BOOLEAN(0,{visibleIf:{class:i.a.indexOf(i.e.OBJECT)}}),this.objectType=a.b.INTEGER(i.o.indexOf(i.l.MESH),{menu:{entries:i.n},visibleIf:{class:i.a.indexOf(i.e.OBJECT),byObjectType:!0}}),this.separatorObjectType=a.b.SEPARATOR(null,{visibleIf:{class:i.a.indexOf(i.e.OBJECT)}}),this.byExpression=a.b.BOOLEAN(0),this.expression=a.b.BOOLEAN("@ptnum==0",{visibleIf:{byExpression:!0},expression:{forEntities:!0}}),this.separatorExpression=a.b.SEPARATOR(),this.byAttrib=a.b.BOOLEAN(0),this.attribType=a.b.INTEGER(i.d.indexOf(i.h.NUMERIC),{menu:{entries:i.i},visibleIf:{byAttrib:1}}),this.attribName=a.b.STRING("",{visibleIf:{byAttrib:1}}),this.attribSize=a.b.INTEGER(1,{range:i.c,rangeLocked:[!0,!0],visibleIf:{byAttrib:1,attribType:i.d.indexOf(i.h.NUMERIC)}}),this.attribComparisonOperator=a.b.INTEGER(m.indexOf(l.EQUAL),{menu:{entries:b},visibleIf:{byAttrib:!0,attribType:i.d.indexOf(i.h.NUMERIC),attribSize:i.g.FLOAT}}),this.attribValue1=a.b.FLOAT(0,{visibleIf:{byAttrib:1,attribType:i.d.indexOf(i.h.NUMERIC),attribSize:1}}),this.attribValue2=a.b.VECTOR2([0,0],{visibleIf:{byAttrib:1,attribType:i.d.indexOf(i.h.NUMERIC),attribSize:2}}),this.attribValue3=a.b.VECTOR3([0,0,0],{visibleIf:{byAttrib:1,attribType:i.d.indexOf(i.h.NUMERIC),attribSize:3}}),this.attribValue4=a.b.VECTOR4([0,0,0,0],{visibleIf:{byAttrib:1,attribType:i.d.indexOf(i.h.NUMERIC),attribSize:4}}),this.attribString=a.b.STRING("",{visibleIf:{byAttrib:1,attribType:i.d.indexOf(i.h.STRING)}}),this.separatorAttrib=a.b.SEPARATOR(),this.byBbox=a.b.BOOLEAN(0,{visibleIf:{class:i.a.indexOf(i.e.VERTEX)}}),this.bboxSize=a.b.VECTOR3([1,1,1],{visibleIf:{class:i.a.indexOf(i.e.VERTEX),byBbox:!0}}),this.bboxCenter=a.b.VECTOR3([0,0,0],{visibleIf:{class:i.a.indexOf(i.e.VERTEX),byBbox:!0}}),this.separatorBbox=a.b.SEPARATOR(null,{visibleIf:{class:i.a.indexOf(i.e.VERTEX)}}),this.keepPoints=a.b.BOOLEAN(0,{visibleIf:{class:i.a.indexOf(i.e.OBJECT)}})}}const O=new E;class A extends r.a{constructor(){super(...arguments),this.params_config=O,this._marked_for_deletion_per_object_index=new Map,this.entity_selection_helper=new _(this),this.byBbox_helper=new x(this),this.byExpression_helper=new v(this),this.byAttribute_helper=new g(this),this.byObjectType_helper=new w(this)}static type(){return"delete"}static displayedInputNames(){return["geometry to delete from"]}initializeNode(){this.io.inputs.setCount(1),this.io.inputs.initInputsClonedState(o.a.FROM_NODE)}async cook(t){const e=t[0];switch(this.pv.class){case i.e.VERTEX:await this._eval_for_points(e);break;case i.e.OBJECT:await this._eval_for_objects(e)}}set_class(t){this.p.class.set(t)}async _eval_for_objects(t){const e=t.coreObjects();this.entity_selection_helper.init(e),this._marked_for_deletion_per_object_index=new Map;for(let t of e)this._marked_for_deletion_per_object_index.set(t.index(),!1);Object(c.a)(this.pv.byExpression)&&await this.byExpression_helper.eval_for_entities(e),Object(c.a)(this.pv.byObjectType)&&this.byObjectType_helper.eval_for_objects(e),Object(c.a)(this.pv.byAttrib)&&""!=this.pv.attribName&&this.byAttribute_helper.eval_for_entities(e);const s=this.entity_selection_helper.entities_to_keep().map(t=>t.object());if(Object(c.a)(this.pv.keepPoints)){const t=this.entity_selection_helper.entities_to_delete();for(let e of t){const t=this._point_object(e);t&&s.push(t)}}this.setObjects(s)}async _eval_for_points(t){const e=t.coreObjects();let s,r=[];for(let t=0;t<e.length;t++){s=e[t];let o=s.coreGeometry();if(o){const t=s.object(),e=o.pointsFromGeometry();this.entity_selection_helper.init(e);const a=e.length;Object(c.a)(this.pv.byExpression)&&await this.byExpression_helper.eval_for_entities(e),Object(c.a)(this.pv.byAttrib)&&""!=this.pv.attribName&&this.byAttribute_helper.eval_for_entities(e),Object(c.a)(this.pv.byBbox)&&this.byBbox_helper.eval_for_points(e);const _=this.entity_selection_helper.entities_to_keep();if(_.length==a)r.push(t);else if(o.geometry().dispose(),_.length>0){const e=n.a.geometryFromPoints(_,Object(i.p)(t.constructor));e&&(t.geometry=e,r.push(t))}}}this.setObjects(r)}_point_object(t){const e=t.points(),s=n.a.geometryFromPoints(e,i.l.POINTS);if(s)return this.create_object(s,i.l.POINTS)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return x}));var r=s(157);class i extends r.a{constructor(){super(...arguments),this._controls_by_viewer=new Map}async apply_controls(t,e){var s;null===(s=e.controlsController)||void 0===s||s.dispose_controls();const r=e.canvas();if(!r)return;const i=await this.create_controls_instance(t,r),n=this._controls_by_viewer.get(e);n&&n.dispose(),this._controls_by_viewer.set(e,i);const o=performance.now();return i.name=`${this.fullPath()}:${t.name}:${o}:${this.controls_id()}`,await this.params.eval_all(),this.setup_controls(i),i}controls_id(){return JSON.stringify(this.params.all.map(t=>t.valueSerialized()))}}var n=s(4),o=s(53),a=s(46),c=s(5),_=s(29),l=s(261),h=s(6),u=s(3),d=function(t,e){var s,r,i,n,o,a,d;void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.enabled=!0,this.target=new u.a,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keyMode="pan",this.keyRotateSpeedVertical=1,this.keyRotateSpeedHorizontal=1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:c.ab.ROTATE,MIDDLE:c.ab.DOLLY,RIGHT:c.ab.PAN},this.touches={ONE:c.Kc.ROTATE,TWO:c.Kc.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return x.phi},this.getAzimuthalAngle=function(){return x.theta},this.saveState=function(){p.target0.copy(p.target),p.position0.copy(p.object.position),p.zoom0=p.object.zoom},this.reset=function(){p.target.copy(p.target0),p.object.position.copy(p.position0),p.object.zoom=p.zoom0,p.object.updateProjectionMatrix(),p.dispatchEvent(m),p.update(),v=g.NONE},this.update=(s=new u.a,r=(new _.a).setFromUnitVectors(t.up,new u.a(0,1,0)),i=r.clone().invert(),n=new u.a,o=new _.a,a=2*Math.PI,d=!1,function(){var t=p.object.position;if(s.copy(t).sub(p.target),s.applyQuaternion(r),x.setFromVector3(s),p.autoRotate&&v===g.NONE&&k(2*Math.PI/60/60*p.autoRotateSpeed),p.enableDamping){const t=w.theta*p.dampingFactor,e=w.phi*p.dampingFactor;t<y&&e<y?d||(p.dispatchEvent(b),d=!0):d=!1,x.theta+=t,x.phi+=e}else x.theta+=w.theta,x.phi+=w.phi;var e=p.minAzimuthAngle,c=p.maxAzimuthAngle;return isFinite(e)&&isFinite(c)&&(e<-Math.PI?e+=a:e>Math.PI&&(e-=a),c<-Math.PI?c+=a:c>Math.PI&&(c-=a),x.theta=e<c?Math.max(e,Math.min(c,x.theta)):x.theta>(e+c)/2?Math.max(e,x.theta):Math.min(c,x.theta)),x.phi=Math.max(p.minPolarAngle,Math.min(p.maxPolarAngle,x.phi)),x.makeSafe(),x.radius*=E,x.radius=Math.max(p.minDistance,Math.min(p.maxDistance,x.radius)),!0===p.enableDamping?p.target.addScaledVector(O,p.dampingFactor):p.target.add(O),s.setFromSpherical(x),s.applyQuaternion(i),t.copy(p.target).add(s),p.object.lookAt(p.target),!0===p.enableDamping?(w.theta*=1-p.dampingFactor,w.phi*=1-p.dampingFactor,O.multiplyScalar(1-p.dampingFactor)):(w.set(0,0,0),O.set(0,0,0)),E=1,!!(A||n.distanceToSquared(p.object.position)>y||8*(1-o.dot(p.object.quaternion))>y)&&(p.dispatchEvent(m),n.copy(p.object.position),o.copy(p.object.quaternion),A=!1,!0)}),this.dispose=function(){p.domElement.removeEventListener("contextmenu",ot,!1),p.domElement.removeEventListener("pointerdown",J,!1),p.domElement.removeEventListener("wheel",et,!1),p.domElement.removeEventListener("touchstart",rt,!1),p.domElement.removeEventListener("touchend",nt,!1),p.domElement.removeEventListener("touchmove",it,!1),p.domElement.ownerDocument.removeEventListener("pointermove",Q,!1),p.domElement.ownerDocument.removeEventListener("pointerup",tt,!1),p.domElement.removeEventListener("keydown",st,!1)};var p=this,m={type:"change"},f={type:"start"},b={type:"end"},g={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},v=g.NONE,y=1e-6,x=new l.a,w=new l.a,E=1,O=new u.a,A=!1,T=new h.a,C=new h.a,N=new h.a,R=new h.a,j=new h.a,S=new h.a,M=new h.a,L=new h.a,P=new h.a;function I(){return Math.pow(.95,p.zoomSpeed)}function k(t){w.theta-=t}function B(t){w.phi-=t}var F,z=(F=new u.a,function(t,e){F.setFromMatrixColumn(e,0),F.multiplyScalar(-t),O.add(F)}),D=function(){var t=new u.a;return function(e,s){!0===p.screenSpacePanning?t.setFromMatrixColumn(s,1):(t.setFromMatrixColumn(s,0),t.crossVectors(p.object.up,t)),t.multiplyScalar(e),O.add(t)}}(),U=function(){var t=new u.a;return function(e,s){var r=p.domElement;if(p.object.isPerspectiveCamera){var i=p.object.position;t.copy(i).sub(p.target);var n=t.length();n*=Math.tan(p.object.fov/2*Math.PI/180),z(2*e*n/r.clientHeight,p.object.matrix),D(2*s*n/r.clientHeight,p.object.matrix)}else p.object.isOrthographicCamera?(z(e*(p.object.right-p.object.left)/p.object.zoom/r.clientWidth,p.object.matrix),D(s*(p.object.top-p.object.bottom)/p.object.zoom/r.clientHeight,p.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),p.enablePan=!1)}}();function G(t){p.object.isPerspectiveCamera?E/=t:p.object.isOrthographicCamera?(p.object.zoom=Math.max(p.minZoom,Math.min(p.maxZoom,p.object.zoom*t)),p.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),p.enableZoom=!1)}function V(t){p.object.isPerspectiveCamera?E*=t:p.object.isOrthographicCamera?(p.object.zoom=Math.max(p.minZoom,Math.min(p.maxZoom,p.object.zoom/t)),p.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),p.enableZoom=!1)}function q(t){T.set(t.clientX,t.clientY)}function H(t){R.set(t.clientX,t.clientY)}function X(t){if(1==t.touches.length)T.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);T.set(e,s)}}function Y(t){if(1==t.touches.length)R.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);R.set(e,s)}}function K(t){var e=t.touches[0].pageX-t.touches[1].pageX,s=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+s*s);M.set(0,r)}function $(t){if(1==t.touches.length)C.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);C.set(e,s)}N.subVectors(C,T).multiplyScalar(p.rotateSpeed);var r=p.domElement;k(2*Math.PI*N.x/r.clientHeight),B(2*Math.PI*N.y/r.clientHeight),T.copy(C)}function Z(t){if(1==t.touches.length)j.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);j.set(e,s)}S.subVectors(j,R).multiplyScalar(p.panSpeed),U(S.x,S.y),R.copy(j)}function W(t){var e=t.touches[0].pageX-t.touches[1].pageX,s=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+s*s);L.set(0,r),P.set(0,Math.pow(L.y/M.y,p.zoomSpeed)),G(P.y),M.copy(L)}function J(t){if(!1!==p.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){var e;switch(t.preventDefault(),p.domElement.focus?p.domElement.focus():window.focus(),t.button){case 0:e=p.mouseButtons.LEFT;break;case 1:e=p.mouseButtons.MIDDLE;break;case 2:e=p.mouseButtons.RIGHT;break;default:e=-1}switch(e){case c.ab.DOLLY:if(!1===p.enableZoom)return;!function(t){M.set(t.clientX,t.clientY)}(t),v=g.DOLLY;break;case c.ab.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===p.enablePan)return;H(t),v=g.PAN}else{if(!1===p.enableRotate)return;q(t),v=g.ROTATE}break;case c.ab.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===p.enableRotate)return;q(t),v=g.ROTATE}else{if(!1===p.enablePan)return;H(t),v=g.PAN}break;default:v=g.NONE}v!==g.NONE&&(p.domElement.ownerDocument.addEventListener("pointermove",Q,!1),p.domElement.ownerDocument.addEventListener("pointerup",tt,!1),p.dispatchEvent(f))}(t)}}function Q(t){if(!1!==p.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){if(!1===p.enabled)return;switch(t.preventDefault(),v){case g.ROTATE:if(!1===p.enableRotate)return;!function(t){C.set(t.clientX,t.clientY),N.subVectors(C,T).multiplyScalar(p.rotateSpeed);var e=p.domElement;k(2*Math.PI*N.x/e.clientHeight),B(2*Math.PI*N.y/e.clientHeight),T.copy(C),p.update()}(t);break;case g.DOLLY:if(!1===p.enableZoom)return;!function(t){L.set(t.clientX,t.clientY),P.subVectors(L,M),P.y>0?G(I()):P.y<0&&V(I()),M.copy(L),p.update()}(t);break;case g.PAN:if(!1===p.enablePan)return;!function(t){j.set(t.clientX,t.clientY),S.subVectors(j,R).multiplyScalar(p.panSpeed),U(S.x,S.y),R.copy(j),p.update()}(t)}}(t)}}function tt(t){if(!1!==p.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){if(!1===p.enabled)return;p.domElement.ownerDocument.removeEventListener("pointermove",Q,!1),p.domElement.ownerDocument.removeEventListener("pointerup",tt,!1),p.dispatchEvent(b),v=g.NONE}()}}function et(t){!1===p.enabled||!1===p.enableZoom||v!==g.NONE&&v!==g.ROTATE||(t.preventDefault(),t.stopPropagation(),p.dispatchEvent(f),function(t){t.deltaY<0?V(I()):t.deltaY>0&&G(I()),p.update()}(t),p.dispatchEvent(b))}function st(t){!1!==p.enabled&&!1!==p.enableKeys&&("pan"==p.keyMode&&!1===p.enablePan||"pan"!=p.keyMode&&!1===p.enableRotate||function(t){var e=!1;if("pan"==p.keyMode)switch(t.keyCode){case p.keys.UP:U(0,p.keyPanSpeed),e=!0;break;case p.keys.BOTTOM:U(0,-p.keyPanSpeed),e=!0;break;case p.keys.LEFT:U(p.keyPanSpeed,0),e=!0;break;case p.keys.RIGHT:U(-p.keyPanSpeed,0),e=!0}else switch(t.keyCode){case p.keys.UP:B(p.keyRotateSpeedVertical),e=!0;break;case p.keys.BOTTOM:B(-p.keyRotateSpeedVertical),e=!0;break;case p.keys.LEFT:k(p.keyRotateSpeedHorizontal),e=!0;break;case p.keys.RIGHT:k(-p.keyRotateSpeedHorizontal),e=!0}e&&(t.preventDefault(),p.update())}(t))}function rt(t){if(!1!==p.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(p.touches.ONE){case c.Kc.ROTATE:if(!1===p.enableRotate)return;X(t),v=g.TOUCH_ROTATE;break;case c.Kc.PAN:if(!1===p.enablePan)return;Y(t),v=g.TOUCH_PAN;break;default:v=g.NONE}break;case 2:switch(p.touches.TWO){case c.Kc.DOLLY_PAN:if(!1===p.enableZoom&&!1===p.enablePan)return;!function(t){p.enableZoom&&K(t),p.enablePan&&Y(t)}(t),v=g.TOUCH_DOLLY_PAN;break;case c.Kc.DOLLY_ROTATE:if(!1===p.enableZoom&&!1===p.enableRotate)return;!function(t){p.enableZoom&&K(t),p.enableRotate&&X(t)}(t),v=g.TOUCH_DOLLY_ROTATE;break;default:v=g.NONE}break;default:v=g.NONE}v!==g.NONE&&p.dispatchEvent(f)}}function it(t){if(!1!==p.enabled)switch(t.preventDefault(),t.stopPropagation(),v){case g.TOUCH_ROTATE:if(!1===p.enableRotate)return;$(t),p.update();break;case g.TOUCH_PAN:if(!1===p.enablePan)return;Z(t),p.update();break;case g.TOUCH_DOLLY_PAN:if(!1===p.enableZoom&&!1===p.enablePan)return;!function(t){p.enableZoom&&W(t),p.enablePan&&Z(t)}(t),p.update();break;case g.TOUCH_DOLLY_ROTATE:if(!1===p.enableZoom&&!1===p.enableRotate)return;!function(t){p.enableZoom&&W(t),p.enableRotate&&$(t)}(t),p.update();break;default:v=g.NONE}}function nt(t){!1!==p.enabled&&(p.dispatchEvent(b),v=g.NONE)}function ot(t){!1!==p.enabled&&t.preventDefault()}p.domElement.addEventListener("contextmenu",ot,!1),p.domElement.addEventListener("pointerdown",J,!1),p.domElement.addEventListener("wheel",et,!1),p.domElement.addEventListener("touchstart",rt,!1),p.domElement.addEventListener("touchend",nt,!1),p.domElement.addEventListener("touchmove",it,!1),p.domElement.addEventListener("keydown",st,!1),-1===p.domElement.tabIndex&&(p.domElement.tabIndex=0),this.update()};(d.prototype=Object.create(a.a.prototype)).constructor=d;var p=function(t,e){d.call(this,t,e),this.screenSpacePanning=!1,this.mouseButtons.LEFT=c.ab.PAN,this.mouseButtons.RIGHT=c.ab.ROTATE,this.touches.ONE=c.Kc.PAN,this.touches.TWO=c.Kc.DOLLY_ROTATE};(p.prototype=Object.create(a.a.prototype)).constructor=p;var m=s(8),f=s(10);var b;!function(t){t.PAN="pan",t.ROTATE="rotate"}(b||(b={}));const g=[b.PAN,b.ROTATE];class v extends n.a{constructor(){super(...arguments),this.enabled=n.b.BOOLEAN(1),this.allowPan=n.b.BOOLEAN(1),this.allowRotate=n.b.BOOLEAN(1),this.allowZoom=n.b.BOOLEAN(1),this.tdamping=n.b.BOOLEAN(1),this.damping=n.b.FLOAT(.1,{visibleIf:{tdamping:!0}}),this.screenSpacePanning=n.b.BOOLEAN(1),this.rotateSpeed=n.b.FLOAT(.5),this.minDistance=n.b.FLOAT(1,{range:[0,100],rangeLocked:[!0,!1]}),this.maxDistance=n.b.FLOAT(50,{range:[0,100],rangeLocked:[!0,!1]}),this.limitAzimuthAngle=n.b.BOOLEAN(0),this.azimuthAngleRange=n.b.VECTOR2(["-2*$PI","2*$PI"],{visibleIf:{limitAzimuthAngle:1}}),this.polarAngleRange=n.b.VECTOR2([0,"$PI"]),this.target=n.b.VECTOR3([0,0,0],{cook:!1,computeOnDirty:!0,callback:t=>{x.PARAM_CALLBACK_update_target(t)}}),this.enableKeys=n.b.BOOLEAN(0),this.keysMode=n.b.INTEGER(g.indexOf(b.PAN),{visibleIf:{enableKeys:1},menu:{entries:g.map((t,e)=>({name:t,value:e}))}}),this.keysPanSpeed=n.b.FLOAT(7,{range:[0,10],rangeLocked:[!1,!1],visibleIf:{enableKeys:1,keysMode:g.indexOf(b.PAN)}}),this.keysRotateSpeedVertical=n.b.FLOAT(1,{range:[0,1],rangeLocked:[!1,!1],visibleIf:{enableKeys:1,keysMode:g.indexOf(b.ROTATE)}}),this.keysRotateSpeedHorizontal=n.b.FLOAT(1,{range:[0,1],rangeLocked:[!1,!1],visibleIf:{enableKeys:1,keysMode:g.indexOf(b.ROTATE)}})}}const y=new v;class x extends i{constructor(){super(...arguments),this.params_config=y,this._controls_by_element_id=new Map,this._target_array=[0,0,0]}static type(){return m.b.ORBIT}endEventName(){return"end"}initializeNode(){this.io.outputs.setNamedOutputConnectionPoints([new o.a("start",o.b.BASE),new o.a("change",o.b.BASE),new o.a("end",o.b.BASE)])}async create_controls_instance(t,e){const s=new d(t,e);return s.addEventListener("end",()=>{this._on_controls_end(s)}),this._controls_by_element_id.set(e.id,s),this._bind_listeners_to_controls_instance(s),s}_bind_listeners_to_controls_instance(t){t.addEventListener("start",()=>{this.dispatch_event_to_output("start",{})}),t.addEventListener("change",()=>{this.dispatch_event_to_output("change",{})}),t.addEventListener("end",()=>{this.dispatch_event_to_output("end",{})})}setup_controls(t){t.enabled=Object(f.a)(this.pv.enabled),t.enablePan=Object(f.a)(this.pv.allowPan),t.enableRotate=Object(f.a)(this.pv.allowRotate),t.enableZoom=Object(f.a)(this.pv.allowZoom),t.enableDamping=Object(f.a)(this.pv.tdamping),t.dampingFactor=this.pv.damping,t.rotateSpeed=this.pv.rotateSpeed,t.screenSpacePanning=Object(f.a)(this.pv.screenSpacePanning),t.minDistance=this.pv.minDistance,t.maxDistance=this.pv.maxDistance,this._set_azimuth_angle(t),t.minPolarAngle=this.pv.polarAngleRange.x,t.maxPolarAngle=this.pv.polarAngleRange.y,t.target.copy(this.pv.target),t.enabled&&t.update(),t.enableKeys=Object(f.a)(this.pv.enableKeys),t.enableKeys&&(t.keyMode=g[this.pv.keysMode],t.keyRotateSpeedVertical=this.pv.keysRotateSpeedVertical,t.keyRotateSpeedHorizontal=this.pv.keysRotateSpeedHorizontal,t.keyPanSpeed=this.pv.keysPanSpeed)}_set_azimuth_angle(t){Object(f.a)(this.pv.limitAzimuthAngle)?(t.minAzimuthAngle=this.pv.azimuthAngleRange.x,t.maxAzimuthAngle=this.pv.azimuthAngleRange.y):(t.minAzimuthAngle=1/0,t.maxAzimuthAngle=1/0)}update_required(){return Object(f.a)(this.pv.tdamping)}_on_controls_end(t){Object(f.a)(this.pv.allowPan)&&(t.target.toArray(this._target_array),this.p.target.set(this._target_array))}static PARAM_CALLBACK_update_target(t){t._update_target()}_update_target(){const t=this.pv.target;this._controls_by_element_id.forEach((e,s)=>{const r=e.target;r.equals(t)||(r.copy(t),e.update())})}dispose_controls_for_html_element_id(t){this._controls_by_element_id.get(t)&&this._controls_by_element_id.delete(t)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return E}));var r=s(311),i=s(165),n=s(4),o=s(51),a=s(39),c=s(64);Object(o.b)(n.a);class _ extends i.a{constructor(){super(...arguments),this.flags=new a.c(this),this.hierarchyController=new c.a(this),this.transformController=new o.a(this)}initializeBaseNode(){super.initializeBaseNode(),this.hierarchyController.initializeNode(),this.transformController.initializeNode()}cook(){this.transformController.update(),this.update_light_params(),this.update_shadow_params(),this.cookController.end_cook()}}var l=s(166),h=s(164),u=s(19),d=s(11),p=s(47),m=s(119),f=s(3),b=s(41);class g extends h.a{constructor(){super(...arguments),this._cone=new m.a,this._line_material=new p.a({fog:!1}),this._matrix_scale=new f.a}createObject(){return new b.a}buildHelper(){const t=new u.a,e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,s=1,r=32;t<r;t++,s++){const i=t/r*Math.PI*2,n=s/r*Math.PI*2;e.push(Math.cos(i),Math.sin(i),1,Math.cos(n),Math.sin(n),1)}t.setAttribute("position",new d.b(e,3)),this._cone.geometry=t,this._cone.material=this._line_material,this._cone.matrixAutoUpdate=!1,this.object.add(this._cone)}update(){const t=(this.node.light.distance?this.node.light.distance:1e3)*this.node.pv.helperSize,e=t*Math.tan(this.node.light.angle);this._matrix_scale.set(e,e,t),this._cone.matrix.identity(),this._cone.matrix.makeRotationX(.5*Math.PI),this._cone.matrix.scale(this._matrix_scale),this._line_material.color.copy(this.node.light.color)}}var v=s(99),y=s(10);class x extends(Object(o.b)(n.a)){constructor(){super(...arguments),this.light=n.b.FOLDER(),this.color=n.b.COLOR([1,1,1],{conversion:v.a.SRGB_TO_LINEAR}),this.intensity=n.b.FLOAT(1),this.angle=n.b.FLOAT(45,{range:[0,180]}),this.penumbra=n.b.FLOAT(.1),this.decay=n.b.FLOAT(.1,{range:[0,1]}),this.distance=n.b.FLOAT(100,{range:[0,100]}),this.showHelper=n.b.BOOLEAN(0),this.helperSize=n.b.FLOAT(1,{visibleIf:{showHelper:1}}),this.shadow=n.b.FOLDER(),this.castShadow=n.b.BOOLEAN(1),this.shadowAutoUpdate=n.b.BOOLEAN(1,{visibleIf:{castShadow:1}}),this.shadowUpdateOnNextRender=n.b.BOOLEAN(0,{visibleIf:{castShadow:1,shadowAutoUpdate:0}}),this.shadowRes=n.b.VECTOR2([256,256],{visibleIf:{castShadow:1}}),this.shadowBias=n.b.FLOAT(.001,{visibleIf:{castShadow:1},range:[-.01,.01],rangeLocked:[!1,!1]}),this.shadowNear=n.b.FLOAT(.1,{visibleIf:{castShadow:1},range:[0,100],rangeLocked:[!0,!1]}),this.shadowFar=n.b.FLOAT(100,{visibleIf:{castShadow:1},range:[0,100],rangeLocked:[!0,!1]})}}const w=new x;class E extends _{constructor(){super(...arguments),this.params_config=w,this._helper_controller=new l.a(this,g,"SpotLightHelper")}static type(){return"spotLight"}initializeNode(){this._helper_controller.initializeNode()}create_light(){const t=new r.a;return t.matrixAutoUpdate=!1,t.castShadow=!0,t.shadow.bias=-.001,t.shadow.mapSize.x=256,t.shadow.mapSize.y=256,t.shadow.camera.near=.1,this._target_target=t.target,this._target_target.name="SpotLight Default Target",this._target_target.matrixAutoUpdate=!1,this.object.add(this._target_target),t}update_light_params(){this.light.color=this.pv.color,this.light.intensity=this.pv.intensity,this.light.angle=this.pv.angle*(Math.PI/180),this.light.penumbra=this.pv.penumbra,this.light.decay=this.pv.decay,this.light.distance=this.pv.distance,this._helper_controller.update()}update_shadow_params(){this.light.castShadow=Object(y.a)(this.pv.castShadow),this.light.shadow.autoUpdate=Object(y.a)(this.pv.shadowAutoUpdate),this.light.shadow.needsUpdate=Object(y.a)(this.pv.shadowUpdateOnNextRender),this.light.shadow.mapSize.copy(this.pv.shadowRes),this.light.shadow.camera.near=this.pv.shadowNear,this.light.shadow.camera.far=this.pv.shadowFar,this.light.shadow.bias=this.pv.shadowBias}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return y}));var r=s(30),i=s(125),n=s(11),o=s(19),a=s(22),c=s(42),_=s(15),l=s(7);class h{constructor(t,e){this._size=t,this._type=e}size(){return this._size}type(){return this._type}static from_value(t){const e=l.a.isString(t)?_.h.STRING:_.h.NUMERIC;return new this(l.a.isArray(t)?t.length:1,e)}}var u=s(31),d=s(20);const p={BufferGeometry:o.a,Float32BufferAttribute:n.b,Points:i.a};class m{constructor(t={}){this._attribute_datas_by_name={},this._options={},this._options.dataKeysPrefix=t.dataKeysPrefix,this._options.skipEntries=t.skipEntries,this._options.doConvert=t.doConvert||!1,this._options.convertToNumeric=t.convertToNumeric}load(t,e,s,r){fetch(t).then(async t=>{this._json=await t.json(),null!=this._options.dataKeysPrefix&&""!=this._options.dataKeysPrefix&&(this._json=this.get_prefixed_json(this._json,this._options.dataKeysPrefix.split(".")));const s=this.create_object();e(s)}).catch(t=>{d.a.error("error",t),r(t)})}get_prefixed_json(t,e){if(0==e.length)return t;{const s=e.shift();if(s)return this.get_prefixed_json(t[s],e)}return[]}set_json(t){return this._json=t}create_object(){const t=new p.BufferGeometry,e=new c.a(t);if(null!=this._json){const s=this._json.length;e.initPositionAttribute(s),this._find_attributes();const r=a.a.attribNames(this._options.convertToNumeric||"");for(let s of Object.keys(this._attribute_datas_by_name)){const i=u.b.remap_name(s);let n=this._attribute_values_for_name(s).flat();const o=this._attribute_datas_by_name[s],c=o.size();if(o.type()===_.h.STRING)if(this._options.doConvert&&a.a.matchesOneMask(s,r)){const e=n.map(t=>l.a.isString(t)?parseFloat(t)||0:t);t.setAttribute(i,new p.Float32BufferAttribute(e,c))}else{const t=u.b.array_to_indexed_arrays(n);e.setIndexedAttribute(i,t.values,t.indices)}else{const e=n;t.setAttribute(i,new p.Float32BufferAttribute(e,c))}}}return t}_find_attributes(){let t;const e=a.a.attribNames(this._options.skipEntries||"");if(this._json&&null!=(t=this._json[0]))for(let s of Object.keys(t)){const r=t[s];if(this._value_has_subentries(r))for(let t of Object.keys(r)){const i=[s,t].join(":"),n=r[s];a.a.matchesOneMask(i,e)||(this._attribute_datas_by_name[i]=h.from_value(n))}else a.a.matchesOneMask(s,e)||(this._attribute_datas_by_name[s]=h.from_value(r))}}_attribute_values_for_name(t){return this._json?this._json.map(e=>{const s=t.split(":")[0],r=e[s];if(this._value_has_subentries(r)){return r[t.substring(s.length+1)]||0}return r||0}):[]}_value_has_subentries(t){return l.a.isObject(t)&&!l.a.isArray(t)}}var f=s(4);const b=JSON.stringify([{value:-40},{value:-30},{value:-20},{value:-10},{value:0},{value:10},{value:20},{value:30},{value:40},{value:50},{value:60},{value:70},{value:80}]);class g extends f.a{constructor(){super(...arguments),this.data=f.b.STRING(b)}}const v=new g;class y extends r.a{constructor(){super(...arguments),this.params_config=v}static type(){return"data"}cook(){let t=null;try{t=JSON.parse(this.pv.data)}catch(t){this.states.error.set("could not parse json")}if(t)try{const e=new m;e.set_json(t);const s=e.create_object();this.setGeometry(s,_.l.POINTS)}catch(t){this.states.error.set("could not build geometry from json")}else this.cookController.end_cook()}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return h}));var r=s(17),i=s(21),n=s(8),o=s(11);var a=s(31),c=s(58);class _{set_attrib(t){const e=t.geometry,s=t.targetAttribSize;if(s<1||s>4)return;const r=t.add,i=t.mult,n=this._data_from_texture(t.texture);if(!n)return;const{data:_,resx:l,resy:h}=n,u=_.length/(l*h),d=e.getAttribute(t.uvAttribName).array,p=d.length/2,m=new Array(p*s);let f,b,g,v,y,x,w,E,O;const A=c.a.clamp;for(x=0;x<p;x++)for(f=2*x,b=A(d[f],0,1),g=A(d[f+1],0,1),v=Math.floor((l-1)*b),y=Math.floor((h-1)*(1-g)),w=y*l+v,O=0;O<s;O++)E=_[u*w+O],m[x*s+O]=i*E+r;const T=a.b.remap_name(t.targetAttribName),C=new Float32Array(m);e.setAttribute(T,new o.a(C,s))}_data_from_texture(t){if(t.image)return t.image.data?this._data_from_data_texture(t):this._data_from_default_texture(t)}_data_from_default_texture(t){const e=t.image.width,s=t.image.height,r=class{static overlay(t,e){return new Promise((s,r)=>{let i=document.createElement("canvas");i.width=Math.max(t.width,e.width),i.height=Math.max(t.height,e.height);let n=i.getContext("2d");n.drawImage(t,0,0,t.width,t.height),n.drawImage(e,0,0,e.width,e.height);const o=i.toDataURL("image/png"),a=new Image;a.onload=()=>{s(a)},a.src=o})}static create_white_image(t,e){return new Promise((s,r)=>{let i=document.createElement("canvas");i.width=t,i.height=e;let n=i.getContext("2d");n.beginPath(),n.rect(0,0,t,e),n.fillStyle="white",n.fill();const o=i.toDataURL("image/png"),a=new Image;a.onload=()=>{s(a)},a.src=o})}static make_square(t){return new Promise((e,s)=>{let r=document.createElement("canvas");const i=Math.min(t.width,t.height),n=t.width/t.height;r.width=i,r.height=i;let o=r.getContext("2d");const a=n>1,c=a?(t.width-i)/2:(t.height-i)/2;a?o.drawImage(t,c,0,i,i,0,0,i,i):o.drawImage(t,0,c,i,i,0,0,i,i);const _=r.toDataURL("image/png"),l=new Image;l.onload=()=>{e(l)},l.src=_})}static async image_to_blob(t){return new Promise((function(e,s){try{let r=new XMLHttpRequest;r.open("GET",t.src),r.responseType="blob",r.onerror=function(){s("Network error.")},r.onload=function(){200===r.status?e(r.response):s("Loading error:"+r.statusText)},r.send()}catch(t){s(t.message)}}))}static data_from_url(t){return new Promise((e,s)=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{const t=this.data_from_image(r);e(t)},r.src=t})}static data_from_image(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");return s.drawImage(t,0,0,t.width,t.height),s.getImageData(0,0,t.width,t.height)}}.data_from_image(t.image);return{data:r.data,resx:e,resy:s}}_data_from_data_texture(t){return{data:t.image.data,resx:t.image.width,resy:t.image.height}}}var l=s(13);class h extends r.a{static type(){return"attribFromTexture"}async cook(t,e){var s;const r=t[0],i=e.texture.ensure_node_context(n.g.COP,null===(s=this.states)||void 0===s?void 0:s.error);if(!i)return r;const o=(await i.requestContainer()).texture();for(let t of r.coreObjects())this._set_position_from_data_texture(t,o,e);return r}_set_position_from_data_texture(t,e,s){var r,i;const n=null===(r=t.coreGeometry())||void 0===r?void 0:r.geometry();if(!n)return;if(null==n.getAttribute(s.uvAttrib))return void(null===(i=this.states)||void 0===i||i.error.set(`param '${s.uvAttrib} not found'`));(new _).set_attrib({geometry:n,texture:e,uvAttribName:s.uvAttrib,targetAttribName:s.attrib,targetAttribSize:s.attribSize,add:s.add,mult:s.mult})}}h.DEFAULT_PARAMS={texture:new i.c(i.b.NODE.UV),uvAttrib:"uv",attrib:"pscale",attribSize:1,add:0,mult:1},h.INPUT_CLONED_STATE=l.a.FROM_NODE},function(t,e,s){"use strict";s.d(e,"a",(function(){return u}));var r=s(17),i=s(3),n=s(19),o=s(11);function a(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}class c extends n.a{constructor(t,e,s,r,n){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:s,detail:r},s=s||1,r=r||0;const c=[],_=[],l=new Map;function h(t,e,s,r){const i=r+1,n=[];for(let r=0;r<=i;r++){n[r]=[];const o=t.clone().lerp(s,r/i),a=e.clone().lerp(s,r/i),c=i-r;for(let t=0;t<=c;t++)n[r][t]=0===t&&r===i?o:o.clone().lerp(a,t/c)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){const s=Math.floor(e/2);e%2==0?(u(n[t][s+1]),u(n[t+1][s]),u(n[t][s])):(u(n[t][s+1]),u(n[t+1][s+1]),u(n[t+1][s]))}}function u(t){if(n){let e=l.get(t.x);if(e){const s=e.get(t.y);if(s&&s.has(t.z))return}e||(e=new Map,l.set(t.x,e));let s=e.get(t.y);s||(s=new Set,e.set(t.y,s)),s.add(t.z)}c.push(t.x,t.y,t.z)}function d(e,s){const r=3*e;s.x=t[r+0],s.y=t[r+1],s.z=t[r+2]}!function(t){const s=new i.a,r=new i.a,n=new i.a;for(let i=0;i<e.length;i+=3)d(e[i+0],s),d(e[i+1],r),d(e[i+2],n),h(s,r,n,t)}(r),function(t){const e=new i.a;for(let s=0;s<c.length;s+=3)e.x=c[s+0],e.y=c[s+1],e.z=c[s+2],e.normalize().multiplyScalar(t),c[s+0]=e.x,c[s+1]=e.y,c[s+2]=e.z}(s),function(){const t=new i.a;for(let s=0;s<c.length;s+=3){t.x=c[s+0],t.y=c[s+1],t.z=c[s+2];const r=(e=t,Math.atan2(e.z,-e.x)/2/Math.PI+.5),i=a(t)/Math.PI+.5;_.push(r,1-i)}var e}(),this.setAttribute("position",new o.b(c,3)),this.setAttribute("uv",new o.b(_,2)),n||(this.setAttribute("normal",new o.b(c.slice(),3)),0===r?this.computeVertexNormals():this.normalizeNormals())}}class _ extends c{constructor(t,e,s){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e,s),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}}var l=s(15),h=s(10);class u extends r.a{static type(){return"icosahedron"}cook(t,e){const s=Object(h.a)(e.pointsOnly),r=new _(e.radius,e.detail,s);if(r.translate(e.center.x,e.center.y,e.center.z),s){const t=this.create_object(r,l.l.POINTS);return this.create_core_group_from_objects([t])}return r.computeVertexNormals(),this.create_core_group_from_geometry(r)}}u.DEFAULT_PARAMS={radius:1,detail:0,pointsOnly:!1,center:new i.a(0,0,0)}},,function(t,e,s){"use strict";s.d(e,"a",(function(){return O}));var r,i=s(57),n=s(5),o=s(32),a=s(4),c=s(158),_=s(109),l=s(110),h=s(111),u=s(112),d=s(113),p=s(50),m=s(14),f=s(10);!function(t){t.ROUND="round",t.BUTT="butt",t.SQUARE="square"}(r||(r={}));const b=[r.ROUND,r.BUTT,r.SQUARE];var g;!function(t){t.ROUND="round",t.BEVEL="bevel",t.MITER="miter"}(g||(g={}));const v=[g.ROUND,g.BEVEL,g.MITER];function y(t){return class extends t{constructor(){super(...arguments),this.wireframe=a.b.BOOLEAN(0),this.wireframeLinecap=a.b.INTEGER(0,{menu:{entries:b.map((t,e)=>({name:t,value:e}))},visibleIf:{wireframe:1}}),this.wireframeLinejoin=a.b.INTEGER(0,{menu:{entries:v.map((t,e)=>({name:t,value:e}))},visibleIf:{wireframe:1}})}}}m.a;y(a.a);o.a;class x extends p.a{constructor(t){super(t),this.node=t}static update(t){const e=t.material,s=t.pv;e.wireframe=Object(f.a)(s.wireframe),e.wireframeLinecap=b[s.wireframeLinecap],e.wireframeLinejoin=v[s.wireframeLinejoin],e.needsUpdate=!0}}class w extends(y(Object(d.b)(Object(u.b)(Object(h.b)(Object(l.b)(Object(_.b)(Object(c.a)(a.a)))))))){}const E=new w;class O extends o.a{constructor(){super(...arguments),this.params_config=E,this.texture_map_controller=new u.a(this,{direct_params:!0}),this.texture_alpha_map_controller=new d.a(this,{direct_params:!0}),this.depth_controller=new l.a(this)}static type(){return"meshBasic"}createMaterial(){return new i.a({vertexColors:!1,side:n.G,color:16777215,opacity:1})}initializeNode(){this.params.onParamsCreated("init controllers",()=>{this.texture_map_controller.initializeNode(),this.texture_alpha_map_controller.initializeNode()})}async cook(){c.b.update(this),_.a.update(this),h.a.update(this),this.texture_map_controller.update(),this.texture_alpha_map_controller.update(),this.depth_controller.update(),x.update(this),this.set_material(this.material)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return v}));var r=s(265),i=s(9),n=s(266),o=s(11),a=s(29),c=s(3),_=s(164),l=s(41);class h extends _.a{constructor(){super(...arguments),this._geometry=new n.a(1),this._quat=new a.a,this._default_position=new c.a(0,1,0),this._color1=new i.a,this._color2=new i.a}createObject(){return new l.a}buildHelper(){this._geometry.rotateZ(.5*Math.PI),this._material.vertexColors=!0;const t=this._geometry.getAttribute("position"),e=new Float32Array(3*t.count);this._geometry.setAttribute("color",new o.a(e,3)),this._object.geometry=this._geometry,this._object.material=this._material,this._object.matrixAutoUpdate=!1}update(){if(!this.node.pv.position)return;this._object.position.copy(this.node.pv.position).multiplyScalar(-1),this._quat.setFromUnitVectors(this._default_position,this.node.pv.position),this._object.setRotationFromQuaternion(this._quat),this._object.scale.setScalar(this.node.pv.helperSize),this._object.updateMatrix();const t=this._geometry.getAttribute("color");this._color1.copy(this.node.light.color),this._color2.copy(this.node.light.groundColor);for(let e=0,s=t.count;e<s;e++){const r=e<s/2?this._color1:this._color2;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}}var u=s(165),d=s(4),p=s(166),m=s(99);const f={skyColor:new i.a(1,1,1),groundColor:new i.a(0,0,0)};class b extends d.a{constructor(){super(...arguments),this.skyColor=d.b.COLOR(f.skyColor,{conversion:m.a.SRGB_TO_LINEAR}),this.groundColor=d.b.COLOR(f.groundColor,{conversion:m.a.SRGB_TO_LINEAR}),this.intensity=d.b.FLOAT(1),this.position=d.b.VECTOR3([0,1,0]),this.showHelper=d.b.BOOLEAN(0),this.helperSize=d.b.FLOAT(1,{visibleIf:{showHelper:1}})}}const g=new b;class v extends u.a{constructor(){super(...arguments),this.params_config=g,this._helper_controller=new p.a(this,h,"HemisphereLightHelper")}static type(){return"hemisphereLight"}create_light(){const t=new r.a;return t.matrixAutoUpdate=!1,t.color.copy(f.skyColor),t.groundColor.copy(f.groundColor),t}initializeNode(){this.io.inputs.setCount(0,1),this._helper_controller.initializeNode()}update_light_params(){this.light.color=this.pv.skyColor,this.light.groundColor=this.pv.groundColor,this.light.position.copy(this.pv.position),this.light.intensity=this.pv.intensity,this._helper_controller.update()}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return v}));var r,i=s(30),n=s(13),o=s(3),a=s(15),c=s(19),_=s(11),l=s(27);!function(t){t.SEGMENTS_COUNT="segments count",t.SEGMENTS_LENGTH="segments length"}(r||(r={}));const h=[r.SEGMENTS_COUNT,r.SEGMENTS_LENGTH];var u;!function(t){t.ABC="abc",t.ACB="acb",t.AB="ab",t.BC="bc",t.AC="ac"}(u||(u={}));const d=[u.ABC,u.ACB,u.AB,u.AC,u.BC];class p{constructor(t){this.params=t,this.a=new o.a,this.b=new o.a,this.c=new o.a,this.an=new o.a,this.bn=new o.a,this.cn=new o.a,this.ac=new o.a,this.ab=new o.a,this.ab_x_ac=new o.a,this.part0=new o.a,this.part1=new o.a,this.divider=1,this.a_center=new o.a,this.center=new o.a,this.normal=new o.a,this.radius=1,this.x=new o.a,this.y=new o.a,this.z=new o.a,this.angle_ab=1,this.angle_ac=1,this.angle_bc=1,this.angle=2*Math.PI,this.x_rotated=new o.a,this._created_geometries={}}created_geometries(){return this._created_geometries}create(t,e,s){this.a.copy(t),this.b.copy(e),this.c.copy(s),this._compute_axis(),this._create_arc(),this._create_center()}_create_arc(){this._compute_angle();const t=this._points_count(),e=new Array(3*t),s=new Array(t),r=this.angle/(t-1);this.x_rotated.copy(this.x).multiplyScalar(this.radius);let i=0;for(i=0;i<t;i++)this.x_rotated.copy(this.x).applyAxisAngle(this.normal,r*i).multiplyScalar(this.radius).add(this.center),this.x_rotated.toArray(e,3*i),i>0&&(s[2*(i-1)]=i-1,s[2*(i-1)+1]=i);this.params.full&&(s.push(i-1),s.push(0));const n=new c.a;if(n.setAttribute("position",new _.a(new Float32Array(e),3)),n.setIndex(s),this.params.addIdAttribute||this.params.addIdnAttribute){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=t;this.params.addIdAttribute&&n.setAttribute("id",new _.a(new Float32Array(e),1));const s=e.map(e=>e/(t-1));this.params.addIdnAttribute&&n.setAttribute("idn",new _.a(new Float32Array(s),1))}this._created_geometries.arc=n}_create_center(){if(!this.params.center)return;const t=new c.a,e=[this.center.x,this.center.y,this.center.z];t.setAttribute("position",new _.a(new Float32Array(e),3)),this._created_geometries.center=t}_compute_axis(){this.ac.copy(this.c).sub(this.a),this.ab.copy(this.b).sub(this.a),this.ab_x_ac.copy(this.ab).cross(this.ac),this.divider=2*this.ab_x_ac.lengthSq(),this.part0.copy(this.ab_x_ac).cross(this.ab).multiplyScalar(this.ac.lengthSq()),this.part1.copy(this.ac).cross(this.ab_x_ac).multiplyScalar(this.ab.lengthSq()),this.a_center.copy(this.part0).add(this.part1).divideScalar(this.divider),this.radius=this.a_center.length(),this.normal.copy(this.ab_x_ac).normalize(),this.center.copy(this.a).add(this.a_center)}_compute_angle(){this.params.arc&&(this.params.full?(this.x.copy(this.a).sub(this.center).normalize(),this.angle=2*Math.PI):(this.an.copy(this.a).sub(this.center).normalize(),this.bn.copy(this.b).sub(this.center).normalize(),this.cn.copy(this.c).sub(this.center).normalize(),this._set_x_from_joinMode(),this.y.copy(this.normal),this.z.copy(this.x).cross(this.y).normalize(),this.angle_ab=this.an.angleTo(this.bn),this.angle_ac=this.an.angleTo(this.cn),this.angle_bc=this.bn.angleTo(this.cn),this._set_angle_from_joinMode()))}_points_count(){const t=this.params.pointsCountMode;switch(t){case r.SEGMENTS_COUNT:return this.params.segmentsCount+1;case r.SEGMENTS_LENGTH:{let t=Math.PI*this.radius*this.radius;return this.params.full||(t*=Math.abs(this.angle)/(2*Math.PI)),Math.ceil(t/this.params.segmentsLength)}}l.a.unreachable(t)}_set_x_from_joinMode(){const t=this.params.joinMode;switch(this.x.copy(this.a).sub(this.center).normalize(),t){case u.ABC:case u.ACB:case u.AB:case u.AC:return this.x.copy(this.an);case u.BC:return this.x.copy(this.bn)}l.a.unreachable(t)}_set_angle_from_joinMode(){const t=this.params.joinMode;switch(t){case u.ABC:return void(this.angle=this.angle_ab+this.angle_bc);case u.ACB:return this.angle=this.angle_ac+this.angle_bc,void(this.angle*=-1);case u.AB:return void(this.angle=this.angle_ab);case u.AC:return this.angle=this.angle_ac,void(this.angle*=-1);case u.BC:return void(this.angle=this.angle_bc)}l.a.unreachable(t)}}var m=s(4),f=s(10);class b extends m.a{constructor(){super(...arguments),this.arc=m.b.BOOLEAN(1),this.pointsCountMode=m.b.INTEGER(h.indexOf(r.SEGMENTS_COUNT),{visibleIf:{arc:1},menu:{entries:h.map((t,e)=>({value:e,name:t}))}}),this.segmentsLength=m.b.FLOAT(.1,{visibleIf:{arc:1,pointsCountMode:h.indexOf(r.SEGMENTS_LENGTH)},range:[0,1],rangeLocked:[!0,!1]}),this.segmentsCount=m.b.INTEGER(100,{visibleIf:{arc:1,pointsCountMode:h.indexOf(r.SEGMENTS_COUNT)},range:[1,100],rangeLocked:[!0,!1]}),this.full=m.b.BOOLEAN(1,{visibleIf:{arc:1}}),this.joinMode=m.b.INTEGER(d.indexOf(u.ABC),{visibleIf:{arc:1,full:0},menu:{entries:d.map((t,e)=>({value:e,name:t}))}}),this.addIdAttribute=m.b.BOOLEAN(1),this.addIdnAttribute=m.b.BOOLEAN(1),this.center=m.b.BOOLEAN(0)}}const g=new b;class v extends i.a{constructor(){super(...arguments),this.params_config=g,this.a=new o.a,this.b=new o.a,this.c=new o.a}static type(){return"circle3Points"}initializeNode(){this.io.inputs.setCount(1),this.io.inputs.initInputsClonedState([n.a.NEVER])}cook(t){const e=t[0].points();e.length<3?this.states.error.set(`only ${e.length} points found, when 3 are required`):this._create_circle(e)}_create_circle(t){const e=new p({arc:Object(f.a)(this.pv.arc),center:Object(f.a)(this.pv.center),pointsCountMode:h[this.pv.pointsCountMode],segmentsLength:this.pv.segmentsLength,segmentsCount:this.pv.segmentsCount,full:Object(f.a)(this.pv.full),joinMode:d[this.pv.joinMode],addIdAttribute:Object(f.a)(this.pv.addIdAttribute),addIdnAttribute:Object(f.a)(this.pv.addIdnAttribute)});t[0].getPosition(this.a),t[1].getPosition(this.b),t[2].getPosition(this.c),e.create(this.a,this.b,this.c);const s=[],r=e.created_geometries();r.arc&&s.push(this.create_object(r.arc,a.l.LINE_SEGMENTS)),r.center&&s.push(this.create_object(r.center,a.l.POINTS)),this.setObjects(s)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return p}));var r=s(17),i=s(3),n=s(58),o=s(6),a=s(11),c=s(19);var _=s(15),l=s(37),h=s(289),u=s(10);const d=new i.a(0,0,1);class p extends r.a{constructor(){super(...arguments),this._core_transform=new l.a}static type(){return"circle"}cook(t,e){return Object(u.a)(e.open)?this._create_circle(e):this._create_disk(e)}_create_circle(t){const e=class{static positions(t,e,s=360){const r=n.a.degrees_to_radians(s)/e,i=[];for(let s=0;s<e;s++){const e=r*s,n=t*Math.cos(e),a=t*Math.sin(e);i.push(new o.a(n,a))}return i}static create(t,e,s=360){const r=this.positions(t,e,s),i=[],n=[];let o;for(let t=0;t<r.length;t++)o=r[t],i.push(o.x),i.push(o.y),i.push(0),t>0&&(n.push(t-1),n.push(t));n.push(e-1),n.push(0);const _=new c.a;return _.setAttribute("position",new a.b(i,3)),_.setIndex(n),_}}.create(t.radius,t.segments,t.arcAngle);return this._core_transform.rotate_geometry(e,d,t.direction),this.create_core_group_from_geometry(e,_.l.LINE_SEGMENTS)}_create_disk(t){const e=new h.a(t.radius,t.segments);return this._core_transform.rotate_geometry(e,d,t.direction),this.create_core_group_from_geometry(e)}}p.DEFAULT_PARAMS={radius:1,segments:12,open:!0,arcAngle:360,direction:new i.a(0,1,0)}}]]);
//# sourceMappingURL=vendors~PolyRegister.bundle.fda87c5a7877e101b399.js.map